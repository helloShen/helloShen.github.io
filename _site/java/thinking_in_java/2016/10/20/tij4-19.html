<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Thinking {SHEN}</title>

    <!-- Bootstrap Core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Blog Template CSS -->
    <link href="/assets/css/blog.css" rel="stylesheet">
    <!-- jQuery Version 1.11.1 -->
    <script src="/assets/js/jquery.js"></script>
    <!-- footer bar -->
    <link href="/assets/css/footer.css" rel="stylesheet">
    <!-- code highlight. I also have other options. But this one looks good! -->
    <link href="/assets/css/jekyll-github.css" rel="stylesheet">
    <!-- Sidebar -->
    <!--<link href="/assets/css/sidebar.css" rel="stylesheet">-->


    <!-- Custom CSS -->
    <style>
        body {
            padding-top: 70px;
            /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
        }
        .container {
            width: 80%;
        }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="">Thinking {SHEN}</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/resume/">Resume</a>
                    </li>
                    <li>
                        <a href="/thinkinginjava/">Thinking in Java</a>
                    </li>
                    <li>
                        <a href="#">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Container -->
    <div class="container">

        <!-- Page Title -->
        <div class="text-center">
      <!-- page-header是Bootstrap内置页头组件 -->
      <div class="page-header">
          <h1>[Thinking in Java] Note: Chapter 19 - Enumerated Types</h1>
      </div>
      <h5 class="blog-post-meta">
                <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span> &nbsp
                2016-10-20 08:04:51 -0400
                &nbsp | &nbsp
                <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span> &nbsp
            
                <a href="/categories/Java.html"><span class="label label-primary"><b>Java</b></span></a>
                &nbsp
            
                <a href="/categories/Thinking_in_Java.html"><span class="label label-primary"><b>Thinking_in_Java</b></span></a>
                &nbsp
            
                &nbsp | &nbsp
                <span class="glyphicon glyphicon-comment" aria-hidden="true"></span> &nbsp
                <a href="#disqus_thread "></a>
      </h5>
      <h5 class="blog-post-meta">
          <span class="glyphicon glyphicon-tags" aria-hidden="true"></span> &nbsp
          
              <a href="/tags/Enum.html"><span class="label label-default">Enum</span></a>
              &nbsp
          
              <a href="/tags/Table_Driven.html"><span class="label label-default">Table_Driven</span></a>
              &nbsp
          
      </h5>
</div>


        <!-- Page Content -->
        <h3 id="enum的一些基本性质">Enum的一些基本性质</h3>
<h4 id="枚举型都是javalangenum的派生类">枚举型都是java.lang.Enum的派生类</h4>
<p>Oracle官方手册上对Enum类的定义：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Class</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span>
</code></pre>
</div>
<p>先不管这个自限定结构的意义到底是什么，很明确的一点是：<strong>所有我们定义的枚举型都是Enum类的派生类。</strong> 下面的语句，声明并定义了一个叫Signal的枚举型。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Signal</span> <span class="o">{</span> <span class="n">GREEN</span><span class="o">,</span> <span class="n">YELLOW</span><span class="o">,</span> <span class="n">RED</span><span class="o">,}</span>
</code></pre>
</div>
<p>关于上面的Signal枚举型，记住两个事实：</p>
<ul>
  <li><strong>Signal是一个实实在在的类。</strong></li>
  <li><strong>GREEN,YELLOW,RED是Signal类仅有的三个实例。</strong></li>
</ul>

<h4 id="枚举型可以有自己的成员">枚举型可以有自己的成员</h4>
<p>为什么说枚举型是一个是实实在在的类? <strong>枚举型和普通类一样，可以有自己的字段和方法，甚至是自己的构造方法。</strong></p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Signal</span> <span class="o">{</span>
	<span class="n">GREEN</span><span class="o">,</span> <span class="n">YELLOW</span><span class="o">,</span> <span class="n">RED</span><span class="o">;</span>

	<span class="kd">private</span> <span class="nf">Signal</span><span class="o">(</span><span class="n">String</span> <span class="n">des</span><span class="o">){</span><span class="n">description</span><span class="o">=</span><span class="n">des</span><span class="o">;}</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">(){</span><span class="k">return</span> <span class="n">description</span><span class="o">;}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">()+</span><span class="s">":	"</span><span class="o">+</span><span class="n">description</span><span class="o">;}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>有两个地方需要注意：</p>
<ol>
  <li>最后一个枚举实例后面要用<strong>“分号”</strong>和下面的字段，方法隔开。</li>
  <li>构造函数<strong>不能是public或protected</strong>的。而且只能在枚举型内部被调用。（实际相当于只能是private的）</li>
</ol>

<h4 id="枚举型的实质是单例模式的变种">枚举型的实质是“单例模式”的变种</h4>
<p>Signal的例子中，GREEN,YELLOW,RED的真实身份<strong>是Signal类型的“静态实例”</strong>。</p>

<p>关于Java的Enum型，必须记住Joshua Bloch的一句话：</p>
<ul>
  <li>The basic idea behind Java’s enum types is simple: <strong>they are classes that export one instance for each enumeration constant via a public static final field.</strong>    – Joshua Bloch</li>
</ul>

<p>简单讲就是：<strong>枚举型中的每个枚举都是它的一个静态成员字段。而且无法改变（常量）。</strong></p>

<p>所以枚举型和单例模式本质上非常相似。他们都严格限制自己的对象实例的数量。不太严格地说，单例器其实是枚举型的一个特例：只有单个枚举实例。记住Joshua Bloch的另一句话：</p>
<ul>
  <li><strong>In other words, enum types are instance-controlled. They are a generalization of singletons which are essentially single-element enums.</strong></li>
</ul>

<p>以下代码为枚举型Signal的javap反编译结果：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="n">GREEN</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="n">YELLOW</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="n">RED</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span><span class="o">[]</span> <span class="nf">values</span><span class="o">();</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">);</span>
  <span class="kd">static</span> <span class="o">{};</span>
<span class="o">}</span>
</code></pre>
</div>
<p>已经确定了GREEN,YELLOW,RED三个枚举都是静态常量成员字段。考虑到枚举型的构造函数无法在枚举型外部被使用，所以保证每个枚举是“effective final”。</p>

<p>另外看到编译器擅自生成了另外两个静态方法：values()和valueOf()。这两个是非常常用的用来获取枚举实例的手段：</p>
<ul>
  <li><strong>values():</strong> 返回含有全部内部枚举实例的数组。</li>
  <li><strong>valueOf(String name):</strong> 通过某个枚举实例的String字面量来获取与之对应的枚举实例。</li>
</ul>

<p>注意！因为是编译器自动合成的，所以这两个方法在Enum里是找不到的。</p>

<p>而且代码中明确了enum Signal继承自Enum<Signal>。注意泛型就是Signal自身。所以这也符合最开始Enum的自限定定义：</Signal></p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Class</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span>
</code></pre>
</div>

<p>而且Signal枚举型本身也是被final关键字修饰的，所以它无法被继承。而且由于它继承自Enum<Signal>它也不能再继承其他类。</Signal></p>

<h4 id="枚举类内部还可以定义抽象方法">枚举类内部还可以定义抽象方法</h4>
<p>枚举型内部允许定义抽象方法。如果这样做，这个抽象方法必须在每个枚举中被实现。我们对之前的Signal类做如下改造：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Light</span> <span class="o">{</span>
    <span class="n">GREEN</span><span class="o">{</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(){</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Green"</span><span class="o">);}},</span>
    <span class="n">YELLOW</span><span class="o">{</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(){</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Yellow"</span><span class="o">);}},</span>
    <span class="n">RED</span><span class="o">{</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(){</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Red"</span><span class="o">);}};</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>
<p>再用javap进行反编译，结果如下：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="n">GREEN</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="n">YELLOW</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="n">RED</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span><span class="o">[]</span> <span class="nf">values</span><span class="o">();</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">);</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">();</span>
  <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">,</span> <span class="kt">int</span><span class="o">,</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span><span class="err">$</span><span class="mi">1</span><span class="o">);</span>
  <span class="kd">static</span> <span class="o">{};</span>
<span class="o">}</span>
</code></pre>
</div>
<p>class Signal前多了一个abstract修饰词。注意Signal$1其实代表了一个匿名内部类。</p>

<h4 id="扒光枚举类的全部语法糖">扒光枚举类的全部语法糖</h4>
<p>怎么看都觉得枚举型还是有问题。到底内部是怎么实现的呢？让我们把所有语法糖都扒掉看一下（用dj反编译）。</p>

<p>下面两个反编译的例子来自<a href="http://rejoy.iteye.com/blog/1781964"><strong>《Java语法糖–枚举》</strong></a>。感谢作者：Rajoy。</p>

<p>第一个例子是最朴素的枚举型：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Sex</span> <span class="o">{</span>  
         <span class="n">MALE</span><span class="o">,</span>  
         <span class="n">FEMALE</span>  
<span class="o">}</span>
</code></pre>
</div>

<p>下面是简单javap反编译的结果：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Sex</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="o">{</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">MALE</span><span class="o">;</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">FEMALE</span><span class="o">;</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Sex</span><span class="o">[]</span> <span class="nf">values</span><span class="o">();</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Sex</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">)</span>  
    <span class="kd">static</span> <span class="o">{};</span>  
<span class="o">}</span>
</code></pre>
</div>

<p>下面是用dj深度反编译的结果：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Sex</span> <span class="kd">extends</span> <span class="n">Enum</span>  
<span class="o">{</span>  

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Sex</span><span class="o">[]</span> <span class="nf">values</span><span class="o">()</span>  
    <span class="o">{</span>  
        <span class="k">return</span> <span class="o">(</span><span class="n">Sex</span><span class="o">[])</span><span class="n">$VALUES</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>  
    <span class="o">}</span>  

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Sex</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span>  
    <span class="o">{</span>  
        <span class="k">return</span> <span class="o">(</span><span class="n">Sex</span><span class="o">)</span><span class="n">Enum</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">Sex</span><span class="o">,</span> <span class="n">s</span><span class="o">);</span>  
    <span class="o">}</span>  

    <span class="kd">private</span> <span class="nf">Sex</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span>  
    <span class="o">{</span>  
        <span class="kd">super</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>  
    <span class="o">}</span>  

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">MALE</span><span class="o">;</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">FEMALE</span><span class="o">;</span>  
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">$VALUES</span><span class="o">[];</span>  

    <span class="kd">static</span>  
    <span class="o">{</span>  
        <span class="n">MALE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sex</span><span class="o">(</span><span class="s">"MALE"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>  
        <span class="n">FEMALE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sex</span><span class="o">(</span><span class="s">"FEMALE"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>  
        <span class="n">$VALUES</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="n">Sex</span><span class="o">[]</span> <span class="o">{</span>  
            <span class="n">MALE</span><span class="o">,</span> <span class="n">FEMALE</span>  
        <span class="o">});</span>  
    <span class="o">}</span>  
<span class="o">}</span>  
</code></pre>
</div>
<p>看清楚编译器背着我们做了什么了吗？</p>

<p>MALE,FEMALE枚举确实是静态常量。在最后的静态块里初始化。构造函数默认两个参数：第一个是String字面量，和变量名保持一致。第二个是声明时候的顺序id。Enum自带的ordinal()和compareTo()函数就以这个字段为依据。$VALUES字段还是字面量的数组。</p>

<p>再来一个复杂一点的例子：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Sex</span> <span class="o">{</span>  
         <span class="n">MALE</span> <span class="o">{</span>  
                   <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>  
                            <span class="k">return</span> <span class="s">"我是男人"</span><span class="o">;</span>  
                   <span class="o">}</span>  
         <span class="o">},</span>  
         <span class="n">FEMALE</span> <span class="o">{</span>  
                   <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>  
                            <span class="k">return</span> <span class="s">"我是女人"</span><span class="o">;</span>  
                   <span class="o">}</span>  
         <span class="o">};</span>  
<span class="o">}</span>
</code></pre>
</div>

<p>下面直接是dj反编译的结果：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sex</span> <span class="kd">extends</span> <span class="n">Enum</span>  
<span class="o">{</span>  

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Sex</span><span class="o">[]</span> <span class="nf">values</span><span class="o">()</span>  
    <span class="o">{</span>  
        <span class="k">return</span> <span class="o">(</span><span class="n">Sex</span><span class="o">[])</span><span class="n">$VALUES</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>  
    <span class="o">}</span>  

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Sex</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span>  
    <span class="o">{</span>  
        <span class="k">return</span> <span class="o">(</span><span class="n">Sex</span><span class="o">)</span><span class="n">Enum</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">Sex</span><span class="o">,</span> <span class="n">s</span><span class="o">);</span>  
    <span class="o">}</span>  

    <span class="kd">private</span> <span class="nf">Sex</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span>  
    <span class="o">{</span>  
        <span class="kd">super</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>  
    <span class="o">}</span>  

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span>  
    <span class="o">{</span>  
    <span class="o">}</span>  


    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">MALE</span><span class="o">;</span>  
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">FEMALE</span><span class="o">;</span>  
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Sex</span> <span class="n">$VALUES</span><span class="o">[];</span>  

    <span class="kd">static</span>  
    <span class="o">{</span>  
        <span class="n">MALE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sex</span><span class="o">(</span><span class="s">"MALE"</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>  

            <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span>  
            <span class="o">{</span>  
                <span class="k">return</span> <span class="s">"\u6211\u662F\u7537\u4EBA"</span><span class="o">;</span>  
            <span class="o">}</span>  

        <span class="o">}</span>  
<span class="o">;</span>  
        <span class="n">FEMALE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sex</span><span class="o">(</span><span class="s">"FEMALE"</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>  

            <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span>  
            <span class="o">{</span>  
                <span class="k">return</span> <span class="s">"\u6211\u662F\u5973\u4EBA"</span><span class="o">;</span>  
            <span class="o">}</span>  

        <span class="o">}</span>  
<span class="o">;</span>  
        <span class="n">$VALUES</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="n">Sex</span><span class="o">[]</span> <span class="o">{</span>  
            <span class="n">MALE</span><span class="o">,</span> <span class="n">FEMALE</span>  
        <span class="o">});</span>  
    <span class="o">}</span>  
<span class="o">}</span>
</code></pre>
</div>

<p>这回重写了toString()方法。可以看到在Sex类内部是以匿名内部类的方式重新定义了Sex类的两个新派生类。</p>

<p>同样的，如果我们像之前那样先定义一个抽象方法，然后在枚举实例中实现它们的话，Sex类就会被定义成抽象类，并以匿名内部类的形式继承抽象类并实现抽象方法。</p>

<p>至此，java枚举型的语法糖浮云总算拨云见日。底层的逻辑总算自洽了。之前提到各种枚举型的特性也都都能得到很好的解释。</p>

<h3 id="利用反射获取enum实例">利用反射获取enum实例</h3>
<p>下面是一个给定一个enum型，随机返回它enum实例的工具：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Enums</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">T</span> <span class="nf">random</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">){</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">()[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">().</span><span class="na">length</span><span class="o">)];</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>这里的关键就在于，利用了反射Class#getEnumConstants()方法获取enum实例。这里<code class="highlighter-rouge">&lt;T extends Enum&lt;T&gt;&gt;</code>代表对enum型泛型。</p>

<h3 id="枚举型作为成员字段是静态的">枚举型作为成员字段是“静态的”</h3>
<p>看下面这个简单场景，枚举型Light是A类中的一个成员字段。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">A</span><span class="o">{</span>
	<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Light</span> <span class="o">{</span><span class="n">GREEN</span><span class="o">,</span> <span class="n">YELLOW</span><span class="o">,</span> <span class="n">RED</span><span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>但要访问Light枚举时，必须这么调用：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">A</span><span class="o">.</span><span class="na">Light</span><span class="o">);</span>
</code></pre>
</div>
<p>因为，<strong>在一个类内部的枚举型“隐式”地是静态的</strong>。用static修饰过。所以枚举型永远是静态成员变量。这样的“语法糖”我非常不喜欢。我宁愿光明正大地声明成static。</p>

<h3 id="enumset">EnumSet</h3>
<p>EnumSet的实现很值得一说。作者是Joshua Bloch。首先，EnumSet是抽象类。和大多数类库自带Set一样，它继承自AbstractSet，获得了AbstractSet和AbstractMap的部分功能。</p>

<p>实现它的两个具体类型：一个RegularEnumSet，一个JumboEnumSet。但之所以我们在代码中很少见到直接调用这两个类的构造函数，是因为主要由EnumSet的构造函数负责调用它们。通过noneOf()函数中的如下部分代码，基本可以判断：RegularEnumSet用在枚举规模小于64的情况下。而JamboEnumSet用在大于64的情况下。要做这样的拆分，估计还是出于效率的考虑。毕竟可扩展大小的开销不小。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">noneOf</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">elementType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Enum</span><span class="o">[]</span> <span class="n">universe</span> <span class="o">=</span> <span class="n">getUniverse</span><span class="o">(</span><span class="n">elementType</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">universe</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ClassCastException</span><span class="o">(</span><span class="n">elementType</span> <span class="o">+</span> <span class="s">" not an enum"</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">universe</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="o">)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">RegularEnumSet</span><span class="o">&lt;&gt;(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">JumboEnumSet</span><span class="o">&lt;&gt;(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>和容器内部大多维护的是数组不同，在RegularEnumSet中维护的主力数据结构确实如书中所说是一个<strong>long型</strong>：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">long</span> <span class="n">elements</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>
</code></pre>
</div>
<p>然后看它的add()函数：明显是把long型64 bit中，某个枚举实例的次序属性（ordinal）所对应的位置设为1。用1 bit表示这个枚举实例的存在。所以也确实像书里说的，long型中的每一位，映射到一个具体的枚举实例。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">typeCheck</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>

        <span class="kt">long</span> <span class="n">oldElements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">;</span>
        <span class="n">elements</span> <span class="o">|=</span> <span class="o">(</span><span class="mi">1L</span> <span class="o">&lt;&lt;</span> <span class="o">((</span><span class="n">Enum</span><span class="o">)</span><span class="n">e</span><span class="o">).</span><span class="na">ordinal</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">elements</span> <span class="o">!=</span> <span class="n">oldElements</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>至于JumboEnumSet，其中维护的主力容器是一个long型数组。看看它的构造器：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">JumboEnumSet</span><span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">334349849919042784L</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">long</span> <span class="n">elements</span><span class="o">[];</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="n">JumboEnumSet</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="n">elementType</span><span class="o">,</span> <span class="n">Enum</span><span class="o">[]</span> <span class="n">universe</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[(</span><span class="n">universe</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="mi">63</span><span class="o">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">];</span>
    <span class="o">}</span>
	<span class="c1">//... ...</span>
</code></pre>
</div>
<p>相当于枚举规模对64取模获得的数组长度。</p>

<p>EnumSet的“效率”是值得信赖的。</p>

<h3 id="enummap">EnumMap</h3>
<p>EnumMap和EnumSet类似。但除了Enum型作为Key值，它还可以有一个Value值。因此使用更灵活。这里要推荐一个很实用的<strong>“命令模式”</strong>。</p>

<p>所谓“命令模式”很简单，顾名思义，就是把“命令”当做Key值，然后相应的“行动”当做Value值，存储到EnumMap中。</p>

<p>由于前面说过每个枚举实例都可以重载一遍枚举类中的成员方法。甚至初始的成员方法可以是个抽象方法。前面也展示过，Enum语法糖剥去以后，每个枚举实例都是静态常量。重写成员方法，实际以匿名内部类的方法实现。这里命令模式中代表Value值的“行动”代码也可以用匿名内部类来实现。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Command</span> <span class="o">{</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">();</span> <span class="o">}</span>

<span class="kd">enum</span> <span class="n">AlarmPoints</span> <span class="o">{</span><span class="n">BATHROOM</span><span class="o">,</span><span class="n">KITCHEN</span><span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnumMaps</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">AlarmPoints</span><span class="o">,</span><span class="n">Command</span><span class="o">&gt;</span> <span class="n">em</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">AlarmPoints</span><span class="o">,</span><span class="n">Command</span><span class="o">&gt;(</span><span class="n">AlarmPoints</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

		<span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">KITCHEN</span><span class="o">,</span> <span class="k">new</span> <span class="n">Command</span><span class="o">()</span> <span class="o">{</span>
			<span class="kd">public</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Kitchen fire!"</span><span class="o">);</span> <span class="o">}</span>
		<span class="o">});</span>
		<span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">BATHROOM</span><span class="o">,</span> <span class="k">new</span> <span class="n">Command</span><span class="o">()</span> <span class="o">{</span>
			<span class="kd">public</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span> <span class="n">print</span><span class="o">(</span><span class="s">"Bathroom alert!"</span><span class="o">);</span> <span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>用书上的一个例子。首先定义一个简单Command接口，只有action()一个方法。 我们的枚举类是AlarmPoints。有两个枚举实例：BATHROOM和KITCHEN。他们作为EnumMap的两个键值，对应了两个不同的action()方法。其中action()方法是以匿名内部类的形式被定义的。</p>

<p>每个枚举实例有自己特有的行为方法，是实际开发中非常常见的一种抽象。这种场景下，用EnumMap能使代码很清晰，简洁。</p>

<h3 id="职责链chain-of-responsibility和状态机">职责链（Chain of Responsibility）和状态机</h3>
<p>职责链（Chain of Responsibility）是很常用的一种抽象。它的本质是把一系列的“操作”抽象成解决问题的一系列方法。在遇到问题之后，进行一一尝试，直到问题被解决为止，或者最终被标记为不可解决。</p>

<p>很明显，枚举很适合用来罗列一系列有限的解决方法。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Problem</span><span class="o">{</span>
	<span class="c1">//some code here</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Solution</span><span class="o">{</span>
	<span class="n">METHOD_A</span><span class="o">{</span>
		<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Problem</span> <span class="n">p</span><span class="o">){</span>
			<span class="c1">//do something</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">METHOD_B</span><span class="o">{</span>
		<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Problem</span> <span class="n">p</span><span class="o">){</span>
			<span class="c1">//do something</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">METHOD_C</span><span class="o">{</span>
		<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Problem</span> <span class="n">p</span><span class="o">){</span>
			<span class="c1">//do something</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<p>状态机模拟的场景更复杂一些。但基本思想是不变的，所谓有限状态机，枚举型可以被用来罗列有限的状态。然后同样的，以匿名内部类的形式定义各个状态下的具体操作。而还可以根据一系列枚举的条件，来决定执行什么操作。练习10和练习11中的<strong>“售货机”</strong>模型就是有限状态机最好的例子。</p>

<h3 id="多路分发">多路分发</h3>

<h4 id="问题">问题</h4>
<p><strong>“多路分发（Multiple Dispatching）”</strong>模式源自于多对象交互的场景。比如下面这个算数的例子。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Number</span><span class="o">{</span>
	<span class="kd">public</span> <span class="n">Number</span> <span class="nf">plus</span><span class="o">(</span><span class="n">Number</span> <span class="n">n</span><span class="o">);</span>
	<span class="kd">public</span> <span class="n">Number</span> <span class="nf">multiple</span><span class="o">(</span><span class="n">Number</span> <span class="n">n</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Integer</span> <span class="kd">extends</span> <span class="n">Number</span><span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Real</span> <span class="kd">extends</span> <span class="n">Number</span><span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Rational</span> <span class="kd">extends</span> <span class="n">Number</span><span class="o">{}</span>
</code></pre>
</div>
<p>Number接口面向其他Number定义了加法和乘法。而Number底下有自然数，实数，有理数这样的派生类。所以当我们用两个数做加法或乘法的时候会像下面这样：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Number</span> <span class="n">a</span><span class="o">=</span><span class="k">new</span> <span class="n">Integer</span><span class="o">();</span>
<span class="n">Number</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="n">Real</span><span class="o">();</span>
<span class="n">a</span><span class="o">.</span><span class="na">plus</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
</code></pre>
</div>
<p>但这里的问题是Java只支持单路分发，编译器只能对一个对象实施动态绑定。所以a.plus(b);是无法编译的。</p>

<h4 id="解决方案">解决方案</h4>
<p>解决的方法就是<strong>“两路分发”</strong>。书中举了一个“石头剪刀布”游戏的例子。像下面这样的朴素方式是不行的：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Item</span> <span class="o">{</span>
	<span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">);</span>
	<span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">);</span>
	<span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Paper</span> <span class="kd">implements</span> <span class="n">Item</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">DRAW</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">WIN</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">LOSE</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Scissors</span> <span class="kd">implements</span> <span class="n">Item</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">LOSE</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">DRAW</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">WIN</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Rock</span> <span class="kd">implements</span> <span class="n">Item</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">WIN</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">LOSE</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">DRAW</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>因为我们最终势必会产生<strong>Item.eval(Item it)</strong>这样的代码。这是无法编译的。解决的办法就是创建一个额外的面向Item（以Item型为参数）的方法。当系统动态绑定it对象的运行时类型后，再通过it对象回调this对象。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">Item</span> <span class="o">{</span>
	<span class="n">Outcome</span> <span class="nf">compete</span><span class="o">(</span><span class="n">Item</span> <span class="n">it</span><span class="o">);</span>
	<span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">);</span>
	<span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">);</span>
	<span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Paper</span> <span class="kd">implements</span> <span class="n">Item</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">compete</span><span class="o">(</span><span class="n">Item</span> <span class="n">it</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="k">this</span><span class="o">);</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">DRAW</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">WIN</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">LOSE</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Scissors</span> <span class="kd">implements</span> <span class="n">Item</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">compete</span><span class="o">(</span><span class="n">Item</span> <span class="n">it</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="k">this</span><span class="o">);</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">LOSE</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">DRAW</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">WIN</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Rock</span> <span class="kd">implements</span> <span class="n">Item</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">compete</span><span class="o">(</span><span class="n">Item</span> <span class="n">it</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="na">eval</span><span class="o">(</span><span class="k">this</span><span class="o">);</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Paper</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">WIN</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Scissors</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">LOSE</span><span class="o">;</span> <span class="o">}</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">eval</span><span class="o">(</span><span class="n">Rock</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">DRAW</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="用枚举型多路分发">用枚举型多路分发</h4>
<p>用枚举实现多路分发，完全是另外一个思路：<strong>“写死”</strong>。下面是书里给的例子：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">RoShamBo2</span> <span class="kd">implements</span> <span class="n">Competitor</span><span class="o">&lt;</span><span class="n">RoShamBo2</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="n">PAPER</span><span class="o">(</span><span class="n">DRAW</span><span class="o">,</span> <span class="n">LOSE</span><span class="o">,</span> <span class="n">WIN</span><span class="o">),</span>
	<span class="n">SCISSORS</span><span class="o">(</span><span class="n">WIN</span><span class="o">,</span> <span class="n">DRAW</span><span class="o">,</span> <span class="n">LOSE</span><span class="o">),</span>
	<span class="n">ROCK</span><span class="o">(</span><span class="n">LOSE</span><span class="o">,</span> <span class="n">WIN</span><span class="o">,</span> <span class="n">DRAW</span><span class="o">);</span>
	<span class="kd">private</span> <span class="n">Outcome</span> <span class="n">vPAPER</span><span class="o">,</span> <span class="n">vSCISSORS</span><span class="o">,</span> <span class="n">vROCK</span><span class="o">;</span>
	<span class="n">RoShamBo2</span><span class="o">(</span><span class="n">Outcome</span> <span class="n">paper</span><span class="o">,</span><span class="n">Outcome</span> <span class="n">scissors</span><span class="o">,</span><span class="n">Outcome</span> <span class="n">rock</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">vPAPER</span> <span class="o">=</span> <span class="n">paper</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">vSCISSORS</span> <span class="o">=</span> <span class="n">scissors</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">vROCK</span> <span class="o">=</span> <span class="n">rock</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">compete</span><span class="o">(</span><span class="n">RoShamBo2</span> <span class="n">it</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">switch</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">default</span><span class="o">:</span>
			<span class="k">case</span> <span class="nl">PAPER:</span> <span class="k">return</span> <span class="n">vPAPER</span><span class="o">;</span>
			<span class="k">case</span> <span class="nl">SCISSORS:</span> <span class="k">return</span> <span class="n">vSCISSORS</span><span class="o">;</span>
			<span class="k">case</span> <span class="nl">ROCK:</span> <span class="k">return</span> <span class="n">vROCK</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>“原理”也很简单，用枚举把石头，剪刀，布之间的胜负关系全部写死。实际玩游戏的时候，对参数进行switch。</p>

<h3 id="表驱动编码">表驱动编码</h3>
<p>上面提到的这种“写死”的方法，看上去和呆萌，但在实际工程中很常用。《代码大全》中也有专门的一节描述这个模式，叫做“表驱动（table-driven code）”。</p>

<p>书上也有一个专门的例子。还是石头剪刀布的例子，彻底用一个二维数组把对决结果全都写死：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">enum</span> <span class="n">RoShamBo6</span> <span class="kd">implements</span> <span class="n">Competitor</span><span class="o">&lt;</span><span class="n">RoShamBo6</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="n">PAPER</span><span class="o">,</span> <span class="n">SCISSORS</span><span class="o">,</span> <span class="n">ROCK</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="n">Outcome</span><span class="o">[][]</span> <span class="n">table</span> <span class="o">=</span> <span class="o">{</span>
		<span class="o">{</span> <span class="n">DRAW</span><span class="o">,</span> <span class="n">LOSE</span><span class="o">,</span> <span class="n">WIN</span> <span class="o">},</span> <span class="c1">// PAPER</span>
		<span class="o">{</span> <span class="n">WIN</span><span class="o">,</span> <span class="n">DRAW</span><span class="o">,</span> <span class="n">LOSE</span> <span class="o">},</span> <span class="c1">// SCISSORS</span>
		<span class="o">{</span> <span class="n">LOSE</span><span class="o">,</span> <span class="n">WIN</span><span class="o">,</span> <span class="n">DRAW</span> <span class="o">},</span> <span class="c1">// ROCK</span>
	<span class="o">};</span>
	<span class="kd">public</span> <span class="n">Outcome</span> <span class="nf">compete</span><span class="o">(</span><span class="n">RoShamBo6</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">table</span><span class="o">[</span><span class="k">this</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()][</span><span class="n">other</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()];</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="练习">练习</h3>

<h4 id="本章练习常用工具包">本章练习常用工具包</h4>

<h5 id="枚举随机器">枚举随机器</h5>
<p>Enums.Random()</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Enums</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">T</span> <span class="nf">random</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">){</span>
        <span class="k">return</span> <span class="nf">random</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">random</span><span class="o">(</span><span class="n">T</span><span class="o">[]</span> <span class="n">values</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">values</span><span class="o">.</span><span class="na">length</span><span class="o">)];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="c1">//System.out.println(random(CartoonCharacter2.class));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-1">Exercise 1</h4>
<ul>
  <li><strong>Exercise 1</strong>: (2) Use a static import to modify TrafficLight.java so you don’t have to qualify the enum instances.</li>
</ul>

<p>除了完成题目，还练习了最基本的Enum型的创建，构造。</p>

<h5 id="signaljava">Signal.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Signal</span> <span class="o">{</span>
    <span class="n">GREEN</span><span class="o">(</span><span class="s">"You can pass!"</span><span class="o">),</span>
    <span class="n">YELLOW</span><span class="o">(</span><span class="s">"Red light coming soon!"</span><span class="o">),</span>
    <span class="n">RED</span><span class="o">(</span><span class="s">"You must stop!"</span><span class="o">);</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nf">Signal</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">description</span><span class="o">=</span><span class="n">s</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">(){</span><span class="k">return</span> <span class="n">description</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span>
        <span class="n">String</span> <span class="n">id</span><span class="o">=</span><span class="n">name</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="trafficlightjava">TrafficLight.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Signal</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TrafficLight</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Signal</span> <span class="n">color</span><span class="o">=</span><span class="n">RED</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">change</span><span class="o">(){</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">color</span><span class="o">){</span>
            <span class="k">case</span> <span class="nl">RED:</span>
                <span class="n">color</span><span class="o">=</span><span class="n">GREEN</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">YELLOW:</span>
                <span class="n">color</span><span class="o">=</span><span class="n">RED</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">GREEN:</span>
                <span class="n">color</span><span class="o">=</span><span class="n">YELLOW</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">look</span><span class="o">(){</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">color</span><span class="o">);}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Signal</span> <span class="nl">s:</span><span class="n">values</span><span class="o">()){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">+</span><span class="s">": "</span><span class="o">+</span><span class="n">s</span><span class="o">.</span><span class="na">getDescription</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">change</span><span class="o">();</span>
            <span class="n">look</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise1java">Exercise1.java</h5>
<div class="highlighter-rouge"><pre class="highlight"><code>package com.ciaoshen.thinkinjava.chapter19;
import java.util.*;
import static com.ciaoshen.thinkinjava.chapter19.Signal.*;
import static com.ciaoshen.thinkinjava.chapter19.TrafficLight.*;

public class Exercise1{
    public static void main(String[] args){
        for(Signal s:values()){
            System.out.println(s+": "+s.getDescription());
        }
        for(int i=0;i&lt;10;i++){
            change();
            look();
        }
    }
}
</code></pre>
</div>

<h4 id="exercise-2">Exercise 2</h4>
<ul>
  <li><strong>Exercise 2</strong>: (2) Instead of implementing an interface, make next( ) a static method. What are the benefits and drawbacks of this approach?</li>
</ul>

<p>用next()不用创建实例，用起来更方便了。缺点是面向Generator接口的方法要受到影响。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">enum</span> <span class="n">CartoonCharacter</span><span class="o">{</span>
    <span class="n">SLAPPY</span><span class="o">,</span> <span class="n">SPANKY</span><span class="o">,</span> <span class="n">PUNCHY</span><span class="o">,</span> <span class="n">SILLY</span><span class="o">,</span> <span class="n">BOUNCY</span><span class="o">,</span> <span class="n">NUTTY</span><span class="o">,</span> <span class="n">BOB</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">CartoonCharacter</span> <span class="nf">next</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">values</span><span class="o">()[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">values</span><span class="o">().</span><span class="na">length</span><span class="o">)];</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise2</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">CartoonCharacter</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-3">Exercise 3</h4>
<ul>
  <li><strong>Exercise 3</strong>: (1) Add a new Course to Course.java and demonstrate that it works in Meal.java.</li>
</ul>

<h5 id="foodjava">Food.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Food</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="n">Appetizer</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
        <span class="n">SALAD</span><span class="o">,</span> <span class="n">SOUP</span><span class="o">,</span> <span class="n">SPRING_ROLLS</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">enum</span> <span class="n">MainCourse</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
        <span class="n">LASAGNE</span><span class="o">,</span> <span class="n">BURRITO</span><span class="o">,</span> <span class="n">PAD_THAI</span><span class="o">,</span>
        <span class="n">LENTILS</span><span class="o">,</span> <span class="n">HUMMOUS</span><span class="o">,</span> <span class="n">VINDALOO</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Dessert</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
        <span class="n">TIRAMISU</span><span class="o">,</span> <span class="n">GELATO</span><span class="o">,</span> <span class="n">BLACK_FOREST_CAKE</span><span class="o">,</span>
        <span class="n">FRUIT</span><span class="o">,</span> <span class="n">CREME_CARAMEL</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Coffee</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
        <span class="n">BLACK_COFFEE</span><span class="o">,</span> <span class="n">DECAF_COFFEE</span><span class="o">,</span> <span class="n">ESPRESSO</span><span class="o">,</span>
        <span class="n">LATTE</span><span class="o">,</span> <span class="n">CAPPUCCINO</span><span class="o">,</span> <span class="n">TEA</span><span class="o">,</span> <span class="n">HERB_TEA</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Drink</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
        <span class="n">COKECOLA</span><span class="o">,</span> <span class="n">APPLE_JUICE</span><span class="o">,</span> <span class="n">ORINGE_JUICE</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="coursejava">Course.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Course</span> <span class="o">{</span>
    <span class="n">APPETIZER</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Appetizer</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">MAINCOURSE</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">MainCourse</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">DESSERT</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Dessert</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">COFFEE</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Coffee</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">DRINK</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Drink</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="n">Food</span><span class="o">[]</span> <span class="n">values</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nf">Course</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Food</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">kind</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Food</span> <span class="nf">randomSelection</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">values</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise3java">Exercise3.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise3</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Course</span> <span class="n">course</span> <span class="o">:</span> <span class="n">Course</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">Food</span> <span class="n">food</span> <span class="o">=</span> <span class="n">course</span><span class="o">.</span><span class="na">randomSelection</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">food</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-4">Exercise 4</h4>
<ul>
  <li><strong>Exercise 4</strong>: (1) Repeat the above exercise for Meal2.java.</li>
</ul>

<h5 id="meal2java">Meal2.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Meal2</span> <span class="o">{</span>
    <span class="n">APPETIZER</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Appetizer</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">MAINCOURSE</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">MainCourse</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">DESSERT</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Dessert</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">COFFEE</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Coffee</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">DRINK</span><span class="o">(</span><span class="n">Food</span><span class="o">.</span><span class="na">Drink</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="n">Food</span><span class="o">[]</span> <span class="n">values</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nf">Meal2</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Food</span><span class="o">&gt;</span> <span class="n">kind</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">kind</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Food</span> <span class="o">{</span>
        <span class="kd">enum</span> <span class="n">Appetizer</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
            <span class="n">SALAD</span><span class="o">,</span> <span class="n">SOUP</span><span class="o">,</span> <span class="n">SPRING_ROLLS</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">enum</span> <span class="n">MainCourse</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
            <span class="n">LASAGNE</span><span class="o">,</span> <span class="n">BURRITO</span><span class="o">,</span> <span class="n">PAD_THAI</span><span class="o">,</span>
            <span class="n">LENTILS</span><span class="o">,</span> <span class="n">HUMMOUS</span><span class="o">,</span> <span class="n">VINDALOO</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">enum</span> <span class="n">Dessert</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
            <span class="n">TIRAMISU</span><span class="o">,</span> <span class="n">GELATO</span><span class="o">,</span> <span class="n">BLACK_FOREST_CAKE</span><span class="o">,</span>
            <span class="n">FRUIT</span><span class="o">,</span> <span class="n">CREME_CARAMEL</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">enum</span> <span class="n">Coffee</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
            <span class="n">BLACK_COFFEE</span><span class="o">,</span> <span class="n">DECAF_COFFEE</span><span class="o">,</span> <span class="n">ESPRESSO</span><span class="o">,</span>
            <span class="n">LATTE</span><span class="o">,</span> <span class="n">CAPPUCCINO</span><span class="o">,</span> <span class="n">TEA</span><span class="o">,</span> <span class="n">HERB_TEA</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">enum</span> <span class="n">Drink</span> <span class="kd">implements</span> <span class="n">Food</span> <span class="o">{</span>
            <span class="n">COKECOLA</span><span class="o">,</span> <span class="n">APPLE_JUICE</span><span class="o">,</span> <span class="n">ORINGE_JUICE</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Food</span> <span class="nf">randomSelection</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">values</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise4java">Exercise4.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise4</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Meal2</span> <span class="n">meal</span> <span class="o">:</span> <span class="n">Meal2</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">Meal2</span><span class="o">.</span><span class="na">Food</span> <span class="n">food</span> <span class="o">=</span> <span class="n">meal</span><span class="o">.</span><span class="na">randomSelection</span><span class="o">();</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">food</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-5">Exercise 5</h4>
<ul>
  <li><strong>Exercise 5</strong>: (4) Modify control/VowelsAndConsonants.java so that it uses three enum types: VOWEL, SOMETIMES_A_VOWEL, and CONSONANT. The enum constructor should take the various letters that describe that particular category. Hint: Use varargs, and remember that varargs automatically creates an array for you.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Exercise5</span> <span class="o">{</span>

    <span class="n">VOWEL</span><span class="o">(</span><span class="s">"aeiou"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">""</span><span class="o">)),</span>
    <span class="n">SOMETIMES_A_VOWEL</span><span class="o">(</span><span class="s">"y"</span><span class="o">,</span><span class="s">"w"</span><span class="o">),</span>
    <span class="n">CONSONANT</span><span class="o">(</span><span class="s">"bcdfghjklmnpqrstvxz"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">""</span><span class="o">));</span>

    <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">members</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nf">Exercise5</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">letters</span><span class="o">){</span>
        <span class="n">members</span><span class="o">=</span><span class="n">letters</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getMembers</span><span class="o">(){</span><span class="k">return</span> <span class="n">members</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">vo</span><span class="o">=</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">VOWEL</span><span class="o">.</span><span class="na">getMembers</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">some</span><span class="o">=</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">SOMETIMES_A_VOWEL</span><span class="o">.</span><span class="na">getMembers</span><span class="o">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">con</span><span class="o">=</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">CONSONANT</span><span class="o">.</span><span class="na">getMembers</span><span class="o">());</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">ic</span><span class="o">=</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">26</span><span class="o">)</span> <span class="o">+</span> <span class="sc">'a'</span><span class="o">;</span>
            <span class="n">String</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="k">new</span> <span class="kt">char</span><span class="o">[]{(</span><span class="kt">char</span><span class="o">)</span><span class="n">ic</span><span class="o">});</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sc</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">ic</span> <span class="o">+</span> <span class="s">": "</span><span class="o">+(</span><span class="n">vo</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">sc</span><span class="o">)?</span> <span class="s">"Vowel"</span><span class="o">:</span><span class="s">""</span><span class="o">)+(</span><span class="n">some</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">sc</span><span class="o">)?</span> <span class="s">"Sometime a Vowel"</span><span class="o">:</span><span class="s">""</span><span class="o">)+(</span><span class="n">con</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">sc</span><span class="o">)?</span> <span class="s">"Consonants"</span><span class="o">:</span><span class="s">""</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-6">Exercise 6</h4>
<ul>
  <li><strong>Exercise 6</strong>: (3) Is there any special benefit in nesting Appetizer, MainCourse, Dessert, and Coffee inside Food rather than making them standalone enums that just happen to implement Food?
我的理解是只要枚举实现了某个接口，都能实现面向这个接口的编程，以及利用反射构造一个模拟套嵌结构（由于枚举无法构造套嵌类的结构）。但如果把枚举放在接口内部，可以有更少的java源文件，封装好一些。如果把接口也放在某个枚举类内部，这样模拟两层套嵌枚举（书里说的“枚举的枚举”）的时候代码更清晰，容易阅读。 下面是根据练习5的字母的枚举的枚举的实现：</li>
</ul>

<h5 id="lettersjava">Letters.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Letters</span> <span class="o">{</span>

    <span class="n">VOWEL</span><span class="o">(</span><span class="n">Letter</span><span class="o">.</span><span class="na">Vowel</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">SOMETIMES_A_VOWEL</span><span class="o">(</span><span class="n">Letter</span><span class="o">.</span><span class="na">SometimesAVowel</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">CONSONANT</span><span class="o">(</span><span class="n">Letter</span><span class="o">.</span><span class="na">Consonant</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="n">Letter</span><span class="o">[]</span> <span class="n">values</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nf">Letters</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Letter</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">){</span>
        <span class="n">values</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Letter</span><span class="o">[]</span> <span class="nf">getValues</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Letter</span><span class="o">{</span>
        <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Vowel</span> <span class="kd">implements</span> <span class="n">Letter</span><span class="o">{</span>
            <span class="n">A</span><span class="o">(</span><span class="sc">'a'</span><span class="o">),</span><span class="n">E</span><span class="o">(</span><span class="sc">'e'</span><span class="o">),</span><span class="n">I</span><span class="o">(</span><span class="sc">'i'</span><span class="o">),</span><span class="n">O</span><span class="o">(</span><span class="sc">'o'</span><span class="o">),</span><span class="n">U</span><span class="o">(</span><span class="sc">'u'</span><span class="o">);</span>
            <span class="kd">private</span> <span class="kt">char</span> <span class="n">name</span><span class="o">;</span>
            <span class="kd">private</span> <span class="nf">Vowel</span><span class="o">(</span><span class="kt">char</span> <span class="n">n</span><span class="o">){</span><span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">;}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="k">new</span> <span class="kt">char</span><span class="o">[]{</span><span class="n">name</span><span class="o">});}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">enum</span> <span class="n">SometimesAVowel</span> <span class="kd">implements</span> <span class="n">Letter</span><span class="o">{</span>
            <span class="n">Y</span><span class="o">(</span><span class="sc">'y'</span><span class="o">),</span><span class="n">W</span><span class="o">(</span><span class="sc">'w'</span><span class="o">);</span>
            <span class="kd">private</span> <span class="kt">char</span> <span class="n">name</span><span class="o">;</span>
            <span class="kd">private</span> <span class="nf">SometimesAVowel</span><span class="o">(</span><span class="kt">char</span> <span class="n">n</span><span class="o">){</span><span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">;}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="k">new</span> <span class="kt">char</span><span class="o">[]{</span><span class="n">name</span><span class="o">});}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Consonant</span> <span class="kd">implements</span> <span class="n">Letter</span><span class="o">{</span>
            <span class="n">B</span><span class="o">(</span><span class="sc">'b'</span><span class="o">),</span><span class="n">C</span><span class="o">(</span><span class="sc">'c'</span><span class="o">),</span><span class="n">D</span><span class="o">(</span><span class="sc">'d'</span><span class="o">),</span><span class="n">F</span><span class="o">(</span><span class="sc">'f'</span><span class="o">),</span><span class="n">G</span><span class="o">(</span><span class="sc">'g'</span><span class="o">),</span><span class="n">H</span><span class="o">(</span><span class="sc">'h'</span><span class="o">),</span><span class="n">J</span><span class="o">(</span><span class="sc">'j'</span><span class="o">),</span><span class="n">K</span><span class="o">(</span><span class="sc">'k'</span><span class="o">),</span><span class="n">L</span><span class="o">(</span><span class="sc">'l'</span><span class="o">),</span><span class="n">M</span><span class="o">(</span><span class="sc">'m'</span><span class="o">),</span><span class="n">N</span><span class="o">(</span><span class="sc">'n'</span><span class="o">),</span><span class="n">P</span><span class="o">(</span><span class="sc">'p'</span><span class="o">),</span><span class="n">Q</span><span class="o">(</span><span class="sc">'q'</span><span class="o">),</span><span class="n">R</span><span class="o">(</span><span class="sc">'r'</span><span class="o">),</span><span class="n">S</span><span class="o">(</span><span class="sc">'s'</span><span class="o">),</span><span class="n">T</span><span class="o">(</span><span class="sc">'t'</span><span class="o">),</span><span class="n">V</span><span class="o">(</span><span class="sc">'v'</span><span class="o">),</span><span class="n">X</span><span class="o">(</span><span class="sc">'x'</span><span class="o">),</span><span class="n">Z</span><span class="o">(</span><span class="sc">'z'</span><span class="o">);</span>
            <span class="kd">private</span> <span class="kt">char</span> <span class="n">name</span><span class="o">;</span>
            <span class="kd">private</span> <span class="nf">Consonant</span><span class="o">(</span><span class="kt">char</span> <span class="n">n</span><span class="o">){</span><span class="n">name</span><span class="o">=</span><span class="n">n</span><span class="o">;}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="k">new</span> <span class="kt">char</span><span class="o">[]{</span><span class="n">name</span><span class="o">});}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise6java">Exercise6.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise6</span> <span class="kd">implements</span> <span class="n">Letters</span><span class="o">.</span><span class="na">Letter</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">j</span><span class="o">++){</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span><span class="o">=</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">Letters</span> <span class="n">ls</span><span class="o">=</span><span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Letters</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="n">Letter</span> <span class="n">l</span><span class="o">=</span><span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">ls</span><span class="o">.</span><span class="na">getValues</span><span class="o">());</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sb</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-7">Exercise 7</h4>
<ul>
  <li><strong>Exercise 7</strong>: (3) Find the source code for EnumSet and explain how it works.</li>
</ul>

<p>以下代码为J2SE的numSet源码。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">sun.misc.SharedSecrets</span><span class="o">;</span>

<span class="cm">/**
 * A specialized {@link Set} implementation for use with enum types.  All of
 * the elements in an enum set must come from a single enum type that is
 * specified, explicitly or implicitly, when the set is created.  Enum sets
 * are represented internally as bit vectors.  This representation is
 * extremely compact and efficient. The space and time performance of this
 * class should be good enough to allow its use as a high-quality, typesafe
 * alternative to traditional &lt;tt&gt;int&lt;/tt&gt;-based "bit flags."  Even bulk
 * operations (such as &lt;tt&gt;containsAll&lt;/tt&gt; and &lt;tt&gt;retainAll&lt;/tt&gt;) should
 * run very quickly if their argument is also an enum set.
 *
 * &lt;p&gt;The iterator returned by the &lt;tt&gt;iterator&lt;/tt&gt; method traverses the
 * elements in their &lt;i&gt;natural order&lt;/i&gt; (the order in which the enum
 * constants are declared).  The returned iterator is &lt;i&gt;weakly
 * consistent&lt;/i&gt;: it will never throw {@link ConcurrentModificationException}
 * and it may or may not show the effects of any modifications to the set that
 * occur while the iteration is in progress.
 *
 * &lt;p&gt;Null elements are not permitted.  Attempts to insert a null element
 * will throw {@link NullPointerException}.  Attempts to test for the
 * presence of a null element or to remove one will, however, function
 * properly.
 *
 * &lt;P&gt;Like most collection implementations, &lt;tt&gt;EnumSet&lt;/tt&gt; is not
 * synchronized.  If multiple threads access an enum set concurrently, and at
 * least one of the threads modifies the set, it should be synchronized
 * externally.  This is typically accomplished by synchronizing on some
 * object that naturally encapsulates the enum set.  If no such object exists,
 * the set should be "wrapped" using the {@link Collections#synchronizedSet}
 * method.  This is best done at creation time, to prevent accidental
 * unsynchronized access:
 *
 * &lt;pre&gt;
 * Set&amp;lt;MyEnum&amp;gt; s = Collections.synchronizedSet(EnumSet.noneOf(MyEnum.class));
 * &lt;/pre&gt;
 *
 * &lt;p&gt;Implementation note: All basic operations execute in constant time.
 * They are likely (though not guaranteed) to be much faster than their
 * {@link HashSet} counterparts.  Even bulk operations execute in
 * constant time if their argument is also an enum set.
 *
 * &lt;p&gt;This class is a member of the
 * &lt;a href="{@docRoot}/../technotes/guides/collections/index.html"&gt;
 * Java Collections Framework&lt;/a&gt;.
 *
 * @author Josh Bloch
 * @since 1.5
 * @see EnumMap
 * @serial exclude
 */</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">EnumSet</span><span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span>
    <span class="kd">implements</span> <span class="n">Cloneable</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span>
<span class="o">{</span>
    <span class="cm">/**
     * The class of all the elements of this set.
     */</span>
    <span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">elementType</span><span class="o">;</span>

    <span class="cm">/**
     * All of the values comprising T.  (Cached for performance.)
     */</span>
    <span class="kd">final</span> <span class="n">Enum</span><span class="o">[]</span> <span class="n">universe</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Enum</span><span class="o">[]</span> <span class="n">ZERO_LENGTH_ENUM_ARRAY</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Enum</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>

    <span class="n">EnumSet</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="n">elementType</span><span class="o">,</span> <span class="n">Enum</span><span class="o">[]</span> <span class="n">universe</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">elementType</span> <span class="o">=</span> <span class="n">elementType</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">universe</span>    <span class="o">=</span> <span class="n">universe</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an empty enum set with the specified element type.
     *
     * @param elementType the class object of the element type for this enum
     *     set
     * @throws NullPointerException if &lt;tt&gt;elementType&lt;/tt&gt; is null
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">noneOf</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">elementType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Enum</span><span class="o">[]</span> <span class="n">universe</span> <span class="o">=</span> <span class="n">getUniverse</span><span class="o">(</span><span class="n">elementType</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">universe</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ClassCastException</span><span class="o">(</span><span class="n">elementType</span> <span class="o">+</span> <span class="s">" not an enum"</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">universe</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="o">)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">RegularEnumSet</span><span class="o">&lt;&gt;(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">JumboEnumSet</span><span class="o">&lt;&gt;(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set containing all of the elements in the specified
     * element type.
     *
     * @param elementType the class object of the element type for this enum
     *     set
     * @throws NullPointerException if &lt;tt&gt;elementType&lt;/tt&gt; is null
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">allOf</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">elementType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">elementType</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">addAll</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Adds all of the elements from the appropriate enum type to this enum
     * set, which is empty prior to the call.
     */</span>
    <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">addAll</span><span class="o">();</span>

    <span class="cm">/**
     * Creates an enum set with the same element type as the specified enum
     * set, initially containing the same elements (if any).
     *
     * @param s the enum set from which to initialize this enum set
     * @throws NullPointerException if &lt;tt&gt;s&lt;/tt&gt; is null
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">copyOf</span><span class="o">(</span><span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initialized from the specified collection.  If
     * the specified collection is an &lt;tt&gt;EnumSet&lt;/tt&gt; instance, this static
     * factory method behaves identically to {@link #copyOf(EnumSet)}.
     * Otherwise, the specified collection must contain at least one element
     * (in order to determine the new enum set's element type).
     *
     * @param c the collection from which to initialize this enum set
     * @throws IllegalArgumentException if &lt;tt&gt;c&lt;/tt&gt; is not an
     *     &lt;tt&gt;EnumSet&lt;/tt&gt; instance and contains no elements
     * @throws NullPointerException if &lt;tt&gt;c&lt;/tt&gt; is null
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">copyOf</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="k">instanceof</span> <span class="n">EnumSet</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">((</span><span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;)</span><span class="n">c</span><span class="o">).</span><span class="na">clone</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Collection is empty"</span><span class="o">);</span>
            <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
            <span class="n">E</span> <span class="n">first</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">EnumSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">first</span><span class="o">);</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span>
                <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set with the same element type as the specified enum
     * set, initially containing all the elements of this type that are
     * &lt;i&gt;not&lt;/i&gt; contained in the specified set.
     *
     * @param s the enum set from whose complement to initialize this enum set
     * @throws NullPointerException if &lt;tt&gt;s&lt;/tt&gt; is null
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">complementOf</span><span class="o">(</span><span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">copyOf</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">complement</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initially containing the specified element.
     *
     * Overloadings of this method exist to initialize an enum set with
     * one through five elements.  A sixth overloading is provided that
     * uses the varargs feature.  This overloading may be used to create
     * an enum set initially containing an arbitrary number of elements, but
     * is likely to run slower than the overloadings that do not use varargs.
     *
     * @param e the element that this set is to contain initially
     * @throws NullPointerException if &lt;tt&gt;e&lt;/tt&gt; is null
     * @return an enum set initially containing the specified element
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initially containing the specified elements.
     *
     * Overloadings of this method exist to initialize an enum set with
     * one through five elements.  A sixth overloading is provided that
     * uses the varargs feature.  This overloading may be used to create
     * an enum set initially containing an arbitrary number of elements, but
     * is likely to run slower than the overloadings that do not use varargs.
     *
     * @param e1 an element that this set is to contain initially
     * @param e2 another element that this set is to contain initially
     * @throws NullPointerException if any parameters are null
     * @return an enum set initially containing the specified elements
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="n">E</span> <span class="n">e1</span><span class="o">,</span> <span class="n">E</span> <span class="n">e2</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">e1</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e1</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e2</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initially containing the specified elements.
     *
     * Overloadings of this method exist to initialize an enum set with
     * one through five elements.  A sixth overloading is provided that
     * uses the varargs feature.  This overloading may be used to create
     * an enum set initially containing an arbitrary number of elements, but
     * is likely to run slower than the overloadings that do not use varargs.
     *
     * @param e1 an element that this set is to contain initially
     * @param e2 another element that this set is to contain initially
     * @param e3 another element that this set is to contain initially
     * @throws NullPointerException if any parameters are null
     * @return an enum set initially containing the specified elements
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="n">E</span> <span class="n">e1</span><span class="o">,</span> <span class="n">E</span> <span class="n">e2</span><span class="o">,</span> <span class="n">E</span> <span class="n">e3</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">e1</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e1</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e2</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e3</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initially containing the specified elements.
     *
     * Overloadings of this method exist to initialize an enum set with
     * one through five elements.  A sixth overloading is provided that
     * uses the varargs feature.  This overloading may be used to create
     * an enum set initially containing an arbitrary number of elements, but
     * is likely to run slower than the overloadings that do not use varargs.
     *
     * @param e1 an element that this set is to contain initially
     * @param e2 another element that this set is to contain initially
     * @param e3 another element that this set is to contain initially
     * @param e4 another element that this set is to contain initially
     * @throws NullPointerException if any parameters are null
     * @return an enum set initially containing the specified elements
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="n">E</span> <span class="n">e1</span><span class="o">,</span> <span class="n">E</span> <span class="n">e2</span><span class="o">,</span> <span class="n">E</span> <span class="n">e3</span><span class="o">,</span> <span class="n">E</span> <span class="n">e4</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">e1</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e1</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e2</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e3</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e4</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initially containing the specified elements.
     *
     * Overloadings of this method exist to initialize an enum set with
     * one through five elements.  A sixth overloading is provided that
     * uses the varargs feature.  This overloading may be used to create
     * an enum set initially containing an arbitrary number of elements, but
     * is likely to run slower than the overloadings that do not use varargs.
     *
     * @param e1 an element that this set is to contain initially
     * @param e2 another element that this set is to contain initially
     * @param e3 another element that this set is to contain initially
     * @param e4 another element that this set is to contain initially
     * @param e5 another element that this set is to contain initially
     * @throws NullPointerException if any parameters are null
     * @return an enum set initially containing the specified elements
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="n">E</span> <span class="n">e1</span><span class="o">,</span> <span class="n">E</span> <span class="n">e2</span><span class="o">,</span> <span class="n">E</span> <span class="n">e3</span><span class="o">,</span> <span class="n">E</span> <span class="n">e4</span><span class="o">,</span>
                                                    <span class="n">E</span> <span class="n">e5</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">e1</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e1</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e2</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e3</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e4</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e5</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initially containing the specified elements.
     * This factory, whose parameter list uses the varargs feature, may
     * be used to create an enum set initially containing an arbitrary
     * number of elements, but it is likely to run slower than the overloadings
     * that do not use varargs.
     *
     * @param first an element that the set is to contain initially
     * @param rest the remaining elements the set is to contain initially
     * @throws NullPointerException if any of the specified elements are null,
     *     or if &lt;tt&gt;rest&lt;/tt&gt; is null
     * @return an enum set initially containing the specified elements
     */</span>
    <span class="nd">@SafeVarargs</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">of</span><span class="o">(</span><span class="n">E</span> <span class="n">first</span><span class="o">,</span> <span class="n">E</span><span class="o">...</span> <span class="n">rest</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">first</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">E</span> <span class="n">e</span> <span class="o">:</span> <span class="n">rest</span><span class="o">)</span>
            <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Creates an enum set initially containing all of the elements in the
     * range defined by the two specified endpoints.  The returned set will
     * contain the endpoints themselves, which may be identical but must not
     * be out of order.
     *
     * @param from the first element in the range
     * @param to the last element in the range
     * @throws NullPointerException if {@code from} or {@code to} are null
     * @throws IllegalArgumentException if {@code from.compareTo(to) &gt; 0}
     * @return an enum set initially containing all of the elements in the
     *         range defined by the two specified endpoints
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">range</span><span class="o">(</span><span class="n">E</span> <span class="n">from</span><span class="o">,</span> <span class="n">E</span> <span class="n">to</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">from</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">to</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">from</span> <span class="o">+</span> <span class="s">" &gt; "</span> <span class="o">+</span> <span class="n">to</span><span class="o">);</span>
        <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">noneOf</span><span class="o">(</span><span class="n">from</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">());</span>
        <span class="n">result</span><span class="o">.</span><span class="na">addRange</span><span class="o">(</span><span class="n">from</span><span class="o">,</span> <span class="n">to</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Adds the specified range to this enum set, which is empty prior
     * to the call.
     */</span>
    <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">addRange</span><span class="o">(</span><span class="n">E</span> <span class="n">from</span><span class="o">,</span> <span class="n">E</span> <span class="n">to</span><span class="o">);</span>

    <span class="cm">/**
     * Returns a copy of this set.
     *
     * @return a copy of this set
     */</span>
    <span class="kd">public</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;)</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">CloneNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AssertionError</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Complements the contents of this enum set.
     */</span>
    <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">complement</span><span class="o">();</span>

    <span class="cm">/**
     * Throws an exception if e is not of the correct type for this enum set.
     */</span>
    <span class="kd">final</span> <span class="kt">void</span> <span class="nf">typeCheck</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Class</span> <span class="n">eClass</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">eClass</span> <span class="o">!=</span> <span class="n">elementType</span> <span class="o">&amp;&amp;</span> <span class="n">eClass</span><span class="o">.</span><span class="na">getSuperclass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">elementType</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ClassCastException</span><span class="o">(</span><span class="n">eClass</span> <span class="o">+</span> <span class="s">" != "</span> <span class="o">+</span> <span class="n">elementType</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Returns all of the values comprising E.
     * The result is uncloned, cached, and shared by all callers.
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">E</span><span class="o">[]</span> <span class="nf">getUniverse</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">elementType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">SharedSecrets</span><span class="o">.</span><span class="na">getJavaLangAccess</span><span class="o">()</span>
                                        <span class="o">.</span><span class="na">getEnumConstantsShared</span><span class="o">(</span><span class="n">elementType</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * This class is used to serialize all EnumSet instances, regardless of
     * implementation type.  It captures their "logical contents" and they
     * are reconstructed using public static factories.  This is necessary
     * to ensure that the existence of a particular implementation type is
     * an implementation detail.
     *
     * @serial include
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SerializationProxy</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span>
        <span class="kd">implements</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span>
    <span class="o">{</span>
        <span class="cm">/**
         * The element type of this enum set.
         *
         * @serial
         */</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">elementType</span><span class="o">;</span>

        <span class="cm">/**
         * The elements contained in this enum set.
         *
         * @serial
         */</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Enum</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>

        <span class="n">SerializationProxy</span><span class="o">(</span><span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">elementType</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">elementType</span><span class="o">;</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="n">ZERO_LENGTH_ENUM_ARRAY</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="n">Object</span> <span class="nf">readResolve</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">EnumSet</span><span class="o">.</span><span class="na">noneOf</span><span class="o">(</span><span class="n">elementType</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Enum</span> <span class="n">e</span> <span class="o">:</span> <span class="n">elements</span><span class="o">)</span>
                <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">((</span><span class="n">E</span><span class="o">)</span><span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">362491234563181265L</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="n">Object</span> <span class="nf">writeReplace</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">SerializationProxy</span><span class="o">&lt;&gt;(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// readObject method for the serialization proxy pattern</span>
    <span class="c1">// See Effective Java, Second Ed., Item 78.</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">ObjectInputStream</span> <span class="n">stream</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">InvalidObjectException</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">InvalidObjectException</span><span class="o">(</span><span class="s">"Proxy required"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>首先，EnumSet是抽象类。和大多数类库自带Set一样，它继承自AbstractSet，获得了AbstractSet和AbstractMap的部分功能。</p>

<p>然后，至少我见到了有两个类是继承EnumSet的：一个RegularEnumSet，一个JumboEnumSet。但之所以我们在代码中很少见到直接调用这两个类的构造函数，是因为EnumSet的构造函数承担了根据枚举规模选择调用它们其中的哪一个构造函数。通过noneOf()函数中的如下部分代码，基本可以判断：RegularEnumSet用在枚举规模小于64的情况下。而JamboEnumSet用在大于64的情况下。要做这样的拆分，估计还是出于效率的考虑。毕竟可扩展大小的开销不小。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">noneOf</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">elementType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Enum</span><span class="o">[]</span> <span class="n">universe</span> <span class="o">=</span> <span class="n">getUniverse</span><span class="o">(</span><span class="n">elementType</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">universe</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ClassCastException</span><span class="o">(</span><span class="n">elementType</span> <span class="o">+</span> <span class="s">" not an enum"</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">universe</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;=</span> <span class="mi">64</span><span class="o">)</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">RegularEnumSet</span><span class="o">&lt;&gt;(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">JumboEnumSet</span><span class="o">&lt;&gt;(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>在RegularEnumSet中维护的主力数据结构确实如书中所说是一个long型：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">long</span> <span class="n">elements</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>
</code></pre>
</div>
<p>然后看它的add()函数：明显是把long型64 bit中，某个枚举实例的次序属性（ordinal）所对应的位置设为1。用1 bit表示这个枚举实例的存在。所以也确实像书里说的，long型中的每一位，映射到一个具体的枚举实例。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">typeCheck</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>

        <span class="kt">long</span> <span class="n">oldElements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">;</span>
        <span class="n">elements</span> <span class="o">|=</span> <span class="o">(</span><span class="mi">1L</span> <span class="o">&lt;&lt;</span> <span class="o">((</span><span class="n">Enum</span><span class="o">)</span><span class="n">e</span><span class="o">).</span><span class="na">ordinal</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">elements</span> <span class="o">!=</span> <span class="n">oldElements</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>至于JumboEnumSet，其中维护的主力容器是一个long型数组。看看它的构造器：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">JumboEnumSet</span><span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="n">EnumSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">334349849919042784L</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kt">long</span> <span class="n">elements</span><span class="o">[];</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="n">JumboEnumSet</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="n">elementType</span><span class="o">,</span> <span class="n">Enum</span><span class="o">[]</span> <span class="n">universe</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">elementType</span><span class="o">,</span> <span class="n">universe</span><span class="o">);</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[(</span><span class="n">universe</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="mi">63</span><span class="o">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">];</span>
    <span class="o">}</span>
	<span class="c1">//... ...</span>
</code></pre>
</div>
<p>相当于枚举规模对64取模获得的数组长度。</p>

<h4 id="exercise-8">Exercise 8</h4>
<ul>
  <li><strong>Exercise 8</strong>: (6) Modify PostOffice.java so it has the ability to forward mail.</li>
</ul>

<h5 id="mailjava">Mail.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mail</span> <span class="o">{</span>
    <span class="c1">// The NO’s lower the probability of random selection:</span>
    <span class="kd">enum</span> <span class="n">GeneralDelivery</span> <span class="o">{</span><span class="n">YES</span><span class="o">,</span><span class="n">NO1</span><span class="o">,</span><span class="n">NO2</span><span class="o">,</span><span class="n">NO3</span><span class="o">,</span><span class="n">NO4</span><span class="o">,</span><span class="n">NO5</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Scannability</span> <span class="o">{</span><span class="n">UNSCANNABLE</span><span class="o">,</span><span class="n">YES1</span><span class="o">,</span><span class="n">YES2</span><span class="o">,</span><span class="n">YES3</span><span class="o">,</span><span class="n">YES4</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Readability</span> <span class="o">{</span><span class="n">ILLEGIBLE</span><span class="o">,</span><span class="n">YES1</span><span class="o">,</span><span class="n">YES2</span><span class="o">,</span><span class="n">YES3</span><span class="o">,</span><span class="n">YES4</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Address</span> <span class="o">{</span><span class="n">INCORRECT</span><span class="o">,</span><span class="n">OK1</span><span class="o">,</span><span class="n">OK2</span><span class="o">,</span><span class="n">OK3</span><span class="o">,</span><span class="n">OK4</span><span class="o">,</span><span class="n">OK5</span><span class="o">,</span><span class="n">OK6</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Forward</span> <span class="o">{</span><span class="n">YES</span><span class="o">,</span><span class="n">NO</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">ForwardAddress</span> <span class="o">{</span><span class="n">INCORRECT</span><span class="o">,</span><span class="n">OK1</span><span class="o">,</span><span class="n">OK2</span><span class="o">,</span><span class="n">OK3</span><span class="o">,</span><span class="n">OK4</span><span class="o">,</span><span class="n">OK5</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">ReturnAddress</span> <span class="o">{</span><span class="n">MISSING</span><span class="o">,</span><span class="n">OK1</span><span class="o">,</span><span class="n">OK2</span><span class="o">,</span><span class="n">OK3</span><span class="o">,</span><span class="n">OK4</span><span class="o">,</span><span class="n">OK5</span><span class="o">}</span>

    <span class="n">GeneralDelivery</span> <span class="n">generalDelivery</span><span class="o">;</span>
    <span class="n">Scannability</span> <span class="n">scannability</span><span class="o">;</span>
    <span class="n">Readability</span> <span class="n">readability</span><span class="o">;</span>
    <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
    <span class="n">Forward</span> <span class="n">forward</span><span class="o">;</span>
    <span class="n">ForwardAddress</span> <span class="n">forwardAddress</span><span class="o">;</span>
    <span class="n">ReturnAddress</span> <span class="n">returnAddress</span><span class="o">;</span>

    <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Mail "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">details</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">+</span>
        <span class="s">", General Delivery: "</span> <span class="o">+</span> <span class="n">generalDelivery</span> <span class="o">+</span>
        <span class="s">", Address Scanability: "</span> <span class="o">+</span> <span class="n">scannability</span> <span class="o">+</span>
        <span class="s">", Address Readability: "</span> <span class="o">+</span> <span class="n">readability</span> <span class="o">+</span>
        <span class="s">", Address Address: "</span> <span class="o">+</span> <span class="n">address</span> <span class="o">+</span>
        <span class="s">", Forward: "</span> <span class="o">+</span> <span class="n">forward</span> <span class="o">+</span>
        <span class="s">", Forward Address: "</span> <span class="o">+</span> <span class="n">forwardAddress</span> <span class="o">+</span>
        <span class="s">", Return address: "</span> <span class="o">+</span> <span class="n">returnAddress</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// Generate test Mail:</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Mail</span> <span class="nf">randomMail</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Mail</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mail</span><span class="o">();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">generalDelivery</span><span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">GeneralDelivery</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">scannability</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Scannability</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">readability</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Readability</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Address</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">forward</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Forward</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">forwardAddress</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">ForwardAddress</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">returnAddress</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">ReturnAddress</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;</span> <span class="nf">generator</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
            <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="k">new</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;()</span> <span class="o">{</span>
                    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">n</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">}</span>
                    <span class="kd">public</span> <span class="n">Mail</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">randomMail</span><span class="o">();</span> <span class="o">}</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Not implemented</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">};</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="postofficejava">PostOffice.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostOffice</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="n">MailHandler</span> <span class="o">{</span>
        <span class="n">GENERAL_DELIVERY</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">generalDelivery</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">YES:</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Using general delivery for "</span> <span class="o">+</span> <span class="n">m</span><span class="o">);</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span>
        <span class="n">MACHINE_SCAN</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">scannability</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">UNSCANNABLE:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">address</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">case</span> <span class="nl">INCORRECT:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                            <span class="k">default</span><span class="o">:</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Delivering "</span><span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="s">" automatically"</span><span class="o">);</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span>
        <span class="n">VISUAL_INSPECTION</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">readability</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">ILLEGIBLE:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">address</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">case</span> <span class="nl">INCORRECT:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                            <span class="k">default</span><span class="o">:</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Delivering "</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="s">" normally"</span><span class="o">);</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span>
        <span class="n">FORWARD_STEP</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">forward</span><span class="o">){</span>
                    <span class="k">case</span> <span class="nl">NO:</span>
                        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">forwardAddress</span><span class="o">){</span>
                            <span class="k">case</span> <span class="nl">INCORRECT:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                            <span class="k">default</span><span class="o">:</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Forward "</span><span class="o">+</span> <span class="n">m</span> <span class="o">+</span><span class="s">" normally"</span><span class="o">);</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span>
        <span class="n">RETURN_TO_SENDER</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">returnAddress</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">MISSING:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Returning "</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="s">" to sender"</span><span class="o">);</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MailHandler</span> <span class="n">handler</span> <span class="o">:</span> <span class="n">MailHandler</span><span class="o">.</span><span class="na">values</span><span class="o">())</span>
            <span class="k">if</span><span class="o">(</span><span class="n">handler</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">m</span><span class="o">))</span>
                <span class="k">return</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span> <span class="o">+</span> <span class="s">" is a dead letter"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise8java">Exercise8.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise8</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Mail</span> <span class="n">mail</span> <span class="o">:</span> <span class="n">Mail</span><span class="o">.</span><span class="na">generator</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">details</span><span class="o">());</span>
            <span class="n">PostOffice</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">mail</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"*****"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-9">Exercise 9</h4>
<ul>
  <li><strong>Exercise 9</strong>: (5) Modify class PostOffice so that it uses an EnumMap. Project:2 Specialized languages like Prolog use backward chaining in order to solve problems like this. Using PostOffice.java for inspiration, research such languages and develop a program that allows new “rules” to be easily added to the system.</li>
</ul>

<h5 id="mailjava-1">Mail.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mail</span> <span class="o">{</span>
    <span class="c1">// The NO’s lower the probability of random selection:</span>
    <span class="kd">enum</span> <span class="n">GeneralDelivery</span> <span class="o">{</span><span class="n">YES</span><span class="o">,</span><span class="n">NO1</span><span class="o">,</span><span class="n">NO2</span><span class="o">,</span><span class="n">NO3</span><span class="o">,</span><span class="n">NO4</span><span class="o">,</span><span class="n">NO5</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Scannability</span> <span class="o">{</span><span class="n">UNSCANNABLE</span><span class="o">,</span><span class="n">YES1</span><span class="o">,</span><span class="n">YES2</span><span class="o">,</span><span class="n">YES3</span><span class="o">,</span><span class="n">YES4</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Readability</span> <span class="o">{</span><span class="n">ILLEGIBLE</span><span class="o">,</span><span class="n">YES1</span><span class="o">,</span><span class="n">YES2</span><span class="o">,</span><span class="n">YES3</span><span class="o">,</span><span class="n">YES4</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Address</span> <span class="o">{</span><span class="n">INCORRECT</span><span class="o">,</span><span class="n">OK1</span><span class="o">,</span><span class="n">OK2</span><span class="o">,</span><span class="n">OK3</span><span class="o">,</span><span class="n">OK4</span><span class="o">,</span><span class="n">OK5</span><span class="o">,</span><span class="n">OK6</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">Forward</span> <span class="o">{</span><span class="n">YES</span><span class="o">,</span><span class="n">NO</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">ForwardAddress</span> <span class="o">{</span><span class="n">INCORRECT</span><span class="o">,</span><span class="n">OK1</span><span class="o">,</span><span class="n">OK2</span><span class="o">,</span><span class="n">OK3</span><span class="o">,</span><span class="n">OK4</span><span class="o">,</span><span class="n">OK5</span><span class="o">}</span>
    <span class="kd">enum</span> <span class="n">ReturnAddress</span> <span class="o">{</span><span class="n">MISSING</span><span class="o">,</span><span class="n">OK1</span><span class="o">,</span><span class="n">OK2</span><span class="o">,</span><span class="n">OK3</span><span class="o">,</span><span class="n">OK4</span><span class="o">,</span><span class="n">OK5</span><span class="o">}</span>

    <span class="n">GeneralDelivery</span> <span class="n">generalDelivery</span><span class="o">;</span>
    <span class="n">Scannability</span> <span class="n">scannability</span><span class="o">;</span>
    <span class="n">Readability</span> <span class="n">readability</span><span class="o">;</span>
    <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
    <span class="n">Forward</span> <span class="n">forward</span><span class="o">;</span>
    <span class="n">ForwardAddress</span> <span class="n">forwardAddress</span><span class="o">;</span>
    <span class="n">ReturnAddress</span> <span class="n">returnAddress</span><span class="o">;</span>

    <span class="kd">static</span> <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">counter</span><span class="o">++;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"Mail "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">details</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">+</span>
        <span class="s">", General Delivery: "</span> <span class="o">+</span> <span class="n">generalDelivery</span> <span class="o">+</span>
        <span class="s">", Address Scanability: "</span> <span class="o">+</span> <span class="n">scannability</span> <span class="o">+</span>
        <span class="s">", Address Readability: "</span> <span class="o">+</span> <span class="n">readability</span> <span class="o">+</span>
        <span class="s">", Address Address: "</span> <span class="o">+</span> <span class="n">address</span> <span class="o">+</span>
        <span class="s">", Forward: "</span> <span class="o">+</span> <span class="n">forward</span> <span class="o">+</span>
        <span class="s">", Forward Address: "</span> <span class="o">+</span> <span class="n">forwardAddress</span> <span class="o">+</span>
        <span class="s">", Return address: "</span> <span class="o">+</span> <span class="n">returnAddress</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// Generate test Mail:</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Mail</span> <span class="nf">randomMail</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Mail</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mail</span><span class="o">();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">generalDelivery</span><span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">GeneralDelivery</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">scannability</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Scannability</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">readability</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Readability</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Address</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">forward</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">Forward</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">forwardAddress</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">ForwardAddress</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">m</span><span class="o">.</span><span class="na">returnAddress</span> <span class="o">=</span> <span class="n">Enums</span><span class="o">.</span><span class="na">random</span><span class="o">(</span><span class="n">ReturnAddress</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;</span> <span class="nf">generator</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
            <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="k">new</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Mail</span><span class="o">&gt;()</span> <span class="o">{</span>
                    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">n</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span> <span class="o">}</span>
                    <span class="kd">public</span> <span class="n">Mail</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">randomMail</span><span class="o">();</span> <span class="o">}</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Not implemented</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">};</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="postoffice9java">PostOffice9.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostOffice9</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="n">MailHandler</span> <span class="o">{</span> <span class="n">GENERAL_DELIVERY</span><span class="o">,</span> <span class="n">MACHINE_SCAN</span><span class="o">,</span> <span class="n">VISUAL_INSPECTION</span><span class="o">,</span> <span class="n">FORWARD_STEP</span><span class="o">,</span> <span class="n">RETURN_TO_SENDER</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">interface</span> <span class="nc">Handler</span><span class="o">{</span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">);}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">MailHandler</span><span class="o">,</span> <span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">&gt;</span> <span class="n">em</span><span class="o">=</span><span class="k">new</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">MailHandler</span><span class="o">,</span><span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">&gt;(</span><span class="n">MailHandler</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">static</span><span class="o">{</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MailHandler</span><span class="o">.</span><span class="na">GENERAL_DELIVERY</span><span class="o">,</span><span class="k">new</span> <span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">(){</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">generalDelivery</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">YES:</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Using general delivery for "</span> <span class="o">+</span> <span class="n">m</span><span class="o">);</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MailHandler</span><span class="o">.</span><span class="na">MACHINE_SCAN</span><span class="o">,</span> <span class="k">new</span> <span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">(){</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">scannability</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">UNSCANNABLE:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">address</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">case</span> <span class="nl">INCORRECT:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                            <span class="k">default</span><span class="o">:</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Delivering "</span><span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="s">" automatically"</span><span class="o">);</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MailHandler</span><span class="o">.</span><span class="na">VISUAL_INSPECTION</span><span class="o">,</span> <span class="k">new</span> <span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">(){</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">readability</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">ILLEGIBLE:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">address</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">case</span> <span class="nl">INCORRECT:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                            <span class="k">default</span><span class="o">:</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Delivering "</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="s">" normally"</span><span class="o">);</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MailHandler</span><span class="o">.</span><span class="na">FORWARD_STEP</span><span class="o">,</span> <span class="k">new</span> <span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">(){</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">forward</span><span class="o">){</span>
                    <span class="k">case</span> <span class="nl">NO:</span>
                        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">forwardAddress</span><span class="o">){</span>
                            <span class="k">case</span> <span class="nl">INCORRECT:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                            <span class="k">default</span><span class="o">:</span>
                                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Forward "</span><span class="o">+</span> <span class="n">m</span> <span class="o">+</span><span class="s">" normally"</span><span class="o">);</span>
                                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MailHandler</span><span class="o">.</span><span class="na">RETURN_TO_SENDER</span><span class="o">,</span> <span class="k">new</span> <span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">(){</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">returnAddress</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">MISSING:</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Returning "</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="s">" to sender"</span><span class="o">);</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Mail</span> <span class="n">m</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">MailHandler</span><span class="o">,</span><span class="n">PostOffice9</span><span class="o">.</span><span class="na">Handler</span><span class="o">&gt;</span> <span class="nl">entry:</span> <span class="n">PostOffice9</span><span class="o">.</span><span class="na">em</span><span class="o">.</span><span class="na">entrySet</span><span class="o">()){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()!=</span><span class="kc">null</span><span class="o">){</span>
               <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">handle</span><span class="o">(</span><span class="n">m</span><span class="o">)){</span>
                   <span class="k">return</span><span class="o">;</span>
               <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span> <span class="o">+</span> <span class="s">" is a dead letter"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">showHandleMap</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">em</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise9java">Exercise9.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise9</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Mail</span> <span class="n">mail</span> <span class="o">:</span> <span class="n">Mail</span><span class="o">.</span><span class="na">generator</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">details</span><span class="o">());</span>
            <span class="n">PostOffice9</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">mail</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"*****"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-10">Exercise 10</h4>
<ul>
  <li><strong>Exercise 10</strong>: (7) Modify class VendingMachine (only) using EnumMap so that one program can have multiple instances of VendingMachine.</li>
</ul>

<p>思路很简单，利用“命令模式”，把状态机的“状态”和“操作”分离。“状态”继续保持静态，放在State枚举型里。但具体的next()操作作为value和“状态”一起存入EnumMap里。而EnumMap作为VendingMachine的一个成员字段被维护。</p>

<h5 id="inputjava">Input.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Input</span> <span class="o">{</span>

    <span class="cm">/**
     *  枚举成员
     */</span>
    <span class="n">NICKEL</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">DIME</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">QUARTER</span><span class="o">(</span><span class="mi">25</span><span class="o">),</span> <span class="n">DOLLAR</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="n">TOOTHPASTE</span><span class="o">(</span><span class="mi">200</span><span class="o">),</span> <span class="n">CHIPS</span><span class="o">(</span><span class="mi">75</span><span class="o">),</span> <span class="n">SODA</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="n">SOAP</span><span class="o">(</span><span class="mi">50</span><span class="o">),</span>
    <span class="n">ABORT_TRANSACTION</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">amount</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Disallow</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"ABORT.amount()"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">},</span>
    <span class="n">STOP</span> <span class="o">{</span> <span class="c1">// This must be the last instance.</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">amount</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Disallow</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"SHUT_DOWN.amount()"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="cm">/**
     *  其他成员
     */</span>
    <span class="kt">int</span> <span class="n">value</span><span class="o">;</span> <span class="c1">// In cents</span>
    <span class="n">Input</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="n">Input</span><span class="o">()</span> <span class="o">{}</span>
    <span class="kt">int</span> <span class="nf">amount</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">};</span> <span class="c1">// In cents</span>
    <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Input</span> <span class="nf">randomSelection</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Don’t include STOP:</span>
        <span class="k">return</span> <span class="nf">values</span><span class="o">()[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">values</span><span class="o">().</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)];</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="categoryjava">Category.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Input</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Category</span> <span class="o">{</span>
    <span class="n">MONEY</span><span class="o">(</span><span class="n">NICKEL</span><span class="o">,</span> <span class="n">DIME</span><span class="o">,</span> <span class="n">QUARTER</span><span class="o">,</span> <span class="n">DOLLAR</span><span class="o">),</span>
    <span class="n">ITEM_SELECTION</span><span class="o">(</span><span class="n">TOOTHPASTE</span><span class="o">,</span> <span class="n">CHIPS</span><span class="o">,</span> <span class="n">SODA</span><span class="o">,</span> <span class="n">SOAP</span><span class="o">),</span>
    <span class="n">QUIT_TRANSACTION</span><span class="o">(</span><span class="n">ABORT_TRANSACTION</span><span class="o">),</span>
    <span class="n">SHUT_DOWN</span><span class="o">(</span><span class="n">STOP</span><span class="o">);</span>

    <span class="kd">private</span> <span class="n">Input</span><span class="o">[]</span> <span class="n">values</span><span class="o">;</span>
    <span class="n">Category</span><span class="o">(</span><span class="n">Input</span><span class="o">...</span> <span class="n">types</span><span class="o">)</span> <span class="o">{</span> <span class="n">values</span> <span class="o">=</span> <span class="n">types</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">Input</span><span class="o">,</span><span class="n">Category</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">Input</span><span class="o">,</span><span class="n">Category</span><span class="o">&gt;(</span><span class="n">Input</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Category</span> <span class="n">c</span> <span class="o">:</span> <span class="n">Category</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Input</span> <span class="n">type</span> <span class="o">:</span> <span class="n">c</span><span class="o">.</span><span class="na">values</span><span class="o">){</span>
                <span class="n">categories</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Category</span> <span class="nf">categorize</span><span class="o">(</span><span class="n">Input</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">categories</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="randominputgeneratorjava">RandomInputGenerator.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="c1">// For a basic sanity check:</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomInputGenerator</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Input</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Input</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">Input</span><span class="o">.</span><span class="na">randomSelection</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="vendingmachinejava">VendingMachine.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VendingMachine</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="n">StateDuration</span> <span class="o">{</span> <span class="n">TRANSIENT</span> <span class="o">}</span> <span class="c1">// Tagging enum</span>
    <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>
        <span class="n">RESTING</span><span class="o">,</span> <span class="n">ADDING_MONEY</span><span class="o">,</span> <span class="n">DISPENSING</span><span class="o">(</span><span class="n">StateDuration</span><span class="o">.</span><span class="na">TRANSIENT</span><span class="o">),</span> <span class="n">GIVING_CHANGE</span><span class="o">(</span><span class="n">StateDuration</span><span class="o">.</span><span class="na">TRANSIENT</span><span class="o">),</span>
        <span class="n">TERMINAL</span><span class="o">;</span>

        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isTransient</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">State</span><span class="o">()</span> <span class="o">{}</span>
        <span class="n">State</span><span class="o">(</span><span class="n">StateDuration</span> <span class="n">trans</span><span class="o">)</span> <span class="o">{</span> <span class="n">isTransient</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">RESTING</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Input</span> <span class="n">selection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">State</span><span class="o">,</span><span class="n">StateMachine</span><span class="o">&gt;</span> <span class="n">em</span><span class="o">=</span><span class="k">new</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">State</span><span class="o">,</span><span class="n">StateMachine</span><span class="o">&gt;(</span><span class="n">State</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">StateMachine</span> <span class="o">{</span>
        <span class="kt">void</span> <span class="nf">next</span><span class="o">(</span><span class="n">Input</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Only call "</span> <span class="o">+</span> <span class="s">"next(Input input) for non-transient states"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">void</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Only call next() for "</span> <span class="o">+</span> <span class="s">"StateDuration.TRANSIENT states"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">void</span> <span class="nf">output</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span> <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">VendingMachine</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">RESTING</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">(</span><span class="n">Input</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">Category</span><span class="o">.</span><span class="na">categorize</span><span class="o">(</span><span class="n">input</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">MONEY:</span>
                        <span class="n">amount</span> <span class="o">+=</span> <span class="n">input</span><span class="o">.</span><span class="na">amount</span><span class="o">();</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">ADDING_MONEY</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">SHUT_DOWN:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">ADDING_MONEY</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">(</span><span class="n">Input</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">Category</span><span class="o">.</span><span class="na">categorize</span><span class="o">(</span><span class="n">input</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">MONEY:</span>
                        <span class="n">amount</span> <span class="o">+=</span> <span class="n">input</span><span class="o">.</span><span class="na">amount</span><span class="o">();</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">ITEM_SELECTION:</span>
                        <span class="n">selection</span> <span class="o">=</span> <span class="n">input</span><span class="o">;</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="n">selection</span><span class="o">.</span><span class="na">amount</span><span class="o">())</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Insufficient money for "</span> <span class="o">+</span> <span class="n">selection</span><span class="o">);</span>
                        <span class="k">else</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">DISPENSING</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">QUIT_TRANSACTION:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">GIVING_CHANGE</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">SHUT_DOWN:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">DISPENSING</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"here is your "</span> <span class="o">+</span> <span class="n">selection</span><span class="o">);</span>
                <span class="n">amount</span> <span class="o">-=</span> <span class="n">selection</span><span class="o">.</span><span class="na">amount</span><span class="o">();</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">GIVING_CHANGE</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">GIVING_CHANGE</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Your change: "</span> <span class="o">+</span> <span class="n">amount</span><span class="o">);</span>
                    <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">output</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Halted"</span><span class="o">);</span> <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="o">(){</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">RESTING</span><span class="o">;</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Generator</span><span class="o">&lt;</span><span class="n">Input</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span><span class="o">(</span><span class="n">state</span> <span class="o">!=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">state</span><span class="o">).</span><span class="na">next</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="k">while</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">isTransient</span><span class="o">){</span>
                <span class="n">em</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">state</span><span class="o">).</span><span class="na">next</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">em</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">state</span><span class="o">).</span><span class="na">output</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">VendingMachine</span> <span class="n">vm</span><span class="o">=</span><span class="k">new</span> <span class="n">VendingMachine</span><span class="o">();</span>
        <span class="n">vm</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">RandomInputGenerator</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise10java">Exercise10.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise10</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">VendingMachine</span> <span class="n">vm1</span><span class="o">=</span><span class="k">new</span> <span class="n">VendingMachine</span><span class="o">();</span>
        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Input</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomInputGenerator</span><span class="o">();</span>
        <span class="n">vm1</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">gen</span><span class="o">);</span>
        <span class="n">vm1</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
        <span class="n">vm1</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">gen</span><span class="o">);</span>

        <span class="n">VendingMachine</span> <span class="n">vm2</span><span class="o">=</span><span class="k">new</span> <span class="n">VendingMachine</span><span class="o">();</span>
        <span class="n">vm2</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">gen</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-11">Exercise 11</h4>
<ul>
  <li><strong>Exercise 11</strong>: (7) In a real vending machine you will want to easily add and change the type of vended items, so the limits imposed by an enum on Input are impractical (remember that enums are for a restricted set of types). Modify VendingMachine.java so that the vended items are represented by a class instead of being part of Input, and initialize an Array List of these objects from a text file (using net.mindview.util.TextFile).</li>
</ul>

<p>思路也很简单，把原先的商品设计成Product类，允许从外部文件读入商品条目。售货机初始化时完成载入商品条目。再把原先ITEM_SELECTION枚举型Input改成一个标记。当状态机收到ITEM_SELECTION型状态时，next()方法变为从商品条目列表中随机读取一个商品。</p>

<h5 id="input11java">Input11.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Input11</span> <span class="o">{</span>

    <span class="cm">/**
     *  枚举成员
     */</span>
    <span class="n">NICKEL</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">DIME</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">QUARTER</span><span class="o">(</span><span class="mi">25</span><span class="o">),</span> <span class="n">DOLLAR</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="n">PRODUCT</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span>
    <span class="n">ABORT_TRANSACTION</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">amount</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Disallow</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"ABORT.amount()"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">},</span>
    <span class="n">STOP</span> <span class="o">{</span> <span class="c1">// This must be the last instance.</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">amount</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// Disallow</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"SHUT_DOWN.amount()"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="cm">/**
     *  其他成员
     */</span>
    <span class="kt">int</span> <span class="n">value</span><span class="o">;</span> <span class="c1">// In cents</span>
    <span class="n">Input11</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="n">Input11</span><span class="o">()</span> <span class="o">{}</span>
    <span class="kt">int</span> <span class="nf">amount</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">};</span> <span class="c1">// In cents</span>
    <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Input11</span> <span class="nf">randomSelection</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Don’t include STOP:</span>
        <span class="k">return</span> <span class="nf">values</span><span class="o">()[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">values</span><span class="o">().</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)];</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="randominputgenerator11java">RandomInputGenerator11.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="c1">// For a basic sanity check:</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomInputGenerator11</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Input11</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Input11</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">Input11</span><span class="o">.</span><span class="na">randomSelection</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="category11java">Category11.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">.</span><span class="na">Input11</span><span class="o">.*;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="n">Category11</span> <span class="o">{</span>
    <span class="n">MONEY</span><span class="o">(</span><span class="n">NICKEL</span><span class="o">,</span> <span class="n">DIME</span><span class="o">,</span> <span class="n">QUARTER</span><span class="o">,</span> <span class="n">DOLLAR</span><span class="o">),</span>
    <span class="n">ITEM_SELECTION</span><span class="o">(</span><span class="n">PRODUCT</span><span class="o">),</span>
    <span class="n">QUIT_TRANSACTION</span><span class="o">(</span><span class="n">ABORT_TRANSACTION</span><span class="o">),</span>
    <span class="n">SHUT_DOWN</span><span class="o">(</span><span class="n">STOP</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">Input11</span><span class="o">,</span><span class="n">Category11</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">Input11</span><span class="o">,</span><span class="n">Category11</span><span class="o">&gt;(</span><span class="n">Input11</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Category11</span> <span class="n">c</span> <span class="o">:</span> <span class="n">Category11</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getEnumConstants</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Input11</span> <span class="n">type</span> <span class="o">:</span> <span class="n">c</span><span class="o">.</span><span class="na">values</span><span class="o">){</span>
                <span class="n">categories</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Category11</span> <span class="nf">categorize</span><span class="o">(</span><span class="n">Input11</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">categories</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Input11</span><span class="o">[]</span> <span class="n">values</span><span class="o">;</span>
    <span class="n">Category11</span><span class="o">(</span><span class="n">Input11</span><span class="o">...</span> <span class="n">types</span><span class="o">)</span> <span class="o">{</span> <span class="n">values</span> <span class="o">=</span> <span class="n">types</span><span class="o">;</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Category11</span><span class="o">.</span><span class="na">MONEY</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Category11</span><span class="o">.</span><span class="na">categories</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="vendingmachine11java">VendingMachine11.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VendingMachine11</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="n">StateDuration</span> <span class="o">{</span> <span class="n">TRANSIENT</span> <span class="o">}</span> <span class="c1">// Tagging enum</span>
    <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>
        <span class="n">RESTING</span><span class="o">,</span> <span class="n">ADDING_MONEY</span><span class="o">,</span> <span class="n">DISPENSING</span><span class="o">(</span><span class="n">StateDuration</span><span class="o">.</span><span class="na">TRANSIENT</span><span class="o">),</span> <span class="n">GIVING_CHANGE</span><span class="o">(</span><span class="n">StateDuration</span><span class="o">.</span><span class="na">TRANSIENT</span><span class="o">),</span>
        <span class="n">TERMINAL</span><span class="o">;</span>

        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isTransient</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">State</span><span class="o">()</span> <span class="o">{}</span>
        <span class="n">State</span><span class="o">(</span><span class="n">StateDuration</span> <span class="n">trans</span><span class="o">)</span> <span class="o">{</span> <span class="n">isTransient</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">RESTING</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Product</span> <span class="n">selection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">State</span><span class="o">,</span><span class="n">StateMachine</span><span class="o">&gt;</span> <span class="n">em</span><span class="o">=</span><span class="k">new</span> <span class="n">EnumMap</span><span class="o">&lt;</span><span class="n">State</span><span class="o">,</span><span class="n">StateMachine</span><span class="o">&gt;(</span><span class="n">State</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">StateMachine</span> <span class="o">{</span>
        <span class="kt">void</span> <span class="nf">next</span><span class="o">(</span><span class="n">Input11</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Only call "</span> <span class="o">+</span> <span class="s">"next(Input input) for non-transient states"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">void</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Only call next() for "</span> <span class="o">+</span> <span class="s">"StateDuration.TRANSIENT states"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">void</span> <span class="nf">output</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span> <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">VendingMachine11</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Product</span><span class="o">.</span><span class="na">loadProducts</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">RESTING</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">(</span><span class="n">Input11</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">Category11</span><span class="o">.</span><span class="na">categorize</span><span class="o">(</span><span class="n">input</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">MONEY:</span>
                        <span class="n">amount</span> <span class="o">+=</span> <span class="n">input</span><span class="o">.</span><span class="na">amount</span><span class="o">();</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">ADDING_MONEY</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">SHUT_DOWN:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">ADDING_MONEY</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">(</span><span class="n">Input11</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">switch</span><span class="o">(</span><span class="n">Category11</span><span class="o">.</span><span class="na">categorize</span><span class="o">(</span><span class="n">input</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">case</span> <span class="nl">MONEY:</span>
                        <span class="n">amount</span> <span class="o">+=</span> <span class="n">input</span><span class="o">.</span><span class="na">amount</span><span class="o">();</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">ITEM_SELECTION:</span>
                        <span class="n">selection</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="na">randomSelection</span><span class="o">();</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="n">selection</span><span class="o">.</span><span class="na">amount</span><span class="o">()){</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Insufficient money for "</span> <span class="o">+</span> <span class="n">selection</span><span class="o">);</span>
                        <span class="o">}</span>
                        <span class="k">else</span> <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">DISPENSING</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">QUIT_TRANSACTION:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">GIVING_CHANGE</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="k">case</span> <span class="nl">SHUT_DOWN:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">;</span>
                    <span class="k">default</span><span class="o">:</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">DISPENSING</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"here is your "</span> <span class="o">+</span> <span class="n">selection</span><span class="o">);</span>
                <span class="n">amount</span> <span class="o">-=</span> <span class="n">selection</span><span class="o">.</span><span class="na">amount</span><span class="o">();</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">GIVING_CHANGE</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">GIVING_CHANGE</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Your change: "</span> <span class="o">+</span> <span class="n">amount</span><span class="o">);</span>
                    <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">em</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">,</span><span class="k">new</span> <span class="n">StateMachine</span><span class="o">(){</span>
            <span class="kt">void</span> <span class="nf">output</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Halted"</span><span class="o">);</span> <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="o">(){</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="na">RESTING</span><span class="o">;</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Generator</span><span class="o">&lt;</span><span class="n">Input11</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span><span class="o">(</span><span class="n">state</span> <span class="o">!=</span> <span class="n">State</span><span class="o">.</span><span class="na">TERMINAL</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">state</span><span class="o">).</span><span class="na">next</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="k">while</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">isTransient</span><span class="o">){</span>
                <span class="n">em</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">state</span><span class="o">).</span><span class="na">next</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">em</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">state</span><span class="o">).</span><span class="na">output</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">VendingMachine11</span> <span class="n">vm</span><span class="o">=</span><span class="k">new</span> <span class="n">VendingMachine11</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter19/product.txt"</span><span class="o">);</span>
        <span class="n">vm</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">RandomInputGenerator11</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="textfilejava">TextFile.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TextFile</span> <span class="kd">extends</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// Read a file as a single string:</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">read</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">in</span><span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">fileName</span><span class="o">).</span><span class="na">getAbsoluteFile</span><span class="o">()));</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">s</span><span class="o">;</span>
                <span class="k">while</span><span class="o">((</span><span class="n">s</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">TextFile</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span> <span class="n">String</span> <span class="n">splitter</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">read</span><span class="o">(</span><span class="n">fileName</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="n">splitter</span><span class="o">)));</span>
        <span class="c1">// Regular expression split() often leaves an empty</span>
        <span class="c1">// String at the first position:</span>
        <span class="k">if</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">))</span> <span class="n">remove</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Normally read by lines:</span>
    <span class="kd">public</span> <span class="nf">TextFile</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="s">"\n"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="producttxt">product.txt</h5>
<p>存放商品条目的文本文件。每行存放一种商品的信息。第一项：商品名，第二项：价格。中间用tab符号分隔。</p>
<pre><code class="language-txt">TOOTTHPASTE	200
CHIPS	75
SODA	100
SOAP	50
</code></pre>

<h5 id="exercise11java">Exercise11.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter19</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise11</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">VendingMachine11</span> <span class="n">vm</span><span class="o">=</span><span class="k">new</span> <span class="n">VendingMachine11</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter19/product.txt"</span><span class="o">);</span>
        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Input11</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomInputGenerator11</span><span class="o">();</span>
        <span class="n">vm</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">gen</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

        <div class="after-post"></div> <!-- 文章结尾，和Disqus留一些间隔。-->
        <script>
            $("div.after-post").css("margin-bottom","50px");
        </script>

        <!-- Disqus plugin -->
        <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = /java/thinking_in_java/2016/10/20/tij4-19.html;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = /java/thinking_in_java/2016/10/20/tij4-19; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//www-ciaoshen-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
    <!-- .container -->


    <!-- footer bar -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<footer>
    <!-- Don't show tag cloud
    <div class="footer" id="footer">
        <div class="container">
            <div id="tags-cloud-title">
            <div class="row">
                <div class="col-lg-12  col-md-12 col-sm-12 col-xs-12">
                    <h2>Tag Cloud</h2>
                </div>
            </div>
            </div>
            <div id="tags-cloud" class="row">
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_String" href="/tags/String.html">
                        String
                        <span class="badge">5</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Memory_Model" href="/tags/Memory_Model.html">
                        Memory_Model
                        <span class="badge">6</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JVM" href="/tags/JVM.html">
                        JVM
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Hexo" href="/tags/Hexo.html">
                        Hexo
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Github" href="/tags/Github.html">
                        Github
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Blog" href="/tags/Blog.html">
                        Blog
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Git" href="/tags/Git.html">
                        Git
                        <span class="badge">6</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JDK" href="/tags/JDK.html">
                        JDK
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JRE" href="/tags/JRE.html">
                        JRE
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_IDE" href="/tags/IDE.html">
                        IDE
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_OOP" href="/tags/OOP.html">
                        OOP
                        <span class="badge">7</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Initialization" href="/tags/Initialization.html">
                        Initialization
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Control_Flow" href="/tags/Control_Flow.html">
                        Control_Flow
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_GC" href="/tags/GC.html">
                        GC
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Access_Control" href="/tags/Access_Control.html">
                        Access_Control
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Package" href="/tags/Package.html">
                        Package
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Inheritance" href="/tags/Inheritance.html">
                        Inheritance
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Composition" href="/tags/Composition.html">
                        Composition
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Factory_Pattern" href="/tags/Factory_Pattern.html">
                        Factory_Pattern
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Polymorphism" href="/tags/Polymorphism.html">
                        Polymorphism
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Late_Binding" href="/tags/Late_Binding.html">
                        Late_Binding
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_State_Pattern" href="/tags/State_Pattern.html">
                        State_Pattern
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Interface" href="/tags/Interface.html">
                        Interface
                        <span class="badge">5</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Abstract_Class" href="/tags/Abstract_Class.html">
                        Abstract_Class
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Strategy_Pattern" href="/tags/Strategy_Pattern.html">
                        Strategy_Pattern
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Inner_Class" href="/tags/Inner_Class.html">
                        Inner_Class
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Callback" href="/tags/Callback.html">
                        Callback
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Closure" href="/tags/Closure.html">
                        Closure
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Lambda_Expression" href="/tags/Lambda_Expression.html">
                        Lambda_Expression
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Container" href="/tags/Container.html">
                        Container
                        <span class="badge">9</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Array" href="/tags/Array.html">
                        Array
                        <span class="badge">6</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Hash" href="/tags/Hash.html">
                        Hash
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Exception" href="/tags/Exception.html">
                        Exception
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_IO" href="/tags/IO.html">
                        IO
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Regular_Expression" href="/tags/Regular_Expression.html">
                        Regular_Expression
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Reflection" href="/tags/Reflection.html">
                        Reflection
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Career_Path" href="/tags/Career_Path.html">
                        Career_Path
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Immutability" href="/tags/Immutability.html">
                        Immutability
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Dynamic_Proxies" href="/tags/Dynamic_Proxies.html">
                        Dynamic_Proxies
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Generics" href="/tags/Generics.html">
                        Generics
                        <span class="badge">8</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Adapter_Pattern" href="/tags/Adapter_Pattern.html">
                        Adapter_Pattern
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Wildcards" href="/tags/Wildcards.html">
                        Wildcards
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_PESC" href="/tags/PESC.html">
                        PESC
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Covariant" href="/tags/Covariant.html">
                        Covariant
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_View" href="/tags/View.html">
                        View
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Iterator" href="/tags/Iterator.html">
                        Iterator
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Fly_Weight" href="/tags/Fly_Weight.html">
                        Fly_Weight
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_LinkedList" href="/tags/LinkedList.html">
                        LinkedList
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Weak_Reference" href="/tags/Weak_Reference.html">
                        Weak_Reference
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Phantom_Reference" href="/tags/Phantom_Reference.html">
                        Phantom_Reference
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_HashMap" href="/tags/HashMap.html">
                        HashMap
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_File" href="/tags/File.html">
                        File
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Stream" href="/tags/Stream.html">
                        Stream
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Encapsulation" href="/tags/Encapsulation.html">
                        Encapsulation
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Unicode" href="/tags/Unicode.html">
                        Unicode
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_UTF-8" href="/tags/UTF-8.html">
                        UTF-8
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_ASCII" href="/tags/ASCII.html">
                        ASCII
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Encoding" href="/tags/Encoding.html">
                        Encoding
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Charset" href="/tags/Charset.html">
                        Charset
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_CPU" href="/tags/CPU.html">
                        CPU
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Process" href="/tags/Process.html">
                        Process
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Block" href="/tags/Block.html">
                        Block
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Logic_Gates" href="/tags/Logic_Gates.html">
                        Logic_Gates
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_NIO" href="/tags/NIO.html">
                        NIO
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Enum" href="/tags/Enum.html">
                        Enum
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Table_Driven" href="/tags/Table_Driven.html">
                        Table_Driven
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Annotations" href="/tags/Annotations.html">
                        Annotations
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Hibernate" href="/tags/Hibernate.html">
                        Hibernate
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JUnit" href="/tags/JUnit.html">
                        JUnit
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Spring" href="/tags/Spring.html">
                        Spring
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Syntactic sugar" href="/tags/Syntactic sugar.html">
                        Syntactic sugar
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_AOP" href="/tags/AOP.html">
                        AOP
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Concurrency" href="/tags/Concurrency.html">
                        Concurrency
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Thread" href="/tags/Thread.html">
                        Thread
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_DJ" href="/tags/DJ.html">
                        DJ
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_IOC" href="/tags/IOC.html">
                        IOC
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Interrupt" href="/tags/Interrupt.html">
                        Interrupt
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_HTML" href="/tags/HTML.html">
                        HTML
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_CSS" href="/tags/CSS.html">
                        CSS
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Javascript" href="/tags/Javascript.html">
                        Javascript
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JQuery" href="/tags/JQuery.html">
                        JQuery
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Sass" href="/tags/Sass.html">
                        Sass
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Responsive_Design" href="/tags/Responsive_Design.html">
                        Responsive_Design
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Code_Style" href="/tags/Code_Style.html">
                        Code_Style
                        <span class="badge">15</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Builder_Pattern" href="/tags/Builder_Pattern.html">
                        Builder_Pattern
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Instance_Control" href="/tags/Instance_Control.html">
                        Instance_Control
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Singleton" href="/tags/Singleton.html">
                        Singleton
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Comparable" href="/tags/Comparable.html">
                        Comparable
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Clone" href="/tags/Clone.html">
                        Clone
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_API" href="/tags/API.html">
                        API
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Template_Pattern" href="/tags/Template_Pattern.html">
                        Template_Pattern
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Jekyll" href="/tags/Jekyll.html">
                        Jekyll
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Bootstrap" href="/tags/Bootstrap.html">
                        Bootstrap
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_SSH" href="/tags/SSH.html">
                        SSH
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_RSA" href="/tags/RSA.html">
                        RSA
                        <span class="badge">1</span>
                        </a>
                    </div>
                
            </div>
        </div>
    </div>
    don't need tag cloud here -->

    <div class="footer-bottom">
        <div class="container">
            <p class="pull-left"> Copyright © <b>Wei SHEN</b> &nbsp | &nbsp Designed by <b>Wei SHEN</b> &nbsp | &nbsp Coded by <b>Wei SHEN</b> &nbsp | &nbsp 2015-2017. All right reserved.  &nbsp | &nbsp  Contact me: <b>symantec__@hotmail.com</b> </p>
            <div class="pull-right">
                <ul class="social">

                </ul>
            </div>
        </div>
    </div>
    <!--/.footer-bottom-->
</footer>



    <!-- Bootstrap Core JavaScript -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Add space between two paragraph -->
    <script src="/assets/js/span.js"></script>
    <!-- Adjust images size -->
    <script src="/assets/js/imgResponsive.js"></script>
    <!-- Disqus comment count plugin -->
    <script id="dsq-count-scr" src="//www-ciaoshen-com.disqus.com/count.js" async></script>

</body>

</html>
