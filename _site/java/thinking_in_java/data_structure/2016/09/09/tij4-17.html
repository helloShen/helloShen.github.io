<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Thinking {SHEN}</title>

    <!-- Bootstrap Core CSS -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Blog Template CSS -->
    <link href="/assets/css/blog.css" rel="stylesheet">
    <!-- jQuery Version 1.11.1 -->
    <script src="/assets/js/jquery.js"></script>
    <!-- footer bar -->
    <link href="/assets/css/footer.css" rel="stylesheet">
    <!-- code highlight. I also have other options. But this one looks good! -->
    <link href="/assets/css/jekyll-github.css" rel="stylesheet">
    <!-- Sidebar -->
    <!--<link href="/assets/css/sidebar.css" rel="stylesheet">-->


    <!-- Custom CSS -->
    <style>
        body {
            padding-top: 70px;
            /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
        }
        .container {
            width: 80%;
        }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="">Thinking {SHEN}</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/resume/">Resume</a>
                    </li>
                    <li>
                        <a href="/thinkinginjava/">Thinking in Java</a>
                    </li>
                    <li>
                        <a href="#">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Container -->
    <div class="container">

        <!-- Page Title -->
        <div class="text-center">
      <!-- page-header是Bootstrap内置页头组件 -->
      <div class="page-header">
          <h1>[Thinking in Java] Note: Chapter 17 - Containers in Depth</h1>
      </div>
      <h5 class="blog-post-meta">
                <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span> &nbsp
                2016-09-09 08:06:45 -0400
                &nbsp | &nbsp
                <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span> &nbsp
            
                <a href="/categories/Java.html"><span class="label label-primary"><b>Java</b></span></a>
                &nbsp
            
                <a href="/categories/Thinking_in_Java.html"><span class="label label-primary"><b>Thinking_in_Java</b></span></a>
                &nbsp
            
                <a href="/categories/Data_Structure.html"><span class="label label-primary"><b>Data_Structure</b></span></a>
                &nbsp
            
                &nbsp | &nbsp
                <span class="glyphicon glyphicon-comment" aria-hidden="true"></span> &nbsp
                <a href="#disqus_thread "></a>
      </h5>
      <h5 class="blog-post-meta">
          <span class="glyphicon glyphicon-tags" aria-hidden="true"></span> &nbsp
          
              <a href="/tags/Container.html"><span class="label label-default">Container</span></a>
              &nbsp
          
              <a href="/tags/View.html"><span class="label label-default">View</span></a>
              &nbsp
          
              <a href="/tags/Iterator.html"><span class="label label-default">Iterator</span></a>
              &nbsp
          
              <a href="/tags/Fly_Weight.html"><span class="label label-default">Fly_Weight</span></a>
              &nbsp
          
      </h5>
</div>


        <!-- Page Content -->
        <h3 id="容器的填充">容器的填充</h3>
<h4 id="实现容器抽象类">实现容器抽象类</h4>
<p>例子是一个“享元模式（FlyWeight）”。顾名思义，Fly Weight，就是用在有大量对象的组件里，为了节省内存空间的大小。指导思想，就是把巨量的对象从代码中剥离出来，单独储存，供大家访问。</p>

<p>这里实现享元模式的动机就是要把Map里的数据从Map里分离出来。演示Map里如果没有实际数据，也是可以依靠外部数据源工作的。</p>

<p>当然现有的容器类不能和它兼容。需要重新构造专用容器。但也不需要完全重头开始造轮子。可以继承类库提供的容器抽象类。代码如下：</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCountries</span> <span class="o">{</span>
    <span class="cm">/**
     *  数据二维数组
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[][]</span> <span class="n">DATA</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// Africa</span>
    <span class="o">{</span><span class="s">"ALGERIA"</span><span class="o">,</span><span class="s">"Algiers"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ANGOLA"</span><span class="o">,</span><span class="s">"Luanda"</span><span class="o">},</span>
    <span class="c1">//一万个国家名和首都的pair... ...</span>
    <span class="o">{</span><span class="s">"URUGUAY"</span><span class="o">,</span><span class="s">"Montevideo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"VENEZUELA"</span><span class="o">,</span><span class="s">"Caracas"</span><span class="o">},</span>
    <span class="o">};</span>

    <span class="cm">/**
     * 套嵌MAP
     * 实现 AbstractMap 要实现 entrySet()。因为AbstractMap没有实现Map接口定义的entrySet方法。
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CountriesMap</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;{</span>

        <span class="cm">/**
         * MAP内部二层套嵌类Entry 实现 Map.Entry 套嵌泛型类。这里为了支持享元，要重写两个方法：getKey()和getValue()。
         * 享元模式：Entry只要一个index字段。Entry所有内容根据这个index到享元里找。
         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;{</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
            <span class="kd">public</span> <span class="nf">Entry</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">index</span><span class="o">=</span><span class="n">index</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKey</span><span class="o">(){</span><span class="k">return</span> <span class="n">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">%</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">][</span><span class="mi">0</span><span class="o">];}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">(){</span><span class="k">return</span> <span class="n">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">%</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">][</span><span class="mi">1</span><span class="o">];}</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span><span class="k">return</span> <span class="n">getKey</span><span class="o">()==((</span><span class="n">Entry</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">getKey</span><span class="o">();}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span><span class="k">return</span> <span class="n">getValue</span><span class="o">().</span><span class="na">hashCode</span><span class="o">();}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">){</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>  <span class="c1">//只读，不支持改数据</span>
            <span class="o">}</span>
        <span class="o">}</span>


        <span class="cm">/**
         * 二层套嵌 Set
         * 实现只读 AbstractSet 要实现 size() &amp; iterator()。 因为AbstractSet继承自AbstractCollection。但AbstractCollection中定义了size() &amp; iterator()方法，但没有实现。
         * 享元模式：只保留一个size字段。Set的所有内容根据这个size从享元中找。
         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;{</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
            <span class="kd">public</span> <span class="nf">EntrySet</span><span class="o">(){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
                <span class="k">if</span><span class="o">(</span><span class="n">size</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">size</span><span class="o">&gt;</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">){</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">size</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="cm">/**
             * Set 内部三层套嵌迭代器
             */</span>
            <span class="kd">private</span> <span class="kd">class</span> <span class="nc">EntryIterator</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;{</span>
                <span class="kd">private</span> <span class="n">Entry</span> <span class="n">e</span><span class="o">=</span><span class="k">new</span> <span class="n">Entry</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
                    <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="na">index</span><span class="o">&lt;</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">index</span><span class="o">++;</span>
                    <span class="k">return</span> <span class="n">e</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="o">(){</span><span class="n">e</span><span class="o">.</span><span class="na">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;}</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">(){</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">EntryIterator</span><span class="o">();</span>
            <span class="o">}</span>

        <span class="o">}</span>

        <span class="c1">//定义好了套嵌Set之后，写entrySet()方法</span>
        <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">(){</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="c1">//神奇的匿名内部类，重写entrySet()方法。</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">select</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CountriesMap</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">(){</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>


    <span class="c1">//返回整个Map</span>
    <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="n">CountriesMap</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">capitals</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//返回部分Map</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">capitals</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">select</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//返回所有国家名的List</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">//返回部分国家名的List</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">capitals</span><span class="o">(</span><span class="n">size</span><span class="o">).</span><span class="na">keySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="看看keyset-方法的源代码看它是怎么实现的">看看keySet( )方法的源代码，看它是怎么实现的</h5>
<p>简单讲就是利用AbstractSet里的Iterator，逐个获取元素的Key键值。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="nf">keySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">keySet</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">keySet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;()</span> <span class="o">{</span>
                <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;()</span> <span class="o">{</span>
                        <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>	<span class="c1">//代理模式</span>

                        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">()</span> <span class="o">{</span>
                            <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span>
                        <span class="o">}</span>

                        <span class="kd">public</span> <span class="n">K</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
                            <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">().</span><span class="na">getKey</span><span class="o">();</span>
                        <span class="o">}</span>

                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
                            <span class="n">i</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
                        <span class="o">}</span>
                    <span class="o">};</span>
                <span class="o">}</span>

                <span class="c1">//AbstractSet接口的其他方法</span>
				<span class="c1">//... ...</span>
            <span class="o">};</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">keySet</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>
<p>这里用了一个代理模式，内部的委托类就是我们实现了的entrySet()方法和iterator()方法。</p>

<p>所以这这个Map实现地非常轻量级，仅仅是设置了一个到储存数据的二维数组的一个索引，就实现了对数据的查询功能。</p>

<h5 id="用匿名内部类覆盖某方法有奇效">用匿名内部类覆盖某方法，有奇效</h5>

<p>内部类这一章，只注意到了匿名内部类的一种使用场景：实现某个interface。</p>

<p>但实际上<strong>匿名内部类的语法表达的是一个“继承”的概念</strong>。看select()方法的代码：</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="c1">//神奇的匿名内部类，重写entrySet()方法。</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">select</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CountriesMap</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">(){</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>这里<strong>“new CountriesMap()”</strong>表达的是：</p>
<ul>
  <li><strong>创建一个继承自CountriesMap的匿名类的对象。</strong></li>
</ul>

<p>这里仅仅是重写了entrySet()方法，就能够返回数据表不同大小的子块。这算是匿名内部类比较经典的应用场景了。</p>

<h3 id="collection接口">Collection接口</h3>
<p>不多说，放张图，这几个方法是要记住的。总的来说，以一个List表为代表的一组容器，最典型的操作就这么几样：</p>
<ul>
  <li><strong>读取元素</strong>：add(), addAll()</li>
  <li><strong>检查元素</strong>：contains(), containsAll(), isEmpty(), size()</li>
  <li><strong>改变元素</strong>：clear(), remove(), removeAll(), retainAll()</li>
  <li><strong>迭代器</strong>：iterator(), Iterator.hasNext(), Iterator.next(), Iterator.remove()</li>
  <li><strong>类型转换</strong>：toArray()</li>
</ul>

<p>这些都是经过时间检验的<strong>“工程经验”</strong>。</p>

<p><img src="/images/tij4-17/collection.png" alt="collection" /></p>

<p>注意一下迭代器光标Cursor位置：
<img src="/images/tij4-17/cursor.png" alt="cursor" /></p>

<h3 id="可选操作">可选操作</h3>
<p>可选操作是个坑。它是指比如在Collection接口中，以下几个方法，</p>
<ul>
  <li>retainAll()</li>
  <li>removeAll()</li>
  <li>clear()</li>
  <li>add()</li>
  <li>addAll()</li>
  <li>remove()</li>
</ul>

<p>它们是可选方法。但仅仅是在官方文档的方法解释后面加了两个字<strong>“(optional operation)”</strong>而已。</p>

<p>它的实现方式非常隐蔽，当我们用<strong>“Arrays.asList()”</strong>方法把一个数组转换成一个List的时候，看起来返回的数据类型是ArrayList，但注意这不是<strong>java.util.ArrayList</strong>，而是Arrays内部一个同名的套嵌类<strong>java.util.Arrays.ArrayList</strong>。在这个“山寨”ArrayList里以上列出来的方法只是假装实现了一下，抛出一个<strong>UnsupportedOperationException</strong>而已。贴一下部分源代码：</p>

<p>下面是java.util.Arrays中套嵌ArrayList的代码开头部分。很明显，它继承自抽象类AbstractList<E>。</E></p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span>
        <span class="kd">implements</span> <span class="n">RandomAccess</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span>
    <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2764017481108945198L</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">E</span><span class="o">[]</span> <span class="n">a</span><span class="o">;</span>

        <span class="n">ArrayList</span><span class="o">(</span><span class="n">E</span><span class="o">[]</span> <span class="n">array</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">array</span><span class="o">==</span><span class="kc">null</span><span class="o">)</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullPointerException</span><span class="o">();</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="o">;</span>
        <span class="o">}</span>
		<span class="c1">//... ...</span>
		<span class="c1">//... ...</span>
	<span class="o">}</span>
</code></pre>
</div>

<p>而抽象类AbstractList里，以上列出来的几个方法根本没有实现，只是抛出<strong>UnsupportedOperationException</strong>。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">E</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">E</span> <span class="nf">remove</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>
	<span class="c1">//... ...</span>
	<span class="c1">//... ...</span>
</code></pre>
</div>

<h4 id="可选操作是坑还是良好的设计">可选操作是坑？还是良好的设计？</h4>
<p>书上对此的解释是：</p>
<ul>
  <li>因为Arrays.asList()生成的List，基于一个固定大小的数组，所以仅支持那些不会改变数组大小的操作，是有道理的。</li>
</ul>

<p>我表示，很难接受这样的解释。这真的很坑。要么索性就重新取个名字，干嘛要取一样的名字骗我们呢。网上都把这个错误列为<a href="http://www.importnew.com/12074.html"><strong>《Java程序员们最常犯的10个错误》</strong></a>之首了好吗，真的不能原谅。</p>

<p>类似这样的“未获支持的操作”的坑，还有<strong>Collections.unmodifiableList()</strong>方法返回的Collection。除了以上列出来的方法，它还禁掉了一个List.set()方法，因为它返回的容器不仅仅是固定大小，还完全不能修改。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"A B C D E F G H I J K L"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">));</span>
<span class="n">Collections</span><span class="o">.</span><span class="na">unmodifiableList</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">list</span><span class="o">));</span>
</code></pre>
</div>

<p>书上更深层的解释是：</p>
<ul>
  <li>这样设计是为了防止“接口爆炸”。</li>
</ul>

<p>因为上面两个例子，就省去了FixSizeList和UnmodifiableList两个接口。</p>

<h3 id="abstractcollection抽象类">AbstractCollection抽象类</h3>
<p>翻一下AbstractCollection抽象类的源码。看到它是完全不依赖于任何数据而独立存在的。对它的简单描述应该是这样：</p>
<ol>
  <li>是个空壳，没有数据。</li>
  <li>所有定义的操作全都指向一个假象的数据体。</li>
  <li>操作和数据之间唯二的发生关系的途径是通过：<strong>get()</strong>和<strong>size()</strong>两个方法。而这两个方法是抽象方法，留给用户自己定义。</li>
  <li>大致的思路就是以size()为界，用Iterator遍历元素。然后假设get()方法能返回元素。能完成几乎所有读取，查找，转换操作。</li>
  <li>然后写操作的add()方法是未定义操作UnsupportedOperationException。</li>
</ol>

<p>所以AbstractCollection是完全没有实体的。</p>

<h3 id="list">List</h3>
<p>工程模型和Collection是一致的，操作也分成：读取元素，检查元素，改变元素，迭代器，类型转换，这几大类。不赘述。</p>

<p>需要注意：<strong>List有个更强大的迭代器ListIterator。</strong> 遍历能往前，往后，双向移动。还有写操作add(),set()。看下图，
<img src="/images/tij4-17/listIterator.png" alt="listIterator" /></p>

<h4 id="单向链表设计思路">单向链表设计思路</h4>
<p>比较重要的几个点，方便以后回顾比较：</p>
<ol>
  <li>节点的数据结构很清楚：一部分放数据，一部分是指向下一个节点的指针。</li>
  <li>个人比较喜欢：前后两个固定的头节点head和尾节点tail。只站桩，无数据。</li>
  <li>其中，只有头节点是必须的。无头节点的话，对第一个元素的操作会和其他元素不同，代码复杂化。</li>
  <li>尾节点可以没有。可以让最后一个元素指向null。加尾节点是为了在末尾插入新元素更高效。不然就得从head遍历到最后一个元素，再插入。</li>
  <li>head.next指向第一个节点，tail.next指向最后一个节点。当链表为空，head.next=tail。 tail.next=head。</li>
  <li>cursor光标表示上一个next()方法返回的节点。</li>
  <li>previous引用盯住cursor。表示cursor的前一个节点。为了remove()的时候能找到前一个节点的向后引用。</li>
  <li>每一次调用next()，只能用remove()方法删除一次当前节点。删除完，光标退回上一节点。</li>
  <li>只有两种情况，previous和cursor指向同一个节点：要么初始阶段还没有调用过next()。要么next()返回的上一个节点被remove()方法删掉。</li>
  <li>previous和cursor永远不可能指向tail。</li>
</ol>

<p>关于LinkedList头节点的总结：</p>
<ol>
  <li>头节点是不储存元素信息的纯功能性节点。用来停放指针。</li>
  <li>单纯从功能上讲，单个头节点head就够了。不需要尾节点。</li>
  <li>没有head头节点的话，大部分操作对第一个元素和后续元素，实现都不同。导致逻辑复杂。容易出bug。编程目标是不出错，不是为了挑战脑力。</li>
  <li>不需要专门的桩子尾节点。但需要一个tail指针，指向末尾元素，方便从末尾插入新元素。</li>
  <li>双头节点版本：一个头节点head，一个尾节点tail。也没什么不好。反而逻辑清楚。</li>
  <li>JDK里的官方LinkedList是没有头节点的版本。不知道为什么。难道是节约内存？</li>
</ol>

<h3 id="set">Set</h3>
<p>Set主要有两个点：</p>
<ol>
  <li>内部元素唯一性。</li>
  <li>维持特定的元素排序。不同类型Set的排序方式不同。</li>
</ol>

<p>其中：</p>
<ol>
  <li>HashSet：以散列值对set容量取余后决定的下标。没有规律。</li>
  <li>TreeSet：保持降序。</li>
  <li>LinkedHashSet：保持插入顺序。</li>
</ol>

<h4 id="set对内部元素的要求">Set对内部元素的要求</h4>
<p>希望放入Set中的元素类型必须先实现一些特定方法：</p>
<ol>
  <li>所有实现Set接口的类，都要求内部元素实现equals()方法。为了保证唯一性。</li>
  <li>HashSet系的还要实现hashCode()方法。</li>
  <li>以TreeSet为代表的SortedSet系需要内部元素实现Comparable接口。也就是实现compareTo()方法。</li>
</ol>

<p>没有实现特定方法，存到Set里就会乱套。但编译器不会报错。因为默认的equals()和hashCode()虽然是错的，但是能运行的。</p>

<h4 id="自定义set">自定义Set</h4>
<p>可以继承AbstractSet抽象类。因为AbstractSet继承自AbstractCollection抽象类。加在一起，基本实现了Set接口。但有几个关键方法还需要自己定义：</p>
<ul>
  <li><strong>add()</strong></li>
  <li><strong>size()</strong></li>
  <li><strong>iterator()</strong></li>
  <li><strong>Iterator</strong></li>
</ul>

<p>比如下面是AbstractCollection里add()方法的源码。直接抛出异常。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<h3 id="队列queue">队列（Queue）</h3>
<p>队列的基本特点就是：先进先出（FIFO）。队列，顾名思义。</p>

<p>PriorityQueue是维持特定排序的Queue。</p>

<h3 id="双端队列deque">双端队列（Deque）</h3>
<p>Deque(Double End Queue)顾名思义，可以在头和尾两个方向实现Queue的抽插。</p>

<p>但Deque在实际工程中用的少。是因为现实生活中没有东西和这个模型对应。比如List对应“列表”。Set对应“集合”。Map对应“字典”。Queue对应“队列”。但没有什么东西需要从两段存取。</p>

<h3 id="映射map">映射（Map）</h3>
<p>都有哪些Map？贴一张图。
<img src="/images/tij4-17/map.png" alt="map" /></p>

<p>最常用的还是HashMap，效率最高。</p>

<h4 id="自定义map">自定义Map</h4>
<p>自定义Map可以继承AbstractMap。但必须自己实现几个方法：</p>
<ul>
  <li><strong><code class="highlighter-rouge">Map.Entry&lt;K,V&gt;</code></strong>接口</li>
  <li><strong>entrySet()</strong>方法</li>
  <li><strong>put()</strong>方法</li>
</ul>

<p>自定义Map的关键在于定义一个键值对的Pair：叫<strong><code class="highlighter-rouge">Map.Entry&lt;K,V&gt;</code></strong>的内部类接口。也可以用一个独立的类来实现这个接口。这个数据结构把Map里的一个“键-值”对捏合成单个元素。</p>

<p>然后定义一个“entrySet()”方法，返回一个Map.Entry元素的集合<strong><code class="highlighter-rouge">Set&lt;Map.Entry&lt;K,V&gt;&gt;</code></strong>。
<img src="/images/tij4-17/mapEntry.png" alt="mapEntry" /></p>

<p>Map接口的大多数方法，AbstractMap都实现了。但这个entrySet()方法是抽象方法，需要自己定义。因为，大多数的方法都是通过entrySet()方法把Map转换成Set来完成的。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">();</span>
</code></pre>
</div>
<p>实现etnrySet()的时候，返回的Set应该是原本Map的<strong>“视图”</strong>，不要返回<strong>“副本”</strong>。也就是直接返回Map内部数据的引用，而不是一份拷贝。要返回<strong>“视图”</strong>，可以返回一个没有实体数据，但带有一个Iterator的Set。具体实现，参见本章练习题16。</p>

<p>另外一个需要自己定义的方法是<strong>put()</strong>。下面是AbstractMap里put()方法的源代码，</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre>
</div>

<h4 id="唯一性">唯一性</h4>
<p>Map和Set的唯一性，由<strong>hashCode()</strong>和<strong>equals()</strong>两个方法来判定。逻辑上不冲突，因为equals()判断为真的两个键值，hashCode()返回值必须相等。这是对hashCode()方法的基本设计要求。</p>

<p>下面是HashMap里put()方法的源码。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="k">return</span> <span class="nf">putForNullKey</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">k</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">)))</span> <span class="o">{</span>	<span class="c1">//注意这一行</span>
                <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
                <span class="n">e</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
                <span class="n">e</span><span class="o">.</span><span class="na">recordAccess</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">modCount</span><span class="o">++;</span>
        <span class="n">addEntry</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>
<p>注意<code class="highlighter-rouge">if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))</code>这个就是根据equal()和hashCode()两个函数返回值判定唯一性的判定语句。</p>

<p>另外，对equals()函数多说两句。判定值相等，虽然简单，但必须满足下面5个逻辑条件：</p>
<ol>
  <li>自反性。x=x必须为true。</li>
  <li>对称性。如果x=y为true，y=x也必须返回true。</li>
  <li>传递性。如果x=y,y=z。那么x=z必须返回true。</li>
  <li>一致性。在x和y都没变的情况下。每次测试x=y必须返回一样的结果。</li>
  <li>任何不是null的x。x.equals(null)必须返回false。</li>
</ol>

<h4 id="散列值hashcode">散列值（hashCode()）</h4>
<p>关于散列值，参见之前的一篇：<a href="http://www.ciaoshen.com/2016/07/16/hash/"><strong>《Java HashMap的哈希值是怎么计算的？》</strong></a>。 这里简单强调几个基本<strong>逻辑层次</strong>：</p>
<ol>
  <li>HashMap的基本理念是：通过对内部数组直接下标访问，做到get()普通情况O(1).</li>
  <li>下标访问的原理：对key键值执行hashCode()函数，生成散列值（一般比较大），然后对内部数组大小取余运算，获得数组下标。</li>
  <li>hashCode()在Object根类就定义了。几乎每个类都重写了这个方法。</li>
  <li>自己写hashCode()要符合两个基本逻辑：第一，同一个对象每次的散列值必须相等。第二，两个equals()判定值相等的对象，散列值也要相等。</li>
</ol>

<h3 id="简单容器测试框架">简单容器测试框架</h3>
<p>非常简单的一个模块化封装实践，主要记住思路：</p>
<ol>
  <li>testframework.Test.java:	框架模块1：封装测试类</li>
  <li>testframework.TestParam.java:	框架模块2：封装测试参数。</li>
  <li>testframework.Tester.java:	框架模块3：运行测试工具包。</li>
  <li>testframework.gen.*:	框架模块4：模拟数据生成器包。</li>
</ol>

<p>最终实现的功能是：</p>
<ol>
  <li>可以自定义扩展测试类（Test.java定义）。</li>
  <li>给一种容器，和一个参数包，自动对容器执行不同参数的全套测试。</li>
</ol>

<h3 id="关于垃圾回收再唐僧几句">关于垃圾回收再唐僧几句</h3>

<h4 id="gc不是什么都管">GC不是什么都管</h4>
<p>GC只负责回收内存。那什么东西GC不负责回收？native方法开辟的资源，比如如native memory（DirectByteBuffer）、file（FileInputStream）之类，GC是不管的，必须自己关掉。所以常见的图形，IO都必须自己关。</p>

<h4 id="finalize-方法作为gc的补充">finalize( )方法作为GC的补充</h4>
<p>既然GC有些东西不管，那也要有办法释放。这可以用finalize()方法。GC在释放被复写finalize()方法的对象的时候，会先调用其finalize()方法。</p>

<h4 id="finalize-方法靠不住不要用">finalize( )方法靠不住，不要用</h4>
<p>GC在回收对象之前，是会先调用finalize()方法。但GC本身执行时机不确定。调用System.gc()方法只是“建议”系统进行垃圾回收，但具体执不执行，还是JVM说了算。说白了，我们对垃圾回收这件事，没有控制权。</p>

<p>而且，触发GC以后，执行finalize()方法，系统是交给Finalizer来做。而且Finalizer坐在另一个Finalizer Daemon Thread线程里。而且此线程优先级比主线程低得多。什么时候执行finalize()不确定。</p>

<p>具体，参考<a href="http://www.ciaoshen.com/2016/09/28/phantom/"><strong>《JAVA虚引用为什么在重载finalize后不会被置入引用队列?》</strong></a>专题。</p>

<ul>
  <li><strong>Joshua Bloch在Effective Java里建议避免使用finalize()方法。</strong></li>
</ul>

<h4 id="finalize-只能被调用一次">finalize( )只能被调用一次</h4>
<p>任何对象的finalize()只能被调用一次。</p>

<h3 id="引用的不同强度">引用的不同强度</h3>
<p>关于弱引用方面不错的一篇文章：
<a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/"><strong>《深入探讨 java.lang.ref 包》</strong></a></p>

<p>四种不同强度reference的定义：
1.<strong>普通引用</strong>：没什么好说的。
2.<strong>软引用（SoftReference）</strong>：系统资源紧张的时候，系统会删除软引用。优先删除长久没用的引用。
3.<strong>弱引用（WeakReference）</strong>：GC的时候删除清理弱引用。
4.<strong>虚引用（PhantomReference）</strong>：通过虚引用无法获得对象。</p>

<h4 id="referencequeue">ReferenceQueue</h4>
<p>当软引用，弱引用，虚引用被系统清除以后，如果绑定了ReferenceQueue，这些引用会被加入ReferenceQueue。</p>

<p>虚引用（PhantomReference）构造函数必须传入一个ReferenceQueue作为参数。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="nf">PhantomReference</span><span class="o">(</span><span class="n">T</span> <span class="n">referent</span><span class="o">,</span> <span class="n">ReferenceQueue</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">q</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">referent</span><span class="o">,</span> <span class="n">q</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>

<p>软引用和弱引用可以选择在构造函数传入ReferenceQueue或者不传入。</p>

<p>不同强度引用被加入ReferenceQueue的时机不同：</p>
<ol>
  <li>当一个对象只维持着WeakReference，直接被加入ReferenceQueue。然后等待被GC销毁。</li>
  <li>当一个对象只维持着PhantomReference，GC先销毁对象，然后把这个虚引用加入ReferenceQueue。</li>
</ol>

<h4 id="weakhashmap">WeakHashMap</h4>
<ol>
  <li>内部类Entry直接继承WeakReference。</li>
  <li>键值Key被包装成WeakReference的referent。</li>
  <li>当Key被销毁回收，整个Entry都被销毁。</li>
</ol>

<p><strong>WeakHashMap有个坑</strong>：Entry的Key是可以被系统收回。但Key指向的对象被系统回收以后，整个Entry的引用是靠expungeStaleEntries()方法从Map里删除的。但expungeStaleEntries()方法只有在getTable(), size(), 和resize()方法执行的时候被调用。</p>

<p>模仿WeakHashMap的结构，但不写expungeStaleEntries()方法，</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">WeakPair</span> <span class="kd">extends</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ReferenceQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rq</span><span class="o">=</span><span class="k">new</span> <span class="n">ReferenceQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">bucket</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">WeakPair</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">i</span><span class="o">){</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">s</span><span class="o">,</span><span class="n">rq</span><span class="o">);</span>
        <span class="n">bucket</span><span class="o">=</span><span class="n">i</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getInfo</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">get</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getBucket</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">bucket</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">ReferenceQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getQueue</span><span class="o">(){</span><span class="k">return</span> <span class="n">rq</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="n">get</span><span class="o">()+</span><span class="s">"@"</span><span class="o">+</span><span class="n">bucket</span><span class="o">;}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>填充List，然后触发GC，</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">WeakPair</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">WeakPair</span><span class="o">&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">WeakPair</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">();</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
        <span class="n">ReferenceQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">rq</span><span class="o">=</span><span class="n">WeakPair</span><span class="o">.</span><span class="na">getQueue</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
</code></pre>
</div>

<p>只有WeakReference的字段部分被回收，而不是整个WeakPair被回收。</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="o">[</span>hiGBEVQ@0, FVhKmED@1, fiRCVzX@2, UOsEWSp@3, egASflb@4, ViKBfJl@5, PaoWYpQ@6, FoUpkau@7, GtRluvU@8, NsyhpYx@9]

<span class="o">[</span>null@0, null@1, null@2, null@3, null@4, null@5, null@6, null@7, null@8, null@9]
</code></pre>
</div>

<p>一种极端的情况是，有很多个WeakHashMap。每个只插入一个很占内存的Entry。一直不对WeakHashMap做任何其他操作。就算主动System.gc()还是会OOM。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>  
    <span class="n">List</span><span class="o">&lt;</span><span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[][],</span> <span class="kt">byte</span><span class="o">[][]&gt;&gt;</span> <span class="n">maps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[][],</span> <span class="kt">byte</span><span class="o">[][]&gt;&gt;();</span>  
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>  
        <span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[][],</span> <span class="kt">byte</span><span class="o">[][]&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[][],</span> <span class="kt">byte</span><span class="o">[][]&gt;();</span>  
        <span class="n">d</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1000</span><span class="o">][</span><span class="mi">1000</span><span class="o">],</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1000</span><span class="o">][</span><span class="mi">1000</span><span class="o">]);</span>  
        <span class="n">maps</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">d</span><span class="o">);</span>  
        <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">();</span>  
        <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>  
    <span class="o">}</span>  
<span class="o">}</span>  
</code></pre>
</div>

<h3 id="练习">练习</h3>
<p>本章习题依赖的工具有：</p>

<h4 id="mycountriesjava">MyCountries.java</h4>
<p>我自己重新写的一个“国家-首都”填充器。也是基于享元模式。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCountries</span> <span class="o">{</span>
    <span class="cm">/**
     *  数据二维数组
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[][]</span> <span class="n">DATA</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// Africa</span>
    <span class="o">{</span><span class="s">"ALGERIA"</span><span class="o">,</span><span class="s">"Algiers"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ANGOLA"</span><span class="o">,</span><span class="s">"Luanda"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BENIN"</span><span class="o">,</span><span class="s">"Porto-Novo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BOTSWANA"</span><span class="o">,</span><span class="s">"Gaberone"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BURKINA FASO"</span><span class="o">,</span><span class="s">"Ouagadougou"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BURUNDI"</span><span class="o">,</span><span class="s">"Bujumbura"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CAMEROON"</span><span class="o">,</span><span class="s">"Yaounde"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CAPE VERDE"</span><span class="o">,</span><span class="s">"Praia"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CENTRAL AFRICAN REPUBLIC"</span><span class="o">,</span><span class="s">"Bangui"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CHAD"</span><span class="o">,</span><span class="s">"N’djamena"</span><span class="o">},</span> <span class="o">{</span><span class="s">"COMOROS"</span><span class="o">,</span><span class="s">"Moroni"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CONGO"</span><span class="o">,</span><span class="s">"Brazzaville"</span><span class="o">},</span> <span class="o">{</span><span class="s">"DJIBOUTI"</span><span class="o">,</span><span class="s">"Dijibouti"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"EGYPT"</span><span class="o">,</span><span class="s">"Cairo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"EQUATORIAL GUINEA"</span><span class="o">,</span><span class="s">"Malabo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ERITREA"</span><span class="o">,</span><span class="s">"Asmara"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ETHIOPIA"</span><span class="o">,</span><span class="s">"Addis Ababa"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GABON"</span><span class="o">,</span><span class="s">"Libreville"</span><span class="o">},</span> <span class="o">{</span><span class="s">"THE GAMBIA"</span><span class="o">,</span><span class="s">"Banjul"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GHANA"</span><span class="o">,</span><span class="s">"Accra"</span><span class="o">},</span> <span class="o">{</span><span class="s">"GUINEA"</span><span class="o">,</span><span class="s">"Conakry"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BISSAU"</span><span class="o">,</span><span class="s">"Bissau"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"COTE D’IVOIR (IVORY COAST)"</span><span class="o">,</span><span class="s">"Yamoussoukro"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"KENYA"</span><span class="o">,</span><span class="s">"Nairobi"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LESOTHO"</span><span class="o">,</span><span class="s">"Maseru"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LIBERIA"</span><span class="o">,</span><span class="s">"Monrovia"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LIBYA"</span><span class="o">,</span><span class="s">"Tripoli"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MADAGASCAR"</span><span class="o">,</span><span class="s">"Antananarivo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MALAWI"</span><span class="o">,</span><span class="s">"Lilongwe"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MALI"</span><span class="o">,</span><span class="s">"Bamako"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MAURITANIA"</span><span class="o">,</span><span class="s">"Nouakchott"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MAURITIUS"</span><span class="o">,</span><span class="s">"Port Louis"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MOROCCO"</span><span class="o">,</span><span class="s">"Rabat"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MOZAMBIQUE"</span><span class="o">,</span><span class="s">"Maputo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NAMIBIA"</span><span class="o">,</span><span class="s">"Windhoek"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NIGER"</span><span class="o">,</span><span class="s">"Niamey"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NIGERIA"</span><span class="o">,</span><span class="s">"Abuja"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"RWANDA"</span><span class="o">,</span><span class="s">"Kigali"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SAO TOME E PRINCIPE"</span><span class="o">,</span><span class="s">"Sao Tome"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SENEGAL"</span><span class="o">,</span><span class="s">"Dakar"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SEYCHELLES"</span><span class="o">,</span><span class="s">"Victoria"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SIERRA LEONE"</span><span class="o">,</span><span class="s">"Freetown"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SOMALIA"</span><span class="o">,</span><span class="s">"Mogadishu"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SOUTH AFRICA"</span><span class="o">,</span><span class="s">"Pretoria/Cape Town"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SUDAN"</span><span class="o">,</span><span class="s">"Khartoum"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SWAZILAND"</span><span class="o">,</span><span class="s">"Mbabane"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TANZANIA"</span><span class="o">,</span><span class="s">"Dodoma"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TOGO"</span><span class="o">,</span><span class="s">"Lome"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TUNISIA"</span><span class="o">,</span><span class="s">"Tunis"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UGANDA"</span><span class="o">,</span><span class="s">"Kampala"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"DEMOCRATIC REPUBLIC OF THE CONGO (ZAIRE)"</span><span class="o">,</span>
    <span class="s">"Kinshasa"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ZAMBIA"</span><span class="o">,</span><span class="s">"Lusaka"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ZIMBABWE"</span><span class="o">,</span><span class="s">"Harare"</span><span class="o">},</span>
    <span class="c1">// Asia</span>
    <span class="o">{</span><span class="s">"AFGHANISTAN"</span><span class="o">,</span><span class="s">"Kabul"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BAHRAIN"</span><span class="o">,</span><span class="s">"Manama"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BANGLADESH"</span><span class="o">,</span><span class="s">"Dhaka"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BHUTAN"</span><span class="o">,</span><span class="s">"Thimphu"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BRUNEI"</span><span class="o">,</span><span class="s">"Bandar Seri Begawan"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CAMBODIA"</span><span class="o">,</span><span class="s">"Phnom Penh"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CHINA"</span><span class="o">,</span><span class="s">"Beijing"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CYPRUS"</span><span class="o">,</span><span class="s">"Nicosia"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"INDIA"</span><span class="o">,</span><span class="s">"New Delhi"</span><span class="o">},</span> <span class="o">{</span><span class="s">"INDONESIA"</span><span class="o">,</span><span class="s">"Jakarta"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"IRAN"</span><span class="o">,</span><span class="s">"Tehran"</span><span class="o">},</span> <span class="o">{</span><span class="s">"IRAQ"</span><span class="o">,</span><span class="s">"Baghdad"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ISRAEL"</span><span class="o">,</span><span class="s">"Jerusalem"</span><span class="o">},</span> <span class="o">{</span><span class="s">"JAPAN"</span><span class="o">,</span><span class="s">"Tokyo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"JORDAN"</span><span class="o">,</span><span class="s">"Amman"</span><span class="o">},</span> <span class="o">{</span><span class="s">"KUWAIT"</span><span class="o">,</span><span class="s">"Kuwait City"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LAOS"</span><span class="o">,</span><span class="s">"Vientiane"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LEBANON"</span><span class="o">,</span><span class="s">"Beirut"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MALAYSIA"</span><span class="o">,</span><span class="s">"Kuala Lumpur"</span><span class="o">},</span> <span class="o">{</span><span class="s">"THE MALDIVES"</span><span class="o">,</span><span class="s">"Male"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MONGOLIA"</span><span class="o">,</span><span class="s">"Ulan Bator"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MYANMAR (BURMA)"</span><span class="o">,</span><span class="s">"Rangoon"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NEPAL"</span><span class="o">,</span><span class="s">"Katmandu"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NORTH KOREA"</span><span class="o">,</span><span class="s">"P’yongyang"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"OMAN"</span><span class="o">,</span><span class="s">"Muscat"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PAKISTAN"</span><span class="o">,</span><span class="s">"Islamabad"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PHILIPPINES"</span><span class="o">,</span><span class="s">"Manila"</span><span class="o">},</span> <span class="o">{</span><span class="s">"QATAR"</span><span class="o">,</span><span class="s">"Doha"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SAUDI ARABIA"</span><span class="o">,</span><span class="s">"Riyadh"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SINGAPORE"</span><span class="o">,</span><span class="s">"Singapore"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SOUTH KOREA"</span><span class="o">,</span><span class="s">"Seoul"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SRI LANKA"</span><span class="o">,</span><span class="s">"Colombo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SYRIA"</span><span class="o">,</span><span class="s">"Damascus"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TAIWAN (REPUBLIC OF CHINA)"</span><span class="o">,</span><span class="s">"Taipei"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"THAILAND"</span><span class="o">,</span><span class="s">"Bangkok"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TURKEY"</span><span class="o">,</span><span class="s">"Ankara"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UNITED ARAB EMIRATES"</span><span class="o">,</span><span class="s">"Abu Dhabi"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"VIETNAM"</span><span class="o">,</span><span class="s">"Hanoi"</span><span class="o">},</span> <span class="o">{</span><span class="s">"YEMEN"</span><span class="o">,</span><span class="s">"Sana’a"</span><span class="o">},</span>
    <span class="c1">// Australia and Oceania</span>
    <span class="o">{</span><span class="s">"AUSTRALIA"</span><span class="o">,</span><span class="s">"Canberra"</span><span class="o">},</span> <span class="o">{</span><span class="s">"FIJI"</span><span class="o">,</span><span class="s">"Suva"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"KIRIBATI"</span><span class="o">,</span><span class="s">"Bairiki"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MARSHALL ISLANDS"</span><span class="o">,</span><span class="s">"Dalap-Uliga-Darrit"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MICRONESIA"</span><span class="o">,</span><span class="s">"Palikir"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NAURU"</span><span class="o">,</span><span class="s">"Yaren"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NEW ZEALAND"</span><span class="o">,</span><span class="s">"Wellington"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PALAU"</span><span class="o">,</span><span class="s">"Koror"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PAPUA NEW GUINEA"</span><span class="o">,</span><span class="s">"Port Moresby"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SOLOMON ISLANDS"</span><span class="o">,</span><span class="s">"Honaira"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TONGA"</span><span class="o">,</span><span class="s">"Nuku’alofa"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TUVALU"</span><span class="o">,</span><span class="s">"Fongafale"</span><span class="o">},</span> <span class="o">{</span><span class="s">"VANUATU"</span><span class="o">,</span><span class="s">"&lt; Port-Vila"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"WESTERN SAMOA"</span><span class="o">,</span><span class="s">"Apia"</span><span class="o">},</span>
    <span class="c1">// Eastern Europe and former USSR</span>
    <span class="o">{</span><span class="s">"ARMENIA"</span><span class="o">,</span><span class="s">"Yerevan"</span><span class="o">},</span> <span class="o">{</span><span class="s">"AZERBAIJAN"</span><span class="o">,</span><span class="s">"Baku"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BELARUS (BYELORUSSIA)"</span><span class="o">,</span><span class="s">"Minsk"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BULGARIA"</span><span class="o">,</span><span class="s">"Sofia"</span><span class="o">},</span> <span class="o">{</span><span class="s">"GEORGIA"</span><span class="o">,</span><span class="s">"Tbilisi"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"KAZAKSTAN"</span><span class="o">,</span><span class="s">"Almaty"</span><span class="o">},</span> <span class="o">{</span><span class="s">"KYRGYZSTAN"</span><span class="o">,</span><span class="s">"Alma-Ata"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MOLDOVA"</span><span class="o">,</span><span class="s">"Chisinau"</span><span class="o">},</span> <span class="o">{</span><span class="s">"RUSSIA"</span><span class="o">,</span><span class="s">"Moscow"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TAJIKISTAN"</span><span class="o">,</span><span class="s">"Dushanbe"</span><span class="o">},</span> <span class="o">{</span><span class="s">"TURKMENISTAN"</span><span class="o">,</span><span class="s">"Ashkabad"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UKRAINE"</span><span class="o">,</span><span class="s">"Kyiv"</span><span class="o">},</span> <span class="o">{</span><span class="s">"UZBEKISTAN"</span><span class="o">,</span><span class="s">"Tashkent"</span><span class="o">},</span>
    <span class="c1">// Europe</span>
    <span class="o">{</span><span class="s">"ALBANIA"</span><span class="o">,</span><span class="s">"Tirana"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ANDORRA"</span><span class="o">,</span><span class="s">"Andorra la Vella"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"AUSTRIA"</span><span class="o">,</span><span class="s">"Vienna"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BELGIUM"</span><span class="o">,</span><span class="s">"Brussels"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BOSNIA"</span><span class="o">,</span><span class="s">"-"</span><span class="o">},</span> <span class="o">{</span><span class="s">"HERZEGOVINA"</span><span class="o">,</span><span class="s">"Sarajevo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CROATIA"</span><span class="o">,</span><span class="s">"Zagreb"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CZECH REPUBLIC"</span><span class="o">,</span><span class="s">"Prague"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"DENMARK"</span><span class="o">,</span><span class="s">"Copenhagen"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ESTONIA"</span><span class="o">,</span><span class="s">"Tallinn"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"FINLAND"</span><span class="o">,</span><span class="s">"Helsinki"</span><span class="o">},</span> <span class="o">{</span><span class="s">"FRANCE"</span><span class="o">,</span><span class="s">"Paris"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GERMANY"</span><span class="o">,</span><span class="s">"Berlin"</span><span class="o">},</span> <span class="o">{</span><span class="s">"GREECE"</span><span class="o">,</span><span class="s">"Athens"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"HUNGARY"</span><span class="o">,</span><span class="s">"Budapest"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ICELAND"</span><span class="o">,</span><span class="s">"Reykjavik"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"IRELAND"</span><span class="o">,</span><span class="s">"Dublin"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ITALY"</span><span class="o">,</span><span class="s">"Rome"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LATVIA"</span><span class="o">,</span><span class="s">"Riga"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LIECHTENSTEIN"</span><span class="o">,</span><span class="s">"Vaduz"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"LITHUANIA"</span><span class="o">,</span><span class="s">"Vilnius"</span><span class="o">},</span> <span class="o">{</span><span class="s">"LUXEMBOURG"</span><span class="o">,</span><span class="s">"Luxembourg"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MACEDONIA"</span><span class="o">,</span><span class="s">"Skopje"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MALTA"</span><span class="o">,</span><span class="s">"Valletta"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MONACO"</span><span class="o">,</span><span class="s">"Monaco"</span><span class="o">},</span> <span class="o">{</span><span class="s">"MONTENEGRO"</span><span class="o">,</span><span class="s">"Podgorica"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"THE NETHERLANDS"</span><span class="o">,</span><span class="s">"Amsterdam"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NORWAY"</span><span class="o">,</span><span class="s">"Oslo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"POLAND"</span><span class="o">,</span><span class="s">"Warsaw"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PORTUGAL"</span><span class="o">,</span><span class="s">"Lisbon"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ROMANIA"</span><span class="o">,</span><span class="s">"Bucharest"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SAN MARINO"</span><span class="o">,</span><span class="s">"San Marino"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SERBIA"</span><span class="o">,</span><span class="s">"Belgrade"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SLOVAKIA"</span><span class="o">,</span><span class="s">"Bratislava"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SLOVENIA"</span><span class="o">,</span><span class="s">"Ljuijana"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SPAIN"</span><span class="o">,</span><span class="s">"Madrid"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"SWEDEN"</span><span class="o">,</span><span class="s">"Stockholm"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SWITZERLAND"</span><span class="o">,</span><span class="s">"Berne"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UNITED KINGDOM"</span><span class="o">,</span><span class="s">"London"</span><span class="o">},</span> <span class="o">{</span><span class="s">"VATICAN CITY"</span><span class="o">,</span><span class="s">"---"</span><span class="o">},</span>
    <span class="c1">// North and Central America</span>
    <span class="o">{</span><span class="s">"ANTIGUA AND BARBUDA"</span><span class="o">,</span><span class="s">"Saint John’s"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BAHAMAS"</span><span class="o">,</span><span class="s">"Nassau"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BARBADOS"</span><span class="o">,</span><span class="s">"Bridgetown"</span><span class="o">},</span> <span class="o">{</span><span class="s">"BELIZE"</span><span class="o">,</span><span class="s">"Belmopan"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CANADA"</span><span class="o">,</span><span class="s">"Ottawa"</span><span class="o">},</span> <span class="o">{</span><span class="s">"COSTA RICA"</span><span class="o">,</span><span class="s">"San Jose"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"CUBA"</span><span class="o">,</span><span class="s">"Havana"</span><span class="o">},</span> <span class="o">{</span><span class="s">"DOMINICA"</span><span class="o">,</span><span class="s">"Roseau"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"DOMINICAN REPUBLIC"</span><span class="o">,</span><span class="s">"Santo Domingo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"EL SALVADOR"</span><span class="o">,</span><span class="s">"San Salvador"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GRENADA"</span><span class="o">,</span><span class="s">"Saint George’s"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GUATEMALA"</span><span class="o">,</span><span class="s">"Guatemala City"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"HAITI"</span><span class="o">,</span><span class="s">"Port-au-Prince"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"HONDURAS"</span><span class="o">,</span><span class="s">"Tegucigalpa"</span><span class="o">},</span> <span class="o">{</span><span class="s">"JAMAICA"</span><span class="o">,</span><span class="s">"Kingston"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"MEXICO"</span><span class="o">,</span><span class="s">"Mexico City"</span><span class="o">},</span> <span class="o">{</span><span class="s">"NICARAGUA"</span><span class="o">,</span><span class="s">"Managua"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PANAMA"</span><span class="o">,</span><span class="s">"Panama City"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ST. KITTS"</span><span class="o">,</span><span class="s">"-"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"NEVIS"</span><span class="o">,</span><span class="s">"Basseterre"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ST. LUCIA"</span><span class="o">,</span><span class="s">"Castries"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"ST. VINCENT AND THE GRENADINES"</span><span class="o">,</span><span class="s">"Kingstown"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"UNITED STATES OF AMERICA"</span><span class="o">,</span><span class="s">"Washington, D.C."</span><span class="o">},</span>
    <span class="c1">// South America</span>
    <span class="o">{</span><span class="s">"ARGENTINA"</span><span class="o">,</span><span class="s">"Buenos Aires"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BOLIVIA"</span><span class="o">,</span><span class="s">"Sucre (legal)/La Paz(administrative)"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"BRAZIL"</span><span class="o">,</span><span class="s">"Brasilia"</span><span class="o">},</span> <span class="o">{</span><span class="s">"CHILE"</span><span class="o">,</span><span class="s">"Santiago"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"COLOMBIA"</span><span class="o">,</span><span class="s">"Bogota"</span><span class="o">},</span> <span class="o">{</span><span class="s">"ECUADOR"</span><span class="o">,</span><span class="s">"Quito"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"GUYANA"</span><span class="o">,</span><span class="s">"Georgetown"</span><span class="o">},</span> <span class="o">{</span><span class="s">"PARAGUAY"</span><span class="o">,</span><span class="s">"Asuncion"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"PERU"</span><span class="o">,</span><span class="s">"Lima"</span><span class="o">},</span> <span class="o">{</span><span class="s">"SURINAME"</span><span class="o">,</span><span class="s">"Paramaribo"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"TRINIDAD AND TOBAGO"</span><span class="o">,</span><span class="s">"Port of Spain"</span><span class="o">},</span>
    <span class="o">{</span><span class="s">"URUGUAY"</span><span class="o">,</span><span class="s">"Montevideo"</span><span class="o">},</span> <span class="o">{</span><span class="s">"VENEZUELA"</span><span class="o">,</span><span class="s">"Caracas"</span><span class="o">},</span>
    <span class="o">};</span>


    <span class="cm">/**
     * 套嵌MAP
     * 实现 AbstractMap 要实现 entrySet()。因为AbstractMap没有实现Map接口定义的entrySet方法。
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CountriesMap</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;{</span>

        <span class="cm">/**
         * MAP内部二层套嵌类Entry 实现 Map.Entry 套嵌泛型类。这里为了支持享元，要重写两个方法：getKey()和getValue()。
         * 享元模式：Entry只要一个index字段。Entry所有内容根据这个index到享元里找。
         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;{</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
            <span class="kd">public</span> <span class="nf">Entry</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">index</span><span class="o">=</span><span class="n">index</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKey</span><span class="o">(){</span><span class="k">return</span> <span class="n">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">%</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">][</span><span class="mi">0</span><span class="o">];}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">(){</span><span class="k">return</span> <span class="n">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">%</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">][</span><span class="mi">1</span><span class="o">];}</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span><span class="k">return</span> <span class="n">getKey</span><span class="o">()==((</span><span class="n">Entry</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">getKey</span><span class="o">();}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span><span class="k">return</span> <span class="n">getValue</span><span class="o">().</span><span class="na">hashCode</span><span class="o">();}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">){</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>  <span class="c1">//只读，不支持改数据</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"("</span><span class="o">+</span><span class="n">getKey</span><span class="o">()+</span><span class="s">","</span><span class="o">+</span><span class="n">getValue</span><span class="o">()+</span><span class="s">")"</span><span class="o">;}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getIndex</span><span class="o">(){</span><span class="k">return</span> <span class="n">index</span><span class="o">;}</span>
        <span class="o">}</span>


        <span class="cm">/**
         * 二层套嵌 Set
         * 实现只读 AbstractSet 要实现 size() &amp; iterator()。 因为AbstractSet继承自AbstractCollection。但AbstractCollection中定义了size() &amp; iterator()方法，但没有实现。
         * 享元模式：只保留一个size字段。Set的所有内容根据这个size从享元中找。
         */</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;{</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
            <span class="kd">public</span> <span class="nf">EntrySet</span><span class="o">(){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
                <span class="k">if</span><span class="o">(</span><span class="n">size</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">size</span><span class="o">&gt;</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">){</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">size</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="cm">/**
             * Set 内部三层套嵌迭代器
             */</span>
            <span class="kd">private</span> <span class="kd">class</span> <span class="nc">EntryIterator</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;{</span>
                <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
                    <span class="k">return</span> <span class="n">index</span><span class="o">&lt;</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nf">Entry</span><span class="o">(</span><span class="n">index</span><span class="o">++);</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="o">(){</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;}</span>
            <span class="o">}</span>

            <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">(){</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">EntryIterator</span><span class="o">();</span>
            <span class="o">}</span>

        <span class="o">}</span>

        <span class="c1">//定义好了套嵌Set之后，写entrySet()方法</span>
        <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">(){</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="c1">//神奇的匿名内部类，重写entrySet()方法。</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">select</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CountriesMap</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">(){</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
    <span class="o">}</span>


    <span class="c1">//返回整个Map</span>
    <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="n">CountriesMap</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">capitals</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//返回部分Map</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">capitals</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">select</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//返回所有国家名的List</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">//返回部分国家名的List</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">names</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">capitals</span><span class="o">(</span><span class="n">size</span><span class="o">).</span><span class="na">keySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="randomgeneratorjava">RandomGenerator.java</h4>
<p>随机填充器。主要用来生成随机String，Integer等。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomGenerator</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

    <span class="c1">//Boolean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Boolean</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextBoolean</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Integer</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Integer</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Long</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Long</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextLong</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Short</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Short</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Float</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Float</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextFloat</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Double</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Double</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Byte</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Byte</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="n">rand</span><span class="o">.</span><span class="na">nextBytes</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//Charactor</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">CS</span><span class="o">=(</span><span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="o">+</span><span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="o">).</span><span class="na">toCharArray</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Character</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">CS</span><span class="o">[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">CS</span><span class="o">.</span><span class="na">length</span><span class="o">)];</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="c1">//String</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">String</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">Character</span><span class="o">();</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">(){}</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">size</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span><span class="o">=</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  测试
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span> <span class="n">s</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-1">Exercise 1</h4>
<ul>
  <li><strong>Exercise 1</strong>: (1) Create a List (try both ArrayList and LinkedList) and fill it using Countries. Sort the list and print it, then apply Collections.shuffle( ) to the list repeatedly, printing it each time so that you can see how the shuffle( ) method randomizes the list differently each time.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">CountriesComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">entry1</span><span class="o">,</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">entry2</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">entry1</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">entry2</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise1</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="cm">/**
         *  ArrayList版本
         */</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">al</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">10</span><span class="o">).</span><span class="na">entrySet</span><span class="o">());</span>
        <span class="c1">//System.out.println(al);</span>
        <span class="cm">/**
         *  LinkedList版本
         */</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">ll</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">15</span><span class="o">).</span><span class="na">entrySet</span><span class="o">());</span>
        <span class="c1">//System.out.println(ll);</span>

        <span class="cm">/**
         *  排序再乱序
         */</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">al</span><span class="o">,</span> <span class="k">new</span> <span class="n">CountriesComparator</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">al</span><span class="o">);</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">shuffle</span><span class="o">(</span><span class="n">al</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">al</span><span class="o">);</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">al</span><span class="o">,</span> <span class="k">new</span> <span class="n">CountriesComparator</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">al</span><span class="o">);</span>
        <span class="n">Collections</span><span class="o">.</span><span class="na">shuffle</span><span class="o">(</span><span class="n">al</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">al</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-2">Exercise 2</h4>
<p>Exercise 2: (2) Produce a Map and a Set containing all the countries that begin with ‘A’.
在MyCountries.java里增加一个countriesBeginWithXXX()方法。</p>

<h5 id="mycountriesjava-1">MyCountries.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCountries</span> <span class="o">{</span>

	<span class="c1">//之前的代码... ...</span>

    <span class="c1">//返回国家名以“subName”开头的国家map</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">countriesBeginWithXXX</span><span class="o">(</span><span class="n">String</span> <span class="n">subName</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">hm</span><span class="o">=</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nl">entry:</span><span class="n">set</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">indexOf</span><span class="o">(</span><span class="n">subName</span><span class="o">)==</span><span class="mi">0</span><span class="o">){</span>
                <span class="n">hm</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">hm</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise2java">Exercise2.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise2</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="cm">/**
         *  "A"字母打头国家的Map
         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">countriesBeginWithXXX</span><span class="o">(</span><span class="s">"A"</span><span class="o">));</span>

        <span class="cm">/**
         *  "A"字母打头国家的Set
         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">countriesBeginWithXXX</span><span class="o">(</span><span class="s">"A"</span><span class="o">).</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-3">Exercise 3</h4>
<ul>
  <li><strong>Exercise 3</strong>: (1) Using Countries, fill a Set multiple times with the same data and verify that the Set ends up with only one of each instance. Try this with HashSet, LinkedHashSet, and TreeSet.</li>
</ul>

<h5 id="exercise3java">Exercise3.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise3</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="cm">/**
         *  AbstractSet版本: 按插入顺序
         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"##########################################"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      AbstractSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"##########################################"</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="na">entrySet</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="cm">/**
         *  HashSet版本：不保持插入顺序
         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"######################################"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      HashSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"######################################"</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="na">entrySet</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="cm">/**
         *  LinkedHashSet版本：保持插入顺序
         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"############################################"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      LinkedHashSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"############################################"</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="na">entrySet</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="cm">/**
         *  TreeSet版本: 按照ABCD顺序
         */</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"######################################"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      TreeSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"######################################"</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="na">entrySet</span><span class="o">());</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mycountriesjava-2">MyCountries.java</h5>
<p>在MyCountries.CountriesMap.Entry套嵌类里，要加一个compareTo()方法，以实现Comparable接口。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCountries</span> <span class="o">{</span>

	<span class="c1">//之前的代码 ... ...</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;,</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;{</span>
            <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
            <span class="kd">public</span> <span class="nf">Entry</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">){</span>
                <span class="k">this</span><span class="o">.</span><span class="na">index</span><span class="o">=</span><span class="n">index</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKey</span><span class="o">(){</span><span class="k">return</span> <span class="n">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">%</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">][</span><span class="mi">0</span><span class="o">];}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">(){</span><span class="k">return</span> <span class="n">DATA</span><span class="o">[</span><span class="n">index</span><span class="o">%</span><span class="n">DATA</span><span class="o">.</span><span class="na">length</span><span class="o">][</span><span class="mi">1</span><span class="o">];}</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span><span class="k">return</span> <span class="n">getKey</span><span class="o">()==((</span><span class="n">Entry</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">getKey</span><span class="o">();}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span><span class="k">return</span> <span class="n">getValue</span><span class="o">().</span><span class="na">hashCode</span><span class="o">();}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">){</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>  <span class="c1">//只读，不支持改数据</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"("</span><span class="o">+</span><span class="n">getKey</span><span class="o">()+</span><span class="s">","</span><span class="o">+</span><span class="n">getValue</span><span class="o">()+</span><span class="s">")"</span><span class="o">;}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getIndex</span><span class="o">(){</span><span class="k">return</span> <span class="n">index</span><span class="o">;}</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Entry</span> <span class="n">e</span><span class="o">){</span>
                <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>

	<span class="c1">//之后的代码 ... ...</span>
</code></pre>
</div>

<h4 id="exercise-4">Exercise 4</h4>
<ul>
  <li><strong>Exercise 4</strong>: (2) Create a Collection initializer that opens a file and breaks it into words using TextFile, and then uses the words as the source of data for the resulting Collection. Demonstrate that it works.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">CollectionInit</span><span class="o">{</span>
    <span class="c1">//读文件切词</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">readFile</span><span class="o">(</span><span class="n">String</span> <span class="n">inFile</span><span class="o">){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">in</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">inFile</span><span class="o">));</span>
            <span class="n">String</span> <span class="n">s</span><span class="o">;</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">words</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
                <span class="k">try</span><span class="o">{</span>
                    <span class="n">s</span><span class="o">=</span><span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">s</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span><span class="k">break</span><span class="o">;}</span>
                    <span class="n">words</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"\\p{Punct}"</span><span class="o">,</span><span class="s">""</span><span class="o">).</span><span class="na">split</span><span class="o">(</span><span class="s">"\\s"</span><span class="o">)));</span>
                <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">words</span><span class="o">;</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise4</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="n">CollectionInit</span><span class="o">.</span><span class="na">readFile</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-5">Exercise 5</h4>
<ul>
  <li><strong>Exercise 5</strong>: (3) Modify CountingMapData.java to fully implement the flyweight by adding a custom EntrySet class like the one in Countries.java.
```java
package com.ciaoshen.thinkinjava.chapter17;
import java.util.*;</li>
</ul>

<p>public class CountingMapData extends AbstractMap&lt;Integer,String&gt; {
    private int size;
    private static String[] chars = “A B C D E F G H I J K L M N O P Q R S T U V W X Y Z”.split(“ “);
    public CountingMapData(int size) {
        if(size &lt; 0) this.size = 0;
        this.size = size;
    }
    private static class Entry implements Map.Entry&lt;Integer,String&gt; {
        int index;
        Entry(int index) { this.index = index; }
        public boolean equals(Object o) {
            return Integer.valueOf(index).equals(o);
        }
        public Integer getKey() { return index; }
        public String getValue() {
            return chars[index % chars.length] + Integer.toString(index / chars.length);
        }
        public String setValue(String value) {
            throw new UnsupportedOperationException();
        }
        public int hashCode() {
            return Integer.valueOf(index).hashCode();
        }
    }</p>

<div class="highlighter-rouge"><pre class="highlight"><code>private static class EntrySet extends AbstractSet&lt;Map.Entry&lt;Integer,String&gt;&gt; {
    private int size;
    public EntrySet(int size){
        this.size=size;
    }
    public int size(){return size;}

    private class Iter implements Iterator&lt;Map.Entry&lt;Integer,String&gt;&gt;{
        int index=0;
        public boolean hasNext(){
            return index&lt;size;
        }
        public Map.Entry&lt;Integer,String&gt; next(){
            return new Entry(index++);
        }
        public void remove(){
            throw new UnsupportedOperationException();
        }
    }

    public Iterator&lt;Map.Entry&lt;Integer,String&gt;&gt; iterator(){
        return new Iter();
    }
}
public Set&lt;Map.Entry&lt;Integer,String&gt;&gt; entrySet() {
    return new EntrySet(size);
}

public static void main(String[] args) {
    System.out.println(new CountingMapData(60));
} } ```
</code></pre>
</div>

<h4 id="exercise-6">Exercise 6</h4>
<ul>
  <li><strong>Exercise 6</strong>: (2) Note that List has additional “optional” operations that are not included in Collection. Write a version of Unsupported.java that tests these additional optional operations.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">UnsupportedList</span> <span class="kd">extends</span> <span class="n">AbstractList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">staticStr</span><span class="o">=</span><span class="s">"A B C D E F G H I J"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">staticStr</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">staticStr</span><span class="o">.</span><span class="na">length</span><span class="o">;}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise6</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">UnsupportedList</span><span class="o">();</span>
        <span class="n">Unsupported</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-7">Exercise 7</h4>
<ul>
  <li><strong>Exercise 7</strong>: (4) Create both an ArrayList and a LinkedList, and fill each using the Countries.names( ) generator. Print each list using an ordinary Iterator, then insert one list into the other by using a Listlterator, inserting at every other location. Now perform the insertion starting at the end of the first list and moving backward.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>package com.ciaoshen.thinkinjava.chapter17;
import java.util.*;

public class Exercise7{

    /**
     *Step 1
     */
    public static void printTwoList(){
        List&lt;String&gt; al=new ArrayList&lt;String&gt;(MyCountries.names());
        List&lt;String&gt; ll=new LinkedList&lt;String&gt;(MyCountries.names());

        Iterator&lt;String&gt; iteAl=al.iterator();
        Iterator&lt;String&gt; iteLl=ll.iterator();

        while(iteAl.hasNext()){
            System.out.print("["+iteAl.next()+"]");
            if(iteAl.hasNext()){
                System.out.print(",");
            }
        }

        System.out.println("\n\n");

        while(iteLl.hasNext()){
            System.out.print("["+iteLl.next()+"]");
            if(iteLl.hasNext()){
                System.out.print(",");
            }
        }
    }

    /**
     *Step 2
     */
    public static void insertion(){
        List&lt;String&gt; al=new ArrayList&lt;String&gt;(MyCountries.names());
        List&lt;String&gt; ll=new LinkedList&lt;String&gt;(MyCountries.names());

        ListIterator&lt;String&gt; listIteAl=al.listIterator();
        ListIterator&lt;String&gt; listIteLl=ll.listIterator();

        while(listIteAl.hasNext() &amp;&amp; listIteLl.hasNext()){
            listIteLl.add(listIteAl.next());
            String s=listIteLl.next();
        }

        System.out.println(ll);
    }

    /**
     *Step 3
     */
    public static void inverseInsertion(){
        List&lt;String&gt; al=new ArrayList&lt;String&gt;(MyCountries.names());
        List&lt;String&gt; ll=new LinkedList&lt;String&gt;(MyCountries.names());

        ListIterator&lt;String&gt; listIteAl=al.listIterator(al.size());
        ListIterator&lt;String&gt; listIteLl=ll.listIterator();

        while(listIteAl.hasPrevious() &amp;&amp; listIteLl.hasNext()){
            listIteLl.add(listIteAl.previous());
            String s=listIteLl.next();
        }

        System.out.println(ll);
    }


    public static void main(String[] args){
        printTwoList();
        insertion();
        inverseInsertion();
    }
}
</code></pre>
</div>

<h4 id="exercise-8">Exercise 8</h4>
<p>Exercise 8: (7) Create a generic, singly linked list class called SList, which, to keep things simple, does not implement the List interface. Each Link object in the list should contain a reference to the next element in the list, but not the previous one (LinkedList, in contrast, is a doubly linked list, which means it maintains links in both directions). Create your own SListIterator which, again for simplicity, does not implement ListIterator. The only method in SList other than toString( ) should be iterator( ), which produces an SListIterator. The only way to insert and remove elements from an SList is through SListIterator. Write code to demonstrate SList.</p>

<p>关于LinkedList头节点的总结：</p>
<ol>
  <li>头节点是不储存元素信息的纯功能性节点。用来停放指针。</li>
  <li>单纯从功能上讲，单个头节点head就够了。不需要尾节点。</li>
  <li>没有head头节点的话，大部分操作对第一个元素和后续元素，实现都不同。导致逻辑复杂。容易出bug。编程目标是不出错，不是为了挑战脑力。</li>
  <li>不需要专门的桩子尾节点。但需要一个tail指针，指向末尾元素，方便从末尾插入新元素。</li>
  <li>双头节点版本：一个头节点head，一个尾节点tail。也没什么不好。反而逻辑清楚。</li>
  <li>JDK里的官方LinkedList是没有头节点的版本。不知道为什么。难道是节约内存？</li>
</ol>

<h5 id="单头节点版本">单头节点版本</h5>
<ol>
  <li>单向列表</li>
  <li>单头节点。只有前头节点head，无尾节点tail。</li>
  <li>tail只是一个指向最后一个元素的指针。</li>
  <li>前中后2个光标：previous,cursor。cursor指向上一个next()返回的元素。previous指向cursor的前一个元素。</li>
</ol>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span> <span class="s">"rawtypes"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SListV2</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;{</span>

    <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">head</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">tail</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">SListV2</span><span class="o">(){</span>
        <span class="n">head</span><span class="o">=</span><span class="k">new</span> <span class="n">Node</span><span class="o">();</span>
        <span class="n">tail</span><span class="o">=</span><span class="n">head</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="n">T</span> <span class="n">item</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Node</span><span class="o">(){</span><span class="n">item</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span><span class="n">next</span><span class="o">=</span><span class="kc">null</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="nf">Node</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">){</span><span class="n">item</span><span class="o">=</span><span class="n">t</span><span class="o">;</span><span class="n">next</span><span class="o">=</span><span class="kc">null</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">toString</span><span class="o">();}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">SListIterator</span><span class="o">{</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">cursor</span><span class="o">=</span><span class="n">head</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">previous</span><span class="o">=</span><span class="n">cursor</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="c1">//在cursor后面插入新元素</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">){</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">n</span><span class="o">=</span><span class="k">new</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">t</span><span class="o">);</span>
            <span class="n">n</span><span class="o">.</span><span class="na">next</span><span class="o">=</span><span class="n">tail</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
            <span class="n">tail</span><span class="o">.</span><span class="na">next</span><span class="o">=</span><span class="n">n</span><span class="o">;</span>
            <span class="n">tail</span><span class="o">=</span><span class="n">n</span><span class="o">;</span>
            <span class="n">size</span><span class="o">++;</span>
        <span class="o">}</span>
        <span class="c1">//替换cursor位置元素</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">head</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Not Begun!"</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">n</span><span class="o">=</span><span class="k">new</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">t</span><span class="o">);</span>
                <span class="n">cursor</span><span class="o">.</span><span class="na">item</span><span class="o">=</span><span class="n">t</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//从cursor位置开始往后删除</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">previous</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Can't remove!"</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">tail</span><span class="o">){</span>
                    <span class="n">tail</span><span class="o">=</span><span class="n">previous</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">previous</span><span class="o">.</span><span class="na">next</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">previous</span><span class="o">;</span>
                <span class="n">index</span><span class="o">--;</span>
                <span class="n">size</span><span class="o">--;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//current还没到tail</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">!=</span><span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//返回cursor的下一个元素</span>
        <span class="kd">public</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">hasNext</span><span class="o">()){</span>
                <span class="n">previous</span><span class="o">=</span><span class="n">cursor</span><span class="o">;</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="n">index</span><span class="o">++;</span>
                <span class="k">return</span> <span class="n">cursor</span><span class="o">;</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Reach the end!"</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">index</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">index</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="o">(){</span>
            <span class="n">cursor</span><span class="o">=</span><span class="n">head</span><span class="o">;</span>
            <span class="n">previous</span><span class="o">=</span><span class="n">cursor</span><span class="o">;</span>
            <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">SListIterator</span> <span class="nf">iterator</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">SListIterator</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span><span class="o">=</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">SListIterator</span> <span class="n">ite</span><span class="o">=</span><span class="n">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">()+</span><span class="s">"]"</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  测试
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">s</span><span class="o">=</span><span class="s">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
        <span class="n">SListV2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">SListV2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">SListV2</span><span class="o">.</span><span class="na">SListIterator</span> <span class="n">ite</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">ite</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">ite</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">length</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">n</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="双头节点版本">双头节点版本</h5>
<ol>
  <li>单向列表</li>
  <li>双头节点。前头节点head，后尾节点tail。两个节点永远不存放元素。尾节点的next指向最后一个元素。空链表时指向head。</li>
  <li>两个光标：previous,cursor。主要是cursor。previous只负责盯住cursor，并在remove的时候提供前一节点的next指针。
```java
package com.ciaoshen.thinkinjava.chapter17;
import java.util.*;</li>
</ol>

<p>@SuppressWarnings(value={“unchecked”, “rawtypes”})
public class SListV3<T>{</T></p>

<div class="highlighter-rouge"><pre class="highlight"><code>private Node&lt;T&gt; head;
private Node&lt;T&gt; tail;
private int size=0;
public SListV3(){
    head=new Node();
    tail=new Node();
    head.next=tail;
    tail.next=head;
}

private static class Node&lt;T&gt;{
    private T item;
    private Node&lt;T&gt; next;
    public Node(){item=null;next=null;}
    public Node(T t){item=t;next=null;}
    public String toString(){return item.toString();}
}

private class SListIterator{
    private Node&lt;T&gt; cursor=head;
    private Node&lt;T&gt; previous=cursor;
    private int index=0;
    //在tail栓塞前插入新元素
    public void add(T t){
        Node&lt;T&gt; n=new Node&lt;T&gt;(t);
        tail.next.next=n;
        n.next=tail;
        tail.next=n;
        size++;
    }
    //替换当前cursor元素（若当前元素被删，也不能set。）
    public void set(T t){
        if(cursor==previous){
            System.out.println("Cannot set!");
        }else{
            cursor.item=t;
        }
    }
    //只删除上一次next()返回的元素。每次next()只能删除一次。
    public void remove(){
        if(cursor==previous){
            System.out.println("Can't remove!");
        }else{
            if(tail.next==cursor){
                tail.next=previous;
            }
            previous.next=cursor.next;
            cursor=previous;
            index--;
            size--;
        }
    }
    //current还没到tail
    public boolean hasNext(){
        return cursor.next!=tail;
    }
    //返回cursor的下一个元素
    public Node&lt;T&gt; next(){
        if(hasNext()){
            previous=cursor;
            cursor=cursor.next;
            index++;
            return cursor;
        }else{
            System.out.println("Reach the end!");
            return null;
        }
    }
    public int index(){
        return index;
    }
    public int size(){
        return size;
    }
    public void reset(){
        cursor=head;
        previous=cursor;
        index=0;
    }
}

public SListIterator iterator(){
    return new SListIterator();
}
public String toString(){
    StringBuilder sb=new StringBuilder();
    SListIterator ite=iterator();
    while(ite.hasNext()){
        sb.append("["+ite.next()+"]");
        if(ite.hasNext()){
            sb.append(",");
        }
    }
    return sb.toString();
}

/**
 *  测试
 */
public static void main(String[] args){
    String[] s="A B C D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ");
    SListV3&lt;String&gt; list=new SListV3&lt;String&gt;();
    SListV3.SListIterator ite=list.iterator();
    for(int i=0;i&lt;s.length;i++){
        ite.add(s[i]);
    }
    System.out.println(list);
    for(int i=0;i&lt;ite.size();i++){
        System.out.println(ite.next());
    }
    ite.reset();
    int length=ite.size();
    for(int i=0;i&lt;10;i++){
        Node&lt;String&gt; n=ite.next();
        ite.remove();
        ite.remove();
    }
    System.out.println(list);
} } ```
</code></pre>
</div>

<h5 id="无头节点版本">无头节点版本</h5>
<ol>
  <li>单向列表</li>
  <li>没有栓塞头</li>
  <li>head和tail只是两个指针，指向第一个和最后一个元素。</li>
  <li>当链表为空：维持一个空节点。head和tail都指向这个空节点。只有一个元素的时候，head和tail也都指向唯一的这个节点。</li>
  <li>两个光标：previous,cursor。cursor指向上一个next()返回的元素。previous指向cursor的前一个元素。</li>
</ol>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span> <span class="s">"rawtypes"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SListV4</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;{</span>

    <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">head</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">tail</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">SListV4</span><span class="o">(){</span>
        <span class="n">head</span><span class="o">=</span><span class="k">new</span> <span class="n">Node</span><span class="o">();</span>
        <span class="n">tail</span><span class="o">=</span><span class="n">head</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="n">T</span> <span class="n">item</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">Node</span><span class="o">(){</span><span class="n">item</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span><span class="n">next</span><span class="o">=</span><span class="kc">null</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="nf">Node</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">){</span><span class="n">item</span><span class="o">=</span><span class="n">t</span><span class="o">;</span><span class="n">next</span><span class="o">=</span><span class="kc">null</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="nf">Node</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">,</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">n</span><span class="o">){</span><span class="n">item</span><span class="o">=</span><span class="n">t</span><span class="o">;</span><span class="n">next</span><span class="o">=</span><span class="n">n</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="na">toString</span><span class="o">();}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">SListIterator</span><span class="o">{</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">cursor</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">previous</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="o">;</span>
        <span class="c1">//在tail栓塞前插入新元素</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">){</span>
            <span class="c1">//空链表</span>
            <span class="k">if</span><span class="o">(</span><span class="n">head</span><span class="o">.</span><span class="na">item</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">head</span><span class="o">.</span><span class="na">item</span><span class="o">=</span><span class="n">t</span><span class="o">;</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">n</span><span class="o">=</span><span class="k">new</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">t</span><span class="o">);</span>
                <span class="n">tail</span><span class="o">.</span><span class="na">next</span><span class="o">=</span><span class="n">n</span><span class="o">;</span>
                <span class="n">tail</span><span class="o">=</span><span class="n">n</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">size</span><span class="o">++;</span>
        <span class="o">}</span>
        <span class="c1">//替换当前cursor元素（若当前元素被删，也不能set。）</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">previous</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Cannot set!"</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">cursor</span><span class="o">.</span><span class="na">item</span><span class="o">=</span><span class="n">t</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//只删除上一次next()返回的元素。每次next()只能删除一次。</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">previous</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Can't remove!"</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">head</span><span class="o">){</span>
                    <span class="n">cursor</span><span class="o">.</span><span class="na">item</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
                    <span class="n">cursor</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">previous</span><span class="o">.</span><span class="na">next</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                    <span class="n">cursor</span><span class="o">=</span><span class="n">previous</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">index</span><span class="o">--;</span>
                <span class="n">size</span><span class="o">--;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//current还没到tail</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                <span class="k">return</span> <span class="o">(</span><span class="n">head</span><span class="o">.</span><span class="na">item</span><span class="o">==</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">head</span><span class="o">.</span><span class="na">next</span><span class="o">==</span><span class="kc">null</span><span class="o">)?</span> <span class="kc">false</span><span class="o">:</span><span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">==</span><span class="kc">null</span><span class="o">)?</span> <span class="kc">false</span><span class="o">:</span><span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//返回cursor的下一个元素</span>
        <span class="kd">public</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">hasNext</span><span class="o">()){</span>
                <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">head</span><span class="o">.</span><span class="na">item</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span>
                    <span class="n">cursor</span><span class="o">=</span><span class="n">head</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                    <span class="n">previous</span><span class="o">=</span><span class="n">head</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">head</span><span class="o">.</span><span class="na">item</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                    <span class="n">cursor</span><span class="o">=</span><span class="n">head</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                    <span class="n">previous</span><span class="o">=</span><span class="n">cursor</span><span class="o">;</span>
                    <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="n">index</span><span class="o">++;</span>
                <span class="k">return</span> <span class="n">cursor</span><span class="o">;</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Reach the end!"</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">index</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">index</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="o">(){</span>
            <span class="n">cursor</span><span class="o">=</span><span class="n">previous</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
            <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">SListIterator</span> <span class="nf">iterator</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">SListIterator</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span><span class="o">=</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">SListIterator</span> <span class="n">ite</span><span class="o">=</span><span class="n">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"["</span><span class="o">+</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">()+</span><span class="s">"]"</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  测试
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">s</span><span class="o">=</span><span class="s">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
        <span class="n">SListV4</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">SListV4</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">SListV4</span><span class="o">.</span><span class="na">SListIterator</span> <span class="n">ite</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">ite</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">ite</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">Node</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">n</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"XXX"</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-9">Exercise 9</h4>
<ul>
  <li><strong>Exercise 9</strong>: (2) Use RandomGenerator.String to fill a TreeSet, but use alphabetic ordering. Print the TreeSet to verify the sort order.</li>
</ul>

<h5 id="randomgeneratorjava-1">RandomGenerator.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomGenerator</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

    <span class="c1">//Boolean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Boolean</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextBoolean</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Integer</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Integer</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Long</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Long</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextLong</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Short</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Short</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Float</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Float</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextFloat</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Double</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Double</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Byte</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Byte</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="n">rand</span><span class="o">.</span><span class="na">nextBytes</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//Charactor</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">CS</span><span class="o">=(</span><span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="o">+</span><span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="o">).</span><span class="na">toCharArray</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Character</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">CS</span><span class="o">[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">CS</span><span class="o">.</span><span class="na">length</span><span class="o">)];</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="c1">//String</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">String</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">Character</span><span class="o">();</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">(){}</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">size</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span><span class="o">=</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise9java">Exercise9.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise9</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">ts</span><span class="o">=</span><span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">ts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ts</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-10">Exercise 10</h4>
<ul>
  <li><strong>Exercise 10</strong>: (7) Using a LinkedList as your underlying implementation, define your own SortedSet.</li>
</ul>

<h5 id="exercise10java">Exercise10.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="c1">//内部元素必须实现equals()方法，实现Comparable接口或者有额外的Comparator。</span>
<span class="kd">class</span> <span class="nc">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">SortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;{</span>
    <span class="c1">//基于LinkedList。类似一个高级代理，或装饰器</span>
    <span class="kd">private</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ll</span><span class="o">;</span>

    <span class="c1">//额外比较器字段</span>
    <span class="kd">private</span> <span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">E</span><span class="o">&gt;</span> <span class="n">comp</span><span class="o">;</span>

    <span class="c1">//构造器，两个版本：有Comparator和没有Comparator。</span>
    <span class="kd">public</span> <span class="nf">LinkedSortedSet</span><span class="o">(){</span>
        <span class="n">ll</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>
        <span class="n">comp</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">LinkedSortedSet</span><span class="o">(</span><span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">){</span>
        <span class="n">ll</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>
        <span class="n">comp</span><span class="o">=</span><span class="n">c</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//靠add()方法维持元素顺序</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">element</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">ll</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">element</span><span class="o">)){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">ll</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
                <span class="k">return</span> <span class="n">ll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">ll</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                    <span class="c1">//用Comparator比</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span><span class="n">element</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">){</span>
                            <span class="n">ll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">index</span><span class="o">,</span><span class="n">element</span><span class="o">);</span>
                            <span class="k">break</span><span class="o">;</span>
                        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                            <span class="n">index</span><span class="o">++;</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">==</span><span class="n">ll</span><span class="o">.</span><span class="na">size</span><span class="o">()){</span>
                        <span class="n">ll</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                    <span class="c1">//用compareTo()比</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                        <span class="n">E</span> <span class="n">curr</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                        <span class="k">if</span><span class="o">(((</span><span class="n">Comparable</span><span class="o">)</span><span class="n">curr</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">element</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">){</span>
                            <span class="n">ll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">index</span><span class="o">,</span><span class="n">element</span><span class="o">);</span>
                            <span class="k">break</span><span class="o">;</span>
                        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                            <span class="n">index</span><span class="o">++;</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">==</span><span class="n">ll</span><span class="o">.</span><span class="na">size</span><span class="o">()){</span>
                        <span class="n">ll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">index</span><span class="o">,</span><span class="n">element</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//检测集合中是否有equals(element)的元素。</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">ll</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//靠构造器带来额外的comparator</span>
    <span class="kd">public</span> <span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">E</span><span class="o">&gt;</span> <span class="nf">comparator</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">comp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//返回首元素</span>
    <span class="kd">public</span> <span class="n">E</span> <span class="nf">first</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">ll</span><span class="o">.</span><span class="na">getFirst</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//返回末尾元素</span>
    <span class="kd">public</span> <span class="n">E</span> <span class="nf">last</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">ll</span><span class="o">.</span><span class="na">getLast</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//返回从首元素到参数toElement元素的子集</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">headSet</span><span class="o">(</span><span class="n">E</span> <span class="n">toElement</span><span class="o">){</span>
        <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">lse</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">ll</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="c1">//用Comparator比</span>
            <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">E</span> <span class="n">curr</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">curr</span><span class="o">,</span><span class="n">toElement</span><span class="o">)&lt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="n">lse</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">curr</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="c1">//用compareTo()比</span>
            <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">E</span> <span class="n">curr</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(((</span><span class="n">Comparable</span><span class="o">)</span><span class="n">curr</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">toElement</span><span class="o">)&lt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="n">lse</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">curr</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">lse</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//返回从fromElement到参数toElement元素的子集</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">subSet</span><span class="o">(</span><span class="n">E</span> <span class="n">fromElement</span><span class="o">,</span> <span class="n">E</span> <span class="n">toElement</span><span class="o">){</span>
        <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">lse</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">ll</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="c1">//用Comparator比</span>
            <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">E</span> <span class="n">curr</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">curr</span><span class="o">,</span><span class="n">fromElement</span><span class="o">)&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">comp</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">curr</span><span class="o">,</span><span class="n">toElement</span><span class="o">)&lt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="n">lse</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">curr</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="c1">//用compareTo()比</span>
            <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">E</span> <span class="n">curr</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(((</span><span class="n">Comparable</span><span class="o">)</span><span class="n">curr</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">fromElement</span><span class="o">)&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">)</span><span class="n">curr</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">toElement</span><span class="o">)&lt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="n">lse</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">curr</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">lse</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//返回从fromElement到莫为元素的子集</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">tailSet</span><span class="o">(</span><span class="n">E</span> <span class="n">fromElement</span><span class="o">){</span>
        <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">lse</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">ll</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="c1">//用Comparator比</span>
            <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">E</span> <span class="n">curr</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">comp</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">curr</span><span class="o">,</span><span class="n">fromElement</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="n">lse</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">curr</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="c1">//用compareTo()比</span>
            <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">E</span> <span class="n">curr</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(((</span><span class="n">Comparable</span><span class="o">)</span><span class="n">curr</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">fromElement</span><span class="o">)&gt;</span><span class="mi">0</span><span class="o">){</span>
                    <span class="n">lse</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">curr</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">lse</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//返回迭代器引用</span>
    <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">(){</span><span class="k">return</span> <span class="n">ll</span><span class="o">.</span><span class="na">iterator</span><span class="o">();}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="n">ll</span><span class="o">.</span><span class="na">toString</span><span class="o">();}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">(){</span><span class="n">ll</span><span class="o">.</span><span class="na">clear</span><span class="o">();}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">ll</span><span class="o">.</span><span class="na">size</span><span class="o">();}</span>
<span class="o">}</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise10</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedSortedSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="c1">//LinkedSortedSet&lt;String&gt; set=new LinkedSortedSet&lt;String&gt;(java.lang.String.CASE_INSENSITIVE_ORDER);</span>

        <span class="n">String</span> <span class="n">no3</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">no8</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">String</span> <span class="n">s</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
            <span class="kt">boolean</span> <span class="n">b</span><span class="o">=</span><span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="o">){</span>
                <span class="n">no3</span><span class="o">=</span><span class="n">s</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">7</span><span class="o">){</span>
                <span class="n">no8</span><span class="o">=</span><span class="n">s</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"abcdefg"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">no3</span><span class="o">));</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"X    &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">no3</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Y    &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">no8</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Element befor X &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">set</span><span class="o">.</span><span class="na">headSet</span><span class="o">(</span><span class="n">no3</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Element after Y &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">set</span><span class="o">.</span><span class="na">tailSet</span><span class="o">(</span><span class="n">no8</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Element between X &amp; Y &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">set</span><span class="o">.</span><span class="na">subSet</span><span class="o">(</span><span class="n">no3</span><span class="o">,</span><span class="n">no8</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-11">Exercise 11</h4>
<ul>
  <li><strong>Exercise 11</strong>: (2) Create a class that contains an Integer that is initialized to a value between o and 100 using java.util.Random. Implement Comparable using this Integer field. Fill a PriorityQueue with objects of your class, and extract the values using poll( ) to show that it produces the expected order.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Programmer</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Programmer</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">level</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Programmer</span><span class="o">(</span><span class="kt">int</span> <span class="n">lev</span><span class="o">,</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="n">level</span><span class="o">=</span><span class="n">lev</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getLevel</span><span class="o">(){</span><span class="k">return</span> <span class="n">level</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Programmer</span> <span class="n">p</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">level</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="na">getLevel</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"Lev "</span><span class="o">+</span><span class="n">level</span><span class="o">+</span><span class="s">"   &gt;&gt;&gt;    "</span><span class="o">+</span><span class="n">name</span><span class="o">;}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ProGen</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Programmer</span><span class="o">&gt;{</span>
    <span class="n">Random</span> <span class="n">levRand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
    <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span> <span class="n">nameRand</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
    <span class="kd">public</span> <span class="n">Programmer</span> <span class="nf">next</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Programmer</span><span class="o">(</span><span class="n">levRand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span><span class="n">nameRand</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise11</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Queue</span><span class="o">&lt;</span><span class="n">Programmer</span><span class="o">&gt;</span> <span class="n">microsoft</span><span class="o">=</span><span class="k">new</span> <span class="n">PriorityQueue</span><span class="o">&lt;</span><span class="n">Programmer</span><span class="o">&gt;();</span>
        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">Programmer</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">ProGen</span><span class="o">();</span>

        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">microsoft</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">microsoft</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">num</span><span class="o">=</span><span class="n">microsoft</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">num</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">microsoft</span><span class="o">.</span><span class="na">poll</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-12">Exercise 12</h4>
<ul>
  <li><strong>Exercise 12</strong>: (1) Substitute a HashMap, a TreeMap and a LinkedHashMap in AssociativeArray .Java’s main( ).</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">AssociativeArray</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Object</span><span class="o">[][]</span> <span class="n">pairs</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">AssociativeArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">length</span><span class="o">][</span><span class="mi">2</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArrayIndexOutOfBoundsException</span><span class="o">();</span>
        <span class="n">pairs</span><span class="o">[</span><span class="n">index</span><span class="o">++]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span> <span class="o">};</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">index</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">]))</span>
                <span class="k">return</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">];</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// Did not find key</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">StringBuilder</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">index</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">" : "</span><span class="o">);</span>
            <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">].</span><span class="na">toString</span><span class="o">());</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
                <span class="n">result</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise12</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"sky"</span><span class="o">,</span> <span class="s">"blue"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"grass"</span><span class="o">,</span> <span class="s">"green"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ocean"</span><span class="o">,</span> <span class="s">"dancing"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"tree"</span><span class="o">,</span> <span class="s">"tall"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"earth"</span><span class="o">,</span> <span class="s">"brown"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"sun"</span><span class="o">,</span> <span class="s">"warm"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"extra"</span><span class="o">,</span> <span class="s">"object"</span><span class="o">);</span> <span class="c1">// Past the end</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">ArrayIndexOutOfBoundsException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Too many objects!"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ocean"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="c1">//AssociativeArray&lt;String,String&gt; map1 = new AssociativeArray&lt;String,String&gt;(6);</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map2</span><span class="o">=</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map3</span><span class="o">=</span><span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map4</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">Exercise12</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">map2</span><span class="o">);</span>
        <span class="n">Exercise12</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">map3</span><span class="o">);</span>
        <span class="n">Exercise12</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">map4</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-13">Exercise 13</h4>
<ul>
  <li><strong>Exercise 13</strong>: (4) Use AssociativeArray Java to create a wordoccurrence counter, mapping String to Integer. Using the net.mindview.util.TextFile utility in this book, open a text file and break up the words in that file using whitespace and punctuation, and count the occurrence of the words in that file.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise13</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">wordsFreq</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">){</span>
        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">dic</span><span class="o">=</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>

        <span class="c1">//读文件</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">address</span><span class="o">)));</span>
            <span class="c1">//割词</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">line</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[\\p{Punct}\\s]+"</span><span class="o">);</span>
                <span class="n">addWords</span><span class="o">(</span><span class="n">words</span><span class="o">,</span><span class="n">dic</span><span class="o">);</span>
                <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">dic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addWords</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">word:</span><span class="n">words</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">word</span><span class="o">)){</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="n">Exercise13</span><span class="o">.</span><span class="na">wordsFreq</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-14">Exercise 14</h4>
<ul>
  <li><strong>Exercise 14</strong>: (3) Show that java.util.Properties works in the above program.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise14</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printKeys</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Size = "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Keys: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span> <span class="c1">// Produce a Set of the keys</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
        <span class="c1">// Map has ‘Set’ behavior for keys:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="c1">// Producing a Collection of the values:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Values: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsKey(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.get(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsValue(\"F0\"): "</span>
              <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsValue</span><span class="o">(</span><span class="s">"F0"</span><span class="o">));</span>
        <span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"First key in map: "</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="c1">// Operations on the Set change the Map:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">removeAll</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">test</span><span class="o">(</span><span class="k">new</span> <span class="n">Properties</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-15">Exercise 15</h4>
<ul>
  <li><strong>Exercise 15</strong>: (1) Repeat Exercise 13 using a SlowMap.</li>
</ul>

<h5 id="slowmapjava">SlowMap.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SlowMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;();</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;();</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span> <span class="c1">// The old value or null</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">keys</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
            <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span>
            <span class="n">values</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">value</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// key is type Object, not K</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">ki</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">ki</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span>
            <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">ki</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span> <span class="n">vi</span><span class="o">.</span><span class="na">next</span><span class="o">()));</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">=</span> <span class="k">new</span> <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"BULGARIA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise15java">Exercise15.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise15</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">wordsFreq</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">){</span>
        <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">dic</span><span class="o">=</span><span class="k">new</span> <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//读文件</span>
            <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">address</span><span class="o">)));</span>
            <span class="c1">//割词</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">line</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[\\p{Punct}\\s]+"</span><span class="o">);</span>
                <span class="n">addWords</span><span class="o">(</span><span class="n">words</span><span class="o">,</span><span class="n">dic</span><span class="o">);</span>
                <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">dic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addWords</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">word:</span><span class="n">words</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">word</span><span class="o">)){</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="n">Exercise13</span><span class="o">.</span><span class="na">wordsFreq</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-16">Exercise 16</h4>
<ul>
  <li><strong>Exercise 16</strong>: (7) Apply the tests in Maps.java to SlowMap to verify that it works. Fix anything in SlowMap that doesn’t work correctly.
SlowMap里EntrySet是享元化的，没有set实体。里面只有一个Iterator返回视图。
实体化只有在要打印的时候，在Abstract.toString()里完成。</li>
</ul>

<h5 id="slowmapjava-1">SlowMap.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SlowMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;();</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;();</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span> <span class="c1">// The old value or null</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">keys</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
            <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span>
            <span class="n">values</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">value</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// key is type Object, not K</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">(){</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;(){</span>
                <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">iteKey</span><span class="o">=</span><span class="n">keys</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
                <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iteValue</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

                <span class="kd">private</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=</span><span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="kc">null</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
                    <span class="k">return</span> <span class="n">iteKey</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">iteValue</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span>
                    <span class="n">entry</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="n">iteKey</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                    <span class="n">entry</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">iteValue</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                    <span class="k">return</span> <span class="n">entry</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
                    <span class="n">iteKey</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
                    <span class="n">iteValue</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">};</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span><span class="n">values</span><span class="o">.</span><span class="na">size</span><span class="o">());}</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">=</span> <span class="k">new</span> <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"BULGARIA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapentryjava">MapEntry.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapsjava">Maps.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Maps</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printKeys</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Size = "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Keys: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span> <span class="c1">// Produce a Set of the keys</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapDataOrig</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="c1">// Map has ‘Set’ behavior for keys:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapDataOrig</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="c1">// Producing a Collection of the values:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Values: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsKey(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.get(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsValue(\"F0\"): "</span>
              <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsValue</span><span class="o">(</span><span class="s">"F0"</span><span class="o">));</span>
        <span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"First key in map: "</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="c1">// Operations on the Set change the Map:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">removeAll</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise16java">Exercise16.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise16</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Maps</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="k">new</span> <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-17">Exercise 17</h4>
<p>大部分不需要实现，AbstractMap都实现了。</p>

<h5 id="slowmapcompletejava">SlowMapComplete.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SlowMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;();</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span> <span class="c1">// The old value or null</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">keys</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
            <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span>
            <span class="n">values</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">value</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// key is type Object, not K</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">(){</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;(){</span>
                <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">iteKey</span><span class="o">=</span><span class="n">keys</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
                <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iteValue</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>

                <span class="kd">private</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=</span><span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="kc">null</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
                    <span class="k">return</span> <span class="n">iteKey</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">iteValue</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span>
                    <span class="n">entry</span><span class="o">.</span><span class="na">setKey</span><span class="o">(</span><span class="n">iteKey</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                    <span class="n">entry</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">iteValue</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                    <span class="k">return</span> <span class="n">entry</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
                    <span class="n">iteKey</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
                    <span class="n">iteValue</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">};</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">keys</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span><span class="n">values</span><span class="o">.</span><span class="na">size</span><span class="o">());}</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  不需要实现，AbstractMap都实现了。
     */</span>

    <span class="c1">//Removes all of the mappings from this map (optional operation).</span>
    <span class="c1">//void clear()</span>

    <span class="c1">//Returns true if this map contains a mapping for the specified key.</span>
    <span class="c1">//boolean containsKey(Object key)</span>

    <span class="c1">//Returns true if this map maps one or more keys to the specified value.</span>
    <span class="c1">//boolean containsValue(Object value)</span>

    <span class="c1">//Compares the specified object with this map for equality.</span>
    <span class="c1">//boolean equals(Object o)</span>

    <span class="c1">//Returns the hash code value for this map.</span>
    <span class="c1">//int hashCode()</span>

    <span class="c1">//Returns true if this map contains no key-value mappings.</span>
    <span class="c1">//boolean isEmpty()</span>

    <span class="c1">//Returns a Set view of the keys contained in this map.</span>
    <span class="c1">//Set&lt;K&gt; keySet()</span>

    <span class="c1">// Copies all of the mappings from the specified map to this map (optional operation).</span>
    <span class="c1">//void putAll(Map&lt;? extends K,? extends V&gt; m)</span>

    <span class="c1">//Removes the mapping for a key from this map if it is present (optional operation).</span>
    <span class="c1">//V remove(Object key)</span>

    <span class="c1">//Returns the number of key-value mappings in this map.</span>
    <span class="c1">//int size()</span>

    <span class="c1">//Returns a Collection view of the values contained in this map.</span>
    <span class="c1">//Collection&lt;V&gt; values()</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">=</span> <span class="k">new</span> <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"BULGARIA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapentryjava-1">MapEntry.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">setKey</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">){</span>
        <span class="n">K</span> <span class="n">result</span><span class="o">=</span><span class="n">key</span><span class="o">;</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise17java">Exercise17.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise17</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Maps</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="k">new</span> <span class="n">SlowMapComplete</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-18">Exercise 18</h4>
<ul>
  <li><strong>Exercise 18</strong>: (3) Using SlowMap.java for inspiration, create a SlowSet.</li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SlowSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="nf">SlowSet</span><span class="o">(){}</span>
    <span class="kd">public</span> <span class="nf">SlowSet</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">){</span><span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;(</span><span class="n">c</span><span class="o">);}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">element</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();}</span>
    <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">(){</span><span class="k">return</span> <span class="k">new</span> <span class="n">Ite</span><span class="o">();}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">Ite</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;{</span>
        <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span><span class="k">return</span> <span class="n">index</span><span class="o">&lt;</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();}</span>
        <span class="kd">public</span> <span class="n">E</span> <span class="nf">next</span><span class="o">(){</span><span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">++);}</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">){</span>
                <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">SlowSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">=</span><span class="k">new</span> <span class="n">SlowSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>

        <span class="n">String</span> <span class="n">s</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">no3</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">no7</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">s</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="o">){</span><span class="n">no3</span><span class="o">=</span><span class="n">s</span><span class="o">;}</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">6</span><span class="o">){</span><span class="n">no7</span><span class="o">=</span><span class="n">s</span><span class="o">;}</span>
            <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Set contains ELement "</span><span class="o">+</span><span class="n">no3</span><span class="o">+</span><span class="s">"    &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">set</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">no3</span><span class="o">));</span>
        <span class="n">set</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">no7</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After delete Element "</span><span class="o">+</span><span class="n">no7</span><span class="o">+</span><span class="s">"   &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">set</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Size    &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">set</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">ss</span><span class="o">=(</span><span class="n">String</span><span class="o">[])(</span><span class="n">set</span><span class="o">.</span><span class="na">toArray</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Arrays  &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">ss</span><span class="o">));</span>
        <span class="n">set</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Delete All Element!!!"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Set is Empty now?   &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">set</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-19">Exercise 19</h4>
<ul>
  <li><strong>Exercise 19</strong>: (1) Repeat Exercise 13 using a SimpleHashMap.</li>
</ul>

<h5 id="exercise19java">Exercise19.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise19</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">wordsFreq</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">){</span>
        <span class="n">SimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">dic</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//读文件</span>
            <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">address</span><span class="o">)));</span>
            <span class="c1">//割词</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">line</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[\\p{Punct}\\s]+"</span><span class="o">);</span>
                <span class="n">addWords</span><span class="o">(</span><span class="n">words</span><span class="o">,</span><span class="n">dic</span><span class="o">);</span>
                <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">dic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addWords</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">word:</span><span class="n">words</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">word</span><span class="o">)){</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="n">Exercise19</span><span class="o">.</span><span class="na">wordsFreq</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="simplehashmapjava">SimpleHashMap.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// Choose a prime number for the hash table</span>
    <span class="c1">// size, to achieve a uniform distribution:</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
    <span class="c1">// You can’t have a physical array of generics,</span>
    <span class="c1">// but you can upcast to one:</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">SimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapentryjava-2">MapEntry.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">setKey</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">){</span>
        <span class="n">K</span> <span class="n">result</span><span class="o">=</span><span class="n">key</span><span class="o">;</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-20">Exercise 20</h4>
<ul>
  <li><strong>Exercise 20</strong>: (3) Modify SimpleHashMap so that it reports collisions, and test this by adding the same data set twice so that you see collisions.</li>
</ul>

<p>只要在SimpleHashMap的put()方法里当找到相同键值的时候，加一个打印语句。</p>

<h5 id="simplehashmap20java">SimpleHashMap20.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap20</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// Choose a prime number for the hash table</span>
    <span class="c1">// size, to achieve a uniform distribution:</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
    <span class="c1">// You can’t have a physical array of generics,</span>
    <span class="c1">// but you can upcast to one:</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Word &gt;&gt;&gt;["</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">()+</span><span class="s">"]&lt;&lt;&lt; already existe!   Frequence:  "</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">()+</span><span class="s">"    &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">value</span><span class="o">);</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleHashMap20</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHashMap20</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapentryjava-3">MapEntry.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">setKey</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">){</span>
        <span class="n">K</span> <span class="n">result</span><span class="o">=</span><span class="n">key</span><span class="o">;</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise20java">Exercise20.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise20</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">wordsFreq</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">){</span>
        <span class="n">SimpleHashMap20</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">dic</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashMap20</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//读文件</span>
            <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">address</span><span class="o">)));</span>
            <span class="c1">//割词</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">line</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[\\p{Punct}\\s]+"</span><span class="o">);</span>
                <span class="n">addWords</span><span class="o">(</span><span class="n">words</span><span class="o">,</span><span class="n">dic</span><span class="o">);</span>
                <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">dic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addWords</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">word:</span><span class="n">words</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">word</span><span class="o">)){</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="n">Exercise20</span><span class="o">.</span><span class="na">wordsFreq</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-21">Exercise 21</h4>
<ul>
  <li><strong>Exercise 21</strong>: (2) Modify SimpleHashMap so that it reports the number of “probes” necessary when collisions occur. That is, how many calls to next( ) must be made on the Iterators that walk the LinkedLists looking for matches?</li>
</ul>

<h5 id="simplehashmap21java">SimpleHashMap21.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 * SimpleHashMap in the book
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap21</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// Choose a prime number for the hash table</span>
    <span class="c1">// size, to achieve a uniform distribution:</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
    <span class="c1">// You can’t have a physical array of generics,</span>
    <span class="c1">// but you can upcast to one:</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">place</span><span class="o">=-</span><span class="mi">1</span><span class="o">;</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">place</span><span class="o">++;</span>
            <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Word &gt;&gt;&gt;["</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">()+</span><span class="s">"]&lt;&lt;&lt; already existe at place "</span><span class="o">+</span><span class="n">place</span><span class="o">+</span><span class="s">" in LinkedList!   Frequence:  "</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">()+</span><span class="s">"    &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">value</span><span class="o">);</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleHashMap21</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHashMap21</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapentryjava-4">MapEntry.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">setKey</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">){</span>
        <span class="n">K</span> <span class="n">result</span><span class="o">=</span><span class="n">key</span><span class="o">;</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise21java">Exercise21.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise21</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">wordsFreq</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">){</span>
        <span class="n">SimpleHashMap21</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">dic</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashMap21</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//读文件</span>
            <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">address</span><span class="o">)));</span>
            <span class="c1">//割词</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">line</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[\\p{Punct}\\s]+"</span><span class="o">);</span>
                <span class="n">addWords</span><span class="o">(</span><span class="n">words</span><span class="o">,</span><span class="n">dic</span><span class="o">);</span>
                <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">dic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addWords</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">word:</span><span class="n">words</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">word</span><span class="o">)){</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="n">Exercise21</span><span class="o">.</span><span class="na">wordsFreq</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-22">Exercise 22</h4>

<h5 id="simplehashmap22java">SimpleHashMap22.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap22</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// Choose a prime number for the hash table</span>
    <span class="c1">// size, to achieve a uniform distribution:</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
    <span class="c1">// You can’t have a physical array of generics,</span>
    <span class="c1">// but you can upcast to one:</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">place</span><span class="o">=-</span><span class="mi">1</span><span class="o">;</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">place</span><span class="o">++;</span>
            <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Word &gt;&gt;&gt;["</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">()+</span><span class="s">"]&lt;&lt;&lt; already existe at place "</span><span class="o">+</span><span class="n">place</span><span class="o">+</span><span class="s">" in LinkedList!   Frequence:  "</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">()+</span><span class="s">"    &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">value</span><span class="o">);</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">(){</span>
        <span class="n">entrySet</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
        <span class="n">V</span> <span class="n">v</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nl">bucket:</span><span class="n">buckets</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">bucket</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
                <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nl">entry:</span><span class="n">bucket</span><span class="o">){</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">)){</span>
                        <span class="n">v</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                        <span class="n">bucket</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleHashMap22</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHashMap22</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapentryjava-5">MapEntry.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">setKey</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">){</span>
        <span class="n">K</span> <span class="n">result</span><span class="o">=</span><span class="n">key</span><span class="o">;</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise22java">Exercise22.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise22</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">wordsFreq</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">){</span>
        <span class="n">SimpleHashMap22</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">dic</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashMap22</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//读文件</span>
            <span class="n">BufferedReader</span> <span class="n">br</span><span class="o">=</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">address</span><span class="o">)));</span>
            <span class="c1">//割词</span>
            <span class="n">String</span> <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">while</span><span class="o">(</span><span class="n">line</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"[\\p{Punct}\\s]+"</span><span class="o">);</span>
                <span class="n">addWords</span><span class="o">(</span><span class="n">words</span><span class="o">,</span><span class="n">dic</span><span class="o">);</span>
                <span class="n">line</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">dic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addWords</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">words</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">word:</span><span class="n">words</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">word</span><span class="o">)){</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">word</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">word</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="n">Exercise22</span><span class="o">.</span><span class="na">wordsFreq</span><span class="o">(</span><span class="s">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"the &gt;&gt;&gt;"</span><span class="o">+</span><span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"the"</span><span class="o">));</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-23">Exercise 23</h4>

<h5 id="simplehashmap23java">SimpleHashMap23.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap23</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">// Choose a prime number for the hash table</span>
    <span class="c1">// size, to achieve a uniform distribution:</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
    <span class="c1">// You can’t have a physical array of generics,</span>
    <span class="c1">// but you can upcast to one:</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">place</span><span class="o">=-</span><span class="mi">1</span><span class="o">;</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">place</span><span class="o">++;</span>
            <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Word &gt;&gt;&gt;["</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">()+</span><span class="s">"]&lt;&lt;&lt; already existe at place "</span><span class="o">+</span><span class="n">place</span><span class="o">+</span><span class="s">" in LinkedList!   Frequence:  "</span><span class="o">+</span><span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">()+</span><span class="s">"    &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">value</span><span class="o">);</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">(){</span>
        <span class="n">entrySet</span><span class="o">().</span><span class="na">clear</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
        <span class="n">V</span> <span class="n">v</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nl">bucket:</span><span class="n">buckets</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">bucket</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
                <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nl">entry:</span><span class="n">bucket</span><span class="o">){</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">)){</span>
                        <span class="n">v</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                        <span class="n">bucket</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//Returns true if this map contains a mapping for the specified key.</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">containsKey</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">){</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">keys</span><span class="o">=</span><span class="n">keySet</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">keys</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//Returns true if this map maps one or more keys to the specified value.</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">containsValue</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">){</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//Compares the specified object with this map for equality.</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">SimpleHashMap23</span><span class="o">)){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">buckets</span><span class="o">.</span><span class="na">length</span><span class="o">!=((</span><span class="n">SimpleHashMap23</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">buckets</span><span class="o">.</span><span class="na">length</span><span class="o">){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="k">this</span><span class="o">.</span><span class="na">buckets</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="k">if</span><span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">buckets</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">equals</span><span class="o">(((</span><span class="n">SimpleHashMap23</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">buckets</span><span class="o">[</span><span class="n">i</span><span class="o">])){</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//Returns the hash code value for this map.</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
        <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="mi">37</span><span class="o">*</span><span class="n">SIZE</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nl">bucket:</span><span class="n">buckets</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">bucket</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
                <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nl">entry:</span><span class="n">bucket</span><span class="o">){</span>
                    <span class="n">index</span><span class="o">++;</span>
                    <span class="n">hash</span><span class="o">=</span><span class="n">hash</span><span class="o">+</span><span class="mi">37</span><span class="o">*</span><span class="n">index</span><span class="o">*</span><span class="n">entry</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">hash</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//Returns true if this map contains no key-value mappings.</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">entrySet</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//Returns a Set view of the keys contained in this map.</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="nf">keySet</span><span class="o">(){</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">keys</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;();</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="n">entrySet</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nl">entry:</span><span class="n">set</span><span class="o">){</span>
            <span class="n">keys</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">keys</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//Copies all of the mappings from the specified map to this map (optional operation).</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"rawtypes"</span><span class="o">,</span><span class="s">"unchecked"</span><span class="o">})</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">putAll</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">K</span><span class="o">,?</span> <span class="kd">extends</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span> <span class="nl">entry:</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">()){</span>
            <span class="n">put</span><span class="o">((</span><span class="n">K</span><span class="o">)</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),(</span><span class="n">V</span><span class="o">)</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//Returns the number of key-value mappings in this map.</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">entrySet</span><span class="o">().</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//Returns a Collection view of the values contained in this map.</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">values</span><span class="o">(){</span>
        <span class="n">Collection</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;();</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="n">entrySet</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nl">entry:</span><span class="n">set</span><span class="o">){</span>
            <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleHashMap23</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHashMap23</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapentryjava-6">MapEntry.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MapEntry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">setKey</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">){</span>
        <span class="n">K</span> <span class="n">result</span><span class="o">=</span><span class="n">key</span><span class="o">;</span>
        <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapsjava-1">Maps.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Maps</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printKeys</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Size = "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Keys: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span> <span class="c1">// Produce a Set of the keys</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapDataOrig</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="c1">// Map has ‘Set’ behavior for keys:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapDataOrig</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="c1">// Producing a Collection of the values:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Values: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsKey(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.get(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsValue(\"F0\"): "</span>
              <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsValue</span><span class="o">(</span><span class="s">"F0"</span><span class="o">));</span>
        <span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"First key in map: "</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="c1">// Operations on the Set change the Map:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">removeAll</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="countingmapdatajava">CountingMapData.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountingMapData</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="s">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
    <span class="kd">public</span> <span class="nf">CountingMapData</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span><span class="o">;</span>
        <span class="n">Entry</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">index</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">chars</span><span class="o">[</span><span class="n">index</span> <span class="o">%</span> <span class="n">chars</span><span class="o">.</span><span class="na">length</span><span class="o">]</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">index</span> <span class="o">/</span> <span class="n">chars</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">hashCode</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">size</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">size</span><span class="o">;}</span>

        <span class="kd">private</span> <span class="kd">class</span> <span class="nc">Iter</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;{</span>
            <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
                <span class="k">return</span> <span class="n">index</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nf">Entry</span><span class="o">(</span><span class="n">index</span><span class="o">++);</span>
            <span class="o">}</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">(){</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">Iter</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">60</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise23java">Exercise23.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise23</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">SimpleHashMap23</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashMap23</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">60</span><span class="o">));</span>
        <span class="n">Maps</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-24">Exercise 24</h4>
<ul>
  <li><strong>Exercise 24</strong>: (5) Following the example in SimpleHashMap.java, create and test a SimpleHashSet.</li>
</ul>

<h5 id="simplehashsetjava">SimpleHashSet.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span><span class="o">=</span><span class="mi">1024</span><span class="o">;</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="kd">private</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;[]</span> <span class="n">buckets</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">Ite</span> <span class="kd">implements</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="o">;</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">bucket</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">E</span> <span class="n">previous</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>

        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">ite</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="kt">int</span> <span class="n">ranger</span><span class="o">=</span><span class="n">index</span><span class="o">;</span>
            <span class="k">while</span><span class="o">(++</span><span class="n">ranger</span><span class="o">&lt;</span><span class="n">SIZE</span><span class="o">){</span>
                <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">ranger</span><span class="o">]!=</span><span class="kc">null</span><span class="o">){</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">E</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">ite</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">previous</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">previous</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">while</span><span class="o">(++</span><span class="n">index</span><span class="o">&lt;</span><span class="n">SIZE</span><span class="o">){</span>
                <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]!=</span><span class="kc">null</span><span class="o">){</span>
                    <span class="n">ite</span><span class="o">=</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">iterator</span><span class="o">();</span>
                    <span class="n">previous</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                    <span class="k">return</span> <span class="n">previous</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">previous</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">remove</span><span class="o">(</span><span class="n">previous</span><span class="o">);</span>
                <span class="n">previous</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
                <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">isEmpty</span><span class="o">()){</span>
                    <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]=</span><span class="kc">null</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">(){</span><span class="k">return</span> <span class="k">new</span> <span class="n">Ite</span><span class="o">();}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">ticket</span><span class="o">=</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">hash</span><span class="o">)%</span><span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">]!=</span><span class="kc">null</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(!</span><span class="n">buckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">].</span><span class="na">contains</span><span class="o">(</span><span class="n">e</span><span class="o">)){</span>
                <span class="n">buckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">]=</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
        <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">size</span><span class="o">++;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/*******
     *  AbstractSet已实现部分
     *******/</span>

    <span class="c1">//public int hashCode()</span>


    <span class="c1">//public boolean equals(Object o)</span>


    <span class="c1">//public boolean removeAll(Collection&lt;?&gt; c)</span>



    <span class="cm">/*******
     *  AbstractCollection已实现部分
     *******/</span>

    <span class="c1">//public boolean addAll(Collection&lt;? extends E&gt; c)</span>

    <span class="c1">//public void clear()</span>

    <span class="c1">//public boolean contains(Object o)</span>

    <span class="c1">//public boolean containsAll(Collection&lt;?&gt; c)</span>

    <span class="c1">//public boolean isEmpty()</span>

    <span class="c1">//public boolean remove(Object o)</span>

    <span class="c1">//public boolean retainAll(Collection&lt;?&gt; c)</span>

    <span class="c1">//public Object[] toArray()</span>

    <span class="c1">//public &lt;T&gt; T[] toArray(T[] a)</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="setsjava">Sets.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sets</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">set1</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">set2</span><span class="o">){</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt;Set1&lt;&lt;&lt;"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Class Name  &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set1</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Size    &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set1</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set1</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&gt;&gt;&gt;Set2&lt;&lt;&lt;"</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Class Name  &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set2</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Size    &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set2</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set2</span><span class="o">);</span>


        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Set1 equals Set1?   &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">set1</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Set1 equals Set2?   &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">set2</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Set1 hash code = "</span><span class="o">+</span><span class="n">set1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Set2 hash code = "</span><span class="o">+</span><span class="n">set2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>


        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="n">set1</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">set2</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Union of Set1 and Set2  &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Size    &gt;&gt;&gt;  "</span><span class="o">+</span><span class="n">set1</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Set1 contains XXXXXX?  "</span><span class="o">+</span><span class="n">set1</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"XXXXXX"</span><span class="o">));</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">set1</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;(</span><span class="n">set1</span><span class="o">.</span><span class="na">size</span><span class="o">()/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">E</span> <span class="n">mid</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Middle Element  &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">mid</span><span class="o">);</span>
        <span class="n">set1</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">mid</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After removing Middle Element   &gt;&gt;&gt; "</span><span class="o">+</span><span class="n">set1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set1</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set2</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">set1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="n">set2</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">Sets</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span><span class="n">set2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise24java">Exercise24.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise24</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set1</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set2</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">set1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="n">set2</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="n">Sets</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span><span class="n">set2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-25">Exercise 25</h4>
<ul>
  <li><strong>Exercise 25</strong>: (6) Instead of using a Listlterator for each bucket, modify MapEntry so that it is a self-contained singly linked list (each MapEntry should have a forward link to the next MapEntry). Modify the rest of the code in SimpleHashMap.java so that this new approach works correctly.</li>
</ul>

<h5 id="linkedmapentryv2java">LinkedMapEntryV2.java</h5>
<p>带指向下一个节点指针的（类单向链表）Map.Entry节点，不需要完整地实现LinkedList的全部功能，甚至不需要实现Iterator接口内部类。只需要提供几个简单的访问next节点的方法就可以了。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">LinkedMapEntryV2</span><span class="o">(){</span>
        <span class="n">key</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">next</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">LinkedMapEntryV2</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">next</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MapEntry</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">MapEntry</span> <span class="n">me</span> <span class="o">=</span> <span class="o">(</span><span class="n">MapEntry</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getKey</span><span class="o">()))</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">value</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">me</span><span class="o">.</span><span class="na">getValue</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">key</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">value</span><span class="o">;</span> <span class="o">}</span>

	<span class="cm">/**
	 *	需要的三个简单的对next节点的访问方法。
	 */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="o">(){</span><span class="k">return</span> <span class="n">next</span><span class="o">==</span><span class="kc">null</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">next</span><span class="o">(){</span><span class="k">return</span> <span class="n">next</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNext</span><span class="o">(</span><span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">){</span><span class="n">next</span><span class="o">=</span><span class="n">entry</span><span class="o">;}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="simplehashmap25v2java">SimpleHashMap25V2.java</h5>
<p>这个山寨HashMap的关键点在于对接口的把握：Map接口里的entrySet()是明确面向Map.Entry的。其他方法可以直接面向LinkedMapEntryV2。而LinkedMapEntryV2的功能比Map接口强很多。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap25V2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedMapEntryV2</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span><span class="n">value</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">)){</span>
                <span class="n">oldValue</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">cursor</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">cursor</span><span class="o">.</span><span class="na">setNext</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span><span class="n">value</span><span class="o">));</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>

        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span><span class="k">return</span> <span class="kc">null</span><span class="o">;}</span>

        <span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="k">while</span><span class="o">(</span><span class="n">cursor</span><span class="o">!=</span><span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">)){</span>
                <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedMapEntryV2</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">cursor</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cursor</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleHashMap25V2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHashMap25V2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="mapsjava-2">Maps.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Maps</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printKeys</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Size = "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Keys: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span> <span class="c1">// Produce a Set of the keys</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapDataOrig</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="c1">// Map has ‘Set’ behavior for keys:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapDataOrig</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="c1">// Producing a Collection of the values:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Values: "</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsKey(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.get(11): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">11</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.containsValue(\"F0\"): "</span>
              <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">containsValue</span><span class="o">(</span><span class="s">"F0"</span><span class="o">));</span>
        <span class="n">Integer</span> <span class="n">key</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"First key in map: "</span> <span class="o">+</span> <span class="n">key</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="n">printKeys</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="c1">// Operations on the Set change the Map:</span>
        <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">removeAll</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"map.isEmpty(): "</span> <span class="o">+</span> <span class="n">map</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise25java">Exercise25.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise25</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">SimpleHashMap25V2</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleHashMap25V2</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingMapData</span><span class="o">(</span><span class="mi">60</span><span class="o">));</span>
        <span class="n">Maps</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-26">Exercise 26</h4>
<ul>
  <li><strong>Exercise 26</strong>: (2) Add a char field to CountedString that is also initialized in the constructor, and modify the hashCode( ) and equals( ) methods to include the value of this char.</li>
</ul>

<h5 id="entrypairjava">EntryPair.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntryPair</span><span class="o">&lt;</span><span class="n">X</span><span class="o">,</span><span class="n">Y</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">X</span> <span class="n">x</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Y</span> <span class="n">y</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">EntryPair</span><span class="o">(</span><span class="n">X</span> <span class="n">inX</span><span class="o">,</span> <span class="n">Y</span> <span class="n">inY</span><span class="o">){</span><span class="n">x</span><span class="o">=</span><span class="n">inX</span><span class="o">;</span> <span class="n">y</span><span class="o">=</span><span class="n">inY</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">X</span> <span class="nf">getX</span><span class="o">(){</span><span class="k">return</span> <span class="n">x</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">Y</span> <span class="nf">getY</span><span class="o">(){</span><span class="k">return</span> <span class="n">y</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">X</span> <span class="nf">setX</span><span class="o">(</span><span class="n">X</span> <span class="n">inX</span><span class="o">){</span><span class="n">X</span> <span class="n">oldX</span><span class="o">=</span><span class="n">x</span><span class="o">;</span> <span class="n">x</span><span class="o">=</span><span class="n">inX</span><span class="o">;</span> <span class="k">return</span> <span class="n">oldX</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">Y</span> <span class="nf">setY</span><span class="o">(</span><span class="n">Y</span> <span class="n">inY</span><span class="o">){</span><span class="n">Y</span> <span class="n">oldY</span><span class="o">=</span><span class="n">y</span><span class="o">;</span> <span class="n">y</span><span class="o">=</span><span class="n">inY</span><span class="o">;</span> <span class="k">return</span> <span class="n">oldY</span><span class="o">;}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span><span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">X</span><span class="o">,</span><span class="n">Y</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">getX</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">X</span><span class="o">,</span><span class="n">Y</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">getY</span><span class="o">());}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span><span class="k">return</span> <span class="o">(</span><span class="n">x</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span> <span class="mi">0</span><span class="o">:</span><span class="n">x</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">y</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span> <span class="mi">0</span><span class="o">:</span><span class="n">y</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="countedstringjava">CountedString.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountedString</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">created</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;();</span>
    <span class="kd">private</span> <span class="kt">char</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">s</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">CountedString</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">type</span><span class="o">=</span><span class="n">c</span><span class="o">;</span>
        <span class="n">s</span><span class="o">=</span><span class="n">str</span><span class="o">;</span>
        <span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">newEntry</span><span class="o">=</span><span class="k">new</span> <span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">c</span><span class="o">,</span><span class="n">str</span><span class="o">);</span>
        <span class="n">created</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">newEntry</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">created</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">newEntry</span><span class="o">)){</span>
                <span class="n">id</span><span class="o">++;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Type: "</span> <span class="o">+</span> <span class="n">type</span> <span class="o">+</span> <span class="s">" String: "</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">" id: "</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">" hashCode(): "</span> <span class="o">+</span> <span class="n">hashCode</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">17</span><span class="o">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">37</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="o">((</span><span class="n">Character</span><span class="o">)</span><span class="n">type</span><span class="o">).</span><span class="na">hashCode</span><span class="o">();</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">37</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">37</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="n">CountedString</span> <span class="o">&amp;&amp;</span>
        <span class="n">s</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">CountedString</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">s</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
        <span class="o">((</span><span class="n">Character</span><span class="o">)</span><span class="n">type</span><span class="o">).</span><span class="na">equals</span><span class="o">(((</span><span class="n">CountedString</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">type</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
        <span class="n">id</span> <span class="o">==</span> <span class="o">((</span><span class="n">CountedString</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise26java">Exercise26.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise26</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">CountedString</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">CountedString</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>
        <span class="n">CountedString</span><span class="o">[]</span> <span class="n">cs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountedString</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cs</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountedString</span><span class="o">(</span><span class="sc">'A'</span><span class="o">,</span><span class="s">"hi"</span><span class="o">);</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">i</span><span class="o">);</span> <span class="c1">// Autobox int -&gt; Integer</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">CountedString</span> <span class="n">cstring</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Looking up "</span> <span class="o">+</span> <span class="n">cstring</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cstring</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-27">Exercise 27</h4>
<ul>
  <li><strong>Exercise 27</strong>: (3) Modify the hashCode( ) in CountedString.java by removing the combination with id, and demonstrate that CountedString still works as a key. What is the problem with this approach?
如果hashCode()没有绑定所有的域，本质上不会影响这个类作为Map的键使用。因为不会出现重复的键值。</li>
</ul>

<p>但还是存在一定问题：不同的对象，在HashMap里有同样的键值。也就是，部分对象会被其他不同的对象替换掉，因为有相同的键值。练习中，下面4个不同的对象，拥有相同的散列值。</p>
<ul>
  <li>A-Hi-1</li>
  <li>A-Hi-2</li>
  <li>A-Hi-3</li>
  <li>A-Hi-4</li>
</ul>

<p>导致前三个对象的信息会丢失，被后面相同散列值的对象覆盖。但如果这就是设计者的用意，那么就不成问题。</p>

<h5 id="entrypairjava-1">EntryPair.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EntryPair</span><span class="o">&lt;</span><span class="n">X</span><span class="o">,</span><span class="n">Y</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">X</span> <span class="n">x</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Y</span> <span class="n">y</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">EntryPair</span><span class="o">(</span><span class="n">X</span> <span class="n">inX</span><span class="o">,</span> <span class="n">Y</span> <span class="n">inY</span><span class="o">){</span><span class="n">x</span><span class="o">=</span><span class="n">inX</span><span class="o">;</span> <span class="n">y</span><span class="o">=</span><span class="n">inY</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">X</span> <span class="nf">getX</span><span class="o">(){</span><span class="k">return</span> <span class="n">x</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">Y</span> <span class="nf">getY</span><span class="o">(){</span><span class="k">return</span> <span class="n">y</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">X</span> <span class="nf">setX</span><span class="o">(</span><span class="n">X</span> <span class="n">inX</span><span class="o">){</span><span class="n">X</span> <span class="n">oldX</span><span class="o">=</span><span class="n">x</span><span class="o">;</span> <span class="n">x</span><span class="o">=</span><span class="n">inX</span><span class="o">;</span> <span class="k">return</span> <span class="n">oldX</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">Y</span> <span class="nf">setY</span><span class="o">(</span><span class="n">Y</span> <span class="n">inY</span><span class="o">){</span><span class="n">Y</span> <span class="n">oldY</span><span class="o">=</span><span class="n">y</span><span class="o">;</span> <span class="n">y</span><span class="o">=</span><span class="n">inY</span><span class="o">;</span> <span class="k">return</span> <span class="n">oldY</span><span class="o">;}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span><span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">X</span><span class="o">,</span><span class="n">Y</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">getX</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">X</span><span class="o">,</span><span class="n">Y</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">getY</span><span class="o">());}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span><span class="k">return</span> <span class="o">(</span><span class="n">x</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span> <span class="mi">0</span><span class="o">:</span><span class="n">x</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">^</span> <span class="o">(</span><span class="n">y</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span> <span class="mi">0</span><span class="o">:</span><span class="n">y</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="countedstring27java">CountedString27.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountedString27</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">created</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;();</span>
    <span class="kd">private</span> <span class="kt">char</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">s</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">CountedString27</span><span class="o">(</span><span class="kt">char</span> <span class="n">c</span><span class="o">,</span> <span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">type</span><span class="o">=</span><span class="n">c</span><span class="o">;</span>
        <span class="n">s</span><span class="o">=</span><span class="n">str</span><span class="o">;</span>
        <span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">newEntry</span><span class="o">=</span><span class="k">new</span> <span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">c</span><span class="o">,</span><span class="n">str</span><span class="o">);</span>
        <span class="n">created</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">newEntry</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">EntryPair</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">created</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">newEntry</span><span class="o">)){</span>
                <span class="n">id</span><span class="o">++;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Type: "</span> <span class="o">+</span> <span class="n">type</span> <span class="o">+</span> <span class="s">" String: "</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">" id: "</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">" hashCode(): "</span> <span class="o">+</span> <span class="n">hashCode</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//hashCode()和id解绑</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">17</span><span class="o">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">37</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="o">((</span><span class="n">Character</span><span class="o">)</span><span class="n">type</span><span class="o">).</span><span class="na">hashCode</span><span class="o">();</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">37</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="n">CountedString27</span> <span class="o">&amp;&amp;</span>
        <span class="n">s</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">CountedString27</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">s</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
        <span class="o">((</span><span class="n">Character</span><span class="o">)</span><span class="n">type</span><span class="o">).</span><span class="na">equals</span><span class="o">(((</span><span class="n">CountedString27</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">type</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise27java">Exercise27.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise27</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">CountedString27</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">CountedString27</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;();</span>
        <span class="n">CountedString27</span><span class="o">[]</span> <span class="n">cs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountedString27</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cs</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountedString27</span><span class="o">(</span><span class="sc">'A'</span><span class="o">,</span><span class="s">"hi"</span><span class="o">);</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cs</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">i</span><span class="o">);</span> <span class="c1">// Autobox int -&gt; Integer</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">CountedString27</span> <span class="n">cstring</span> <span class="o">:</span> <span class="n">cs</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Looking up "</span> <span class="o">+</span> <span class="n">cstring</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cstring</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-28">Exercise 28</h4>
<ul>
  <li><strong>Exercise 28</strong>: (4) Modify net/mindview/util/Tuple.java to make it a general-purpose class by adding hashCode( ), equals( ), and implementing Comparable for each type of Tuple.</li>
</ul>

<h5 id="tuplejava">Tuple.java</h5>
<p>这里实现的是Comparable<Tuple>接口。有一个缺点：高级的Tuple和低级的Tuple比较的时候，容易出Bug。</Tuple></p>

<p>比如TupleFive和TupleTwo比较的时候，如果前两个元素相等，就会开始比较第三个元素。会调用TupleThree的compareTo()方法。就会把TupleTwo强制转型成TupleThree，会出ClassCastException。</p>

<p>所以只能拿低级的和高级的比，或者同级之间比较。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tuple</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Tuple</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="n">A</span> <span class="n">first</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="n">B</span> <span class="n">second</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">TwoTuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span> <span class="n">first</span> <span class="o">=</span> <span class="n">a</span><span class="o">;</span> <span class="n">second</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
            <span class="k">return</span> <span class="n">first</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">first</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">second</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">second</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
            <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="mi">17</span><span class="o">;</span>
            <span class="n">hash</span><span class="o">=</span><span class="mi">37</span><span class="o">*</span><span class="n">hash</span><span class="o">+</span><span class="n">first</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="n">hash</span><span class="o">=</span><span class="mi">37</span><span class="o">*</span><span class="n">hash</span><span class="o">+</span><span class="n">second</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Tuple</span> <span class="n">t</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;)</span><span class="k">this</span><span class="o">.</span><span class="na">first</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">).</span><span class="na">first</span><span class="o">)==</span><span class="mi">0</span><span class="o">){</span>
                <span class="k">return</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;)</span><span class="k">this</span><span class="o">.</span><span class="na">second</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">).</span><span class="na">second</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;)</span><span class="k">this</span><span class="o">.</span><span class="na">first</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">).</span><span class="na">first</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="n">C</span> <span class="n">third</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">ThreeTuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
            <span class="n">third</span> <span class="o">=</span> <span class="n">c</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">third</span> <span class="o">+</span><span class="s">")"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">third</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">third</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
            <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="kd">super</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="n">hash</span><span class="o">=</span><span class="mi">37</span><span class="o">*</span><span class="n">hash</span><span class="o">+</span><span class="n">third</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Tuple</span> <span class="n">t</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="kd">super</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">))==</span><span class="mi">0</span><span class="o">){</span>
                <span class="k">return</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;)</span><span class="k">this</span><span class="o">.</span><span class="na">third</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">).</span><span class="na">third</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">compareTo</span><span class="o">((</span><span class="n">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="n">D</span> <span class="n">fourth</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">FourTuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">,</span> <span class="n">D</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
            <span class="n">fourth</span> <span class="o">=</span> <span class="n">d</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span>
            <span class="n">third</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">fourth</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">fourth</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">fourth</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
            <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="kd">super</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="n">hash</span><span class="o">=</span><span class="mi">37</span><span class="o">*</span><span class="n">hash</span><span class="o">+</span><span class="n">fourth</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Tuple</span> <span class="n">t</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="kd">super</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">))==</span><span class="mi">0</span><span class="o">){</span>
                <span class="k">return</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;)</span><span class="k">this</span><span class="o">.</span><span class="na">fourth</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">).</span><span class="na">fourth</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">compareTo</span><span class="o">((</span><span class="n">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FiveTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="n">E</span> <span class="n">fifth</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nf">FiveTuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">,</span> <span class="n">D</span> <span class="n">d</span><span class="o">,</span> <span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
            <span class="n">fifth</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span>
            <span class="n">third</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">fourth</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">fifth</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">fifth</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">FiveTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">).</span><span class="na">fifth</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
            <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="kd">super</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="n">hash</span><span class="o">=</span><span class="mi">37</span><span class="o">*</span><span class="n">hash</span><span class="o">+</span><span class="n">fifth</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Tuple</span> <span class="n">t</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="kd">super</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">))==</span><span class="mi">0</span><span class="o">){</span>
                <span class="k">return</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;)</span><span class="k">this</span><span class="o">.</span><span class="na">fifth</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(((</span><span class="n">FiveTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">).</span><span class="na">fifth</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">compareTo</span><span class="o">((</span><span class="n">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;)</span><span class="n">t</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">TwoTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">ThreeTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">,</span> <span class="n">D</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">FourTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">FiveTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">tuple</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">,</span> <span class="n">B</span> <span class="n">b</span><span class="o">,</span> <span class="n">C</span> <span class="n">c</span><span class="o">,</span> <span class="n">D</span> <span class="n">d</span><span class="o">,</span> <span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">FiveTuple</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span><span class="n">B</span><span class="o">,</span><span class="n">C</span><span class="o">,</span><span class="n">D</span><span class="o">,</span><span class="n">E</span><span class="o">&gt;(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise28java">Exercise28.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Amphibian</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Amphibian</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Amphibian</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">){</span><span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"Amphibian: "</span><span class="o">+</span><span class="n">name</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Amphibian</span> <span class="n">a</span><span class="o">){</span><span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">name</span><span class="o">);}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">Vehicle</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Vehicle</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">){</span><span class="n">name</span><span class="o">=</span><span class="n">s</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"Vehicle: "</span><span class="o">+</span><span class="n">name</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Vehicle</span> <span class="n">v</span><span class="o">){</span><span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">name</span><span class="o">);}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise28</span><span class="o">{</span>

    <span class="cm">/**
     *  测试
     */</span>
    <span class="kd">static</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">TwoTuple</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">static</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">TwoTuple</span> <span class="nf">f2</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span> <span class="o">}</span>
    <span class="kd">static</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">ThreeTuple</span><span class="o">&lt;</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">g</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiToTo"</span><span class="o">),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">FourTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">h</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiJiJi"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiPaPa"</span><span class="o">),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">FiveTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">k</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiBiuBiu"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiQQ"</span><span class="o">),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">,</span> <span class="mf">11.1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Tuple</span><span class="o">.</span><span class="na">TwoTuple</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ttsi</span> <span class="o">=</span> <span class="n">Exercise28</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ttsi</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Exercise28</span><span class="o">.</span><span class="na">f2</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Exercise28</span><span class="o">.</span><span class="na">g</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Exercise28</span><span class="o">.</span><span class="na">h</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Exercise28</span><span class="o">.</span><span class="na">k</span><span class="o">());</span>

        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">.</span><span class="na">FiveTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span><span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">.</span><span class="na">FiveTuple</span><span class="o">&lt;</span><span class="n">Vehicle</span><span class="o">,</span><span class="n">Amphibian</span><span class="o">,</span><span class="n">String</span><span class="o">,</span><span class="n">Integer</span><span class="o">,</span><span class="n">Double</span><span class="o">&gt;&gt;();</span>

        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiBiuBiu"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiQQ"</span><span class="o">),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">,</span> <span class="mf">11.1</span><span class="o">));</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiBiuBiu"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiQQ"</span><span class="o">),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">47</span><span class="o">,</span> <span class="mf">111.1</span><span class="o">));</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiBiuBiu"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiQQ"</span><span class="o">),</span> <span class="s">"hi"</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mf">5555.5</span><span class="o">));</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiBiuBiu"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiQQ"</span><span class="o">),</span> <span class="s">"hello"</span><span class="o">,</span> <span class="mi">433</span><span class="o">,</span> <span class="mf">1234.5</span><span class="o">));</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiBiuBiu"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiBMW"</span><span class="o">),</span> <span class="s">"world"</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mf">865.8</span><span class="o">));</span>
        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Tuple</span><span class="o">.</span><span class="na">tuple</span><span class="o">(</span><span class="k">new</span> <span class="n">Vehicle</span><span class="o">(</span><span class="s">"VehiGoogle"</span><span class="o">),</span> <span class="k">new</span> <span class="n">Amphibian</span><span class="o">(</span><span class="s">"AmphiBenz"</span><span class="o">),</span> <span class="s">"Java"</span><span class="o">,</span> <span class="mi">765</span><span class="o">,</span> <span class="mf">11.1</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">set</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="package-comciaoshenthinkinjavachapter17testframework">package com.ciaoshen.thinkinjava.chapter17.testframework</h4>
<p>练习29-33，依赖com.ciaoshen.thinkinjava.chapter17.testframework包中部分组件才能运行。这个包就是书中介绍的容器测试框架。具体组件如下：</p>

<h5 id="testjava">Test.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块1：封装测试类
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="cm">/**
 *  每种测试一个类
 *  有名字，有test()方法
 *  test()方法给个容器，给点参数就能运行
 */</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Test</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">name</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">C</span> <span class="n">container</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="testparamjava">TestParam.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块2：封装测试参数。
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="cm">/**
 *  TestParam类负责批量解析原始数据，生成参数包。
 *  每个参数包有两个参数：size-代表容器大小。loops-代表测试迭代次数。
 *  两个array()方法切割参数包。
 */</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestParam</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">loops</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">TestParam</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">loops</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">size</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">loops</span><span class="o">=</span><span class="n">loops</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="nf">array</span><span class="o">(</span><span class="kt">int</span><span class="o">...</span> <span class="n">values</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="na">length</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span>
        <span class="n">TestParam</span><span class="o">[]</span> <span class="n">result</span><span class="o">=</span><span class="k">new</span> <span class="n">TestParam</span><span class="o">[</span><span class="n">size</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">result</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">TestParam</span><span class="o">(</span><span class="n">values</span><span class="o">[</span><span class="n">cursor</span><span class="o">++],</span><span class="n">values</span><span class="o">[</span><span class="n">cursor</span><span class="o">++]);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="nf">array</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">values</span><span class="o">){</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">result</span><span class="o">=</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">values</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">values</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">result</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">values</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="nf">array</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="testerjava">Tester.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块3：运行测试工具包。
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="cm">/**
 *  Tester类是负责运行Test测试类的单元。
 *  用户调用run()方法。
 */</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tester</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
     *  构造函数
     */</span>
    <span class="kd">public</span> <span class="nf">Tester</span><span class="o">(</span><span class="n">C</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">container</span> <span class="o">=</span> <span class="n">container</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tests</span> <span class="o">=</span> <span class="n">tests</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">container</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">headline</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">Tester</span><span class="o">(</span><span class="n">C</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span>
                  <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">paramList</span> <span class="o">=</span> <span class="n">paramList</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="cm">/**
     *  基本参数初始化相关域和方法
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">defaultParams</span><span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">10000</span><span class="o">,</span> <span class="mi">500</span><span class="o">);</span>
    <span class="kd">private</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span> <span class="o">=</span> <span class="n">defaultParams</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">C</span> <span class="n">container</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;&gt;</span> <span class="n">tests</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">C</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">container</span><span class="o">;</span> <span class="o">}</span>


    <span class="cm">/**
     *  输出打印相关域和方法
     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">headline</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">fieldWidth</span> <span class="o">=</span> <span class="mi">8</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">sizeWidth</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">sizeField</span> <span class="o">=</span> <span class="s">"%"</span> <span class="o">+</span> <span class="n">sizeWidth</span> <span class="o">+</span> <span class="s">"s"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">stringField</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"%"</span> <span class="o">+</span> <span class="n">fieldWidth</span> <span class="o">+</span> <span class="s">"s"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">numberField</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"%"</span> <span class="o">+</span> <span class="n">fieldWidth</span> <span class="o">+</span> <span class="s">"d"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHeadline</span><span class="o">(</span><span class="n">String</span> <span class="n">newHeadline</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">headline</span> <span class="o">=</span> <span class="n">newHeadline</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"rawtypes"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">displayHeader</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">fieldWidth</span> <span class="o">*</span> <span class="n">tests</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="n">sizeWidth</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">dashLength</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">headline</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span>
        <span class="n">StringBuilder</span> <span class="n">head</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">(</span><span class="n">width</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dashLength</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">head</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">'-'</span><span class="o">);</span>
        <span class="n">head</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">' '</span><span class="o">);</span>
        <span class="n">head</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">headline</span><span class="o">);</span>
        <span class="n">head</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">' '</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dashLength</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">head</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">'-'</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">head</span><span class="o">);</span>
        <span class="c1">// Print column headers:</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">sizeField</span><span class="o">,</span> <span class="s">"size"</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Test</span> <span class="n">test</span> <span class="o">:</span> <span class="n">tests</span><span class="o">)</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">stringField</span><span class="o">(),</span> <span class="n">test</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
    <span class="o">}</span>



    <span class="cm">/**
     *  实际运行测试方法
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">C</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;&gt;</span> <span class="n">tests</span><span class="o">){</span>
        <span class="k">new</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">C</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">//最终执行者：对每组不同的参数配置，跑全套测试。</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">timedTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">displayHeader</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">TestParam</span> <span class="n">param</span> <span class="o">:</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">sizeField</span><span class="o">,</span> <span class="n">param</span><span class="o">.</span><span class="na">size</span><span class="o">);</span>
            <span class="k">for</span><span class="o">(</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="n">test</span> <span class="o">:</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">C</span> <span class="n">kontainer</span> <span class="o">=</span> <span class="n">initialize</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">size</span><span class="o">);</span>
                <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
                <span class="c1">// Call the overriden method:</span>
                <span class="kt">int</span> <span class="n">reps</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">kontainer</span><span class="o">,</span> <span class="n">param</span><span class="o">);</span>
                <span class="kt">long</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">;</span>
                <span class="kt">long</span> <span class="n">timePerRep</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="n">reps</span><span class="o">;</span> <span class="c1">// Nanoseconds</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">numberField</span><span class="o">(),</span> <span class="n">timePerRep</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="package-comciaoshenthinkinjavachapter17testframeworkgen">package com.ciaoshen.thinkinjava.chapter17.testframework.gen</h4>
<p>练习29-33，也依赖com.ciaoshen.thinkinjava.chapter17.testframework.gen包中部分组件才能运行。gen包是用来自动生成测试用随机数据的工具包。具体组件如下：</p>

<h5 id="generatorjava">Generator.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块4：模拟数据生成器
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">.</span><span class="na">gen</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">next</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="randomgeneratorjava-2">RandomGenerator.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  RandomGenerator随机生成填充常用类型。
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">.</span><span class="na">gen</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RandomGenerator</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

    <span class="c1">//Boolean</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Boolean</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextBoolean</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Integer</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Integer</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Long</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Long</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextLong</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Short</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Short</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Float</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Float</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextFloat</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Double</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Double</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//Byte</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Byte</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span><span class="o">=</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="n">rand</span><span class="o">.</span><span class="na">nextBytes</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//Charactor</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">CS</span><span class="o">=(</span><span class="s">"abcdefghijklmnopqrstuvwxyz"</span><span class="o">+</span><span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="o">).</span><span class="na">toCharArray</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Character</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;{</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">CS</span><span class="o">[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">CS</span><span class="o">.</span><span class="na">length</span><span class="o">)];</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="c1">//String</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">String</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">=</span><span class="k">new</span> <span class="n">Character</span><span class="o">();</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">(){}</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="n">size</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="nf">next</span><span class="o">(){</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span><span class="o">=</span><span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  测试
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span> <span class="n">s</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="generatedjava">Generated.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块4：模拟数据生成器
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">.</span><span class="na">gen</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Generated</span> <span class="o">{</span>
    <span class="c1">// Fill an existing array:</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span><span class="o">[]</span> <span class="nf">array</span><span class="o">(</span><span class="n">T</span><span class="o">[]</span> <span class="n">a</span><span class="o">,</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CollectionData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">gen</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">).</span><span class="na">toArray</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Create a new array:</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span><span class="o">[]</span> <span class="nf">array</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">T</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">[])</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CollectionData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">gen</span><span class="o">,</span> <span class="n">size</span><span class="o">).</span><span class="na">toArray</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="countingintegerlistjava">CountingIntegerList.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块4：模拟数据生成器
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">.</span><span class="na">gen</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountingIntegerList</span> <span class="kd">extends</span> <span class="n">AbstractList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">CountingIntegerList</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">size</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingIntegerList</span><span class="o">(</span><span class="mi">30</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="countingstringlistjava">CountingStringList.java</h5>
<p>com.ciaoshen.thinkinjava.chapter17.testframework.gen生成器包里还要加一个新的List<String>生成器。为了减小生成List本身时间上的影响，这个CountingStringList和CountingIntegerList一样是没有数据主体的。每次get()方法都随机生成一个String。</String></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">.</span><span class="na">gen</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountingStringList</span> <span class="kd">extends</span> <span class="n">AbstractList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">CountingStringList</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">size</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">CountingStringList</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">size</span><span class="o">;</span>
        <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">(</span><span class="n">length</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">size</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="mi">30</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="countinggeneratorjava">CountingGenerator.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块4：模拟数据生成器
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">.</span><span class="na">gen</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountingGenerator</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Boolean</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">!</span><span class="n">value</span><span class="o">;</span> <span class="c1">// Just flips back and forth</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Byte</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">byte</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">++;</span> <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="o">(</span><span class="s">"abcdefghijklmnopqrstuvwxyz"</span> <span class="o">+</span> <span class="s">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="o">).</span><span class="na">toCharArray</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Character</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">index</span> <span class="o">=</span> <span class="o">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">%</span> <span class="n">chars</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">chars</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">String</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span>
        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span><span class="o">&gt;</span> <span class="n">cg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Character</span><span class="o">();</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">()</span> <span class="o">{}</span>
        <span class="kd">public</span> <span class="nf">String</span><span class="o">(</span><span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
            <span class="kt">char</span><span class="o">[]</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                <span class="n">buf</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">cg</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">(</span><span class="n">buf</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Short</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">short</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">++;</span> <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Integer</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">++;</span> <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Long</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">long</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">value</span><span class="o">++;</span> <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Float</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">float</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
            <span class="kt">float</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Double</span> <span class="kd">implements</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kt">double</span> <span class="n">value</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">;</span>
        <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
            <span class="kt">double</span> <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="collectiondatajava">CollectionData.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  容器测试框架
 *  框架模块4：模拟数据生成器
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">.</span><span class="na">testframework</span><span class="o">.</span><span class="na">gen</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"serial"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectionData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">CollectionData</span><span class="o">(</span><span class="n">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="c1">// A generic convenience method:</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">CollectionData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">list</span><span class="o">(</span><span class="n">Generator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">CollectionData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">gen</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-29">Exercise 29</h4>
<ul>
  <li><strong>Exercise 29</strong>: (2) Modify ListPerformance.java so that the Lists hold String objects instead of Integers. Use a Generator from the Arrays chapter to create test values.</li>
</ul>

<h5 id="exercise29java">Exercise29.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise29</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
    <span class="kd">static</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">&gt;</span> <span class="n">strRand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
    <span class="kd">static</span> <span class="kt">int</span> <span class="n">reps</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">;</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">qTests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;();</span>

    <span class="cm">/**
     *  实际测试类在这里定义
     */</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"add"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">listSize</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strRand</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">listSize</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="n">reps</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">listSize</span><span class="o">));</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"set"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="n">reps</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">listSize</span><span class="o">),</span> <span class="n">strRand</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"iteradd"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="kt">int</span> <span class="n">LOOPS</span> <span class="o">=</span> <span class="mi">1000000</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">half</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
                <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">listIterator</span><span class="o">(</span><span class="n">half</span><span class="o">);</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LOOPS</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">it</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">strRand</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                <span class="k">return</span> <span class="n">LOOPS</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"insert"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">strRand</span><span class="o">.</span><span class="na">next</span><span class="o">());</span> <span class="c1">// Minimize random-access cost</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"remove"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="o">)</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span> <span class="c1">// Minimize random-access cost</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="c1">// Tests for queue behavior:</span>
        <span class="n">qTests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"addFirst"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">addFirst</span><span class="o">(</span><span class="n">strRand</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">qTests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"addLast"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="n">strRand</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">qTests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"rmFirst"</span><span class="o">)</span> <span class="o">{</span>
                       <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                           <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                           <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                           <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                               <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                               <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                               <span class="k">while</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
                                   <span class="n">list</span><span class="o">.</span><span class="na">removeFirst</span><span class="o">();</span>
                           <span class="o">}</span>
                           <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
                       <span class="o">}</span>
                   <span class="o">});</span>
        <span class="n">qTests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"rmLast"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">removeLast</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>


    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ListTester</span> <span class="kd">extends</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nf">ListTester</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="n">container</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
            <span class="n">container</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
            <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">ListTester</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Tester</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">arrayTest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="kc">null</span><span class="o">,</span> <span class="n">tests</span><span class="o">.</span><span class="na">subList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">)){</span>
            <span class="nd">@Override</span> <span class="kd">protected</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">ia</span> <span class="o">=</span> <span class="n">Generated</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">CountingGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">(),</span> <span class="n">size</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">ia</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">arrayTest</span><span class="o">.</span><span class="na">setHeadline</span><span class="o">(</span><span class="s">"Array as List"</span><span class="o">);</span>
        <span class="n">arrayTest</span><span class="o">.</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span><span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">10000</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">ListTester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">ListTester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">ListTester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">fieldWidth</span> <span class="o">=</span> <span class="mi">12</span><span class="o">;</span>
        <span class="n">Tester</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">qTest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">qTests</span><span class="o">);</span>
        <span class="n">qTest</span><span class="o">.</span><span class="na">setHeadline</span><span class="o">(</span><span class="s">"Queue tests"</span><span class="o">);</span>
        <span class="n">qTest</span><span class="o">.</span><span class="na">timedTest</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-30">Exercise 30</h4>
<ul>
  <li><strong>Exercise 30</strong>: (3) Compare the performance of Collections.sort( ) between an ArrayList and a LinkedList.
ArrayList和LinkedList在较大规模的测试下，效率基本一致。</li>
</ul>

<p>因为，Collections.sort()的源码是把List统一转换成数组，然后用Arrays.sort()来排序的。所以两个效率的差距只有前面转换成数组的效率高低。后面排序完全一样。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise30</span><span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">params</span><span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">2000</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>

    <span class="kd">static</span><span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"sort"</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"sort"</span><span class="o">;</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">loops</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">loops</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                    <span class="n">container</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">j</span><span class="o">++){</span>
                        <span class="n">container</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="n">size</span><span class="o">,</span><span class="mi">5</span><span class="o">));</span>
                    <span class="o">}</span>
                    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">container</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">size</span><span class="o">*</span><span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span><span class="n">tests</span><span class="o">,</span><span class="n">params</span><span class="o">);</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span><span class="n">tests</span><span class="o">,</span><span class="n">params</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>结果：</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>- ArrayList -
 size    sort
   10   14125
  100   39813
 1000  294339
10000 3639676
- LinkedList -
 size    sort
   10    3246
  100   24711
 1000  306514
10000 4026489
</code></pre>
</div>

<p>但这个测试的结果中，container.addAll(）对List填充这一步的时间也被计算到运行时间里。对结果的影响比较大。
不排序，光填充的时间：</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>- ArrayList -
 size    sort
   10   12761
  100   18892
 1000  169804
10000 1349499
- LinkedList -
 size    sort
   10    1858
  100   14822
 1000  139999
10000 1406752
</code></pre>
</div>

<h4 id="exercise-31">Exercise 31</h4>
<ul>
  <li><strong>Exercise 31</strong>: (5) Create a container that encapsulates an array of String, and that only allows adding Strings and getting Strings, so that there are no casting issues during use. If the internal array isn’t big enough for the next add, your container should automatically resize it. In main( ), compare the performance of your container with an ArrayList<String>.</String></li>
</ul>

<h5 id="stringlistjava">StringList.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringList</span> <span class="kd">extends</span> <span class="n">AbstractList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span><span class="o">=</span><span class="mi">10</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">list</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">max</span><span class="o">=</span><span class="n">SIZE</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">StringList</span><span class="o">(){</span>
        <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">max</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">StringList</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="n">max</span><span class="o">=</span><span class="n">size</span><span class="o">;</span>
        <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">max</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="c1">//add last</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">max</span><span class="o">){</span>
            <span class="n">resize</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">list</span><span class="o">[</span><span class="n">cursor</span><span class="o">]=</span><span class="n">s</span><span class="o">;</span>
        <span class="n">cursor</span><span class="o">++;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//get first</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">size</span><span class="o">()==</span><span class="mi">0</span><span class="o">?</span> <span class="kc">null</span><span class="o">:</span><span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">0</span> <span class="o">||</span> <span class="n">index</span><span class="o">&gt;=</span><span class="n">max</span><span class="o">){</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="c1">//size*2</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resize</span><span class="o">(){</span>
        <span class="n">max</span><span class="o">*=</span><span class="mi">2</span><span class="o">;</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">newList</span><span class="o">=</span><span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">max</span><span class="o">);</span>
        <span class="n">list</span><span class="o">=</span><span class="n">newList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">cursor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">(){</span>
        <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
        <span class="n">max</span><span class="o">=</span><span class="n">SIZE</span><span class="o">;</span>
        <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">StringList</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="mi">50</span><span class="o">));</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"String No."</span><span class="o">+</span><span class="n">index</span><span class="o">+</span><span class="s">":    "</span><span class="o">+</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise31java">Exercise31.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise31</span><span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;();</span>

    <span class="kd">static</span><span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"add"</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"sort"</span><span class="o">;</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">loops</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="n">Generator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">loops</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                    <span class="n">container</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">j</span><span class="o">++){</span>
                        <span class="n">container</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">size</span><span class="o">*</span><span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"sort"</span><span class="o">;</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">loops</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="n">container</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingStringList</span><span class="o">(</span><span class="n">size</span><span class="o">,</span><span class="mi">5</span><span class="o">));</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">loops</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                    <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span><span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">StringList</span><span class="o">(),</span><span class="n">tests</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="结果">结果</h5>
<p>不泛型的简单StringList和ArrayList比，add()方法差不多，get()方法快一倍多。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>----- ArrayList -----
 size     add     get
   10    1115     579
  100     229     173
 1000     211     362
10000     180   11722
----- StringList -----
 size     add     get
   10     409     187
  100     193      78
 1000     176     101
10000     175    4020
</code></pre>
</div>

<h4 id="exercise-32">Exercise 32</h4>
<ul>
  <li><strong>Exercise 32</strong>: (2) Repeat the previous exercise for a container of int, and compare the performance to an ArrayList<Integer>. In your performance comparison, include the process of incrementing each object in the container.</Integer></li>
</ul>

<h5 id="intlistjava">IntList.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IntList</span> <span class="kd">extends</span> <span class="n">AbstractList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span><span class="o">=</span><span class="mi">10</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">list</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">max</span><span class="o">=</span><span class="n">SIZE</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">IntList</span><span class="o">(){</span>
        <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">max</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">IntList</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
        <span class="n">max</span><span class="o">=</span><span class="n">size</span><span class="o">;</span>
        <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">max</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="c1">//add last</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">Integer</span> <span class="n">i</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">cursor</span><span class="o">==</span><span class="n">max</span><span class="o">){</span>
            <span class="n">resize</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">list</span><span class="o">[</span><span class="n">cursor</span><span class="o">]=</span><span class="n">i</span><span class="o">;</span>
        <span class="n">cursor</span><span class="o">++;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//get first</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">get</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nf">size</span><span class="o">()==</span><span class="mi">0</span><span class="o">?</span> <span class="kc">null</span><span class="o">:</span><span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">0</span> <span class="o">||</span> <span class="n">index</span><span class="o">&gt;=</span><span class="n">max</span><span class="o">){</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">set</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">i</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">0</span> <span class="o">||</span> <span class="n">index</span><span class="o">&gt;=</span><span class="n">max</span><span class="o">){</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">list</span><span class="o">[</span><span class="n">index</span><span class="o">]=</span><span class="n">i</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
    <span class="o">}</span>
    <span class="c1">//size*2</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resize</span><span class="o">(){</span>
        <span class="n">max</span><span class="o">*=</span><span class="mi">2</span><span class="o">;</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">newList</span><span class="o">=</span><span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">max</span><span class="o">);</span>
        <span class="n">list</span><span class="o">=</span><span class="n">newList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">cursor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">(){</span>
        <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
        <span class="n">max</span><span class="o">=</span><span class="n">SIZE</span><span class="o">;</span>
        <span class="n">cursor</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">IntList</span><span class="o">();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingIntegerList</span><span class="o">(</span><span class="mi">50</span><span class="o">));</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Int No."</span><span class="o">+</span><span class="n">index</span><span class="o">+</span><span class="s">":    "</span><span class="o">+</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise32java">Exercise32.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise32</span><span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>

    <span class="kd">static</span><span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"add"</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"sort"</span><span class="o">;</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">loops</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">loops</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                    <span class="n">container</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">j</span><span class="o">++){</span>
                        <span class="n">container</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">size</span><span class="o">*</span><span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"sort"</span><span class="o">;</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">loops</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="n">container</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingIntegerList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">loops</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                    <span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"plus"</span><span class="o">){</span>
            <span class="n">String</span> <span class="n">name</span><span class="o">=</span><span class="s">"sort"</span><span class="o">;</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">){</span>
                <span class="kt">int</span> <span class="n">size</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">loops</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="n">Random</span> <span class="n">rand</span><span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
                <span class="n">container</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingIntegerList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">loops</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">j</span><span class="o">++){</span>
                        <span class="n">container</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">j</span><span class="o">,</span><span class="n">container</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">*</span><span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(),</span><span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">IntList</span><span class="o">(),</span><span class="n">tests</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="结果-1">结果</h5>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>--------- ArrayList ---------
 size     add     get    plus
   10     193     312     221
  100      38      68      30
 1000      22     154      10
10000      15    1762      10
---------- IntList ----------
 size     add     get    plus
   10      61     137     234
  100      24      67      41
 1000      20      80       8
10000      27    3006       7
</code></pre>
</div>

<h4 id="exercise-33">Exercise 33</h4>
<ul>
  <li><strong>Exercise 33</strong>: (5) Create a FastTraversalLinkedList that internally uses a LinkedList for rapid insertions and removals, and an ArrayList for rapid traversals and get( ) operations. Test it by modifying ListPerformance.java.</li>
</ul>

<ol>
  <li>插入，移除用LinkdList</li>
  <li>遍历，set(),get()用ArrayList</li>
  <li>ListIterator(int index)接口用来返回LinkedList的迭代器</li>
  <li>iterator()接口用来返回ArrayList的迭代器</li>
</ol>

<h5 id="fasttraversallinkedlistjava">FastTraversalLinkedList.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"serial"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FastTraversalLinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">synArrayList</span><span class="o">(){</span>
        <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">listIterator</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">synLinkedList</span><span class="o">(){</span>
        <span class="n">clear</span><span class="o">();</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">listIterator</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
            <span class="n">add</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  四个用ArrayList的方法
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">(){</span><span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()?</span> <span class="kc">null</span><span class="o">:</span><span class="n">list</span><span class="o">.</span><span class="na">iterator</span><span class="o">();}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">E</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()?</span> <span class="kc">null</span><span class="o">:</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">E</span> <span class="nf">set</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="n">E</span> <span class="n">element</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()&gt;</span><span class="n">index</span><span class="o">?</span>  <span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">index</span><span class="o">,</span><span class="n">element</span><span class="o">):</span><span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise33java">Exercise33.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise33</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">Random</span> <span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
    <span class="kd">static</span> <span class="kt">int</span> <span class="n">reps</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">;</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;();</span>

    <span class="cm">/**
     *  实际测试类在这里定义
     */</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="cm">/**
         *  用LinkedList的3个方法
         */</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"add"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">listSize</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">listSize</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"insert"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">47</span><span class="o">);</span> <span class="c1">// Minimize random-access cost</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"remove"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingIntegerList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="o">)</span>
                        <span class="n">list</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span> <span class="c1">// Minimize random-access cost</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="cm">/**
         *  用ArrayList的4个方法
         */</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="n">reps</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">listSize</span><span class="o">));</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"set"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="n">reps</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">listSize</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">listSize</span><span class="o">),</span> <span class="mi">47</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"iter"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
                <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                        <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span><span class="o">*</span><span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>


    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ListTester</span> <span class="kd">extends</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nf">ListTester</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"uchecked"</span><span class="o">)</span>
        <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="n">container</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
            <span class="n">container</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="n">CountingIntegerList</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
            <span class="k">if</span><span class="o">(</span><span class="n">container</span> <span class="k">instanceof</span> <span class="n">FastTraversalLinkedList</span><span class="o">){</span>
                <span class="o">((</span><span class="n">FastTraversalLinkedList</span><span class="o">)</span><span class="n">container</span><span class="o">).</span><span class="na">synArrayList</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">ListTester</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span><span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">10000</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">ListTester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">ListTester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">ListTester</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">FastTraversalLinkedList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester</span><span class="o">.</span><span class="na">fieldWidth</span> <span class="o">=</span> <span class="mi">12</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="测试结果">测试结果</h5>
<p>虽然测试成绩是各取ArrayList和LinkedList的优点，但实际使用的时候因为有synchronize同步两个列表的开销，所以综合开销还是不沾优的。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>--------------------- ArrayList ---------------------
 size     add  insert  remove     get     <span class="nb">set    </span>iter
   10      91    1172     245      15      14       8
  100      13     290      31      14      15       0
 1000      16     198      93      11      13       0
10000       8    1605     497      12      17       0
--------------------- LinkedList ---------------------
 size     add  insert  remove     get     <span class="nb">set    </span>iter
   10     110     322     110      32      27      10
  100       8     119      14      41      41       0
 1000      10      61      15     379     374       2
10000      18      75      19    4720    4428       0
-------------- FastTraversalLinkedList --------------
 size     add  insert  remove     get     <span class="nb">set    </span>iter
   10      70      87      30      14      15       3
  100      11      58      21      14      15       0
 1000      29      80      35      13      12       0
10000      17      64      21      12      13       0
</code></pre>
</div>

<h4 id="exercise-34">Exercise 34</h4>
<ul>
  <li><strong>Exercise 34</strong>: (1) Modify SetPerformance.java so that the Sets hold String objects instead of Integers. Use a Generator from the Arrays chapter to create test values.</li>
</ul>

<h5 id="exercise34java">Exercise34.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise34</span><span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="n">Generator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"add"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">set</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"contains"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">span</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">span</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">set</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"xxxxxxx"</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">span</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="s">"iterate"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="mi">10</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                        <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">set</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Tester34</span> <span class="kd">extends</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="nf">Tester34</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nf">Tester34</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">){</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">){</span>
            <span class="k">new</span> <span class="nf">Tester34</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Tester34</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="n">Generator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">container</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Tester34</span><span class="o">.</span><span class="na">fieldWidth</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="n">Tester34</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester34</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester34</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="测试结果-1">测试结果</h5>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>------------- TreeSet -------------
 size       add  contains   iterate
   10      1538        71        39
  100       325        29         6
 1000       312        39         8
10000       412        49        20
------------- HashSet -------------
 size       add  contains   iterate
   10       478        63        89
  100       190        12         7
 1000       180         4         8
10000       199         2        14
---------- LinkedHashSet ----------
 size       add  contains   iterate
   10       279        52        25
  100       193         5         7
 1000       200         5         6
10000       202         7        11
</code></pre>
</div>

<h4 id="exercise-35">Exercise 35</h4>
<ul>
  <li><strong>Exercise 35</strong>: (1) Modify MapPerformance.java to include tests of SlowMap.</li>
</ul>

<p>SlowMap真的非常慢。</p>

<h5 id="exercise35java">Exercise35.java</h5>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise35</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"put"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">j</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">span</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">span</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">span</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"iterate"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="mi">10</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span>
                        <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Tester35</span> <span class="kd">extends</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="nf">Tester35</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nf">Tester35</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">){</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">){</span>
            <span class="k">new</span> <span class="nf">Tester35</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Tester35</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span><span class="n">i</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">defaultParams</span><span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">10000</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span><span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span>
                     <span class="k">new</span> <span class="n">IdentityHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">BetterSlowMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester35</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">SortedSlowMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="测试结果-2">测试结果</h5>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>---------- TreeMap ----------
 size     put     get iterate
   10     424      98      32
  100      60      26       8
 1000      69      46       5
10000      94      58       8
---------- HashMap ----------
 size     put     get iterate
   10     205      97      71
  100      10       3       8
 1000      16       5       5
10000      15       5       6
------- LinkedHashMap -------
 size     put     get iterate
   10     290      46      14
  100      32      11       7
 1000      26      10       6
10000      27      11       6
------ IdentityHashMap ------
 size     put     get iterate
   10      89      33      24
  100      20      41      15
 1000      81      84      16
10000      95     133      16
-------- WeakHashMap --------
 size     put     get iterate
   10     126      57      28
  100      42       7      10
 1000      29      10      14
10000      25      11      16
--------- Hashtable ---------
 size     put     get iterate
   10      63      37      21
  100      53      22       9
 1000      28      27       8
10000      30      23       9
---------- SlowMap ----------
 size     put     get iterate
   10     316     135      53
  100     195     120      12
 1000    1334     820      11
10000   15946    8691      11
</code></pre>
</div>

<h4 id="exercise-36">Exercise 36</h4>
<ul>
  <li><strong>Exercise 36</strong>: (5) Modify SlowMap so that instead of two ArrayLists, it holds a single ArrayList of MapEntry objects. Verify that the modified version works correctly. Using MapPerformance.java, test the speed of your new Map. Now change the put( ) method so that it performs a sort( ) after each pair is entered, and modify get( ) to use Collections.binarySearch( ) to look up the key. Compare the performance of the new version with the old ones.</li>
</ul>

<h5 id="betterslowmapjava">BetterSlowMap.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BetterSlowMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;{</span>
        <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">MPair</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">,</span> <span class="n">V</span> <span class="n">v</span><span class="o">){</span><span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">(){</span><span class="k">return</span> <span class="n">key</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">(){</span><span class="k">return</span> <span class="n">value</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">){</span><span class="n">V</span> <span class="n">old</span><span class="o">=</span><span class="n">value</span><span class="o">;</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="o">;</span><span class="k">return</span> <span class="n">old</span><span class="o">;}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(!</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">)){</span><span class="k">return</span> <span class="kc">false</span><span class="o">;}</span>
            <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">;</span>
            <span class="k">return</span>
            <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()==</span><span class="kc">null</span> <span class="o">:</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
            <span class="o">&amp;&amp;</span>
            <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()==</span><span class="kc">null</span> <span class="o">:</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
            <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="mi">17</span><span class="o">*</span><span class="mi">37</span><span class="o">;</span>
            <span class="n">hash</span><span class="o">+=</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span><span class="o">)?</span> <span class="mi">0</span><span class="o">:</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="n">hash</span><span class="o">*=</span><span class="mi">37</span><span class="o">;</span>
            <span class="n">hash</span><span class="o">+=</span> <span class="o">(</span><span class="n">value</span><span class="o">==</span><span class="kc">null</span><span class="o">)?</span> <span class="mi">0</span><span class="o">:</span><span class="n">value</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=</span><span class="k">new</span> <span class="n">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">==-</span><span class="mi">1</span><span class="o">){</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">oldValue</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
            <span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">index</span><span class="o">,</span><span class="n">entry</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">value</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">K</span> <span class="n">k</span><span class="o">=(</span><span class="n">K</span><span class="o">)</span><span class="n">key</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nl">entry:</span><span class="n">list</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">)){</span>
                <span class="n">value</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();}</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">=</span> <span class="k">new</span> <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"BULGARIA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="sortedslowmapjava">SortedSlowMap.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 *  持有MPair对象数组的SlowMap
 *  每次put()完，用sort()排序
 *  get()的时候用binarySearch()
 */</span>
<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">SlowMapComparator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;{</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">a</span><span class="o">,</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">b</span><span class="o">){</span>
        <span class="k">return</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;)</span><span class="n">a</span><span class="o">.</span><span class="na">getKey</span><span class="o">()).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SortedSlowMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;,</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;{</span>
        <span class="kd">private</span> <span class="n">K</span> <span class="n">key</span><span class="o">;</span>
        <span class="kd">private</span> <span class="n">V</span> <span class="n">value</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">MPair</span><span class="o">(</span><span class="n">K</span> <span class="n">k</span><span class="o">,</span> <span class="n">V</span> <span class="n">v</span><span class="o">){</span><span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="o">;</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">K</span> <span class="nf">getKey</span><span class="o">(){</span><span class="k">return</span> <span class="n">key</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">V</span> <span class="nf">getValue</span><span class="o">(){</span><span class="k">return</span> <span class="n">value</span><span class="o">;}</span>
        <span class="kd">public</span> <span class="n">V</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">V</span> <span class="n">v</span><span class="o">){</span><span class="n">V</span> <span class="n">old</span><span class="o">=</span><span class="n">value</span><span class="o">;</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="o">;</span><span class="k">return</span> <span class="n">old</span><span class="o">;}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(!</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">)){</span><span class="k">return</span> <span class="kc">false</span><span class="o">;}</span>
            <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;)</span><span class="n">o</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">key</span><span class="o">==</span><span class="kc">null</span><span class="o">?</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()==</span><span class="kc">null</span> <span class="o">:</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
            <span class="kt">int</span> <span class="n">hash</span><span class="o">=</span><span class="mi">17</span><span class="o">*</span><span class="mi">37</span><span class="o">;</span>
            <span class="n">hash</span><span class="o">+=</span> <span class="o">(</span><span class="n">key</span><span class="o">==</span><span class="kc">null</span><span class="o">)?</span> <span class="mi">0</span><span class="o">:</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hash</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">){</span>
            <span class="k">return</span> <span class="o">((</span><span class="n">Comparable</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;)</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=</span><span class="k">new</span> <span class="n">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span><span class="n">value</span><span class="o">);</span>
        <span class="n">V</span> <span class="n">oldValue</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">comp</span><span class="o">=</span><span class="k">new</span> <span class="n">SlowMapComparator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;();</span>
        <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="n">Collections</span><span class="o">.</span><span class="na">binarySearch</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">entry</span><span class="o">,</span><span class="n">comp</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">oldValue</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">index</span><span class="o">,</span><span class="n">entry</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
            <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">comp</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">value</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=</span><span class="k">new</span> <span class="n">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;((</span><span class="n">K</span><span class="o">)</span><span class="n">key</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="n">Collections</span><span class="o">.</span><span class="na">binarySearch</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">entry</span><span class="o">,</span><span class="k">new</span> <span class="n">SlowMapComparator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;());</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">value</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">EntrySet</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">EntrySet</span> <span class="kd">extends</span> <span class="n">AbstractSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">iterator</span><span class="o">(){</span>
            <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span><span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();}</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span><span class="o">=</span> <span class="k">new</span> <span class="n">SlowMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">MyCountries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">15</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"BULGARIA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise36java">Exercise36.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise36</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"put"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">j</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">span</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">span</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">span</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"iterate"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="mi">10</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span>
                        <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Tester36</span> <span class="kd">extends</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="nf">Tester36</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nf">Tester36</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">){</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">){</span>
            <span class="k">new</span> <span class="nf">Tester36</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Tester36</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span><span class="n">i</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">defaultParams</span><span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">10000</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span><span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span>
                   <span class="k">new</span> <span class="n">IdentityHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">BetterSlowMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester36</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">SortedSlowMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>  
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="sortedslowmap_v2java-不需要用sort排序">SortedSlowMap_V2.java 不需要用sort()排序</h5>
<p>因为Collections.binarySearch()如果没有找到元素，返回值是(-(insertion point) - 1)。其中insertion point就是代表这个元素在原集合中应该插入的位置。利用这个数字新插入的元素就可以保持集合的排序。</p>
<div class="language-java highlighter-rouge"><pre class="highlight"><code>    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=</span><span class="k">new</span> <span class="n">MPair</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span><span class="n">value</span><span class="o">);</span>
        <span class="n">V</span> <span class="n">oldValue</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">comp</span><span class="o">=</span><span class="k">new</span> <span class="n">SlowMapComparator</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;();</span>
        <span class="kt">int</span> <span class="n">index</span><span class="o">=</span><span class="n">Collections</span><span class="o">.</span><span class="na">binarySearch</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">entry</span><span class="o">,</span><span class="n">comp</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">index</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">oldValue</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">index</span><span class="o">,</span><span class="n">entry</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="o">),</span><span class="n">entry</span><span class="o">);</span>
            <span class="c1">//Collections.sort(list,comp);	//不需要排序</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>

<h5 id="测试结果-3">测试结果</h5>
<p>结果是用MPair做元素的BetterSlowMap没有比原来的SlowMap更快。尤其是get()方法因为要遍历所有MPair变得更慢了。</p>

<p>用了sort()和binarySearch()之后，SortedSlowMap最大的变化就是get()操作的开销指数级缩小。但代价是sort()的开销也不小。put()方法更慢了。</p>

<p>最后利用binarySearch()返回值的位置保持排序的SortedSlowMap_V2，put()和get()方法都显著优化。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>---------- TreeMap ----------
 size     put     get iterate
   10     366     112      48
  100      61      30       6
  100      67      19       3
10000      74      69       8
---------- HashMap ----------
 size     put     get iterate
   10     193     157      73
  100      18       4       8
  100      11       3       9
10000      28      35      10
------- LinkedHashMap -------
 size     put     get iterate
   10     404      57      24
  100      43      12       7
  100      25      10       7
10000      27      11       7
------ IdentityHashMap ------
 size     put     get iterate
   10     133      54      39
  100      32      36      15
  100      13      29      13
10000     114      86      17
-------- WeakHashMap --------
 size     put     get iterate
   10     119      38      22
  100      33       8      10
  100      18       8      10
10000      26      14      11
--------- Hashtable ---------
 size     put     get iterate
   10      65      39      21
  100      34      21      10
  100      27      18       9
10000      59      34      10
---------- SlowMap ----------
 size     put     get iterate
   10     480     172      43
  100     146      91      11
  100     151      94      15
10000   11191   10775      11
------- BetterSlowMap -------
 size     put     get iterate
   10     313      77      13
  100     153     155       8
  100     168     183       9
10000   12001   17013       7
------- SortedSlowMap -------
 size     put     get iterate
   10     580     146      21
  100     288      25       7
  100     201      28       7
10000   28663      74       7
------- SortedSlowMap_V2 -------
 size     put     get iterate
   10     465     147      10
  100      38      32       7
  100      47      29       8
10000     561      69       7
</code></pre>
</div>

<h4 id="exercise-37">Exercise 37</h4>
<ul>
  <li><strong>Exercise 37</strong>: (2) Modify SimpleHashMap to use ArrayLists instead of LinkedLists. Modify MapPerformance.java to compare the performance of the two implementations.</li>
</ul>

<h4 id="simplehashmap37java">SimpleHashMap37.java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap37</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="o">}</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SimpleHashMap37</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHashMap37</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise37java">Exercise37.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise37</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"put"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="n">map</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">j</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">size</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">span</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">span</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">span</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"iterate"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span> <span class="o">*</span> <span class="mi">10</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span> <span class="o">{</span>
                    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">iterator</span><span class="o">();</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span>
                        <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">map</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Tester37</span> <span class="kd">extends</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="nf">Tester37</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nf">Tester37</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">){</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">){</span>
            <span class="k">new</span> <span class="nf">Tester37</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Tester37</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span><span class="n">i</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">10000</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">TreeMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span><span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">IdentityHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleHashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
        <span class="n">Tester37</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleHashMap37</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(),</span> <span class="n">tests</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="测试结果-4">测试结果</h5>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>---------- TreeMap ----------
 size     put     get iterate
   10     524     117      38
  100      56      27       7
  100      72      18       3
10000     101      85       8
---------- HashMap ----------
 size     put     get iterate
   10     146     114      74
  100      11       4       8
  100      28       3       7
10000      90     175      71
------- LinkedHashMap -------
 size     put     get iterate
   10     477      46      21
  100      24      10       6
  100      21       9       5
10000      94      11       6
------ IdentityHashMap ------
 size     put     get iterate
   10     115      32      23
  100      21      30      15
  100      13      35      20
10000     252      75      19
-------- WeakHashMap --------
 size     put     get iterate
   10     113      39      21
  100      27       7      10
  100      18       8      10
10000     148      54      18
--------- Hashtable ---------
 size     put     get iterate
   10      91      28      20
  100      35      19       9
  100      19      16       8
10000     130      19       8
------- SimpleHashMap -------
 size     put     get iterate
   10    1220      49     115
  100    1075      11     823
  100     996       9     805
10000     533     261  142641
------ SimpleHashMap37 ------
 size     put     get iterate
   10     761      62     113
  100     972       8     797
  100    1007       8     852
10000     756     289  145136
</code></pre>
</div>

<h4 id="exercise-38">Exercise 38</h4>
<ul>
  <li><strong>Exercise 38</strong>: (3) Look up the HashMap class in the JDK documentation. Create a HashMap, fill it with elements, and determine the load factor. Test the lookup speed with this map, then attempt to increase the speed by making a new HashMap with a larger initial capacity and copying the old map into the new one, then run your lookup speed test again on the new map.</li>
</ul>

<p>#####Exercise38.java</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ciaoshen.thinkinjava.chapter17.testframework.gen.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise38</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;();</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">tests</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;(</span><span class="s">"get"</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">int</span> <span class="nf">test</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="n">TestParam</span> <span class="n">tp</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">loops</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">loops</span><span class="o">;</span>
                <span class="kt">int</span> <span class="n">span</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="na">size</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
                <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">span</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
                        <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">loops</span> <span class="o">*</span> <span class="n">span</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Tester38</span> <span class="kd">extends</span> <span class="n">Tester</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;{</span>
        <span class="kd">public</span> <span class="nf">Tester38</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="nf">Tester38</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">container</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">){</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">container</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">){</span>
            <span class="k">new</span> <span class="nf">Tester38</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cntnr</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Test</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;&gt;&gt;</span> <span class="n">tests</span><span class="o">,</span> <span class="n">TestParam</span><span class="o">[]</span> <span class="n">paramList</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">Tester38</span><span class="o">(</span><span class="n">cntnr</span><span class="o">,</span> <span class="n">tests</span><span class="o">,</span> <span class="n">paramList</span><span class="o">).</span><span class="na">timedTest</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">initialize</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">){</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
                <span class="n">container</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">i</span><span class="o">,</span><span class="n">i</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="n">Tester</span><span class="o">.</span><span class="na">defaultParams</span> <span class="o">=</span> <span class="n">TestParam</span><span class="o">.</span><span class="na">array</span><span class="o">(</span><span class="mi">10000</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">Tester38</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="mi">16384</span><span class="o">),</span> <span class="n">tests</span><span class="o">);</span>	<span class="c1">//负载因子：10000/16384=0.61</span>
        <span class="n">Tester38</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="mi">65536</span><span class="o">),</span> <span class="n">tests</span><span class="o">);</span>	<span class="c1">//负载因子：10000/65536=0.15</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="测试结果-5">测试结果</h5>
<p>当负载因子等于0.15的时候，查询速度明显比负载因子是0.61的时候快。</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>-- HashMap --
 size     get
10000      97
-- HashMap --
 size     get
10000      17
</code></pre>
</div>

<h4 id="exercise-39">Exercise 39</h4>
<ul>
  <li><strong>Exercise 39</strong>: (6) Add a private rehash( ) method to SimpleHashMap that is invoked when the load factor exceeds 0.75. During rehashing, double the number of buckets, then search for the first prime number greater than that to determine the new number of buckets.</li>
</ul>

<h5 id="rehashsimplehashmapjava">RehashSimpleHashMap.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RehashSimpleHashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">LOAD_FACTOR</span><span class="o">=</span><span class="mf">0.75</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">){</span>
            <span class="k">if</span><span class="o">((</span><span class="n">size</span><span class="o">()/(</span><span class="kt">double</span><span class="o">)</span><span class="n">SIZE</span><span class="o">)&gt;=</span><span class="n">LOAD_FACTOR</span><span class="o">){</span>
                <span class="n">rehash</span><span class="o">();</span>
                <span class="n">index</span><span class="o">=</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
                <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]==</span><span class="kc">null</span><span class="o">){</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();}</span>
                <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">rehash</span><span class="o">(){</span>
        <span class="c1">//double size</span>
        <span class="n">SIZE</span><span class="o">*=</span><span class="mi">2</span><span class="o">;</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">isPrime</span><span class="o">(++</span><span class="n">SIZE</span><span class="o">)){</span><span class="k">break</span><span class="o">;}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Resize to "</span><span class="o">+</span><span class="n">SIZE</span><span class="o">);</span>
        <span class="c1">//transfer elements</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;[]</span> <span class="n">newBuckets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="nl">bucket:</span><span class="n">buckets</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;</span> <span class="n">ite</span><span class="o">=</span><span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
                <span class="k">while</span><span class="o">(</span><span class="n">ite</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
                    <span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">=</span><span class="n">ite</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                    <span class="kt">int</span> <span class="n">h</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="na">getHash</span><span class="o">();</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">h</span><span class="o">==</span><span class="mi">0</span><span class="o">){</span>
                        <span class="n">h</span><span class="o">=</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">hashCode</span><span class="o">();</span>
                        <span class="n">entry</span><span class="o">.</span><span class="na">setHash</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="kt">int</span> <span class="n">ticket</span><span class="o">=</span><span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">h</span><span class="o">)%</span><span class="n">SIZE</span><span class="o">;</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">newBuckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">]==</span><span class="kc">null</span><span class="o">){</span>
                        <span class="n">newBuckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">]=</span><span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">MapEntry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;&gt;();</span>
                        <span class="n">newBuckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="n">newBuckets</span><span class="o">[</span><span class="n">ticket</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">buckets</span><span class="o">=</span><span class="n">newBuckets</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isPrime</span><span class="o">(</span><span class="kt">int</span> <span class="n">num</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">num</span><span class="o">&lt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Give me a number positive!"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(</span><span class="n">num</span><span class="o">==</span><span class="mi">1</span> <span class="o">||</span> <span class="n">num</span><span class="o">==</span><span class="mi">2</span><span class="o">){</span><span class="k">return</span> <span class="kc">true</span><span class="o">;}</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">num</span><span class="o">%</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="o">){</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RehashSimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RehashSimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">50</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise39java">Exercise39.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise39</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RehashSimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RehashSimpleHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">50</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"ERITREA"</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-40">Exercise 40</h4>
<ul>
  <li><strong>Exercise 40</strong>: (5) Create a class containing two String objects and make it Comparable so that the comparison only cares about the first String. Fill an array and an ArrayList with objects of your class, using the RandomGenerator generator. Demonstrate that sorting works properly. Now make a Comparator that only cares about the second String, and demonstrate that sorting works properly. Also perform a binary search using your Comparator.</li>
</ul>

<h5 id="pairjava">Pair.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Pair</span><span class="o">{</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="n">a</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="n">b</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Pair</span><span class="o">(</span><span class="n">String</span> <span class="n">a</span><span class="o">,</span><span class="n">String</span> <span class="n">b</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">=</span><span class="n">a</span><span class="o">;</span><span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">=</span><span class="n">b</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getA</span><span class="o">(){</span><span class="k">return</span> <span class="n">a</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getB</span><span class="o">(){</span><span class="k">return</span> <span class="n">b</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"("</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="s">","</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="s">")"</span><span class="o">;}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="pairajava">PairA.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PairA</span> <span class="kd">extends</span> <span class="n">Pair</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;{</span>

    <span class="kd">public</span> <span class="nf">PairA</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">y</span><span class="o">){</span><span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PairA</span> <span class="n">pair</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getA</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="pairbjava">PairB.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PairB</span> <span class="kd">extends</span> <span class="n">Pair</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">PairB</span><span class="o">&gt;{</span>

    <span class="kd">public</span> <span class="nf">PairB</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">y</span><span class="o">){</span><span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PairB</span> <span class="n">pair</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getB</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise40java">Exercise40.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">class</span> <span class="nc">CompPairA</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">PairA</span> <span class="n">x</span><span class="o">,</span> <span class="n">PairA</span> <span class="n">y</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">CompPairB</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">PairB</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">PairB</span> <span class="n">x</span><span class="o">,</span> <span class="n">PairB</span> <span class="n">y</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise40</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="n">PairA</span><span class="o">[]</span> <span class="n">array</span><span class="o">=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;();</span>

        <span class="n">String</span> <span class="n">arrayNo4</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">listNo8</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">String</span> <span class="n">x</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">y</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">3</span><span class="o">){</span>
                <span class="n">arrayNo4</span><span class="o">=</span><span class="n">x</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">7</span><span class="o">){</span>
                <span class="n">listNo8</span><span class="o">=</span><span class="n">y</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">y</span><span class="o">,</span><span class="n">x</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">CompPairA</span> <span class="n">cpa</span><span class="o">=</span><span class="k">new</span> <span class="n">CompPairA</span><span class="o">();</span>
        <span class="n">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">array</span><span class="o">,</span><span class="n">cpa</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">array</span><span class="o">));</span>
        <span class="n">PairA</span> <span class="n">newArrayNode</span><span class="o">=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">arrayNo4</span><span class="o">,</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="kt">int</span> <span class="n">indexArray</span><span class="o">=</span><span class="n">Arrays</span><span class="o">.</span><span class="na">binarySearch</span><span class="o">(</span><span class="n">array</span><span class="o">,</span><span class="n">newArrayNode</span><span class="o">,</span><span class="n">cpa</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">indexArray</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">newArrayNode</span><span class="o">+</span><span class="s">"=="</span><span class="o">+</span><span class="n">array</span><span class="o">[</span><span class="n">indexArray</span><span class="o">]);</span>
        <span class="o">}</span>

        <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="n">PairA</span> <span class="n">newListNode</span><span class="o">=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">listNo8</span><span class="o">,</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="kt">int</span> <span class="n">indexList</span><span class="o">=</span><span class="n">Collections</span><span class="o">.</span><span class="na">binarySearch</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">newListNode</span><span class="o">,</span><span class="n">cpa</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">indexList</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">newListNode</span><span class="o">+</span><span class="s">"=="</span><span class="o">+</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">indexList</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-41">Exercise 41</h4>
<ul>
  <li><strong>Exercise 41</strong>: (3) Modify the class in the previous exercise so that it will work with HashSets and as a key in HashMaps.</li>
</ul>

<h5 id="pairjava-1">Pair.java</h5>
<p>Pair基类不变</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Pair</span><span class="o">{</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="n">a</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="n">b</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Pair</span><span class="o">(</span><span class="n">String</span> <span class="n">a</span><span class="o">,</span><span class="n">String</span> <span class="n">b</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">=</span><span class="n">a</span><span class="o">;</span><span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">=</span><span class="n">b</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getA</span><span class="o">(){</span><span class="k">return</span> <span class="n">a</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getB</span><span class="o">(){</span><span class="k">return</span> <span class="n">b</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"("</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="s">","</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="s">")"</span><span class="o">;}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="pairajava-1">PairA.java</h5>
<p>为了在Set里使用，最好实现equals()和hashCode()方法。
为了在Map里使用，需要实现Map.Entry接口。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PairA</span> <span class="kd">extends</span> <span class="n">Pair</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;,</span> <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;{</span>

    <span class="kd">public</span> <span class="nf">PairA</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">y</span><span class="o">){</span><span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PairA</span> <span class="n">pair</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getA</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  For the Map
     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKey</span><span class="o">(){</span><span class="k">return</span> <span class="n">a</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">(){</span><span class="k">return</span> <span class="n">b</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">v</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">old</span><span class="o">=</span><span class="n">b</span><span class="o">;</span>
        <span class="n">b</span><span class="o">=</span><span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">old</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="cm">/**
     *  For the Set
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">PairA</span><span class="o">)){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">PairA</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">getA</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="pairbjava-1">PairB.java</h5>
<p>和PairA同理</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PairB</span> <span class="kd">extends</span> <span class="n">Pair</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">PairB</span><span class="o">&gt;,</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;{</span>

    <span class="kd">public</span> <span class="nf">PairB</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">y</span><span class="o">){</span><span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PairB</span> <span class="n">pair</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getB</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
     *  For the Map
     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKey</span><span class="o">(){</span><span class="k">return</span> <span class="n">b</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getValue</span><span class="o">(){</span><span class="k">return</span> <span class="n">a</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">v</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">old</span><span class="o">=</span><span class="n">a</span><span class="o">;</span>
        <span class="n">a</span><span class="o">=</span><span class="n">v</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">old</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="cm">/**
     *  For the Set
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">PairB</span><span class="o">)){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">PairB</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">getB</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="simplehashmap41java">SimpleHashMap41.java</h5>
<p>为了使用</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleHashMap41</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mi">997</span><span class="o">;</span>
    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">"unchecked"</span><span class="o">,</span><span class="s">"rawtypes"</span><span class="o">})</span>
    <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">[</span><span class="n">SIZE</span><span class="o">];</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;();</span>
        <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
        <span class="n">PairA</span> <span class="n">pair</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">ListIterator</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">listIterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">PairA</span> <span class="n">iPair</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">oldValue</span> <span class="o">=</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                <span class="n">it</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span> <span class="c1">// Replace old with new</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">found</span><span class="o">)</span>
            <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">add</span><span class="o">(</span><span class="n">pair</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">())</span> <span class="o">%</span> <span class="n">SIZE</span><span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">PairA</span> <span class="n">iPair</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">[</span><span class="n">index</span><span class="o">])</span>
            <span class="k">if</span><span class="o">(</span><span class="n">iPair</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
                <span class="k">return</span> <span class="n">iPair</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="nf">entrySet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">set</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;</span> <span class="n">bucket</span> <span class="o">:</span> <span class="n">buckets</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
            <span class="k">for</span><span class="o">(</span><span class="n">PairA</span> <span class="n">mpair</span> <span class="o">:</span> <span class="n">bucket</span><span class="o">)</span>
                <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">mpair</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">set</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise41java">Exercise41.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise41</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">runMap</span><span class="o">(){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleHashMap41</span><span class="o">();</span>
        <span class="n">m</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">Countries</span><span class="o">.</span><span class="na">capitals</span><span class="o">(</span><span class="mi">25</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"BENIN"</span><span class="o">));</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">entrySet</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">runSet</span><span class="o">(){</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;</span> <span class="n">set1</span><span class="o">=</span><span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;();</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;</span> <span class="n">set2</span><span class="o">=</span><span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;();</span>
        <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">set1</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">()));</span>
            <span class="n">set2</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">(),</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">()));</span>
        <span class="o">}</span>
        <span class="n">Sets</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">set1</span><span class="o">,</span><span class="n">set2</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Exercise41</span><span class="o">.</span><span class="na">runMap</span><span class="o">();</span>
        <span class="n">Exercise41</span><span class="o">.</span><span class="na">runSet</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="exercise-42">Exercise 42</h4>
<ul>
  <li><strong>Exercise 42</strong>: (2) Modify Exercise 40 so that an alphabetic sort is used.</li>
</ul>

<p>PairA和PairB都不变。</p>

<h5 id="pairjava-2">Pair.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Pair</span><span class="o">{</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="n">a</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="n">b</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Pair</span><span class="o">(</span><span class="n">String</span> <span class="n">a</span><span class="o">,</span><span class="n">String</span> <span class="n">b</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">a</span><span class="o">=</span><span class="n">a</span><span class="o">;</span><span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">=</span><span class="n">b</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getA</span><span class="o">(){</span><span class="k">return</span> <span class="n">a</span><span class="o">;}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getB</span><span class="o">(){</span><span class="k">return</span> <span class="n">b</span><span class="o">;}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span><span class="k">return</span> <span class="s">"("</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="s">","</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="s">")"</span><span class="o">;}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="pairajava-2">PairA.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PairA</span> <span class="kd">extends</span> <span class="n">Pair</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;{</span>

    <span class="kd">public</span> <span class="nf">PairA</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">y</span><span class="o">){</span><span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PairA</span> <span class="n">pair</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getA</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="pairbjava-2">PairB.java</h5>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PairB</span> <span class="kd">extends</span> <span class="n">Pair</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">PairB</span><span class="o">&gt;{</span>

    <span class="kd">public</span> <span class="nf">PairB</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">,</span> <span class="n">String</span> <span class="n">y</span><span class="o">){</span><span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PairB</span> <span class="n">pair</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="na">getB</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="exercise42java">Exercise42.java</h5>
<p>就是把Comparator改成用String自带的忽略大小写的CASE_INSENSITIVE_ORDER。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ciaoshen</span><span class="o">.</span><span class="na">thinkinjava</span><span class="o">.</span><span class="na">chapter17</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>


<span class="kd">class</span> <span class="nc">CompPairA</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">PairA</span> <span class="n">x</span><span class="o">,</span> <span class="n">PairA</span> <span class="n">y</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">CASE_INSENSITIVE_ORDER</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="na">getA</span><span class="o">(),</span><span class="n">y</span><span class="o">.</span><span class="na">getA</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">CompPairB</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">PairB</span><span class="o">&gt;{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">PairB</span> <span class="n">x</span><span class="o">,</span> <span class="n">PairB</span> <span class="n">y</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">CASE_INSENSITIVE_ORDER</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="na">getB</span><span class="o">(),</span><span class="n">y</span><span class="o">.</span><span class="na">getB</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Exercise42</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="n">Generator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">gen</span><span class="o">=</span><span class="k">new</span> <span class="n">RandomGenerator</span><span class="o">.</span><span class="na">String</span><span class="o">();</span>
        <span class="n">PairA</span><span class="o">[]</span> <span class="n">array</span><span class="o">=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">[</span><span class="mi">10</span><span class="o">];</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">=</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">PairA</span><span class="o">&gt;();</span>

        <span class="n">String</span> <span class="n">arrayNo4</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">listNo8</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
            <span class="n">String</span> <span class="n">x</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="n">String</span> <span class="n">y</span><span class="o">=</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">3</span><span class="o">){</span>
                <span class="n">arrayNo4</span><span class="o">=</span><span class="n">x</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span><span class="o">==</span><span class="mi">7</span><span class="o">){</span>
                <span class="n">listNo8</span><span class="o">=</span><span class="n">y</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">y</span><span class="o">,</span><span class="n">x</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">CompPairA</span> <span class="n">cpa</span><span class="o">=</span><span class="k">new</span> <span class="n">CompPairA</span><span class="o">();</span>
        <span class="n">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">array</span><span class="o">,</span><span class="n">cpa</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">array</span><span class="o">));</span>
        <span class="n">PairA</span> <span class="n">newArrayNode</span><span class="o">=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">arrayNo4</span><span class="o">,</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="kt">int</span> <span class="n">indexArray</span><span class="o">=</span><span class="n">Arrays</span><span class="o">.</span><span class="na">binarySearch</span><span class="o">(</span><span class="n">array</span><span class="o">,</span><span class="n">newArrayNode</span><span class="o">,</span><span class="n">cpa</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">indexArray</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">newArrayNode</span><span class="o">+</span><span class="s">"=="</span><span class="o">+</span><span class="n">array</span><span class="o">[</span><span class="n">indexArray</span><span class="o">]);</span>
        <span class="o">}</span>

        <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="n">PairA</span> <span class="n">newListNode</span><span class="o">=</span><span class="k">new</span> <span class="n">PairA</span><span class="o">(</span><span class="n">listNo8</span><span class="o">,</span><span class="n">gen</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
        <span class="kt">int</span> <span class="n">indexList</span><span class="o">=</span><span class="n">Collections</span><span class="o">.</span><span class="na">binarySearch</span><span class="o">(</span><span class="n">list</span><span class="o">,</span><span class="n">newListNode</span><span class="o">,</span><span class="n">cpa</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">indexList</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">newListNode</span><span class="o">+</span><span class="s">"=="</span><span class="o">+</span><span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">indexList</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

        <div class="after-post"></div> <!-- 文章结尾，和Disqus留一些间隔。-->
        <script>
            $("div.after-post").css("margin-bottom","50px");
        </script>

        <!-- Disqus plugin -->
        <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = /java/thinking_in_java/data_structure/2016/09/09/tij4-17.html;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = /java/thinking_in_java/data_structure/2016/09/09/tij4-17; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//www-ciaoshen-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
    <!-- .container -->


    <!-- footer bar -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<footer>
    <!-- Don't show tag cloud
    <div class="footer" id="footer">
        <div class="container">
            <div id="tags-cloud-title">
            <div class="row">
                <div class="col-lg-12  col-md-12 col-sm-12 col-xs-12">
                    <h2>Tag Cloud</h2>
                </div>
            </div>
            </div>
            <div id="tags-cloud" class="row">
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_String" href="/tags/String.html">
                        String
                        <span class="badge">5</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Memory_Model" href="/tags/Memory_Model.html">
                        Memory_Model
                        <span class="badge">6</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JVM" href="/tags/JVM.html">
                        JVM
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Hexo" href="/tags/Hexo.html">
                        Hexo
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Github" href="/tags/Github.html">
                        Github
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Blog" href="/tags/Blog.html">
                        Blog
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Git" href="/tags/Git.html">
                        Git
                        <span class="badge">6</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JDK" href="/tags/JDK.html">
                        JDK
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JRE" href="/tags/JRE.html">
                        JRE
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_IDE" href="/tags/IDE.html">
                        IDE
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_OOP" href="/tags/OOP.html">
                        OOP
                        <span class="badge">7</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Initialization" href="/tags/Initialization.html">
                        Initialization
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Control_Flow" href="/tags/Control_Flow.html">
                        Control_Flow
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_GC" href="/tags/GC.html">
                        GC
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Access_Control" href="/tags/Access_Control.html">
                        Access_Control
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Package" href="/tags/Package.html">
                        Package
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Inheritance" href="/tags/Inheritance.html">
                        Inheritance
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Composition" href="/tags/Composition.html">
                        Composition
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Factory_Pattern" href="/tags/Factory_Pattern.html">
                        Factory_Pattern
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Polymorphism" href="/tags/Polymorphism.html">
                        Polymorphism
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Late_Binding" href="/tags/Late_Binding.html">
                        Late_Binding
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_State_Pattern" href="/tags/State_Pattern.html">
                        State_Pattern
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Interface" href="/tags/Interface.html">
                        Interface
                        <span class="badge">5</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Abstract_Class" href="/tags/Abstract_Class.html">
                        Abstract_Class
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Strategy_Pattern" href="/tags/Strategy_Pattern.html">
                        Strategy_Pattern
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Inner_Class" href="/tags/Inner_Class.html">
                        Inner_Class
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Callback" href="/tags/Callback.html">
                        Callback
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Closure" href="/tags/Closure.html">
                        Closure
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Lambda_Expression" href="/tags/Lambda_Expression.html">
                        Lambda_Expression
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Container" href="/tags/Container.html">
                        Container
                        <span class="badge">9</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Array" href="/tags/Array.html">
                        Array
                        <span class="badge">6</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Hash" href="/tags/Hash.html">
                        Hash
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Exception" href="/tags/Exception.html">
                        Exception
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_IO" href="/tags/IO.html">
                        IO
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Regular_Expression" href="/tags/Regular_Expression.html">
                        Regular_Expression
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Reflection" href="/tags/Reflection.html">
                        Reflection
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Career_Path" href="/tags/Career_Path.html">
                        Career_Path
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Immutability" href="/tags/Immutability.html">
                        Immutability
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Dynamic_Proxies" href="/tags/Dynamic_Proxies.html">
                        Dynamic_Proxies
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Generics" href="/tags/Generics.html">
                        Generics
                        <span class="badge">8</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Adapter_Pattern" href="/tags/Adapter_Pattern.html">
                        Adapter_Pattern
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Wildcards" href="/tags/Wildcards.html">
                        Wildcards
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_PESC" href="/tags/PESC.html">
                        PESC
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Covariant" href="/tags/Covariant.html">
                        Covariant
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_View" href="/tags/View.html">
                        View
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Iterator" href="/tags/Iterator.html">
                        Iterator
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Fly_Weight" href="/tags/Fly_Weight.html">
                        Fly_Weight
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_LinkedList" href="/tags/LinkedList.html">
                        LinkedList
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Weak_Reference" href="/tags/Weak_Reference.html">
                        Weak_Reference
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Phantom_Reference" href="/tags/Phantom_Reference.html">
                        Phantom_Reference
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_HashMap" href="/tags/HashMap.html">
                        HashMap
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_File" href="/tags/File.html">
                        File
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Stream" href="/tags/Stream.html">
                        Stream
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Encapsulation" href="/tags/Encapsulation.html">
                        Encapsulation
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Unicode" href="/tags/Unicode.html">
                        Unicode
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_UTF-8" href="/tags/UTF-8.html">
                        UTF-8
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_ASCII" href="/tags/ASCII.html">
                        ASCII
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Encoding" href="/tags/Encoding.html">
                        Encoding
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Charset" href="/tags/Charset.html">
                        Charset
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_CPU" href="/tags/CPU.html">
                        CPU
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Process" href="/tags/Process.html">
                        Process
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Block" href="/tags/Block.html">
                        Block
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Logic_Gates" href="/tags/Logic_Gates.html">
                        Logic_Gates
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_NIO" href="/tags/NIO.html">
                        NIO
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Enum" href="/tags/Enum.html">
                        Enum
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Table_Driven" href="/tags/Table_Driven.html">
                        Table_Driven
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Annotations" href="/tags/Annotations.html">
                        Annotations
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Hibernate" href="/tags/Hibernate.html">
                        Hibernate
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JUnit" href="/tags/JUnit.html">
                        JUnit
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Spring" href="/tags/Spring.html">
                        Spring
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Syntactic sugar" href="/tags/Syntactic sugar.html">
                        Syntactic sugar
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_AOP" href="/tags/AOP.html">
                        AOP
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Concurrency" href="/tags/Concurrency.html">
                        Concurrency
                        <span class="badge">4</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Thread" href="/tags/Thread.html">
                        Thread
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_DJ" href="/tags/DJ.html">
                        DJ
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_IOC" href="/tags/IOC.html">
                        IOC
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Interrupt" href="/tags/Interrupt.html">
                        Interrupt
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_HTML" href="/tags/HTML.html">
                        HTML
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_CSS" href="/tags/CSS.html">
                        CSS
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Javascript" href="/tags/Javascript.html">
                        Javascript
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_JQuery" href="/tags/JQuery.html">
                        JQuery
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Sass" href="/tags/Sass.html">
                        Sass
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Responsive_Design" href="/tags/Responsive_Design.html">
                        Responsive_Design
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Code_Style" href="/tags/Code_Style.html">
                        Code_Style
                        <span class="badge">15</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Builder_Pattern" href="/tags/Builder_Pattern.html">
                        Builder_Pattern
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Instance_Control" href="/tags/Instance_Control.html">
                        Instance_Control
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Singleton" href="/tags/Singleton.html">
                        Singleton
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Comparable" href="/tags/Comparable.html">
                        Comparable
                        <span class="badge">2</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Clone" href="/tags/Clone.html">
                        Clone
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_API" href="/tags/API.html">
                        API
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Template_Pattern" href="/tags/Template_Pattern.html">
                        Template_Pattern
                        <span class="badge">3</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Jekyll" href="/tags/Jekyll.html">
                        Jekyll
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_Bootstrap" href="/tags/Bootstrap.html">
                        Bootstrap
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_SSH" href="/tags/SSH.html">
                        SSH
                        <span class="badge">1</span>
                        </a>
                    </div>
                
                    <div col-lg-3  col-md-4 col-sm-4 col-xs-6">
                        <a class="list-group-item" id="tag_RSA" href="/tags/RSA.html">
                        RSA
                        <span class="badge">1</span>
                        </a>
                    </div>
                
            </div>
        </div>
    </div>
    don't need tag cloud here -->

    <div class="footer-bottom">
        <div class="container">
            <p class="pull-left"> Copyright © <b>Wei SHEN</b> &nbsp | &nbsp Designed by <b>Wei SHEN</b> &nbsp | &nbsp Coded by <b>Wei SHEN</b> &nbsp | &nbsp 2015-2017. All right reserved.  &nbsp | &nbsp  Contact me: <b>symantec__@hotmail.com</b> </p>
            <div class="pull-right">
                <ul class="social">

                </ul>
            </div>
        </div>
    </div>
    <!--/.footer-bottom-->
</footer>



    <!-- Bootstrap Core JavaScript -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Add space between two paragraph -->
    <script src="/assets/js/span.js"></script>
    <!-- Adjust images size -->
    <script src="/assets/js/imgResponsive.js"></script>
    <!-- Disqus comment count plugin -->
    <script id="dsq-count-scr" src="//www-ciaoshen-com.disqus.com/count.js" async></script>

</body>

</html>
