---
layout: post
title: "Memory Layout of C Programs"
date: 2017-07-28 22:52:43
author: "Wei SHEN"
categories: ["c"]
tags: ["memory"]
description: >
---

### C程序的存储空间布局
下图可以看做是操作系统为一个典型的 **C程序进程** 使用主存方式提供的抽象。
![c-memory-layout](/images/c-memory/c-memory-layout.gif)

1. **`正文段`**。这是由CPU执行的机器指令部分。通常，正文段是可以共享的，所以即使是频繁执行的程序（如文本编辑器，C编译器和shell等）在存储器中也只需有一个副本，另外正文段常常是只读的，以防止程序由于意外而修改其指令。

2. **`初始化数据段`**。通常将此段称为数据段，它包含了程序中需要明确赋初始值的变量。例如C程序中任何函数之外的声明。

3. **`未初始化数据段`**。通常将此段称为`bss`段。在程序开始执行之前，内核将此段中的数据初始化为0或空指针。

4. **`栈`**。自动变量以及每次函数调用时所需保存的信息都放在此段中。每次函数调用时，其返回地址以及调用者的环境信息（如某些机器寄存器的值）都存放在栈中。然后最近被调用的函数在沾上为其自动和临时变量分配存储空间。通过以这种方式使用栈，C递归函数可以工作。递归函数每次调用自身时，就用一个新的栈帧，因此一次函数调用实例中的变量集不会影响另一次函数调用实例中的变量。

5. **`堆`**。通常在堆中进行动态存储分配。


**但注意！这只是程序的逻辑布局。并不一定要求底层硬件也必须以这种方式安排。**

#### 参考资料
《Unix环境高级编程》
