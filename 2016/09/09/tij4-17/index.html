<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Container,容器," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="容器的填充实现容器抽象类例子是一个“享元模式（FlyWeight）”。顾名思义，Fly Weight，就是用在有大量对象的组件里，为了节省内存空间的大小。指导思想，就是把巨量的对象从代码中剥离出来，单独储存，供大家访问。
这里实现享元模式的动机就是要把Map里的数据从Map里分离出来。演示Map里如果没有实际数据，也是可以依靠外部数据源工作的。
当然现有的容器类不能和它兼容。需要重新构造专用容器。">
<meta property="og:type" content="article">
<meta property="og:title" content="Thinking in Java 读书笔记：第十七章 - 容器深入研究">
<meta property="og:url" content="www.ciaoshen.com/2016/09/09/tij4-17/index.html">
<meta property="og:site_name" content="沈玮 | Wei SHEN">
<meta property="og:description" content="容器的填充实现容器抽象类例子是一个“享元模式（FlyWeight）”。顾名思义，Fly Weight，就是用在有大量对象的组件里，为了节省内存空间的大小。指导思想，就是把巨量的对象从代码中剥离出来，单独储存，供大家访问。
这里实现享元模式的动机就是要把Map里的数据从Map里分离出来。演示Map里如果没有实际数据，也是可以依靠外部数据源工作的。
当然现有的容器类不能和它兼容。需要重新构造专用容器。">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-17/collection.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-17/cursor.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-17/listIterator.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-17/map.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-17/mapEntry.png">
<meta property="og:updated_time" content="2016-10-15T17:28:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Thinking in Java 读书笔记：第十七章 - 容器深入研究">
<meta name="twitter:description" content="容器的填充实现容器抽象类例子是一个“享元模式（FlyWeight）”。顾名思义，Fly Weight，就是用在有大量对象的组件里，为了节省内存空间的大小。指导思想，就是把巨量的对象从代码中剥离出来，单独储存，供大家访问。
这里实现享元模式的动机就是要把Map里的数据从Map里分离出来。演示Map里如果没有实际数据，也是可以依靠外部数据源工作的。
当然现有的容器类不能和它兼容。需要重新构造专用容器。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>



  <meta name="baidu-site-verification" content="3iRy3UFlpa" />


<script>
  (function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


  <title> Thinking in Java 读书笔记：第十七章 - 容器深入研究 | 沈玮 | Wei SHEN </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74473715-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">沈玮 | Wei SHEN</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Coder & Designer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hDG3wYskg4CYKGSXw8x7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Thinking in Java 读书笔记：第十七章 - 容器深入研究
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-09T12:06:45-04:00" content="2016-09-09">
              2016-09-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/09/tij4-17/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/09/tij4-17/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span id="busuanzi_container_page_pv">&nbsp; |  &nbsp; &nbsp; Viewed <span id="busuanzi_value_page_pv"></span> times</span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="容器的填充"><a href="#容器的填充" class="headerlink" title="容器的填充"></a>容器的填充</h3><h4 id="实现容器抽象类"><a href="#实现容器抽象类" class="headerlink" title="实现容器抽象类"></a>实现容器抽象类</h4><p>例子是一个“享元模式（FlyWeight）”。顾名思义，Fly Weight，就是用在有大量对象的组件里，为了节省内存空间的大小。指导思想，就是把巨量的对象从代码中剥离出来，单独储存，供大家访问。</p>
<p>这里实现享元模式的动机就是要把Map里的数据从Map里分离出来。演示Map里如果没有实际数据，也是可以依靠外部数据源工作的。</p>
<p>当然现有的容器类不能和它兼容。需要重新构造专用容器。但也不需要完全重头开始造轮子。可以继承类库提供的容器抽象类。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCountries</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  数据二维数组</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[][] DATA = &#123;</span><br><span class="line">    <span class="comment">// Africa</span></span><br><span class="line">    &#123;<span class="string">"ALGERIA"</span>,<span class="string">"Algiers"</span>&#125;, &#123;<span class="string">"ANGOLA"</span>,<span class="string">"Luanda"</span>&#125;,</span><br><span class="line">    <span class="comment">//一万个国家名和首都的pair... ...</span></span><br><span class="line">    &#123;<span class="string">"URUGUAY"</span>,<span class="string">"Montevideo"</span>&#125;, &#123;<span class="string">"VENEZUELA"</span>,<span class="string">"Caracas"</span>&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">       </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 套嵌MAP</span><br><span class="line">     * 实现 AbstractMap 要实现 entrySet()。因为AbstractMap没有实现Map接口定义的entrySet方法。</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CountriesMap</span> <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * MAP内部二层套嵌类Entry 实现 Map.Entry 套嵌泛型类。这里为了支持享元，要重写两个方法：getKey()和getValue()。</span><br><span class="line">         * 享元模式：Entry只要一个index字段。Entry所有内容根据这个index到享元里找。</span><br><span class="line">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Entry</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.index=index;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> DATA[index%DATA.length][<span class="number">0</span>];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> DATA[index%DATA.length][<span class="number">1</span>];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;<span class="keyword">return</span> getKey()==((Entry)o).getKey();&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> getValue().hashCode();&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String value)</span></span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();  <span class="comment">//只读，不支持改数据</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * 二层套嵌 Set</span><br><span class="line">         * 实现只读 AbstractSet 要实现 size() &amp; iterator()。 因为AbstractSet继承自AbstractCollection。但AbstractCollection中定义了size() &amp; iterator()方法，但没有实现。</span><br><span class="line">         * 享元模式：只保留一个size字段。Set的所有内容根据这个size从享元中找。</span><br><span class="line">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">EntrySet</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.size=DATA.length;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">EntrySet</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(size&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.size=<span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(size&gt;DATA.length)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.size=DATA.length;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>.size=size;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> size;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/**</span><br><span class="line">             * Set 内部三层套嵌迭代器</span><br><span class="line">             */</span></span><br><span class="line">            <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">EntryIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">private</span> Entry e=<span class="keyword">new</span> Entry(<span class="number">0</span>);</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> e.index&lt;size-<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">public</span> Map.Entry&lt;String,String&gt; next()&#123;</span><br><span class="line">                    e.index++;</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>&#123;e.index=<span class="number">0</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;String,String&gt;&gt; iterator()&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> EntryIterator();</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//定义好了套嵌Set之后，写entrySet()方法</span></span><br><span class="line">        <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(DATA.length);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//神奇的匿名内部类，重写entrySet()方法。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; select(<span class="keyword">final</span> <span class="keyword">int</span> size)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CountriesMap()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet()&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回整个Map</span></span><br><span class="line">    <span class="keyword">static</span> Map&lt;String,String&gt; map=<span class="keyword">new</span> CountriesMap();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; capitals()&#123;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回部分Map</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; capitals(<span class="keyword">int</span> size)&#123;</span><br><span class="line">        <span class="keyword">return</span> select(size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回所有国家名的List</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">names</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;String&gt;(map.keySet());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回部分国家名的List</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">names</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;String&gt;(capitals(size).keySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="看看keySet-方法的源代码，看它是怎么实现的"><a href="#看看keySet-方法的源代码，看它是怎么实现的" class="headerlink" title="看看keySet( )方法的源代码，看它是怎么实现的"></a>看看keySet( )方法的源代码，看它是怎么实现的</h5><p>简单讲就是利用AbstractSet里的Iterator，逐个获取元素的Key键值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;K&gt; <span class="title">keySet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (keySet == <span class="keyword">null</span>) &#123;</span><br><span class="line">        keySet = <span class="keyword">new</span> AbstractSet&lt;K&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> Iterator&lt;K&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;K&gt;() &#123;</span><br><span class="line">                    <span class="keyword">private</span> Iterator&lt;Entry&lt;K,V&gt;&gt; i = entrySet().iterator();	<span class="comment">//代理模式</span></span><br><span class="line"></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> i.hasNext();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> K <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> i.next().getKey();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        i.remove();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//AbstractSet接口的其他方法</span></span><br><span class="line"><span class="comment">//... ...</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keySet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里用了一个代理模式，内部的委托类就是我们实现了的entrySet()方法和iterator()方法。</p>
<p>所以这这个Map实现地非常轻量级，仅仅是设置了一个到储存数据的二维数组的一个索引，就实现了对数据的查询功能。</p>
<h5 id="用匿名内部类覆盖某方法，有奇效"><a href="#用匿名内部类覆盖某方法，有奇效" class="headerlink" title="用匿名内部类覆盖某方法，有奇效"></a>用匿名内部类覆盖某方法，有奇效</h5><p>内部类这一章，只注意到了匿名内部类的一种使用场景：实现某个interface。</p>
<p>但实际上<strong>匿名内部类的语法表达的是一个“继承”的概念</strong>。看select()方法的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//神奇的匿名内部类，重写entrySet()方法。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; select(<span class="keyword">final</span> <span class="keyword">int</span> size)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CountriesMap()&#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里<strong>“new CountriesMap()”</strong>表达的是：</p>
<ul>
<li><strong>创建一个继承自CountriesMap的匿名类的对象。</strong></li>
</ul>
<p>这里仅仅是重写了entrySet()方法，就能够返回数据表不同大小的子块。这算是匿名内部类比较经典的应用场景了。</p>
<h3 id="Collection接口"><a href="#Collection接口" class="headerlink" title="Collection接口"></a>Collection接口</h3><p>不多说，放张图，这几个方法是要记住的。总的来说，以一个List表为代表的一组容器，最典型的操作就这么几样：</p>
<ul>
<li><strong>读取元素</strong>：add(), addAll()</li>
<li><strong>检查元素</strong>：contains(), containsAll(), isEmpty(), size()</li>
<li><strong>改变元素</strong>：clear(), remove(), removeAll(), retainAll()</li>
<li><strong>迭代器</strong>：iterator(), Iterator.hasNext(), Iterator.next(), Iterator.remove()</li>
<li><strong>类型转换</strong>：toArray()</li>
</ul>
<p>这些都是经过时间检验的<strong>“工程经验”</strong>。</p>
<p><img src="/uploads/tij4-17/collection.png" alt="collection"></p>
<p>注意一下迭代器光标Cursor位置：<br><img src="/uploads/tij4-17/cursor.png" alt="cursor"></p>
<h3 id="可选操作"><a href="#可选操作" class="headerlink" title="可选操作"></a>可选操作</h3><p>可选操作是个坑。它是指比如在Collection接口中，以下几个方法，</p>
<ul>
<li>retainAll()</li>
<li>removeAll()</li>
<li>clear()</li>
<li>add()</li>
<li>addAll()</li>
<li>remove()</li>
</ul>
<p>它们是可选方法。但仅仅是在官方文档的方法解释后面加了两个字<strong>“(optional operation)”</strong>而已。</p>
<p>它的实现方式非常隐蔽，当我们用<strong>“Arrays.asList()”</strong>方法把一个数组转换成一个List的时候，看起来返回的数据类型是ArrayList，但注意这不是<strong>java.util.ArrayList</strong>，而是Arrays内部一个同名的套嵌类<strong>java.util.Arrays.ArrayList</strong>。在这个“山寨”ArrayList里以上列出来的方法只是假装实现了一下，抛出一个<strong>UnsupportedOperationException</strong>而已。贴一下部分源代码：</p>
<p>下面是java.util.Arrays中套嵌ArrayList的代码开头部分。很明显，它继承自抽象类AbstractList<e>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span><br><span class="line">       <span class="keyword">implements</span> <span class="title">RandomAccess</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span><br><span class="line">   </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2764017481108945198L</span>;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> E[] a;</span><br><span class="line"></span><br><span class="line">       ArrayList(E[] array) &#123;</span><br><span class="line">           <span class="keyword">if</span> (array==<span class="keyword">null</span>)</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">           a = array;</span><br><span class="line">       &#125;</span><br><span class="line">	<span class="comment">//... ...</span></span><br><span class="line">	<span class="comment">//... ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></e></p>
<p>而抽象类AbstractList里，以上列出来的几个方法根本没有实现，只是抛出<strong>UnsupportedOperationException</strong>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">//... ...</span></span><br><span class="line"><span class="comment">//... ...</span></span><br></pre></td></tr></table></figure></p>
<h4 id="可选操作是坑？还是良好的设计？"><a href="#可选操作是坑？还是良好的设计？" class="headerlink" title="可选操作是坑？还是良好的设计？"></a>可选操作是坑？还是良好的设计？</h4><p>书上对此的解释是：</p>
<ul>
<li>因为Arrays.asList()生成的List，基于一个固定大小的数组，所以仅支持那些不会改变数组大小的操作，是有道理的。</li>
</ul>
<p>我表示，很难接受这样的解释。这真的很坑。要么索性就重新取个名字，干嘛要取一样的名字骗我们呢。网上都把这个错误列为<a href="http://www.importnew.com/12074.html" target="_blank" rel="external"><strong>《Java程序员们最常犯的10个错误》</strong></a>之首了好吗，真的不能原谅。</p>
<p>类似这样的“未获支持的操作”的坑，还有<strong>Collections.unmodifiableList()</strong>方法返回的Collection。除了以上列出来的方法，它还禁掉了一个List.set()方法，因为它返回的容器不仅仅是固定大小，还完全不能修改。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">"A B C D E F G H I J K L"</span>.split(<span class="string">" "</span>));</span><br><span class="line">Collections.unmodifiableList(<span class="keyword">new</span> ArrayList&lt;String&gt;(list));</span><br></pre></td></tr></table></figure></p>
<p>书上更深层的解释是：</p>
<ul>
<li>这样设计是为了防止“接口爆炸”。</li>
</ul>
<p>因为上面两个例子，就省去了FixSizeList和UnmodifiableList两个接口。</p>
<h3 id="AbstractCollection抽象类"><a href="#AbstractCollection抽象类" class="headerlink" title="AbstractCollection抽象类"></a>AbstractCollection抽象类</h3><p>翻一下AbstractCollection抽象类的源码。看到它是完全不依赖于任何数据而独立存在的。对它的简单描述应该是这样：</p>
<ol>
<li>是个空壳，没有数据。</li>
<li>所有定义的操作全都指向一个假象的数据体。</li>
<li>操作和数据之间唯二的发生关系的途径是通过：<strong>get()</strong>和<strong>size()</strong>两个方法。而这两个方法是抽象方法，留给用户自己定义。</li>
<li>大致的思路就是以size()为界，用Iterator遍历元素。然后假设get()方法能返回元素。能完成几乎所有读取，查找，转换操作。</li>
<li>然后写操作的add()方法是未定义操作UnsupportedOperationException。</li>
</ol>
<p>所以AbstractCollection是完全没有实体的。</p>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>工程模型和Collection是一致的，操作也分成：读取元素，检查元素，改变元素，迭代器，类型转换，这几大类。不赘述。</p>
<p>需要注意：<strong>List有个更强大的迭代器ListIterator。</strong> 遍历能往前，往后，双向移动。还有写操作add(),set()。看下图，<br><img src="/uploads/tij4-17/listIterator.png" alt="listIterator"></p>
<h4 id="单向链表设计思路"><a href="#单向链表设计思路" class="headerlink" title="单向链表设计思路"></a>单向链表设计思路</h4><p>比较重要的几个点，方便以后回顾比较：</p>
<ol>
<li>节点的数据结构很清楚：一部分放数据，一部分是指向下一个节点的指针。</li>
<li>个人比较喜欢：前后两个固定的头节点head和尾节点tail。只站桩，无数据。</li>
<li>其中，只有头节点是必须的。无头节点的话，对第一个元素的操作会和其他元素不同，代码复杂化。</li>
<li>尾节点可以没有。可以让最后一个元素指向null。加尾节点是为了在末尾插入新元素更高效。不然就得从head遍历到最后一个元素，再插入。</li>
<li>head.next指向第一个节点，tail.next指向最后一个节点。当链表为空，head.next=tail。 tail.next=head。</li>
<li>cursor光标表示上一个next()方法返回的节点。</li>
<li>previous引用盯住cursor。表示cursor的前一个节点。为了remove()的时候能找到前一个节点的向后引用。</li>
<li>每一次调用next()，只能用remove()方法删除一次当前节点。删除完，光标退回上一节点。</li>
<li>只有两种情况，previous和cursor指向同一个节点：要么初始阶段还没有调用过next()。要么next()返回的上一个节点被remove()方法删掉。</li>
<li>previous和cursor永远不可能指向tail。</li>
</ol>
<p>关于LinkedList头节点的总结：</p>
<ol>
<li>头节点是不储存元素信息的纯功能性节点。用来停放指针。</li>
<li>单纯从功能上讲，单个头节点head就够了。不需要尾节点。</li>
<li>没有head头节点的话，大部分操作对第一个元素和后续元素，实现都不同。导致逻辑复杂。容易出bug。编程目标是不出错，不是为了挑战脑力。</li>
<li>不需要专门的桩子尾节点。但需要一个tail指针，指向末尾元素，方便从末尾插入新元素。</li>
<li>双头节点版本：一个头节点head，一个尾节点tail。也没什么不好。反而逻辑清楚。</li>
<li>JDK里的官方LinkedList是没有头节点的版本。不知道为什么。难道是节约内存？</li>
</ol>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>Set主要有两个点：</p>
<ol>
<li>内部元素唯一性。</li>
<li>维持特定的元素排序。不同类型Set的排序方式不同。</li>
</ol>
<p>其中：</p>
<ol>
<li>HashSet：以散列值对set容量取余后决定的下标。没有规律。</li>
<li>TreeSet：保持降序。</li>
<li>LinkedHashSet：保持插入顺序。</li>
</ol>
<h4 id="Set对内部元素的要求"><a href="#Set对内部元素的要求" class="headerlink" title="Set对内部元素的要求"></a>Set对内部元素的要求</h4><p>希望放入Set中的元素类型必须先实现一些特定方法：</p>
<ol>
<li>所有实现Set接口的类，都要求内部元素实现equals()方法。为了保证唯一性。</li>
<li>HashSet系的还要实现hashCode()方法。</li>
<li>以TreeSet为代表的SortedSet系需要内部元素实现Comparable接口。也就是实现compareTo()方法。</li>
</ol>
<p>没有实现特定方法，存到Set里就会乱套。但编译器不会报错。因为默认的equals()和hashCode()虽然是错的，但是能运行的。</p>
<h4 id="自定义Set"><a href="#自定义Set" class="headerlink" title="自定义Set"></a>自定义Set</h4><p>可以继承AbstractSet抽象类。因为AbstractSet继承自AbstractCollection抽象类。加在一起，基本实现了Set接口。但有几个关键方法还需要自己定义：</p>
<ul>
<li><strong>add()</strong></li>
<li><strong>size()</strong></li>
<li><strong>iterator()</strong></li>
<li><strong>Iterator</strong></li>
</ul>
<p>比如下面是AbstractCollection里add()方法的源码。直接抛出异常。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="队列（Queue）"><a href="#队列（Queue）" class="headerlink" title="队列（Queue）"></a>队列（Queue）</h3><p>队列的基本特点就是：先进先出（FIFO）。队列，顾名思义。</p>
<p>PriorityQueue是维持特定排序的Queue。</p>
<h3 id="双端队列（Deque）"><a href="#双端队列（Deque）" class="headerlink" title="双端队列（Deque）"></a>双端队列（Deque）</h3><p>Deque(Double End Queue)顾名思义，可以在头和尾两个方向实现Queue的抽插。</p>
<p>但Deque在实际工程中用的少。是因为现实生活中没有东西和这个模型对应。比如List对应“列表”。Set对应“集合”。Map对应“字典”。Queue对应“队列”。但没有什么东西需要从两段存取。</p>
<h3 id="映射（Map）"><a href="#映射（Map）" class="headerlink" title="映射（Map）"></a>映射（Map）</h3><p>都有哪些Map？贴一张图。<br><img src="/uploads/tij4-17/map.png" alt="map"></p>
<p>最常用的还是HashMap，效率最高。</p>
<h4 id="自定义Map"><a href="#自定义Map" class="headerlink" title="自定义Map"></a>自定义Map</h4><p>自定义Map可以继承AbstractMap。但必须自己实现几个方法：</p>
<ul>
<li><strong><code>Map.Entry&lt;K,V&gt;</code></strong>接口</li>
<li><strong>entrySet()</strong>方法</li>
<li><strong>put()</strong>方法</li>
</ul>
<p>自定义Map的关键在于定义一个键值对的Pair：叫<strong><code>Map.Entry&lt;K,V&gt;</code></strong>的内部类接口。也可以用一个独立的类来实现这个接口。这个数据结构把Map里的一个“键-值”对捏合成单个元素。</p>
<p>然后定义一个“entrySet()”方法，返回一个Map.Entry元素的集合<strong><code>Set&lt;Map.Entry&lt;K,V&gt;&gt;</code></strong>。<br><img src="/uploads/tij4-17/mapEntry.png" alt="mapEntry"></p>
<p>Map接口的大多数方法，AbstractMap都实现了。但这个entrySet()方法是抽象方法，需要自己定义。因为，大多数的方法都是通过entrySet()方法把Map转换成Set来完成的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Set&lt;Entry&lt;K,V&gt;&gt; entrySet();</span><br></pre></td></tr></table></figure></p>
<p>实现etnrySet()的时候，返回的Set应该是原本Map的<strong>“视图”</strong>，不要返回<strong>“副本”</strong>。也就是直接返回Map内部数据的引用，而不是一份拷贝。要返回<strong>“视图”</strong>，可以返回一个没有实体数据，但带有一个Iterator的Set。具体实现，参见本章练习题16。</p>
<p>另外一个需要自己定义的方法是<strong>put()</strong>。下面是AbstractMap里put()方法的源代码，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="唯一性"><a href="#唯一性" class="headerlink" title="唯一性"></a>唯一性</h4><p>Map和Set的唯一性，由<strong>hashCode()</strong>和<strong>equals()</strong>两个方法来判定。逻辑上不冲突，因为equals()判断为真的两个键值，hashCode()返回值必须相等。这是对hashCode()方法的基本设计要求。</p>
<p>下面是HashMap里put()方法的源码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">    <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">    <span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">        Object k;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;	<span class="comment">//注意这一行</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            e.value = value;</span><br><span class="line">            e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modCount++;</span><br><span class="line">    addEntry(hash, key, value, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意<code>if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k)))</code>这个就是根据equal()和hashCode()两个函数返回值判定唯一性的判定语句。</p>
<p>另外，对equals()函数多说两句。判定值相等，虽然简单，但必须满足下面5个逻辑条件：</p>
<ol>
<li>自反性。x=x必须为true。</li>
<li>对称性。如果x=y为true，y=x也必须返回true。</li>
<li>传递性。如果x=y,y=z。那么x=z必须返回true。</li>
<li>一致性。在x和y都没变的情况下。每次测试x=y必须返回一样的结果。</li>
<li>任何不是null的x。x.equals(null)必须返回false。</li>
</ol>
<h4 id="散列值（hashCode-）"><a href="#散列值（hashCode-）" class="headerlink" title="散列值（hashCode()）"></a>散列值（hashCode()）</h4><p>关于散列值，参见之前的一篇：<a href="http://www.ciaoshen.com/2016/07/16/hash/"><strong>《Java HashMap的哈希值是怎么计算的？》</strong></a>。 这里简单强调几个基本<strong>逻辑层次</strong>：</p>
<ol>
<li>HashMap的基本理念是：通过对内部数组直接下标访问，做到get()普通情况O(1).</li>
<li>下标访问的原理：对key键值执行hashCode()函数，生成散列值（一般比较大），然后对内部数组大小取余运算，获得数组下标。</li>
<li>hashCode()在Object根类就定义了。几乎每个类都重写了这个方法。</li>
<li>自己写hashCode()要符合两个基本逻辑：第一，同一个对象每次的散列值必须相等。第二，两个equals()判定值相等的对象，散列值也要相等。</li>
</ol>
<h3 id="简单容器测试框架"><a href="#简单容器测试框架" class="headerlink" title="简单容器测试框架"></a>简单容器测试框架</h3><p>非常简单的一个模块化封装实践，主要记住思路：</p>
<ol>
<li>testframework.Test.java:    框架模块1：封装测试类</li>
<li>testframework.TestParam.java:    框架模块2：封装测试参数。</li>
<li>testframework.Tester.java:    框架模块3：运行测试工具包。</li>
<li>testframework.gen.*:    框架模块4：模拟数据生成器包。</li>
</ol>
<p>最终实现的功能是：</p>
<ol>
<li>可以自定义扩展测试类（Test.java定义）。</li>
<li>给一种容器，和一个参数包，自动对容器执行不同参数的全套测试。</li>
</ol>
<h3 id="关于垃圾回收再唐僧几句"><a href="#关于垃圾回收再唐僧几句" class="headerlink" title="关于垃圾回收再唐僧几句"></a>关于垃圾回收再唐僧几句</h3><h4 id="GC不是什么都管"><a href="#GC不是什么都管" class="headerlink" title="GC不是什么都管"></a>GC不是什么都管</h4><p>GC只负责回收内存。那什么东西GC不负责回收？native方法开辟的资源，比如如native memory（DirectByteBuffer）、file（FileInputStream）之类，GC是不管的，必须自己关掉。所以常见的图形，IO都必须自己关。</p>
<h4 id="finalize-方法作为GC的补充"><a href="#finalize-方法作为GC的补充" class="headerlink" title="finalize( )方法作为GC的补充"></a>finalize( )方法作为GC的补充</h4><p>既然GC有些东西不管，那也要有办法释放。这可以用finalize()方法。GC在释放被复写finalize()方法的对象的时候，会先调用其finalize()方法。</p>
<h4 id="finalize-方法靠不住，不要用"><a href="#finalize-方法靠不住，不要用" class="headerlink" title="finalize( )方法靠不住，不要用"></a>finalize( )方法靠不住，不要用</h4><p>GC在回收对象之前，是会先调用finalize()方法。但GC本身执行时机不确定。调用System.gc()方法只是“建议”系统进行垃圾回收，但具体执不执行，还是JVM说了算。说白了，我们对垃圾回收这件事，没有控制权。</p>
<p>而且，触发GC以后，执行finalize()方法，系统是交给Finalizer来做。而且Finalizer坐在另一个Finalizer Daemon Thread线程里。而且此线程优先级比主线程低得多。什么时候执行finalize()不确定。</p>
<p>具体，参考<a href="http://www.ciaoshen.com/2016/09/28/phantom/"><strong>《JAVA虚引用为什么在重载finalize后不会被置入引用队列?》</strong></a>专题。</p>
<ul>
<li><strong>Joshua Bloch在Effective Java里建议避免使用finalize()方法。</strong></li>
</ul>
<h4 id="finalize-只能被调用一次"><a href="#finalize-只能被调用一次" class="headerlink" title="finalize( )只能被调用一次"></a>finalize( )只能被调用一次</h4><p>任何对象的finalize()只能被调用一次。</p>
<h3 id="引用的不同强度"><a href="#引用的不同强度" class="headerlink" title="引用的不同强度"></a>引用的不同强度</h3><p>关于弱引用方面不错的一篇文章：<br><a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/" target="_blank" rel="external"><strong>《深入探讨 java.lang.ref 包》</strong></a></p>
<p>四种不同强度reference的定义：<br>1.<strong>普通引用</strong>：没什么好说的。<br>2.<strong>软引用（SoftReference）</strong>：系统资源紧张的时候，系统会删除软引用。优先删除长久没用的引用。<br>3.<strong>弱引用（WeakReference）</strong>：GC的时候删除清理弱引用。<br>4.<strong>虚引用（PhantomReference）</strong>：通过虚引用无法获得对象。</p>
<h4 id="ReferenceQueue"><a href="#ReferenceQueue" class="headerlink" title="ReferenceQueue"></a>ReferenceQueue</h4><p>当软引用，弱引用，虚引用被系统清除以后，如果绑定了ReferenceQueue，这些引用会被加入ReferenceQueue。</p>
<p>虚引用（PhantomReference）构造函数必须传入一个ReferenceQueue作为参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PhantomReference</span><span class="params">(T referent, ReferenceQueue&lt;? <span class="keyword">super</span> T&gt; q)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(referent, q);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>软引用和弱引用可以选择在构造函数传入ReferenceQueue或者不传入。</p>
<p>不同强度引用被加入ReferenceQueue的时机不同：</p>
<ol>
<li>当一个对象只维持着WeakReference，直接被加入ReferenceQueue。然后等待被GC销毁。</li>
<li>当一个对象只维持着PhantomReference，GC先销毁对象，然后把这个虚引用加入ReferenceQueue。</li>
</ol>
<h4 id="WeakHashMap"><a href="#WeakHashMap" class="headerlink" title="WeakHashMap"></a>WeakHashMap</h4><ol>
<li>内部类Entry直接继承WeakReference。</li>
<li>键值Key被包装成WeakReference的referent。</li>
<li>当Key被销毁回收，整个Entry都被销毁。</li>
</ol>
<p><strong>WeakHashMap有个坑</strong>：Entry的Key是可以被系统收回。但Key指向的对象被系统回收以后，整个Entry的引用是靠expungeStaleEntries()方法从Map里删除的。但expungeStaleEntries()方法只有在getTable(), size(), 和resize()方法执行的时候被调用。</p>
<p>模仿WeakHashMap的结构，但不写expungeStaleEntries()方法，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeakPair</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ReferenceQueue&lt;String&gt; rq=<span class="keyword">new</span> ReferenceQueue&lt;String&gt;();</span><br><span class="line">    <span class="keyword">private</span> Integer bucket;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WeakPair</span><span class="params">(String s, Integer i)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(s,rq);</span><br><span class="line">        bucket=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getBucket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bucket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReferenceQueue&lt;String&gt; <span class="title">getQueue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> rq;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> get()+<span class="string">"@"</span>+bucket;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>填充List，然后触发GC，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Generator&lt;String&gt; gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">List&lt;WeakPair&gt; list=<span class="keyword">new</span> ArrayList&lt;WeakPair&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">    list.add(<span class="keyword">new</span> WeakPair(gen.next(),i));</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(list);</span><br><span class="line">System.gc();</span><br><span class="line">Thread.sleep(<span class="number">500</span>);</span><br><span class="line">ReferenceQueue&lt;String&gt; rq=WeakPair.getQueue();</span><br><span class="line">System.out.println(list);</span><br></pre></td></tr></table></figure></p>
<p>只有WeakReference的字段部分被回收，而不是整个WeakPair被回收。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[hiGBEVQ@<span class="number">0</span>, FVhKmED@<span class="number">1</span>, <span class="keyword">fi</span>RCVzX@<span class="number">2</span>, UOsEWSp@<span class="number">3</span>, egASflb@<span class="number">4</span>, ViKBfJl@<span class="number">5</span>, PaoWYpQ@<span class="number">6</span>, FoUpkau@<span class="number">7</span>, GtRluvU@<span class="number">8</span>, NsyhpYx@<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">[null@<span class="number">0</span>, null@<span class="number">1</span>, null@<span class="number">2</span>, null@<span class="number">3</span>, null@<span class="number">4</span>, null@<span class="number">5</span>, null@<span class="number">6</span>, null@<span class="number">7</span>, null@<span class="number">8</span>, null@<span class="number">9</span>]</span><br></pre></td></tr></table></figure></p>
<p>一种极端的情况是，有很多个WeakHashMap。每个只插入一个很占内存的Entry。一直不对WeakHashMap做任何其他操作。就算主动System.gc()还是会OOM。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">    List&lt;WeakHashMap&lt;<span class="keyword">byte</span>[][], <span class="keyword">byte</span>[][]&gt;&gt; maps = <span class="keyword">new</span> ArrayList&lt;WeakHashMap&lt;<span class="keyword">byte</span>[][], <span class="keyword">byte</span>[][]&gt;&gt;();  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;  </span><br><span class="line">        WeakHashMap&lt;<span class="keyword">byte</span>[][], <span class="keyword">byte</span>[][]&gt; d = <span class="keyword">new</span> WeakHashMap&lt;<span class="keyword">byte</span>[][], <span class="keyword">byte</span>[][]&gt;();  </span><br><span class="line">        d.put(<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1000</span>][<span class="number">1000</span>], <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1000</span>][<span class="number">1000</span>]);  </span><br><span class="line">        maps.add(d);  </span><br><span class="line">        System.gc();  </span><br><span class="line">        System.err.println(i);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h3><p>本章习题依赖的工具有：</p>
<h4 id="MyCountries-java"><a href="#MyCountries-java" class="headerlink" title="MyCountries.java"></a>MyCountries.java</h4><p>我自己重新写的一个“国家-首都”填充器。也是基于享元模式。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCountries</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  数据二维数组</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[][] DATA = &#123;</span><br><span class="line">    <span class="comment">// Africa</span></span><br><span class="line">    &#123;<span class="string">"ALGERIA"</span>,<span class="string">"Algiers"</span>&#125;, &#123;<span class="string">"ANGOLA"</span>,<span class="string">"Luanda"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BENIN"</span>,<span class="string">"Porto-Novo"</span>&#125;, &#123;<span class="string">"BOTSWANA"</span>,<span class="string">"Gaberone"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BURKINA FASO"</span>,<span class="string">"Ouagadougou"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BURUNDI"</span>,<span class="string">"Bujumbura"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CAMEROON"</span>,<span class="string">"Yaounde"</span>&#125;, &#123;<span class="string">"CAPE VERDE"</span>,<span class="string">"Praia"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CENTRAL AFRICAN REPUBLIC"</span>,<span class="string">"Bangui"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CHAD"</span>,<span class="string">"N’djamena"</span>&#125;, &#123;<span class="string">"COMOROS"</span>,<span class="string">"Moroni"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CONGO"</span>,<span class="string">"Brazzaville"</span>&#125;, &#123;<span class="string">"DJIBOUTI"</span>,<span class="string">"Dijibouti"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"EGYPT"</span>,<span class="string">"Cairo"</span>&#125;, &#123;<span class="string">"EQUATORIAL GUINEA"</span>,<span class="string">"Malabo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ERITREA"</span>,<span class="string">"Asmara"</span>&#125;, &#123;<span class="string">"ETHIOPIA"</span>,<span class="string">"Addis Ababa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GABON"</span>,<span class="string">"Libreville"</span>&#125;, &#123;<span class="string">"THE GAMBIA"</span>,<span class="string">"Banjul"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GHANA"</span>,<span class="string">"Accra"</span>&#125;, &#123;<span class="string">"GUINEA"</span>,<span class="string">"Conakry"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BISSAU"</span>,<span class="string">"Bissau"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"COTE D’IVOIR (IVORY COAST)"</span>,<span class="string">"Yamoussoukro"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KENYA"</span>,<span class="string">"Nairobi"</span>&#125;, &#123;<span class="string">"LESOTHO"</span>,<span class="string">"Maseru"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LIBERIA"</span>,<span class="string">"Monrovia"</span>&#125;, &#123;<span class="string">"LIBYA"</span>,<span class="string">"Tripoli"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MADAGASCAR"</span>,<span class="string">"Antananarivo"</span>&#125;, &#123;<span class="string">"MALAWI"</span>,<span class="string">"Lilongwe"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MALI"</span>,<span class="string">"Bamako"</span>&#125;, &#123;<span class="string">"MAURITANIA"</span>,<span class="string">"Nouakchott"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MAURITIUS"</span>,<span class="string">"Port Louis"</span>&#125;, &#123;<span class="string">"MOROCCO"</span>,<span class="string">"Rabat"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MOZAMBIQUE"</span>,<span class="string">"Maputo"</span>&#125;, &#123;<span class="string">"NAMIBIA"</span>,<span class="string">"Windhoek"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NIGER"</span>,<span class="string">"Niamey"</span>&#125;, &#123;<span class="string">"NIGERIA"</span>,<span class="string">"Abuja"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"RWANDA"</span>,<span class="string">"Kigali"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SAO TOME E PRINCIPE"</span>,<span class="string">"Sao Tome"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SENEGAL"</span>,<span class="string">"Dakar"</span>&#125;, &#123;<span class="string">"SEYCHELLES"</span>,<span class="string">"Victoria"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SIERRA LEONE"</span>,<span class="string">"Freetown"</span>&#125;, &#123;<span class="string">"SOMALIA"</span>,<span class="string">"Mogadishu"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SOUTH AFRICA"</span>,<span class="string">"Pretoria/Cape Town"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SUDAN"</span>,<span class="string">"Khartoum"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SWAZILAND"</span>,<span class="string">"Mbabane"</span>&#125;, &#123;<span class="string">"TANZANIA"</span>,<span class="string">"Dodoma"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TOGO"</span>,<span class="string">"Lome"</span>&#125;, &#123;<span class="string">"TUNISIA"</span>,<span class="string">"Tunis"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UGANDA"</span>,<span class="string">"Kampala"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DEMOCRATIC REPUBLIC OF THE CONGO (ZAIRE)"</span>,</span><br><span class="line">    <span class="string">"Kinshasa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ZAMBIA"</span>,<span class="string">"Lusaka"</span>&#125;, &#123;<span class="string">"ZIMBABWE"</span>,<span class="string">"Harare"</span>&#125;,</span><br><span class="line">    <span class="comment">// Asia</span></span><br><span class="line">    &#123;<span class="string">"AFGHANISTAN"</span>,<span class="string">"Kabul"</span>&#125;, &#123;<span class="string">"BAHRAIN"</span>,<span class="string">"Manama"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BANGLADESH"</span>,<span class="string">"Dhaka"</span>&#125;, &#123;<span class="string">"BHUTAN"</span>,<span class="string">"Thimphu"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BRUNEI"</span>,<span class="string">"Bandar Seri Begawan"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CAMBODIA"</span>,<span class="string">"Phnom Penh"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CHINA"</span>,<span class="string">"Beijing"</span>&#125;, &#123;<span class="string">"CYPRUS"</span>,<span class="string">"Nicosia"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"INDIA"</span>,<span class="string">"New Delhi"</span>&#125;, &#123;<span class="string">"INDONESIA"</span>,<span class="string">"Jakarta"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"IRAN"</span>,<span class="string">"Tehran"</span>&#125;, &#123;<span class="string">"IRAQ"</span>,<span class="string">"Baghdad"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ISRAEL"</span>,<span class="string">"Jerusalem"</span>&#125;, &#123;<span class="string">"JAPAN"</span>,<span class="string">"Tokyo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"JORDAN"</span>,<span class="string">"Amman"</span>&#125;, &#123;<span class="string">"KUWAIT"</span>,<span class="string">"Kuwait City"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LAOS"</span>,<span class="string">"Vientiane"</span>&#125;, &#123;<span class="string">"LEBANON"</span>,<span class="string">"Beirut"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MALAYSIA"</span>,<span class="string">"Kuala Lumpur"</span>&#125;, &#123;<span class="string">"THE MALDIVES"</span>,<span class="string">"Male"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MONGOLIA"</span>,<span class="string">"Ulan Bator"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MYANMAR (BURMA)"</span>,<span class="string">"Rangoon"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NEPAL"</span>,<span class="string">"Katmandu"</span>&#125;, &#123;<span class="string">"NORTH KOREA"</span>,<span class="string">"P’yongyang"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"OMAN"</span>,<span class="string">"Muscat"</span>&#125;, &#123;<span class="string">"PAKISTAN"</span>,<span class="string">"Islamabad"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PHILIPPINES"</span>,<span class="string">"Manila"</span>&#125;, &#123;<span class="string">"QATAR"</span>,<span class="string">"Doha"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SAUDI ARABIA"</span>,<span class="string">"Riyadh"</span>&#125;, &#123;<span class="string">"SINGAPORE"</span>,<span class="string">"Singapore"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SOUTH KOREA"</span>,<span class="string">"Seoul"</span>&#125;, &#123;<span class="string">"SRI LANKA"</span>,<span class="string">"Colombo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SYRIA"</span>,<span class="string">"Damascus"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TAIWAN (REPUBLIC OF CHINA)"</span>,<span class="string">"Taipei"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"THAILAND"</span>,<span class="string">"Bangkok"</span>&#125;, &#123;<span class="string">"TURKEY"</span>,<span class="string">"Ankara"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UNITED ARAB EMIRATES"</span>,<span class="string">"Abu Dhabi"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"VIETNAM"</span>,<span class="string">"Hanoi"</span>&#125;, &#123;<span class="string">"YEMEN"</span>,<span class="string">"Sana’a"</span>&#125;,</span><br><span class="line">    <span class="comment">// Australia and Oceania</span></span><br><span class="line">    &#123;<span class="string">"AUSTRALIA"</span>,<span class="string">"Canberra"</span>&#125;, &#123;<span class="string">"FIJI"</span>,<span class="string">"Suva"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KIRIBATI"</span>,<span class="string">"Bairiki"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MARSHALL ISLANDS"</span>,<span class="string">"Dalap-Uliga-Darrit"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MICRONESIA"</span>,<span class="string">"Palikir"</span>&#125;, &#123;<span class="string">"NAURU"</span>,<span class="string">"Yaren"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NEW ZEALAND"</span>,<span class="string">"Wellington"</span>&#125;, &#123;<span class="string">"PALAU"</span>,<span class="string">"Koror"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PAPUA NEW GUINEA"</span>,<span class="string">"Port Moresby"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SOLOMON ISLANDS"</span>,<span class="string">"Honaira"</span>&#125;, &#123;<span class="string">"TONGA"</span>,<span class="string">"Nuku’alofa"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TUVALU"</span>,<span class="string">"Fongafale"</span>&#125;, &#123;<span class="string">"VANUATU"</span>,<span class="string">"&lt; Port-Vila"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"WESTERN SAMOA"</span>,<span class="string">"Apia"</span>&#125;,</span><br><span class="line">    <span class="comment">// Eastern Europe and former USSR</span></span><br><span class="line">    &#123;<span class="string">"ARMENIA"</span>,<span class="string">"Yerevan"</span>&#125;, &#123;<span class="string">"AZERBAIJAN"</span>,<span class="string">"Baku"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BELARUS (BYELORUSSIA)"</span>,<span class="string">"Minsk"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BULGARIA"</span>,<span class="string">"Sofia"</span>&#125;, &#123;<span class="string">"GEORGIA"</span>,<span class="string">"Tbilisi"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"KAZAKSTAN"</span>,<span class="string">"Almaty"</span>&#125;, &#123;<span class="string">"KYRGYZSTAN"</span>,<span class="string">"Alma-Ata"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MOLDOVA"</span>,<span class="string">"Chisinau"</span>&#125;, &#123;<span class="string">"RUSSIA"</span>,<span class="string">"Moscow"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TAJIKISTAN"</span>,<span class="string">"Dushanbe"</span>&#125;, &#123;<span class="string">"TURKMENISTAN"</span>,<span class="string">"Ashkabad"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UKRAINE"</span>,<span class="string">"Kyiv"</span>&#125;, &#123;<span class="string">"UZBEKISTAN"</span>,<span class="string">"Tashkent"</span>&#125;,</span><br><span class="line">    <span class="comment">// Europe</span></span><br><span class="line">    &#123;<span class="string">"ALBANIA"</span>,<span class="string">"Tirana"</span>&#125;, &#123;<span class="string">"ANDORRA"</span>,<span class="string">"Andorra la Vella"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"AUSTRIA"</span>,<span class="string">"Vienna"</span>&#125;, &#123;<span class="string">"BELGIUM"</span>,<span class="string">"Brussels"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BOSNIA"</span>,<span class="string">"-"</span>&#125;, &#123;<span class="string">"HERZEGOVINA"</span>,<span class="string">"Sarajevo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CROATIA"</span>,<span class="string">"Zagreb"</span>&#125;, &#123;<span class="string">"CZECH REPUBLIC"</span>,<span class="string">"Prague"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DENMARK"</span>,<span class="string">"Copenhagen"</span>&#125;, &#123;<span class="string">"ESTONIA"</span>,<span class="string">"Tallinn"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"FINLAND"</span>,<span class="string">"Helsinki"</span>&#125;, &#123;<span class="string">"FRANCE"</span>,<span class="string">"Paris"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GERMANY"</span>,<span class="string">"Berlin"</span>&#125;, &#123;<span class="string">"GREECE"</span>,<span class="string">"Athens"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"HUNGARY"</span>,<span class="string">"Budapest"</span>&#125;, &#123;<span class="string">"ICELAND"</span>,<span class="string">"Reykjavik"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"IRELAND"</span>,<span class="string">"Dublin"</span>&#125;, &#123;<span class="string">"ITALY"</span>,<span class="string">"Rome"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LATVIA"</span>,<span class="string">"Riga"</span>&#125;, &#123;<span class="string">"LIECHTENSTEIN"</span>,<span class="string">"Vaduz"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"LITHUANIA"</span>,<span class="string">"Vilnius"</span>&#125;, &#123;<span class="string">"LUXEMBOURG"</span>,<span class="string">"Luxembourg"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MACEDONIA"</span>,<span class="string">"Skopje"</span>&#125;, &#123;<span class="string">"MALTA"</span>,<span class="string">"Valletta"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MONACO"</span>,<span class="string">"Monaco"</span>&#125;, &#123;<span class="string">"MONTENEGRO"</span>,<span class="string">"Podgorica"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"THE NETHERLANDS"</span>,<span class="string">"Amsterdam"</span>&#125;, &#123;<span class="string">"NORWAY"</span>,<span class="string">"Oslo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"POLAND"</span>,<span class="string">"Warsaw"</span>&#125;, &#123;<span class="string">"PORTUGAL"</span>,<span class="string">"Lisbon"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ROMANIA"</span>,<span class="string">"Bucharest"</span>&#125;, &#123;<span class="string">"SAN MARINO"</span>,<span class="string">"San Marino"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SERBIA"</span>,<span class="string">"Belgrade"</span>&#125;, &#123;<span class="string">"SLOVAKIA"</span>,<span class="string">"Bratislava"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SLOVENIA"</span>,<span class="string">"Ljuijana"</span>&#125;, &#123;<span class="string">"SPAIN"</span>,<span class="string">"Madrid"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"SWEDEN"</span>,<span class="string">"Stockholm"</span>&#125;, &#123;<span class="string">"SWITZERLAND"</span>,<span class="string">"Berne"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UNITED KINGDOM"</span>,<span class="string">"London"</span>&#125;, &#123;<span class="string">"VATICAN CITY"</span>,<span class="string">"---"</span>&#125;,</span><br><span class="line">    <span class="comment">// North and Central America</span></span><br><span class="line">    &#123;<span class="string">"ANTIGUA AND BARBUDA"</span>,<span class="string">"Saint John’s"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BAHAMAS"</span>,<span class="string">"Nassau"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BARBADOS"</span>,<span class="string">"Bridgetown"</span>&#125;, &#123;<span class="string">"BELIZE"</span>,<span class="string">"Belmopan"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CANADA"</span>,<span class="string">"Ottawa"</span>&#125;, &#123;<span class="string">"COSTA RICA"</span>,<span class="string">"San Jose"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"CUBA"</span>,<span class="string">"Havana"</span>&#125;, &#123;<span class="string">"DOMINICA"</span>,<span class="string">"Roseau"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"DOMINICAN REPUBLIC"</span>,<span class="string">"Santo Domingo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"EL SALVADOR"</span>,<span class="string">"San Salvador"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GRENADA"</span>,<span class="string">"Saint George’s"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GUATEMALA"</span>,<span class="string">"Guatemala City"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"HAITI"</span>,<span class="string">"Port-au-Prince"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"HONDURAS"</span>,<span class="string">"Tegucigalpa"</span>&#125;, &#123;<span class="string">"JAMAICA"</span>,<span class="string">"Kingston"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"MEXICO"</span>,<span class="string">"Mexico City"</span>&#125;, &#123;<span class="string">"NICARAGUA"</span>,<span class="string">"Managua"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PANAMA"</span>,<span class="string">"Panama City"</span>&#125;, &#123;<span class="string">"ST. KITTS"</span>,<span class="string">"-"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"NEVIS"</span>,<span class="string">"Basseterre"</span>&#125;, &#123;<span class="string">"ST. LUCIA"</span>,<span class="string">"Castries"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"ST. VINCENT AND THE GRENADINES"</span>,<span class="string">"Kingstown"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"UNITED STATES OF AMERICA"</span>,<span class="string">"Washington, D.C."</span>&#125;,</span><br><span class="line">    <span class="comment">// South America</span></span><br><span class="line">    &#123;<span class="string">"ARGENTINA"</span>,<span class="string">"Buenos Aires"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BOLIVIA"</span>,<span class="string">"Sucre (legal)/La Paz(administrative)"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"BRAZIL"</span>,<span class="string">"Brasilia"</span>&#125;, &#123;<span class="string">"CHILE"</span>,<span class="string">"Santiago"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"COLOMBIA"</span>,<span class="string">"Bogota"</span>&#125;, &#123;<span class="string">"ECUADOR"</span>,<span class="string">"Quito"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"GUYANA"</span>,<span class="string">"Georgetown"</span>&#125;, &#123;<span class="string">"PARAGUAY"</span>,<span class="string">"Asuncion"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"PERU"</span>,<span class="string">"Lima"</span>&#125;, &#123;<span class="string">"SURINAME"</span>,<span class="string">"Paramaribo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"TRINIDAD AND TOBAGO"</span>,<span class="string">"Port of Spain"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"URUGUAY"</span>,<span class="string">"Montevideo"</span>&#125;, &#123;<span class="string">"VENEZUELA"</span>,<span class="string">"Caracas"</span>&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 套嵌MAP</span><br><span class="line">     * 实现 AbstractMap 要实现 entrySet()。因为AbstractMap没有实现Map接口定义的entrySet方法。</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CountriesMap</span> <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * MAP内部二层套嵌类Entry 实现 Map.Entry 套嵌泛型类。这里为了支持享元，要重写两个方法：getKey()和getValue()。</span><br><span class="line">         * 享元模式：Entry只要一个index字段。Entry所有内容根据这个index到享元里找。</span><br><span class="line">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Entry</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.index=index;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> DATA[index%DATA.length][<span class="number">0</span>];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> DATA[index%DATA.length][<span class="number">1</span>];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;<span class="keyword">return</span> getKey()==((Entry)o).getKey();&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> getValue().hashCode();&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String value)</span></span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();  <span class="comment">//只读，不支持改数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"("</span>+getKey()+<span class="string">","</span>+getValue()+<span class="string">")"</span>;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> index;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * 二层套嵌 Set</span><br><span class="line">         * 实现只读 AbstractSet 要实现 size() &amp; iterator()。 因为AbstractSet继承自AbstractCollection。但AbstractCollection中定义了size() &amp; iterator()方法，但没有实现。</span><br><span class="line">         * 享元模式：只保留一个size字段。Set的所有内容根据这个size从享元中找。</span><br><span class="line">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">EntrySet</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.size=DATA.length;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">EntrySet</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(size&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.size=<span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(size&gt;DATA.length)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.size=DATA.length;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>.size=size;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> size;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/**</span><br><span class="line">             * Set 内部三层套嵌迭代器</span><br><span class="line">             */</span></span><br><span class="line">            <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">EntryIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">private</span> <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> index&lt;size-<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">public</span> Map.Entry&lt;String,String&gt; next()&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Entry(index++);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>&#123;index=<span class="number">0</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;String,String&gt;&gt; iterator()&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> EntryIterator();</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//定义好了套嵌Set之后，写entrySet()方法</span></span><br><span class="line">        <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(DATA.length);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//神奇的匿名内部类，重写entrySet()方法。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; select(<span class="keyword">final</span> <span class="keyword">int</span> size)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CountriesMap()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet()&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回整个Map</span></span><br><span class="line">    <span class="keyword">static</span> Map&lt;String,String&gt; map=<span class="keyword">new</span> CountriesMap();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; capitals()&#123;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回部分Map</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; capitals(<span class="keyword">int</span> size)&#123;</span><br><span class="line">        <span class="keyword">return</span> select(size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回所有国家名的List</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">names</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;String&gt;(map.keySet());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回部分国家名的List</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">names</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;String&gt;(capitals(size).keySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="RandomGenerator-java"><a href="#RandomGenerator-java" class="headerlink" title="RandomGenerator.java"></a>RandomGenerator.java</h4><p>随机填充器。主要用来生成随机String，Integer等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Boolean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextBoolean();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Integer</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Integer</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Long</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Long</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextLong();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Short</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Short</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Short</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">short</span>)rand.nextInt((<span class="keyword">int</span>)java.lang.Short.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Float</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Float</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Float</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextFloat();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Double</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Double</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Double</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextDouble();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Byte</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Byte</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Byte</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            rand.nextBytes(b);</span><br><span class="line">            <span class="keyword">return</span> b[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Charactor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] CS=(<span class="string">"abcdefghijklmnopqrstuvwxyz"</span>+<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>).toCharArray();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Character</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Character</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CS[rand.nextInt(CS.length)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> size=<span class="number">7</span>;</span><br><span class="line">        <span class="keyword">private</span> Generator&lt;java.lang.Character&gt; c=<span class="keyword">new</span> Character();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;<span class="keyword">this</span>.size=size;&#125;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">String <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                sb.append(c.next());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  测试</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[] args)</span></span>&#123;</span><br><span class="line">        RandomGenerator.String s=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        System.out.println(s.next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-1"><a href="#Exercise-1" class="headerlink" title="Exercise 1"></a>Exercise 1</h4><ul>
<li><strong>Exercise 1</strong>: (1) Create a List (try both ArrayList and LinkedList) and fill it using Countries. Sort the list and print it, then apply Collections.shuffle( ) to the list repeatedly, printing it each time so that you can see how the shuffle( ) method randomizes the list differently each time.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountriesComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Map.Entry&lt;String,String&gt; entry1, Map.Entry&lt;String,String&gt; entry2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entry1.getKey().compareTo(entry2.getKey());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise1</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  ArrayList版本</span><br><span class="line">         */</span></span><br><span class="line">        List&lt;Map.Entry&lt;String,String&gt;&gt; al=<span class="keyword">new</span> ArrayList&lt;Map.Entry&lt;String,String&gt;&gt;(MyCountries.capitals(<span class="number">10</span>).entrySet());</span><br><span class="line">        <span class="comment">//System.out.println(al);</span></span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  LinkedList版本</span><br><span class="line">         */</span></span><br><span class="line">        List&lt;Map.Entry&lt;String,String&gt;&gt; ll=<span class="keyword">new</span> LinkedList&lt;Map.Entry&lt;String,String&gt;&gt;(MyCountries.capitals(<span class="number">15</span>).entrySet());</span><br><span class="line">        <span class="comment">//System.out.println(ll);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  排序再乱序</span><br><span class="line">         */</span></span><br><span class="line">        Collections.sort(al, <span class="keyword">new</span> CountriesComparator());</span><br><span class="line">        System.out.println(al);</span><br><span class="line">        Collections.shuffle(al);</span><br><span class="line">        System.out.println(al);</span><br><span class="line">        Collections.sort(al, <span class="keyword">new</span> CountriesComparator());</span><br><span class="line">        System.out.println(al);</span><br><span class="line">        Collections.shuffle(al);</span><br><span class="line">        System.out.println(al);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-2"><a href="#Exercise-2" class="headerlink" title="Exercise 2"></a>Exercise 2</h4><p>Exercise 2: (2) Produce a Map and a Set containing all the countries that begin with ‘A’.<br>在MyCountries.java里增加一个countriesBeginWithXXX()方法。</p>
<h5 id="MyCountries-java-1"><a href="#MyCountries-java-1" class="headerlink" title="MyCountries.java"></a>MyCountries.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCountries</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//之前的代码... ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回国家名以“subName”开头的国家map</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; countriesBeginWithXXX(String subName)&#123;</span><br><span class="line">        Map&lt;String,String&gt; hm=<span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">        Set&lt;Map.Entry&lt;String,String&gt;&gt; set=map.entrySet();</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;String,String&gt; entry:set)&#123;</span><br><span class="line">            <span class="keyword">if</span>(entry.getKey().indexOf(subName)==<span class="number">0</span>)&#123;</span><br><span class="line">                hm.put(entry.getKey(),entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise2-java"><a href="#Exercise2-java" class="headerlink" title="Exercise2.java"></a>Exercise2.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise2</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  "A"字母打头国家的Map</span><br><span class="line">         */</span></span><br><span class="line">        System.out.println(MyCountries.countriesBeginWithXXX(<span class="string">"A"</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  "A"字母打头国家的Set</span><br><span class="line">         */</span></span><br><span class="line">        System.out.println(MyCountries.countriesBeginWithXXX(<span class="string">"A"</span>).entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-3"><a href="#Exercise-3" class="headerlink" title="Exercise 3"></a>Exercise 3</h4><ul>
<li><strong>Exercise 3</strong>: (1) Using Countries, fill a Set multiple times with the same data and verify that the Set ends up with only one of each instance. Try this with HashSet, LinkedHashSet, and TreeSet.</li>
</ul>
<h5 id="Exercise3-java"><a href="#Exercise3-java" class="headerlink" title="Exercise3.java"></a>Exercise3.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise3</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  AbstractSet版本: 按插入顺序</span><br><span class="line">         */</span></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        System.out.println(<span class="string">"##########################################"</span>);</span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      AbstractSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>);</span><br><span class="line">        System.out.println(<span class="string">"##########################################"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            Set&lt;Map.Entry&lt;String,String&gt;&gt; set=MyCountries.capitals(<span class="number">20</span>).entrySet();</span><br><span class="line">            System.out.println(set);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  HashSet版本：不保持插入顺序</span><br><span class="line">         */</span></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        System.out.println(<span class="string">"######################################"</span>);</span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      HashSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>);</span><br><span class="line">        System.out.println(<span class="string">"######################################"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            Set&lt;Map.Entry&lt;String,String&gt;&gt; set=<span class="keyword">new</span> HashSet&lt;Map.Entry&lt;String,String&gt;&gt;(MyCountries.capitals(<span class="number">20</span>).entrySet());</span><br><span class="line">            System.out.println(set);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  LinkedHashSet版本：保持插入顺序</span><br><span class="line">         */</span></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        System.out.println(<span class="string">"############################################"</span>);</span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      LinkedHashSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>);</span><br><span class="line">        System.out.println(<span class="string">"############################################"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            Set&lt;Map.Entry&lt;String,String&gt;&gt; set=<span class="keyword">new</span> LinkedHashSet&lt;Map.Entry&lt;String,String&gt;&gt;(MyCountries.capitals(<span class="number">20</span>).entrySet());</span><br><span class="line">            System.out.println(set);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  TreeSet版本: 按照ABCD顺序</span><br><span class="line">         */</span></span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        System.out.println(<span class="string">"######################################"</span>);</span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;      TreeSet      &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>);</span><br><span class="line">        System.out.println(<span class="string">"######################################"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            Set&lt;Map.Entry&lt;String,String&gt;&gt; set=<span class="keyword">new</span> TreeSet&lt;Map.Entry&lt;String,String&gt;&gt;(MyCountries.capitals(<span class="number">20</span>).entrySet());</span><br><span class="line">            System.out.println(set);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MyCountries-java-2"><a href="#MyCountries-java-2" class="headerlink" title="MyCountries.java"></a>MyCountries.java</h5><p>在MyCountries.CountriesMap.Entry套嵌类里，要加一个compareTo()方法，以实现Comparable接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCountries</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//之前的代码 ... ...</span></span><br><span class="line">	</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;, <span class="title">Comparable</span>&lt;<span class="title">Entry</span>&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Entry</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.index=index;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> DATA[index%DATA.length][<span class="number">0</span>];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> DATA[index%DATA.length][<span class="number">1</span>];&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;<span class="keyword">return</span> getKey()==((Entry)o).getKey();&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> getValue().hashCode();&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String value)</span></span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();  <span class="comment">//只读，不支持改数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"("</span>+getKey()+<span class="string">","</span>+getValue()+<span class="string">")"</span>;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> index;&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Entry e)</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.getKey().compareTo(e.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//之后的代码 ... ...</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-4"><a href="#Exercise-4" class="headerlink" title="Exercise 4"></a>Exercise 4</h4><ul>
<li><strong>Exercise 4</strong>: (2) Create a Collection initializer that opens a file and breaks it into words using TextFile, and then uses the words as the source of data for the resulting Collection. Demonstrate that it works.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollectionInit</span></span>&#123;</span><br><span class="line">    <span class="comment">//读文件切词</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">readFile</span><span class="params">(String inFile)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            BufferedReader in=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(inFile));</span><br><span class="line">            String s;</span><br><span class="line">            List&lt;String&gt; words=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    s=in.readLine();</span><br><span class="line">                    <span class="keyword">if</span>(s==<span class="keyword">null</span>)&#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">                    words.addAll(Arrays.asList(s.replaceAll(<span class="string">"\\p&#123;Punct&#125;"</span>,<span class="string">""</span>).split(<span class="string">"\\s"</span>)));</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    System.out.println(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> words;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise4</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        List&lt;String&gt; list=CollectionInit.readFile(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-5"><a href="#Exercise-5" class="headerlink" title="Exercise 5"></a>Exercise 5</h4><ul>
<li><strong>Exercise 5</strong>: (3) Modify CountingMapData.java to fully implement the flyweight by adding a custom EntrySet class like the one in Countries.java.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingMapData</span> <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String[] chars = <span class="string">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span>.split(<span class="string">" "</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountingMapData</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(size &lt; <span class="number">0</span>) <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index;</span><br><span class="line">        Entry(<span class="keyword">int</span> index) &#123; <span class="keyword">this</span>.index = index; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(index).equals(o);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> index; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> chars[index % chars.length] + Integer.toString(index / chars.length);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(index).hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EntrySet</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.size=size;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> size;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Iter</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> index&lt;size;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">public</span> Map.Entry&lt;Integer,String&gt; next()&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Entry(index++);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;Integer,String&gt;&gt; iterator()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Iter();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;Integer,String&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> CountingMapData(<span class="number">60</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Exercise-6"><a href="#Exercise-6" class="headerlink" title="Exercise 6"></a>Exercise 6</h4><ul>
<li><strong>Exercise 6</strong>: (2) Note that List has additional “optional” operations that are not included in Collection. Write a version of Unsupported.java that tests these additional optional operations.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnsupportedList</span> <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] staticStr=<span class="string">"A B C D E F G H I J"</span>.split(<span class="string">" "</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> staticStr[index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> staticStr.length;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise6</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> UnsupportedList();</span><br><span class="line">        Unsupported.test(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-7"><a href="#Exercise-7" class="headerlink" title="Exercise 7"></a>Exercise 7</h4><ul>
<li><strong>Exercise 7</strong>: (4) Create both an ArrayList and a LinkedList, and fill each using the Countries.names( ) generator. Print each list using an ordinary Iterator, then insert one list into the other by using a Listlterator, inserting at every other location. Now perform the insertion starting at the end of the first list and moving backward.</li>
</ul>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> class Exercise7&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *Step 1</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> printTwoList()&#123;</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; al=<span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;(MyCountries.names());</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; ll=<span class="keyword">new</span> LinkedList&lt;<span class="keyword">String</span>&gt;(MyCountries.names());</span><br><span class="line">        </span><br><span class="line">        Iterator&lt;<span class="keyword">String</span>&gt; iteAl=al.iterator();</span><br><span class="line">        Iterator&lt;<span class="keyword">String</span>&gt; iteLl=ll.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(iteAl.hasNext())&#123;</span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="string">"["</span>+iteAl.next()+<span class="string">"]"</span>);</span><br><span class="line">            <span class="keyword">if</span>(iteAl.hasNext())&#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"\n\n"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(iteLl.hasNext())&#123;</span><br><span class="line">            System.out.<span class="built_in">print</span>(<span class="string">"["</span>+iteLl.next()+<span class="string">"]"</span>);</span><br><span class="line">            <span class="keyword">if</span>(iteLl.hasNext())&#123;</span><br><span class="line">                System.out.<span class="built_in">print</span>(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *Step 2</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> insertion()&#123;</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; al=<span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;(MyCountries.names());</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; ll=<span class="keyword">new</span> LinkedList&lt;<span class="keyword">String</span>&gt;(MyCountries.names());</span><br><span class="line">        </span><br><span class="line">        ListIterator&lt;<span class="keyword">String</span>&gt; listIteAl=al.listIterator();</span><br><span class="line">        ListIterator&lt;<span class="keyword">String</span>&gt; listIteLl=ll.listIterator();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(listIteAl.hasNext() &amp;&amp; listIteLl.hasNext())&#123;</span><br><span class="line">            listIteLl.<span class="built_in">add</span>(listIteAl.next());</span><br><span class="line">            <span class="keyword">String</span> s=listIteLl.next();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.<span class="built_in">println</span>(ll);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *Step 3</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> inverseInsertion()&#123;</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; al=<span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;(MyCountries.names());</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; ll=<span class="keyword">new</span> LinkedList&lt;<span class="keyword">String</span>&gt;(MyCountries.names());</span><br><span class="line">        </span><br><span class="line">        ListIterator&lt;<span class="keyword">String</span>&gt; listIteAl=al.listIterator(al.<span class="built_in">size</span>());</span><br><span class="line">        ListIterator&lt;<span class="keyword">String</span>&gt; listIteLl=ll.listIterator();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(listIteAl.hasPrevious() &amp;&amp; listIteLl.hasNext())&#123;</span><br><span class="line">            listIteLl.<span class="built_in">add</span>(listIteAl.previous());</span><br><span class="line">            <span class="keyword">String</span> s=listIteLl.next();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.<span class="built_in">println</span>(ll);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(<span class="keyword">String</span>[] args)&#123;</span><br><span class="line">        printTwoList();</span><br><span class="line">        insertion();</span><br><span class="line">        inverseInsertion();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-8"><a href="#Exercise-8" class="headerlink" title="Exercise 8"></a>Exercise 8</h4><p>Exercise 8: (7) Create a generic, singly linked list class called SList, which, to keep things simple, does not implement the List interface. Each Link object in the list should contain a reference to the next element in the list, but not the previous one (LinkedList, in contrast, is a doubly linked list, which means it maintains links in both directions). Create your own SListIterator which, again for simplicity, does not implement ListIterator. The only method in SList other than toString( ) should be iterator( ), which produces an SListIterator. The only way to insert and remove elements from an SList is through SListIterator. Write code to demonstrate SList.</p>
<p>关于LinkedList头节点的总结：</p>
<ol>
<li>头节点是不储存元素信息的纯功能性节点。用来停放指针。</li>
<li>单纯从功能上讲，单个头节点head就够了。不需要尾节点。</li>
<li>没有head头节点的话，大部分操作对第一个元素和后续元素，实现都不同。导致逻辑复杂。容易出bug。编程目标是不出错，不是为了挑战脑力。</li>
<li>不需要专门的桩子尾节点。但需要一个tail指针，指向末尾元素，方便从末尾插入新元素。</li>
<li>双头节点版本：一个头节点head，一个尾节点tail。也没什么不好。反而逻辑清楚。</li>
<li>JDK里的官方LinkedList是没有头节点的版本。不知道为什么。难道是节约内存？</li>
</ol>
<h5 id="单头节点版本"><a href="#单头节点版本" class="headerlink" title="单头节点版本"></a>单头节点版本</h5><ol>
<li>单向列表</li>
<li>单头节点。只有前头节点head，无尾节点tail。</li>
<li>tail只是一个指向最后一个元素的指针。</li>
<li>前中后2个光标：previous,cursor。cursor指向上一个next()返回的元素。previous指向cursor的前一个元素。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SListV2</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head;</span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SListV2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        head=<span class="keyword">new</span> Node();</span><br><span class="line">        tail=head;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T item;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>&#123;item=<span class="keyword">null</span>;next=<span class="keyword">null</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T t)</span></span>&#123;item=t;next=<span class="keyword">null</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> item.toString();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SListIterator</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; cursor=head;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; previous=cursor;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//在cursor后面插入新元素</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            Node&lt;T&gt; n=<span class="keyword">new</span> Node&lt;T&gt;(t);</span><br><span class="line">            n.next=tail.next;</span><br><span class="line">            tail.next=n;</span><br><span class="line">            tail=n;</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//替换cursor位置元素</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor==head)&#123;</span><br><span class="line">                System.out.println(<span class="string">"Not Begun!"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Node&lt;T&gt; n=<span class="keyword">new</span> Node&lt;T&gt;(t);</span><br><span class="line">                cursor.item=t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从cursor位置开始往后删除</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor==previous)&#123;</span><br><span class="line">                System.out.println(<span class="string">"Can't remove!"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(cursor==tail)&#123;</span><br><span class="line">                    tail=previous;</span><br><span class="line">                &#125;</span><br><span class="line">                previous.next=cursor.next;</span><br><span class="line">                cursor=previous;</span><br><span class="line">                index--;</span><br><span class="line">                size--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//current还没到tail</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor.next!=<span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回cursor的下一个元素</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Node&lt;T&gt; <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(hasNext())&#123;</span><br><span class="line">                previous=cursor;</span><br><span class="line">                cursor=cursor.next;</span><br><span class="line">                index++;</span><br><span class="line">                <span class="keyword">return</span> cursor;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Reach the end!"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> index;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> size;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>&#123;</span><br><span class="line">            cursor=head;</span><br><span class="line">            previous=cursor;</span><br><span class="line">            index=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SListIterator <span class="title">iterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SListIterator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        SListIterator ite=iterator();</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            sb.append(<span class="string">"["</span>+ite.next()+<span class="string">"]"</span>);</span><br><span class="line">            <span class="keyword">if</span>(ite.hasNext())&#123;</span><br><span class="line">                sb.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  测试</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        String[] s=<span class="string">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span>.split(<span class="string">" "</span>);</span><br><span class="line">        SListV2&lt;String&gt; list=<span class="keyword">new</span> SListV2&lt;String&gt;();</span><br><span class="line">        SListV2.SListIterator ite=list.iterator();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.length;i++)&#123;</span><br><span class="line">            ite.add(s[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ite.size();i++)&#123;</span><br><span class="line">            System.out.println(ite.next());</span><br><span class="line">        &#125;</span><br><span class="line">        ite.reset();</span><br><span class="line">        <span class="keyword">int</span> length=ite.size();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            Node&lt;String&gt; n=ite.next();</span><br><span class="line">            ite.remove();</span><br><span class="line">            ite.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="双头节点版本"><a href="#双头节点版本" class="headerlink" title="双头节点版本"></a>双头节点版本</h5><ol>
<li>单向列表</li>
<li>双头节点。前头节点head，后尾节点tail。两个节点永远不存放元素。尾节点的next指向最后一个元素。空链表时指向head。</li>
<li>两个光标：previous,cursor。主要是cursor。previous只负责盯住cursor，并在remove的时候提供前一节点的next指针。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SListV3</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head;</span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SListV3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        head=<span class="keyword">new</span> Node();</span><br><span class="line">        tail=<span class="keyword">new</span> Node();</span><br><span class="line">        head.next=tail;</span><br><span class="line">        tail.next=head;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T item;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>&#123;item=<span class="keyword">null</span>;next=<span class="keyword">null</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T t)</span></span>&#123;item=t;next=<span class="keyword">null</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> item.toString();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SListIterator</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; cursor=head;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; previous=cursor;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//在tail栓塞前插入新元素</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            Node&lt;T&gt; n=<span class="keyword">new</span> Node&lt;T&gt;(t);</span><br><span class="line">            tail.next.next=n;</span><br><span class="line">            n.next=tail;</span><br><span class="line">            tail.next=n;</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//替换当前cursor元素（若当前元素被删，也不能set。）</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor==previous)&#123;</span><br><span class="line">                System.out.println(<span class="string">"Cannot set!"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                cursor.item=t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//只删除上一次next()返回的元素。每次next()只能删除一次。</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor==previous)&#123;</span><br><span class="line">                System.out.println(<span class="string">"Can't remove!"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(tail.next==cursor)&#123;</span><br><span class="line">                    tail.next=previous;</span><br><span class="line">                &#125;</span><br><span class="line">                previous.next=cursor.next;</span><br><span class="line">                cursor=previous;</span><br><span class="line">                index--;</span><br><span class="line">                size--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//current还没到tail</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor.next!=tail;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回cursor的下一个元素</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Node&lt;T&gt; <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(hasNext())&#123;</span><br><span class="line">                previous=cursor;</span><br><span class="line">                cursor=cursor.next;</span><br><span class="line">                index++;</span><br><span class="line">                <span class="keyword">return</span> cursor;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Reach the end!"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> index;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> size;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>&#123;</span><br><span class="line">            cursor=head;</span><br><span class="line">            previous=cursor;</span><br><span class="line">            index=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SListIterator <span class="title">iterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SListIterator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        SListIterator ite=iterator();</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            sb.append(<span class="string">"["</span>+ite.next()+<span class="string">"]"</span>);</span><br><span class="line">            <span class="keyword">if</span>(ite.hasNext())&#123;</span><br><span class="line">                sb.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  测试</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        String[] s=<span class="string">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span>.split(<span class="string">" "</span>);</span><br><span class="line">        SListV3&lt;String&gt; list=<span class="keyword">new</span> SListV3&lt;String&gt;();</span><br><span class="line">        SListV3.SListIterator ite=list.iterator();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.length;i++)&#123;</span><br><span class="line">            ite.add(s[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ite.size();i++)&#123;</span><br><span class="line">            System.out.println(ite.next());</span><br><span class="line">        &#125;</span><br><span class="line">        ite.reset();</span><br><span class="line">        <span class="keyword">int</span> length=ite.size();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            Node&lt;String&gt; n=ite.next();</span><br><span class="line">            ite.remove();</span><br><span class="line">            ite.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="无头节点版本"><a href="#无头节点版本" class="headerlink" title="无头节点版本"></a>无头节点版本</h5><ol>
<li>单向列表</li>
<li>没有栓塞头</li>
<li>head和tail只是两个指针，指向第一个和最后一个元素。</li>
<li>当链表为空：维持一个空节点。head和tail都指向这个空节点。只有一个元素的时候，head和tail也都指向唯一的这个节点。</li>
<li>两个光标：previous,cursor。cursor指向上一个next()返回的元素。previous指向cursor的前一个元素。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SListV4</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head;</span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; tail;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SListV4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        head=<span class="keyword">new</span> Node();</span><br><span class="line">        tail=head;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T item;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; next;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>&#123;item=<span class="keyword">null</span>;next=<span class="keyword">null</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T t)</span></span>&#123;item=t;next=<span class="keyword">null</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T t, Node&lt;T&gt; n)</span></span>&#123;item=t;next=n;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> item.toString();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SListIterator</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; cursor=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;T&gt; previous=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index=-<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//在tail栓塞前插入新元素</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            <span class="comment">//空链表</span></span><br><span class="line">            <span class="keyword">if</span>(head.item==<span class="keyword">null</span>)&#123;</span><br><span class="line">                head.item=t;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Node&lt;T&gt; n=<span class="keyword">new</span> Node&lt;T&gt;(t);</span><br><span class="line">                tail.next=n;</span><br><span class="line">                tail=n;</span><br><span class="line">            &#125;</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//替换当前cursor元素（若当前元素被删，也不能set。）</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor==previous)&#123;</span><br><span class="line">                System.out.println(<span class="string">"Cannot set!"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                cursor.item=t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//只删除上一次next()返回的元素。每次next()只能删除一次。</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor==previous)&#123;</span><br><span class="line">                System.out.println(<span class="string">"Can't remove!"</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(cursor==head)&#123;</span><br><span class="line">                    cursor.item=<span class="keyword">null</span>;</span><br><span class="line">                    cursor=<span class="keyword">null</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    previous.next=cursor.next;</span><br><span class="line">                    cursor=previous;</span><br><span class="line">                &#125;</span><br><span class="line">                index--;</span><br><span class="line">                size--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//current还没到tail</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor==<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> (head.item==<span class="keyword">null</span> &amp;&amp; head.next==<span class="keyword">null</span>)? <span class="keyword">false</span>:<span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (cursor.next==<span class="keyword">null</span>)? <span class="keyword">false</span>:<span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回cursor的下一个元素</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Node&lt;T&gt; <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(hasNext())&#123;</span><br><span class="line">                <span class="keyword">if</span>(cursor==<span class="keyword">null</span> &amp;&amp; head.item==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    cursor=head.next;</span><br><span class="line">                    previous=head;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cursor==<span class="keyword">null</span> &amp;&amp; head.item!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    cursor=head;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    previous=cursor;</span><br><span class="line">                    cursor=cursor.next;</span><br><span class="line">                &#125;</span><br><span class="line">                index++;</span><br><span class="line">                <span class="keyword">return</span> cursor;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"Reach the end!"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> index;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> size;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>&#123;</span><br><span class="line">            cursor=previous=<span class="keyword">null</span>;</span><br><span class="line">            index=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SListIterator <span class="title">iterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SListIterator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        SListIterator ite=iterator();</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            sb.append(<span class="string">"["</span>+ite.next()+<span class="string">"]"</span>);</span><br><span class="line">            <span class="keyword">if</span>(ite.hasNext())&#123;</span><br><span class="line">                sb.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  测试</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        String[] s=<span class="string">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span>.split(<span class="string">" "</span>);</span><br><span class="line">        SListV4&lt;String&gt; list=<span class="keyword">new</span> SListV4&lt;String&gt;();</span><br><span class="line">        SListV4.SListIterator ite=list.iterator();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.length;i++)&#123;</span><br><span class="line">            ite.add(s[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ite.size();i++)&#123;</span><br><span class="line">            System.out.println(ite.next());</span><br><span class="line">        &#125;</span><br><span class="line">        ite.reset();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            Node&lt;String&gt; n=ite.next();</span><br><span class="line">            ite.set(<span class="string">"XXX"</span>);</span><br><span class="line">            System.out.println(list);</span><br><span class="line">            ite.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-9"><a href="#Exercise-9" class="headerlink" title="Exercise 9"></a>Exercise 9</h4><ul>
<li><strong>Exercise 9</strong>: (2) Use RandomGenerator.String to fill a TreeSet, but use alphabetic ordering. Print the TreeSet to verify the sort order.</li>
</ul>
<h5 id="RandomGenerator-java-1"><a href="#RandomGenerator-java-1" class="headerlink" title="RandomGenerator.java"></a>RandomGenerator.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Boolean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextBoolean();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Integer</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Integer</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Long</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Long</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextLong();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Short</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Short</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Short</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">short</span>)rand.nextInt((<span class="keyword">int</span>)java.lang.Short.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Float</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Float</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Float</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextFloat();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Double</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Double</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Double</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextDouble();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Byte</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Byte</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Byte</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            rand.nextBytes(b);</span><br><span class="line">            <span class="keyword">return</span> b[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Charactor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] CS=(<span class="string">"abcdefghijklmnopqrstuvwxyz"</span>+<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>).toCharArray();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Character</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Character</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CS[rand.nextInt(CS.length)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> size=<span class="number">7</span>;</span><br><span class="line">        <span class="keyword">private</span> Generator&lt;java.lang.Character&gt; c=<span class="keyword">new</span> Character();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;<span class="keyword">this</span>.size=size;&#125;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">String <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                sb.append(c.next());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise9-java"><a href="#Exercise9-java" class="headerlink" title="Exercise9.java"></a>Exercise9.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise9</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        TreeSet&lt;String&gt; ts=<span class="keyword">new</span> TreeSet&lt;String&gt;();</span><br><span class="line">        RandomGenerator.String gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            ts.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-10"><a href="#Exercise-10" class="headerlink" title="Exercise 10"></a>Exercise 10</h4><ul>
<li><strong>Exercise 10</strong>: (7) Using a LinkedList as your underlying implementation, define your own SortedSet.</li>
</ul>
<h5 id="Exercise10-java"><a href="#Exercise10-java" class="headerlink" title="Exercise10.java"></a>Exercise10.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//内部元素必须实现equals()方法，实现Comparable接口或者有额外的Comparator。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedSortedSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">SortedSet</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//基于LinkedList。类似一个高级代理，或装饰器</span></span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;E&gt; ll;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//额外比较器字段</span></span><br><span class="line">    <span class="keyword">private</span> Comparator&lt;? <span class="keyword">super</span> E&gt; comp;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造器，两个版本：有Comparator和没有Comparator。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedSortedSet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ll=<span class="keyword">new</span> LinkedList&lt;E&gt;();</span><br><span class="line">        comp=<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedSortedSet</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; c)</span></span>&#123;</span><br><span class="line">        ll=<span class="keyword">new</span> LinkedList&lt;E&gt;();</span><br><span class="line">        comp=c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//靠add()方法维持元素顺序</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E element)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!ll.contains(element))&#123;</span><br><span class="line">            <span class="keyword">if</span>(ll.isEmpty())&#123;</span><br><span class="line">                <span class="keyword">return</span> ll.add(element);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Iterator&lt;E&gt; ite=ll.iterator();</span><br><span class="line">                <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(comp!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//用Comparator比</span></span><br><span class="line">                    <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                        <span class="keyword">if</span>(comp.compare(ite.next(),element)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                            ll.add(index,element);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            index++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(index==ll.size())&#123;</span><br><span class="line">                        ll.addLast(element);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="comment">//用compareTo()比</span></span><br><span class="line">                    <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                        E curr=ite.next();</span><br><span class="line">                        <span class="keyword">if</span>(((Comparable)curr).compareTo(element)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                            ll.add(index,element);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            index++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(index==ll.size())&#123;</span><br><span class="line">                        ll.add(index,element);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//检测集合中是否有equals(element)的元素。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ll.contains(o);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//靠构造器带来额外的comparator</span></span><br><span class="line">    <span class="keyword">public</span> Comparator&lt;? <span class="keyword">super</span> E&gt; comparator()&#123;</span><br><span class="line">        <span class="keyword">return</span> comp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回首元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">first</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ll.getFirst();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回末尾元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">last</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ll.getLast();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回从首元素到参数toElement元素的子集</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LinkedSortedSet&lt;E&gt; <span class="title">headSet</span><span class="params">(E toElement)</span></span>&#123;</span><br><span class="line">        LinkedSortedSet&lt;E&gt; lse=<span class="keyword">new</span> LinkedSortedSet&lt;E&gt;();</span><br><span class="line">        Iterator&lt;E&gt; ite=ll.iterator();</span><br><span class="line">        <span class="keyword">if</span>(comp!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//用Comparator比</span></span><br><span class="line">            <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                E curr=ite.next();</span><br><span class="line">                <span class="keyword">if</span>(comp.compare(curr,toElement)&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                    lse.add(curr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//用compareTo()比</span></span><br><span class="line">            <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                E curr=ite.next();</span><br><span class="line">                <span class="keyword">if</span>(((Comparable)curr).compareTo(toElement)&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                    lse.add(curr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lse;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回从fromElement到参数toElement元素的子集</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LinkedSortedSet&lt;E&gt; <span class="title">subSet</span><span class="params">(E fromElement, E toElement)</span></span>&#123;</span><br><span class="line">        LinkedSortedSet&lt;E&gt; lse=<span class="keyword">new</span> LinkedSortedSet&lt;E&gt;();</span><br><span class="line">        Iterator&lt;E&gt; ite=ll.iterator();</span><br><span class="line">        <span class="keyword">if</span>(comp!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//用Comparator比</span></span><br><span class="line">            <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                E curr=ite.next();</span><br><span class="line">                <span class="keyword">if</span>(comp.compare(curr,fromElement)&gt;<span class="number">0</span> &amp;&amp; comp.compare(curr,toElement)&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                    lse.add(curr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//用compareTo()比</span></span><br><span class="line">            <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                E curr=ite.next();</span><br><span class="line">                <span class="keyword">if</span>(((Comparable)curr).compareTo(fromElement)&gt;<span class="number">0</span> &amp;&amp; ((Comparable)curr).compareTo(toElement)&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                    lse.add(curr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lse;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回从fromElement到莫为元素的子集</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> LinkedSortedSet&lt;E&gt; <span class="title">tailSet</span><span class="params">(E fromElement)</span></span>&#123;</span><br><span class="line">        LinkedSortedSet&lt;E&gt; lse=<span class="keyword">new</span> LinkedSortedSet&lt;E&gt;();</span><br><span class="line">        Iterator&lt;E&gt; ite=ll.iterator();</span><br><span class="line">        <span class="keyword">if</span>(comp!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//用Comparator比</span></span><br><span class="line">            <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                E curr=ite.next();</span><br><span class="line">                <span class="keyword">if</span>(comp.compare(curr,fromElement)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    lse.add(curr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//用compareTo()比</span></span><br><span class="line">            <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                E curr=ite.next();</span><br><span class="line">                <span class="keyword">if</span>(((Comparable)curr).compareTo(fromElement)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    lse.add(curr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lse;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回迭代器引用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> ll.iterator();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> ll.toString();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;ll.clear();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> ll.size();&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise10</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Generator&lt;java.lang.String&gt; gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        LinkedSortedSet&lt;String&gt; set=<span class="keyword">new</span> LinkedSortedSet&lt;String&gt;();</span><br><span class="line">        <span class="comment">//LinkedSortedSet&lt;String&gt; set=new LinkedSortedSet&lt;String&gt;(java.lang.String.CASE_INSENSITIVE_ORDER);</span></span><br><span class="line">        </span><br><span class="line">        String no3=<span class="keyword">null</span>;</span><br><span class="line">        String no8=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            String s=gen.next();</span><br><span class="line">            System.out.println(s);</span><br><span class="line">            <span class="keyword">boolean</span> b=set.add(s);</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">2</span>)&#123;</span><br><span class="line">                no3=s;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">7</span>)&#123;</span><br><span class="line">                no8=s;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(set);</span><br><span class="line">        </span><br><span class="line">        System.out.println(set.contains(<span class="string">"abcdefg"</span>));</span><br><span class="line">        System.out.println(set.contains(no3));</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"X    &gt;&gt;&gt;"</span>+no3);</span><br><span class="line">        System.out.println(<span class="string">"Y    &gt;&gt;&gt;"</span>+no8);</span><br><span class="line">        System.out.println(<span class="string">"Element befor X &gt;&gt;&gt;"</span>+set.headSet(no3));</span><br><span class="line">        System.out.println(<span class="string">"Element after Y &gt;&gt;&gt;"</span>+set.tailSet(no8));</span><br><span class="line">        System.out.println(<span class="string">"Element between X &amp; Y &gt;&gt;&gt;"</span>+set.subSet(no3,no8));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-11"><a href="#Exercise-11" class="headerlink" title="Exercise 11"></a>Exercise 11</h4><ul>
<li><strong>Exercise 11</strong>: (2) Create a class that contains an Integer that is initialized to a value between o and 100 using java.util.Random. Implement Comparable using this Integer field. Fill a PriorityQueue with objects of your class, and extract the values using poll( ) to show that it produces the expected order.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Programmer</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Programmer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> level;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Programmer</span><span class="params">(<span class="keyword">int</span> lev,String name)</span></span>&#123;</span><br><span class="line">        level=lev;</span><br><span class="line">        <span class="keyword">this</span>.name=name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLevel</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> level;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Programmer p)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> level-p.getLevel();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"Lev "</span>+level+<span class="string">"   &gt;&gt;&gt;    "</span>+name;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProGen</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">Programmer</span>&gt;</span>&#123;</span><br><span class="line">    Random levRand=<span class="keyword">new</span> Random();</span><br><span class="line">    Generator&lt;java.lang.String&gt; nameRand=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Programmer <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Programmer(levRand.nextInt(<span class="number">10</span>),nameRand.next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise11</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Queue&lt;Programmer&gt; microsoft=<span class="keyword">new</span> PriorityQueue&lt;Programmer&gt;();</span><br><span class="line">        Generator&lt;Programmer&gt; gen=<span class="keyword">new</span> ProGen();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            microsoft.offer(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(microsoft);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> num=microsoft.size();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;num;i++)&#123;</span><br><span class="line">            System.out.println(microsoft.poll());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-12"><a href="#Exercise-12" class="headerlink" title="Exercise 12"></a>Exercise 12</h4><ul>
<li><strong>Exercise 12</strong>: (1) Substitute a HashMap, a TreeMap and a LinkedHashMap in AssociativeArray .Java’s main( ).</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssociativeArray</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object[][] pairs;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AssociativeArray</span><span class="params">(<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        pairs = <span class="keyword">new</span> Object[length][<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &gt;= pairs.length)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException();</span><br><span class="line">        pairs[index++] = <span class="keyword">new</span> Object[]&#123; key, value &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            <span class="keyword">if</span>(key.equals(pairs[i][<span class="number">0</span>]))</span><br><span class="line">                <span class="keyword">return</span> (V)pairs[i][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// Did not find key</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            result.append(pairs[i][<span class="number">0</span>].toString());</span><br><span class="line">            result.append(<span class="string">" : "</span>);</span><br><span class="line">            result.append(pairs[i][<span class="number">1</span>].toString());</span><br><span class="line">            <span class="keyword">if</span>(i &lt; index - <span class="number">1</span>)</span><br><span class="line">                result.append(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise12</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Map&lt;String,String&gt; map)</span></span>&#123;</span><br><span class="line">        map.put(<span class="string">"sky"</span>, <span class="string">"blue"</span>);</span><br><span class="line">        map.put(<span class="string">"grass"</span>, <span class="string">"green"</span>);</span><br><span class="line">        map.put(<span class="string">"ocean"</span>, <span class="string">"dancing"</span>);</span><br><span class="line">        map.put(<span class="string">"tree"</span>, <span class="string">"tall"</span>);</span><br><span class="line">        map.put(<span class="string">"earth"</span>, <span class="string">"brown"</span>);</span><br><span class="line">        map.put(<span class="string">"sun"</span>, <span class="string">"warm"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            map.put(<span class="string">"extra"</span>, <span class="string">"object"</span>); <span class="comment">// Past the end</span></span><br><span class="line">        &#125; <span class="keyword">catch</span>(ArrayIndexOutOfBoundsException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Too many objects!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        System.out.println(map.get(<span class="string">"ocean"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//AssociativeArray&lt;String,String&gt; map1 = new AssociativeArray&lt;String,String&gt;(6);</span></span><br><span class="line">        HashMap&lt;String,String&gt; map2=<span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">        TreeMap&lt;String,String&gt; map3=<span class="keyword">new</span> TreeMap&lt;String,String&gt;();</span><br><span class="line">        LinkedHashMap&lt;String,String&gt; map4=<span class="keyword">new</span> LinkedHashMap&lt;String,String&gt;();</span><br><span class="line">        </span><br><span class="line">        Exercise12.test(map2);</span><br><span class="line">        Exercise12.test(map3);</span><br><span class="line">        Exercise12.test(map4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-13"><a href="#Exercise-13" class="headerlink" title="Exercise 13"></a>Exercise 13</h4><ul>
<li><strong>Exercise 13</strong>: (4) Use AssociativeArray Java to create a wordoccurrence counter, mapping String to Integer. Using the net.mindview.util.TextFile utility in this book, open a text file and break up the words in that file using whitespace and punctuation, and count the occurrence of the words in that file.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise13</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; wordsFreq(String address)&#123;</span><br><span class="line">        HashMap&lt;String,Integer&gt; dic=<span class="keyword">new</span> HashMap&lt;String,Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//读文件</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(address)));</span><br><span class="line">            <span class="comment">//割词</span></span><br><span class="line">            String line=br.readLine();</span><br><span class="line">            <span class="keyword">while</span>(line!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String[] words=line.split(<span class="string">"[\\p&#123;Punct&#125;\\s]+"</span>);</span><br><span class="line">                addWords(words,dic);</span><br><span class="line">                line=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dic;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addWords</span><span class="params">(String[] words, Map&lt;String,Integer&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String word:words)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(word))&#123;</span><br><span class="line">                map.put(word,map.get(word)+<span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                map.put(word,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Integer&gt; map=Exercise13.wordsFreq(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-14"><a href="#Exercise-14" class="headerlink" title="Exercise 14"></a>Exercise 14</h4><ul>
<li><strong>Exercise 14</strong>: (3) Show that java.util.Properties works in the above program.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise14</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printKeys</span><span class="params">(Map&lt;Object,Object&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"Size = "</span> + map.size() + <span class="string">", "</span>);</span><br><span class="line">        System.out.print(<span class="string">"Keys: "</span>);</span><br><span class="line">        System.out.println(map.keySet()); <span class="comment">// Produce a Set of the keys</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Map&lt;Object,Object&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.println(map.getClass().getSimpleName());</span><br><span class="line">        <span class="comment">// Map has ‘Set’ behavior for keys:</span></span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapData(<span class="number">25</span>));</span><br><span class="line">        printKeys(map);</span><br><span class="line">        <span class="comment">// Producing a Collection of the values:</span></span><br><span class="line">        System.out.print(<span class="string">"Values: "</span>);</span><br><span class="line">        System.out.println(map.values());</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        System.out.println(<span class="string">"map.containsKey(11): "</span> + map.containsKey(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.get(11): "</span> + map.get(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.containsValue(\"F0\"): "</span></span><br><span class="line">              + map.containsValue(<span class="string">"F0"</span>));</span><br><span class="line">        Integer key = (Integer)map.keySet().iterator().next();</span><br><span class="line">        System.out.println(<span class="string">"First key in map: "</span> + key);</span><br><span class="line">        map.remove(key);</span><br><span class="line">        printKeys(map);</span><br><span class="line">        map.clear();</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapData(<span class="number">25</span>));</span><br><span class="line">        <span class="comment">// Operations on the Set change the Map:</span></span><br><span class="line">        map.keySet().removeAll(map.keySet());</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        test(<span class="keyword">new</span> Properties());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-15"><a href="#Exercise-15" class="headerlink" title="Exercise 15"></a>Exercise 15</h4><ul>
<li><strong>Exercise 15</strong>: (1) Repeat Exercise 13 using a SlowMap.</li>
</ul>
<h5 id="SlowMap-java"><a href="#SlowMap-java" class="headerlink" title="SlowMap.java"></a>SlowMap.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlowMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;K&gt; keys = <span class="keyword">new</span> ArrayList&lt;K&gt;();</span><br><span class="line">    <span class="keyword">private</span> List&lt;V&gt; values = <span class="keyword">new</span> ArrayList&lt;V&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = get(key); <span class="comment">// The old value or null</span></span><br><span class="line">        <span class="keyword">if</span>(!keys.contains(key)) &#123;</span><br><span class="line">            keys.add(key);</span><br><span class="line">            values.add(value);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            values.set(keys.indexOf(key), value);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123; <span class="comment">// key is type Object, not K</span></span><br><span class="line">        <span class="keyword">if</span>(!keys.contains(key))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> values.get(keys.indexOf(key));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        Iterator&lt;K&gt; ki = keys.iterator();</span><br><span class="line">        Iterator&lt;V&gt; vi = values.iterator();</span><br><span class="line">        <span class="keyword">while</span>(ki.hasNext())</span><br><span class="line">            set.add(<span class="keyword">new</span> MapEntry&lt;K,V&gt;(ki.next(), vi.next()));</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> K key;</span><br><span class="line">        <span class="keyword">private</span> V value;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">            V result = value;</span><br><span class="line">            value = v;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            MapEntry me = (MapEntry)o;</span><br><span class="line">            <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SlowMap&lt;String,String&gt; m= <span class="keyword">new</span> SlowMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(MyCountries.capitals(<span class="number">15</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"BULGARIA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise15-java"><a href="#Exercise15-java" class="headerlink" title="Exercise15.java"></a>Exercise15.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise15</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; wordsFreq(String address)&#123;</span><br><span class="line">        SlowMap&lt;String,Integer&gt; dic=<span class="keyword">new</span> SlowMap&lt;String,Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//读文件</span></span><br><span class="line">            BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(address)));</span><br><span class="line">            <span class="comment">//割词</span></span><br><span class="line">            String line=br.readLine();</span><br><span class="line">            <span class="keyword">while</span>(line!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String[] words=line.split(<span class="string">"[\\p&#123;Punct&#125;\\s]+"</span>);</span><br><span class="line">                addWords(words,dic);</span><br><span class="line">                line=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dic;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addWords</span><span class="params">(String[] words, Map&lt;String,Integer&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String word:words)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(word))&#123;</span><br><span class="line">                map.put(word,map.get(word)+<span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                map.put(word,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Integer&gt; map=Exercise13.wordsFreq(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-16"><a href="#Exercise-16" class="headerlink" title="Exercise 16"></a>Exercise 16</h4><ul>
<li><strong>Exercise 16</strong>: (7) Apply the tests in Maps.java to SlowMap to verify that it works. Fix anything in SlowMap that doesn’t work correctly.<br>SlowMap里EntrySet是享元化的，没有set实体。里面只有一个Iterator返回视图。<br>实体化只有在要打印的时候，在Abstract.toString()里完成。</li>
</ul>
<h5 id="SlowMap-java-1"><a href="#SlowMap-java-1" class="headerlink" title="SlowMap.java"></a>SlowMap.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlowMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;K&gt; keys = <span class="keyword">new</span> ArrayList&lt;K&gt;();</span><br><span class="line">    <span class="keyword">private</span> List&lt;V&gt; values = <span class="keyword">new</span> ArrayList&lt;V&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = get(key); <span class="comment">// The old value or null</span></span><br><span class="line">        <span class="keyword">if</span>(!keys.contains(key)) &#123;</span><br><span class="line">            keys.add(key);</span><br><span class="line">            values.add(value);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            values.set(keys.indexOf(key), value);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123; <span class="comment">// key is type Object, not K</span></span><br><span class="line">        <span class="keyword">if</span>(!keys.contains(key))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> values.get(keys.indexOf(key));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySet();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt;()&#123;</span><br><span class="line">                <span class="keyword">private</span> Iterator&lt;K&gt; iteKey=keys.iterator();</span><br><span class="line">                <span class="keyword">private</span> Iterator&lt;V&gt; iteValue=values.iterator();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">private</span> MapEntry&lt;K,V&gt; entry=<span class="keyword">new</span> MapEntry&lt;K,V&gt;(<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> iteKey.hasNext() &amp;&amp; iteValue.hasNext();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">public</span> Map.Entry&lt;K,V&gt; next()&#123;</span><br><span class="line">                    entry.setKey(iteKey.next());</span><br><span class="line">                    entry.setValue(iteValue.next());</span><br><span class="line">                    <span class="keyword">return</span> entry;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    iteKey.remove();</span><br><span class="line">                    iteValue.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> Math.min(keys.size(),values.size());&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SlowMap&lt;String,String&gt; m= <span class="keyword">new</span> SlowMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(MyCountries.capitals(<span class="number">15</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"BULGARIA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MapEntry-java"><a href="#MapEntry-java" class="headerlink" title="MapEntry.java"></a>MapEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Maps-java"><a href="#Maps-java" class="headerlink" title="Maps.java"></a>Maps.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Maps</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printKeys</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"Size = "</span> + map.size() + <span class="string">", "</span>);</span><br><span class="line">        System.out.print(<span class="string">"Keys: "</span>);</span><br><span class="line">        System.out.println(map.keySet()); <span class="comment">// Produce a Set of the keys</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.println(map.getClass().getSimpleName());</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapDataOrig(<span class="number">25</span>));</span><br><span class="line">        <span class="comment">// Map has ‘Set’ behavior for keys:</span></span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapDataOrig(<span class="number">25</span>));</span><br><span class="line">        printKeys(map);</span><br><span class="line">        <span class="comment">// Producing a Collection of the values:</span></span><br><span class="line">        System.out.print(<span class="string">"Values: "</span>);</span><br><span class="line">        System.out.println(map.values());</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        System.out.println(<span class="string">"map.containsKey(11): "</span> + map.containsKey(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.get(11): "</span> + map.get(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.containsValue(\"F0\"): "</span></span><br><span class="line">              + map.containsValue(<span class="string">"F0"</span>));</span><br><span class="line">        Integer key = map.keySet().iterator().next();</span><br><span class="line">        System.out.println(<span class="string">"First key in map: "</span> + key);</span><br><span class="line">        map.remove(key);</span><br><span class="line">        printKeys(map);</span><br><span class="line">        map.clear();</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapData(<span class="number">25</span>));</span><br><span class="line">        <span class="comment">// Operations on the Set change the Map:</span></span><br><span class="line">        map.keySet().removeAll(map.keySet());</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise16-java"><a href="#Exercise16-java" class="headerlink" title="Exercise16.java"></a>Exercise16.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise16</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Maps.test(<span class="keyword">new</span> SlowMap&lt;Integer,String&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-17"><a href="#Exercise-17" class="headerlink" title="Exercise 17"></a>Exercise 17</h4><p>大部分不需要实现，AbstractMap都实现了。</p>
<h5 id="SlowMapComplete-java"><a href="#SlowMapComplete-java" class="headerlink" title="SlowMapComplete.java"></a>SlowMapComplete.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlowMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;K&gt; keys = <span class="keyword">new</span> ArrayList&lt;K&gt;();</span><br><span class="line">    <span class="keyword">private</span> List&lt;V&gt; values = <span class="keyword">new</span> ArrayList&lt;V&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = get(key); <span class="comment">// The old value or null</span></span><br><span class="line">        <span class="keyword">if</span>(!keys.contains(key)) &#123;</span><br><span class="line">            keys.add(key);</span><br><span class="line">            values.add(value);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            values.set(keys.indexOf(key), value);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123; <span class="comment">// key is type Object, not K</span></span><br><span class="line">        <span class="keyword">if</span>(!keys.contains(key))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> values.get(keys.indexOf(key));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySet();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt;()&#123;</span><br><span class="line">                <span class="keyword">private</span> Iterator&lt;K&gt; iteKey=keys.iterator();</span><br><span class="line">                <span class="keyword">private</span> Iterator&lt;V&gt; iteValue=values.iterator();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">private</span> MapEntry&lt;K,V&gt; entry=<span class="keyword">new</span> MapEntry&lt;K,V&gt;(<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> iteKey.hasNext() &amp;&amp; iteValue.hasNext();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">public</span> Map.Entry&lt;K,V&gt; next()&#123;</span><br><span class="line">                    entry.setKey(iteKey.next());</span><br><span class="line">                    entry.setValue(iteValue.next());</span><br><span class="line">                    <span class="keyword">return</span> entry;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">                    iteKey.remove();</span><br><span class="line">                    iteValue.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> Math.min(keys.size(),values.size());&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  不需要实现，AbstractMap都实现了。</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Removes all of the mappings from this map (optional operation).</span></span><br><span class="line">    <span class="comment">//void clear()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this map contains a mapping for the specified key.</span></span><br><span class="line">    <span class="comment">//boolean containsKey(Object key)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this map maps one or more keys to the specified value.</span></span><br><span class="line">    <span class="comment">//boolean containsValue(Object value)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Compares the specified object with this map for equality.</span></span><br><span class="line">    <span class="comment">//boolean equals(Object o)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns the hash code value for this map.</span></span><br><span class="line">    <span class="comment">//int hashCode()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this map contains no key-value mappings.</span></span><br><span class="line">    <span class="comment">//boolean isEmpty()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns a Set view of the keys contained in this map.</span></span><br><span class="line">    <span class="comment">//Set&lt;K&gt; keySet()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Copies all of the mappings from the specified map to this map (optional operation).</span></span><br><span class="line">    <span class="comment">//void putAll(Map&lt;? extends K,? extends V&gt; m)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Removes the mapping for a key from this map if it is present (optional operation).</span></span><br><span class="line">    <span class="comment">//V remove(Object key)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns the number of key-value mappings in this map.</span></span><br><span class="line">    <span class="comment">//int size()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns a Collection view of the values contained in this map.</span></span><br><span class="line">    <span class="comment">//Collection&lt;V&gt; values()</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SlowMap&lt;String,String&gt; m= <span class="keyword">new</span> SlowMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(MyCountries.capitals(<span class="number">15</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"BULGARIA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MapEntry-java-1"><a href="#MapEntry-java-1" class="headerlink" title="MapEntry.java"></a>MapEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">setKey</span><span class="params">(K k)</span></span>&#123;</span><br><span class="line">        K result=key;</span><br><span class="line">        key=k;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise17-java"><a href="#Exercise17-java" class="headerlink" title="Exercise17.java"></a>Exercise17.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise17</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Maps.test(<span class="keyword">new</span> SlowMapComplete&lt;Integer,String&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-18"><a href="#Exercise-18" class="headerlink" title="Exercise 18"></a>Exercise 18</h4><ul>
<li><strong>Exercise 18</strong>: (3) Using SlowMap.java for inspiration, create a SlowSet.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SlowSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;E&gt; list=<span class="keyword">new</span> ArrayList&lt;E&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlowSet</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SlowSet</span><span class="params">(Collection&lt;E&gt; c)</span></span>&#123;list=<span class="keyword">new</span> ArrayList&lt;E&gt;(c);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E element)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.add(element);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> list.size();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> Ite();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Ite</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> index&lt;list.size();&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> list.get(index++);&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(index&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                list.remove(index-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        SlowSet&lt;String&gt; set=<span class="keyword">new</span> SlowSet&lt;String&gt;();</span><br><span class="line">        RandomGenerator.String gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        </span><br><span class="line">        String s=<span class="keyword">null</span>;</span><br><span class="line">        String no3=<span class="keyword">null</span>;</span><br><span class="line">        String no7=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            s=gen.next();</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">2</span>)&#123;no3=s;&#125;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">6</span>)&#123;no7=s;&#125;</span><br><span class="line">            set.add(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(set);</span><br><span class="line">        System.out.println(<span class="string">"Set contains ELement "</span>+no3+<span class="string">"    &gt;&gt;&gt;"</span>+set.contains(no3));</span><br><span class="line">        set.remove(no7);</span><br><span class="line">        System.out.println(<span class="string">"After delete Element "</span>+no7+<span class="string">"   &gt;&gt;&gt;"</span>+set);</span><br><span class="line">        System.out.println(<span class="string">"Size    &gt;&gt;&gt;"</span>+set.size());</span><br><span class="line">        String[] ss=(String[])(set.toArray());</span><br><span class="line">        System.out.println(<span class="string">"Arrays  &gt;&gt;&gt;"</span>+Arrays.toString(ss));</span><br><span class="line">        set.clear();</span><br><span class="line">        System.out.println(<span class="string">"Delete All Element!!!"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Set is Empty now?   &gt;&gt;&gt;"</span>+set.isEmpty());</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-19"><a href="#Exercise-19" class="headerlink" title="Exercise 19"></a>Exercise 19</h4><ul>
<li><strong>Exercise 19</strong>: (1) Repeat Exercise 13 using a SimpleHashMap.</li>
</ul>
<h5 id="Exercise19-java"><a href="#Exercise19-java" class="headerlink" title="Exercise19.java"></a>Exercise19.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise19</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; wordsFreq(String address)&#123;</span><br><span class="line">        SimpleHashMap&lt;String,Integer&gt; dic=<span class="keyword">new</span> SimpleHashMap&lt;String,Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//读文件</span></span><br><span class="line">            BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(address)));</span><br><span class="line">            <span class="comment">//割词</span></span><br><span class="line">            String line=br.readLine();</span><br><span class="line">            <span class="keyword">while</span>(line!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String[] words=line.split(<span class="string">"[\\p&#123;Punct&#125;\\s]+"</span>);</span><br><span class="line">                addWords(words,dic);</span><br><span class="line">                line=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dic;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addWords</span><span class="params">(String[] words, Map&lt;String,Integer&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String word:words)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(word))&#123;</span><br><span class="line">                map.put(word,map.get(word)+<span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                map.put(word,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Integer&gt; map=Exercise19.wordsFreq(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="SimpleHashMap-java"><a href="#SimpleHashMap-java" class="headerlink" title="SimpleHashMap.java"></a>SimpleHashMap.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Choose a prime number for the hash table</span></span><br><span class="line">    <span class="comment">// size, to achieve a uniform distribution:</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    <span class="comment">// You can’t have a physical array of generics,</span></span><br><span class="line">    <span class="comment">// but you can upcast to one:</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedList&lt;MapEntry&lt;K,V&gt;&gt;[] buckets =</span><br><span class="line">    <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">        LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket = buckets[index];</span><br><span class="line">        MapEntry&lt;K,V&gt; pair = <span class="keyword">new</span> MapEntry&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;MapEntry&lt;K,V&gt;&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            MapEntry&lt;K,V&gt; iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair); <span class="comment">// Replace old with new</span></span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)</span><br><span class="line">            buckets[index].add(pair);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(MapEntry&lt;K,V&gt; iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(MapEntry&lt;K,V&gt; mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHashMap&lt;String,String&gt; m =</span><br><span class="line">        <span class="keyword">new</span> SimpleHashMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MapEntry-java-2"><a href="#MapEntry-java-2" class="headerlink" title="MapEntry.java"></a>MapEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">setKey</span><span class="params">(K k)</span></span>&#123;</span><br><span class="line">        K result=key;</span><br><span class="line">        key=k;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-20"><a href="#Exercise-20" class="headerlink" title="Exercise 20"></a>Exercise 20</h4><ul>
<li><strong>Exercise 20</strong>: (3) Modify SimpleHashMap so that it reports collisions, and test this by adding the same data set twice so that you see collisions.</li>
</ul>
<p>只要在SimpleHashMap的put()方法里当找到相同键值的时候，加一个打印语句。</p>
<h5 id="SimpleHashMap20-java"><a href="#SimpleHashMap20-java" class="headerlink" title="SimpleHashMap20.java"></a>SimpleHashMap20.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap20</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Choose a prime number for the hash table</span></span><br><span class="line">    <span class="comment">// size, to achieve a uniform distribution:</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    <span class="comment">// You can’t have a physical array of generics,</span></span><br><span class="line">    <span class="comment">// but you can upcast to one:</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedList&lt;MapEntry&lt;K,V&gt;&gt;[] buckets =</span><br><span class="line">    <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">        LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket = buckets[index];</span><br><span class="line">        MapEntry&lt;K,V&gt; pair = <span class="keyword">new</span> MapEntry&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;MapEntry&lt;K,V&gt;&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            MapEntry&lt;K,V&gt; iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Word &gt;&gt;&gt;["</span>+iPair.getKey()+<span class="string">"]&lt;&lt;&lt; already existe!   Frequence:  "</span>+iPair.getValue()+<span class="string">"    &gt;&gt;&gt; "</span>+value);</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair); <span class="comment">// Replace old with new</span></span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)</span><br><span class="line">            buckets[index].add(pair);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(MapEntry&lt;K,V&gt; iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(MapEntry&lt;K,V&gt; mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHashMap20&lt;String,String&gt; m = <span class="keyword">new</span> SimpleHashMap20&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MapEntry-java-3"><a href="#MapEntry-java-3" class="headerlink" title="MapEntry.java"></a>MapEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">setKey</span><span class="params">(K k)</span></span>&#123;</span><br><span class="line">        K result=key;</span><br><span class="line">        key=k;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise20-java"><a href="#Exercise20-java" class="headerlink" title="Exercise20.java"></a>Exercise20.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise20</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; wordsFreq(String address)&#123;</span><br><span class="line">        SimpleHashMap20&lt;String,Integer&gt; dic=<span class="keyword">new</span> SimpleHashMap20&lt;String,Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//读文件</span></span><br><span class="line">            BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(address)));</span><br><span class="line">            <span class="comment">//割词</span></span><br><span class="line">            String line=br.readLine();</span><br><span class="line">            <span class="keyword">while</span>(line!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String[] words=line.split(<span class="string">"[\\p&#123;Punct&#125;\\s]+"</span>);</span><br><span class="line">                addWords(words,dic);</span><br><span class="line">                line=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dic;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addWords</span><span class="params">(String[] words, Map&lt;String,Integer&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String word:words)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(word))&#123;</span><br><span class="line">                map.put(word,map.get(word)+<span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                map.put(word,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Integer&gt; map=Exercise20.wordsFreq(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-21"><a href="#Exercise-21" class="headerlink" title="Exercise 21"></a>Exercise 21</h4><ul>
<li><strong>Exercise 21</strong>: (2) Modify SimpleHashMap so that it reports the number of “probes” necessary when collisions occur. That is, how many calls to next( ) must be made on the Iterators that walk the LinkedLists looking for matches?</li>
</ul>
<h5 id="SimpleHashMap21-java"><a href="#SimpleHashMap21-java" class="headerlink" title="SimpleHashMap21.java"></a>SimpleHashMap21.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * SimpleHashMap in the book</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap21</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Choose a prime number for the hash table</span></span><br><span class="line">    <span class="comment">// size, to achieve a uniform distribution:</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    <span class="comment">// You can’t have a physical array of generics,</span></span><br><span class="line">    <span class="comment">// but you can upcast to one:</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedList&lt;MapEntry&lt;K,V&gt;&gt;[] buckets =</span><br><span class="line">    <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">        LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket = buckets[index];</span><br><span class="line">        MapEntry&lt;K,V&gt; pair = <span class="keyword">new</span> MapEntry&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;MapEntry&lt;K,V&gt;&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">int</span> place=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            place++;</span><br><span class="line">            MapEntry&lt;K,V&gt; iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Word &gt;&gt;&gt;["</span>+iPair.getKey()+<span class="string">"]&lt;&lt;&lt; already existe at place "</span>+place+<span class="string">" in LinkedList!   Frequence:  "</span>+iPair.getValue()+<span class="string">"    &gt;&gt;&gt; "</span>+value);</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair); <span class="comment">// Replace old with new</span></span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)</span><br><span class="line">            buckets[index].add(pair);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(MapEntry&lt;K,V&gt; iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(MapEntry&lt;K,V&gt; mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHashMap21&lt;String,String&gt; m = <span class="keyword">new</span> SimpleHashMap21&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MapEntry-java-4"><a href="#MapEntry-java-4" class="headerlink" title="MapEntry.java"></a>MapEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">setKey</span><span class="params">(K k)</span></span>&#123;</span><br><span class="line">        K result=key;</span><br><span class="line">        key=k;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise21-java"><a href="#Exercise21-java" class="headerlink" title="Exercise21.java"></a>Exercise21.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise21</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; wordsFreq(String address)&#123;</span><br><span class="line">        SimpleHashMap21&lt;String,Integer&gt; dic=<span class="keyword">new</span> SimpleHashMap21&lt;String,Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//读文件</span></span><br><span class="line">            BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(address)));</span><br><span class="line">            <span class="comment">//割词</span></span><br><span class="line">            String line=br.readLine();</span><br><span class="line">            <span class="keyword">while</span>(line!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String[] words=line.split(<span class="string">"[\\p&#123;Punct&#125;\\s]+"</span>);</span><br><span class="line">                addWords(words,dic);</span><br><span class="line">                line=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dic;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addWords</span><span class="params">(String[] words, Map&lt;String,Integer&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String word:words)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(word))&#123;</span><br><span class="line">                map.put(word,map.get(word)+<span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                map.put(word,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Integer&gt; map=Exercise21.wordsFreq(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-22"><a href="#Exercise-22" class="headerlink" title="Exercise 22"></a>Exercise 22</h4><h5 id="SimpleHashMap22-java"><a href="#SimpleHashMap22-java" class="headerlink" title="SimpleHashMap22.java"></a>SimpleHashMap22.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap22</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Choose a prime number for the hash table</span></span><br><span class="line">    <span class="comment">// size, to achieve a uniform distribution:</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    <span class="comment">// You can’t have a physical array of generics,</span></span><br><span class="line">    <span class="comment">// but you can upcast to one:</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedList&lt;MapEntry&lt;K,V&gt;&gt;[] buckets =</span><br><span class="line">    <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">        LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket = buckets[index];</span><br><span class="line">        MapEntry&lt;K,V&gt; pair = <span class="keyword">new</span> MapEntry&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;MapEntry&lt;K,V&gt;&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">int</span> place=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            place++;</span><br><span class="line">            MapEntry&lt;K,V&gt; iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Word &gt;&gt;&gt;["</span>+iPair.getKey()+<span class="string">"]&lt;&lt;&lt; already existe at place "</span>+place+<span class="string">" in LinkedList!   Frequence:  "</span>+iPair.getValue()+<span class="string">"    &gt;&gt;&gt; "</span>+value);</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair); <span class="comment">// Replace old with new</span></span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)</span><br><span class="line">            buckets[index].add(pair);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(MapEntry&lt;K,V&gt; iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(MapEntry&lt;K,V&gt; mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        entrySet().clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        V v=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket:buckets)&#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket!=<span class="keyword">null</span> &amp;&amp; !bucket.isEmpty())&#123;</span><br><span class="line">                <span class="keyword">for</span>(MapEntry&lt;K,V&gt; entry:bucket)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(entry.getKey().equals(o))&#123;</span><br><span class="line">                        v=entry.getValue();</span><br><span class="line">                        bucket.remove(entry);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHashMap22&lt;String,String&gt; m = <span class="keyword">new</span> SimpleHashMap22&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MapEntry-java-5"><a href="#MapEntry-java-5" class="headerlink" title="MapEntry.java"></a>MapEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">setKey</span><span class="params">(K k)</span></span>&#123;</span><br><span class="line">        K result=key;</span><br><span class="line">        key=k;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise22-java"><a href="#Exercise22-java" class="headerlink" title="Exercise22.java"></a>Exercise22.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise22</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Integer&gt; wordsFreq(String address)&#123;</span><br><span class="line">        SimpleHashMap22&lt;String,Integer&gt; dic=<span class="keyword">new</span> SimpleHashMap22&lt;String,Integer&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//读文件</span></span><br><span class="line">            BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(address)));</span><br><span class="line">            <span class="comment">//割词</span></span><br><span class="line">            String line=br.readLine();</span><br><span class="line">            <span class="keyword">while</span>(line!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String[] words=line.split(<span class="string">"[\\p&#123;Punct&#125;\\s]+"</span>);</span><br><span class="line">                addWords(words,dic);</span><br><span class="line">                line=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dic;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addWords</span><span class="params">(String[] words, Map&lt;String,Integer&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String word:words)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(word))&#123;</span><br><span class="line">                map.put(word,map.get(word)+<span class="number">1</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                map.put(word,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Integer&gt; map=Exercise22.wordsFreq(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter17/Text.txt"</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"the &gt;&gt;&gt;"</span>+map.remove(<span class="string">"the"</span>));</span><br><span class="line">        </span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-23"><a href="#Exercise-23" class="headerlink" title="Exercise 23"></a>Exercise 23</h4><h5 id="SimpleHashMap23-java"><a href="#SimpleHashMap23-java" class="headerlink" title="SimpleHashMap23.java"></a>SimpleHashMap23.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap23</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Choose a prime number for the hash table</span></span><br><span class="line">    <span class="comment">// size, to achieve a uniform distribution:</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    <span class="comment">// You can’t have a physical array of generics,</span></span><br><span class="line">    <span class="comment">// but you can upcast to one:</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedList&lt;MapEntry&lt;K,V&gt;&gt;[] buckets = <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">        LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket = buckets[index];</span><br><span class="line">        MapEntry&lt;K,V&gt; pair = <span class="keyword">new</span> MapEntry&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;MapEntry&lt;K,V&gt;&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">int</span> place=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            place++;</span><br><span class="line">            MapEntry&lt;K,V&gt; iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Word &gt;&gt;&gt;["</span>+iPair.getKey()+<span class="string">"]&lt;&lt;&lt; already existe at place "</span>+place+<span class="string">" in LinkedList!   Frequence:  "</span>+iPair.getValue()+<span class="string">"    &gt;&gt;&gt; "</span>+value);</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair); <span class="comment">// Replace old with new</span></span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)</span><br><span class="line">            buckets[index].add(pair);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(MapEntry&lt;K,V&gt; iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(MapEntry&lt;K,V&gt; mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        entrySet().clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        V v=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket:buckets)&#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket!=<span class="keyword">null</span> &amp;&amp; !bucket.isEmpty())&#123;</span><br><span class="line">                <span class="keyword">for</span>(MapEntry&lt;K,V&gt; entry:bucket)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(entry.getKey().equals(o))&#123;</span><br><span class="line">                        v=entry.getValue();</span><br><span class="line">                        bucket.remove(entry);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this map contains a mapping for the specified key.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsKey</span><span class="params">(Object key)</span></span>&#123;</span><br><span class="line">        Set&lt;K&gt; keys=keySet();</span><br><span class="line">        <span class="keyword">return</span> keys.contains(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this map maps one or more keys to the specified value.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsValue</span><span class="params">(Object value)</span></span>&#123;</span><br><span class="line">        Collection&lt;V&gt; values=values();</span><br><span class="line">        <span class="keyword">return</span> values.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Compares the specified object with this map for equality.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> SimpleHashMap23))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.buckets.length!=((SimpleHashMap23)o).buckets.length)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="keyword">this</span>.buckets.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">this</span>.buckets[i].equals(((SimpleHashMap23)o).buckets[i]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns the hash code value for this map.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hash=<span class="number">37</span>*SIZE;</span><br><span class="line">        <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket:buckets)&#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket!=<span class="keyword">null</span> &amp;&amp; !bucket.isEmpty())&#123;</span><br><span class="line">                <span class="keyword">for</span>(MapEntry&lt;K,V&gt; entry:bucket)&#123;</span><br><span class="line">                    index++;</span><br><span class="line">                    hash=hash+<span class="number">37</span>*index*entry.hashCode();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this map contains no key-value mappings.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entrySet().isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns a Set view of the keys contained in this map.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;K&gt; <span class="title">keySet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Set&lt;K&gt; keys=<span class="keyword">new</span> LinkedHashSet&lt;K&gt;();</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set=entrySet();</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;K,V&gt; entry:set)&#123;</span><br><span class="line">            keys.add(entry.getKey());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> keys;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Copies all of the mappings from the specified map to this map (optional operation).</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putAll</span><span class="params">(Map&lt;? extends K,? extends V&gt; m)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry entry:m.entrySet())&#123;</span><br><span class="line">            put((K)entry.getKey(),(V)entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns the number of key-value mappings in this map.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entrySet().size();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns a Collection view of the values contained in this map.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;V&gt; <span class="title">values</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Collection&lt;V&gt; values=<span class="keyword">new</span> ArrayList&lt;V&gt;();</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set=entrySet();</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;K,V&gt; entry:set)&#123;</span><br><span class="line">            values.add(entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> values;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHashMap23&lt;String,String&gt; m = <span class="keyword">new</span> SimpleHashMap23&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MapEntry-java-6"><a href="#MapEntry-java-6" class="headerlink" title="MapEntry.java"></a>MapEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapEntry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MapEntry</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">setKey</span><span class="params">(K k)</span></span>&#123;</span><br><span class="line">        K result=key;</span><br><span class="line">        key=k;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Maps-java-1"><a href="#Maps-java-1" class="headerlink" title="Maps.java"></a>Maps.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Maps</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printKeys</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"Size = "</span> + map.size() + <span class="string">", "</span>);</span><br><span class="line">        System.out.print(<span class="string">"Keys: "</span>);</span><br><span class="line">        System.out.println(map.keySet()); <span class="comment">// Produce a Set of the keys</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.println(map.getClass().getSimpleName());</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapDataOrig(<span class="number">25</span>));</span><br><span class="line">        <span class="comment">// Map has ‘Set’ behavior for keys:</span></span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapDataOrig(<span class="number">25</span>));</span><br><span class="line">        printKeys(map);</span><br><span class="line">        <span class="comment">// Producing a Collection of the values:</span></span><br><span class="line">        System.out.print(<span class="string">"Values: "</span>);</span><br><span class="line">        System.out.println(map.values());</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        System.out.println(<span class="string">"map.containsKey(11): "</span> + map.containsKey(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.get(11): "</span> + map.get(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.containsValue(\"F0\"): "</span></span><br><span class="line">              + map.containsValue(<span class="string">"F0"</span>));</span><br><span class="line">        Integer key = map.keySet().iterator().next();</span><br><span class="line">        System.out.println(<span class="string">"First key in map: "</span> + key);</span><br><span class="line">        map.remove(key);</span><br><span class="line">        printKeys(map);</span><br><span class="line">        map.clear();</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapData(<span class="number">25</span>));</span><br><span class="line">        <span class="comment">// Operations on the Set change the Map:</span></span><br><span class="line">        map.keySet().removeAll(map.keySet());</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CountingMapData-java"><a href="#CountingMapData-java" class="headerlink" title="CountingMapData.java"></a>CountingMapData.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingMapData</span> <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String[] chars = <span class="string">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span>.split(<span class="string">" "</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountingMapData</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(size &lt; <span class="number">0</span>) <span class="keyword">this</span>.size = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index;</span><br><span class="line">        Entry(<span class="keyword">int</span> index) &#123; <span class="keyword">this</span>.index = index; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(index).equals(o);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> index; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> chars[index % chars.length] + Integer.toString(index / chars.length);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.valueOf(index).hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EntrySet</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.size=size;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> size;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Iter</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">Integer</span>,<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> index&lt;size;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">public</span> Map.Entry&lt;Integer,String&gt; next()&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Entry(index++);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;Integer,String&gt;&gt; iterator()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Iter();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;Integer,String&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySet(size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> CountingMapData(<span class="number">60</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise23-java"><a href="#Exercise23-java" class="headerlink" title="Exercise23.java"></a>Exercise23.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise23</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        SimpleHashMap23&lt;Integer,String&gt; map=<span class="keyword">new</span> SimpleHashMap23&lt;Integer,String&gt;();</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapData(<span class="number">60</span>));</span><br><span class="line">        Maps.test(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-24"><a href="#Exercise-24" class="headerlink" title="Exercise 24"></a>Exercise 24</h4><ul>
<li><strong>Exercise 24</strong>: (5) Following the example in SimpleHashMap.java, create and test a SimpleHashSet.</li>
</ul>
<h5 id="SimpleHashSet-java"><a href="#SimpleHashSet-java" class="headerlink" title="SimpleHashSet.java"></a>SimpleHashSet.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE=<span class="number">1024</span>;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;E&gt;[] buckets=<span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Ite</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index=-<span class="number">1</span>;</span><br><span class="line">        LinkedList&lt;E&gt; bucket=<span class="keyword">null</span>;</span><br><span class="line">        Iterator&lt;E&gt; ite=<span class="keyword">null</span>;</span><br><span class="line">        E previous=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(ite!=<span class="keyword">null</span> &amp;&amp; ite.hasNext())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">int</span> ranger=index;</span><br><span class="line">            <span class="keyword">while</span>(++ranger&lt;SIZE)&#123;</span><br><span class="line">                <span class="keyword">if</span>(buckets[ranger]!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(ite!=<span class="keyword">null</span> &amp;&amp; ite.hasNext())&#123;</span><br><span class="line">                previous=ite.next();</span><br><span class="line">                <span class="keyword">return</span> previous;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(++index&lt;SIZE)&#123;</span><br><span class="line">                <span class="keyword">if</span>(buckets[index]!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    ite=buckets[index].iterator();</span><br><span class="line">                    previous=ite.next();</span><br><span class="line">                    <span class="keyword">return</span> previous;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(previous!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                buckets[index].remove(previous);</span><br><span class="line">                previous=<span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span>(buckets[index].isEmpty())&#123;</span><br><span class="line">                    buckets[index]=<span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> Ite();&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hash=e.hashCode();</span><br><span class="line">        <span class="keyword">int</span> ticket=Math.abs(hash)%SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[ticket]!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!buckets[ticket].contains(e))&#123;</span><br><span class="line">                buckets[ticket].add(e);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            buckets[ticket]=<span class="keyword">new</span> LinkedList&lt;E&gt;();</span><br><span class="line">            buckets[ticket].add(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size=<span class="number">0</span>;</span><br><span class="line">        Iterator&lt;E&gt; ite=iterator();</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            ite.next();</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*******</span><br><span class="line">     *  AbstractSet已实现部分</span><br><span class="line">     *******/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public int hashCode()</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean equals(Object o)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean removeAll(Collection&lt;?&gt; c)</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*******</span><br><span class="line">     *  AbstractCollection已实现部分</span><br><span class="line">     *******/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean addAll(Collection&lt;? extends E&gt; c)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public void clear()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean contains(Object o)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean containsAll(Collection&lt;?&gt; c)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean isEmpty()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean remove(Object o)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public boolean retainAll(Collection&lt;?&gt; c)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//public Object[] toArray()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//public &lt;T&gt; T[] toArray(T[] a)</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Sets-java"><a href="#Sets-java" class="headerlink" title="Sets.java"></a>Sets.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sets</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(Set&lt;E&gt; set1, Set&lt;E&gt; set2)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;Set1&lt;&lt;&lt;"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Class Name  &gt;&gt;&gt; "</span>+set1.getClass().getName());</span><br><span class="line">        System.out.println(<span class="string">"Size    &gt;&gt;&gt; "</span>+set1.size());</span><br><span class="line">        System.out.println(set1);</span><br><span class="line">        </span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;Set2&lt;&lt;&lt;"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Class Name  &gt;&gt;&gt; "</span>+set2.getClass().getName());</span><br><span class="line">        System.out.println(<span class="string">"Size    &gt;&gt;&gt; "</span>+set2.size());</span><br><span class="line">        System.out.println(set2);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"Set1 equals Set1?   &gt;&gt;&gt; "</span>+set1.equals(set1));</span><br><span class="line">        System.out.println(<span class="string">"Set1 equals Set2?   &gt;&gt;&gt; "</span>+set1.equals(set2));</span><br><span class="line">        System.out.println(<span class="string">"Set1 hash code = "</span>+set1.hashCode());</span><br><span class="line">        System.out.println(<span class="string">"Set2 hash code = "</span>+set2.hashCode());</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        System.out.println();</span><br><span class="line">        set1.addAll(set2);</span><br><span class="line">        System.out.println(<span class="string">"Union of Set1 and Set2  &gt;&gt;&gt; "</span>+set1);</span><br><span class="line">        System.out.println(<span class="string">"Size    &gt;&gt;&gt;  "</span>+set1.size());</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"Set1 contains XXXXXX?  "</span>+set1.contains(<span class="string">"XXXXXX"</span>));</span><br><span class="line">        Iterator&lt;E&gt; ite=set1.iterator();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;(set1.size()/<span class="number">2</span>-<span class="number">1</span>);i++)&#123;</span><br><span class="line">            ite.next();</span><br><span class="line">        &#125;</span><br><span class="line">        E mid=ite.next();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"Middle Element  &gt;&gt;&gt; "</span>+mid);</span><br><span class="line">        set1.remove(mid);</span><br><span class="line">        System.out.println(<span class="string">"After removing Middle Element   &gt;&gt;&gt; "</span>+set1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; set1=<span class="keyword">new</span> LinkedHashSet&lt;String&gt;();</span><br><span class="line">        Set&lt;String&gt; set2=<span class="keyword">new</span> LinkedHashSet&lt;String&gt;();</span><br><span class="line">        RandomGenerator.String gen=<span class="keyword">new</span> RandomGenerator.String(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">            set1.add(gen.next());</span><br><span class="line">            set2.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        Sets.test(set1,set2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise24-java"><a href="#Exercise24-java" class="headerlink" title="Exercise24.java"></a>Exercise24.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise24</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; set1=<span class="keyword">new</span> SimpleHashSet&lt;String&gt;();</span><br><span class="line">        Set&lt;String&gt; set2=<span class="keyword">new</span> SimpleHashSet&lt;String&gt;();</span><br><span class="line">        RandomGenerator.String gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">            set1.add(gen.next());</span><br><span class="line">            set2.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        Sets.test(set1,set2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-25"><a href="#Exercise-25" class="headerlink" title="Exercise 25"></a>Exercise 25</h4><ul>
<li><strong>Exercise 25</strong>: (6) Instead of using a Listlterator for each bucket, modify MapEntry so that it is a self-contained singly linked list (each MapEntry should have a forward link to the next MapEntry). Modify the rest of the code in SimpleHashMap.java so that this new approach works correctly.</li>
</ul>
<h5 id="LinkedMapEntryV2-java"><a href="#LinkedMapEntryV2-java" class="headerlink" title="LinkedMapEntryV2.java"></a>LinkedMapEntryV2.java</h5><p>带指向下一个节点指针的（类单向链表）Map.Entry节点，不需要完整地实现LinkedList的全部功能，甚至不需要实现Iterator接口内部类。只需要提供几个简单的访问next节点的方法就可以了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedMapEntryV2</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line">    <span class="keyword">private</span> LinkedMapEntryV2&lt;K,V&gt; next;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedMapEntryV2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        key=<span class="keyword">null</span>;</span><br><span class="line">        value=<span class="keyword">null</span>;</span><br><span class="line">        next=<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedMapEntryV2</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        next=<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        V result = value;</span><br><span class="line">        value = v;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode()) ^ (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> MapEntry)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        MapEntry me = (MapEntry)o;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span> ? me.getKey() == <span class="keyword">null</span> : key.equals(me.getKey())) &amp;&amp; (value == <span class="keyword">null</span> ? me.getValue()== <span class="keyword">null</span> : value.equals(me.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">"="</span> + value; &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 *	需要的三个简单的对next节点的访问方法。</span><br><span class="line">	 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> next==<span class="keyword">null</span>;&#125;</span><br><span class="line">    <span class="keyword">public</span> LinkedMapEntryV2&lt;K,V&gt; next()&#123;<span class="keyword">return</span> next;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(LinkedMapEntryV2&lt;K,V&gt; entry)</span></span>&#123;next=entry;&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="SimpleHashMap25V2-java"><a href="#SimpleHashMap25V2-java" class="headerlink" title="SimpleHashMap25V2.java"></a>SimpleHashMap25V2.java</h5><p>这个山寨HashMap的关键点在于对接口的把握：Map接口里的entrySet()是明确面向Map.Entry的。其他方法可以直接面向LinkedMapEntryV2。而LinkedMapEntryV2的功能比Map接口强很多。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap25V2</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedMapEntryV2&lt;K,V&gt;[] buckets = <span class="keyword">new</span> LinkedMapEntryV2[SIZE];</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)&#123;</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedMapEntryV2&lt;K,V&gt;(key,value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        LinkedMapEntryV2&lt;K,V&gt; cursor = buckets[index];</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor.getKey().equals(key))&#123;</span><br><span class="line">                oldValue=cursor.getValue();</span><br><span class="line">                cursor.setValue(value);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cursor.hasNext())&#123;</span><br><span class="line">                cursor=cursor.next();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                cursor.setNext(<span class="keyword">new</span> LinkedMapEntryV2&lt;K,V&gt;(key,value));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)&#123;<span class="keyword">return</span> <span class="keyword">null</span>;&#125;</span><br><span class="line">        </span><br><span class="line">        LinkedMapEntryV2&lt;K,V&gt; cursor = buckets[index];</span><br><span class="line">        <span class="keyword">while</span>(cursor!=<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor.getKey().equals(key))&#123;</span><br><span class="line">                <span class="keyword">return</span> cursor.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">            cursor=cursor.next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedMapEntryV2&lt;K,V&gt; cursor : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                set.add(cursor);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHashMap25V2&lt;String,String&gt; m = <span class="keyword">new</span> SimpleHashMap25V2&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Maps-java-2"><a href="#Maps-java-2" class="headerlink" title="Maps.java"></a>Maps.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Maps</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printKeys</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"Size = "</span> + map.size() + <span class="string">", "</span>);</span><br><span class="line">        System.out.print(<span class="string">"Keys: "</span>);</span><br><span class="line">        System.out.println(map.keySet()); <span class="comment">// Produce a Set of the keys</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Map&lt;Integer,String&gt; map)</span> </span>&#123;</span><br><span class="line">        System.out.println(map.getClass().getSimpleName());</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapDataOrig(<span class="number">25</span>));</span><br><span class="line">        <span class="comment">// Map has ‘Set’ behavior for keys:</span></span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapDataOrig(<span class="number">25</span>));</span><br><span class="line">        printKeys(map);</span><br><span class="line">        <span class="comment">// Producing a Collection of the values:</span></span><br><span class="line">        System.out.print(<span class="string">"Values: "</span>);</span><br><span class="line">        System.out.println(map.values());</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        System.out.println(<span class="string">"map.containsKey(11): "</span> + map.containsKey(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.get(11): "</span> + map.get(<span class="number">11</span>));</span><br><span class="line">        System.out.println(<span class="string">"map.containsValue(\"F0\"): "</span></span><br><span class="line">              + map.containsValue(<span class="string">"F0"</span>));</span><br><span class="line">        Integer key = map.keySet().iterator().next();</span><br><span class="line">        System.out.println(<span class="string">"First key in map: "</span> + key);</span><br><span class="line">        map.remove(key);</span><br><span class="line">        printKeys(map);</span><br><span class="line">        map.clear();</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapData(<span class="number">25</span>));</span><br><span class="line">        <span class="comment">// Operations on the Set change the Map:</span></span><br><span class="line">        map.keySet().removeAll(map.keySet());</span><br><span class="line">        System.out.println(<span class="string">"map.isEmpty(): "</span> + map.isEmpty());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise25-java"><a href="#Exercise25-java" class="headerlink" title="Exercise25.java"></a>Exercise25.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise25</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        SimpleHashMap25V2&lt;Integer,String&gt; map=<span class="keyword">new</span> SimpleHashMap25V2&lt;Integer,String&gt;();</span><br><span class="line">        map.putAll(<span class="keyword">new</span> CountingMapData(<span class="number">60</span>));</span><br><span class="line">        Maps.test(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-26"><a href="#Exercise-26" class="headerlink" title="Exercise 26"></a>Exercise 26</h4><ul>
<li><strong>Exercise 26</strong>: (2) Add a char field to CountedString that is also initialized in the constructor, and modify the hashCode( ) and equals( ) methods to include the value of this char.</li>
</ul>
<h5 id="EntryPair-java"><a href="#EntryPair-java" class="headerlink" title="EntryPair.java"></a>EntryPair.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EntryPair</span>&lt;<span class="title">X</span>,<span class="title">Y</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> X x;</span><br><span class="line">    <span class="keyword">private</span> Y y;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EntryPair</span><span class="params">(X inX, Y inY)</span></span>&#123;x=inX; y=inY;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> X <span class="title">getX</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Y <span class="title">getY</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> X <span class="title">setX</span><span class="params">(X inX)</span></span>&#123;X oldX=x; x=inX; <span class="keyword">return</span> oldX;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Y <span class="title">setY</span><span class="params">(Y inY)</span></span>&#123;Y oldY=y; y=inY; <span class="keyword">return</span> oldY;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;<span class="keyword">return</span> x.equals(((EntryPair&lt;X,Y&gt;)o).getX()) &amp;&amp; y.equals(((EntryPair&lt;X,Y&gt;)o).getY());&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> (x==<span class="keyword">null</span>? <span class="number">0</span>:x.hashCode()) ^ (y==<span class="keyword">null</span>? <span class="number">0</span>:y.hashCode());&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CountedString-java"><a href="#CountedString-java" class="headerlink" title="CountedString.java"></a>CountedString.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountedString</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;EntryPair&lt;Character,String&gt;&gt; created = <span class="keyword">new</span> ArrayList&lt;EntryPair&lt;Character,String&gt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span> type;</span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountedString</span><span class="params">(<span class="keyword">char</span> c, String str)</span> </span>&#123;</span><br><span class="line">        type=c;</span><br><span class="line">        s=str;</span><br><span class="line">        EntryPair&lt;Character,String&gt; newEntry=<span class="keyword">new</span> EntryPair&lt;Character,String&gt;(c,str);</span><br><span class="line">        created.add(newEntry);</span><br><span class="line">        <span class="keyword">for</span>(EntryPair&lt;Character,String&gt; entry : created)&#123;</span><br><span class="line">            <span class="keyword">if</span>(entry.equals(newEntry))&#123;</span><br><span class="line">                id++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Type: "</span> + type + <span class="string">" String: "</span> + s + <span class="string">" id: "</span> + id + <span class="string">" hashCode(): "</span> + hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">17</span>;</span><br><span class="line">        result = <span class="number">37</span> * result + ((Character)type).hashCode();</span><br><span class="line">        result = <span class="number">37</span> * result + s.hashCode();</span><br><span class="line">        result = <span class="number">37</span> * result + id;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o <span class="keyword">instanceof</span> CountedString &amp;&amp;</span><br><span class="line">        s.equals(((CountedString)o).s) &amp;&amp;</span><br><span class="line">        ((Character)type).equals(((CountedString)o).type) &amp;&amp;</span><br><span class="line">        id == ((CountedString)o).id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise26-java"><a href="#Exercise26-java" class="headerlink" title="Exercise26.java"></a>Exercise26.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise26</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;CountedString,Integer&gt; map = <span class="keyword">new</span> HashMap&lt;CountedString,Integer&gt;();</span><br><span class="line">        CountedString[] cs = <span class="keyword">new</span> CountedString[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cs.length; i++) &#123;</span><br><span class="line">            cs[i] = <span class="keyword">new</span> CountedString(<span class="string">'A'</span>,<span class="string">"hi"</span>);</span><br><span class="line">            map.put(cs[i], i); <span class="comment">// Autobox int -&gt; Integer</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        <span class="keyword">for</span>(CountedString cstring : cs) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Looking up "</span> + cstring);</span><br><span class="line">            System.out.println(map.get(cstring));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-27"><a href="#Exercise-27" class="headerlink" title="Exercise 27"></a>Exercise 27</h4><ul>
<li><strong>Exercise 27</strong>: (3) Modify the hashCode( ) in CountedString.java by removing the combination with id, and demonstrate that CountedString still works as a key. What is the problem with this approach?<br>如果hashCode()没有绑定所有的域，本质上不会影响这个类作为Map的键使用。因为不会出现重复的键值。</li>
</ul>
<p>但还是存在一定问题：不同的对象，在HashMap里有同样的键值。也就是，部分对象会被其他不同的对象替换掉，因为有相同的键值。练习中，下面4个不同的对象，拥有相同的散列值。</p>
<ul>
<li>A-Hi-1</li>
<li>A-Hi-2</li>
<li>A-Hi-3</li>
<li>A-Hi-4</li>
</ul>
<p>导致前三个对象的信息会丢失，被后面相同散列值的对象覆盖。但如果这就是设计者的用意，那么就不成问题。</p>
<h5 id="EntryPair-java-1"><a href="#EntryPair-java-1" class="headerlink" title="EntryPair.java"></a>EntryPair.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EntryPair</span>&lt;<span class="title">X</span>,<span class="title">Y</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> X x;</span><br><span class="line">    <span class="keyword">private</span> Y y;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EntryPair</span><span class="params">(X inX, Y inY)</span></span>&#123;x=inX; y=inY;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> X <span class="title">getX</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> x;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Y <span class="title">getY</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> X <span class="title">setX</span><span class="params">(X inX)</span></span>&#123;X oldX=x; x=inX; <span class="keyword">return</span> oldX;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Y <span class="title">setY</span><span class="params">(Y inY)</span></span>&#123;Y oldY=y; y=inY; <span class="keyword">return</span> oldY;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;<span class="keyword">return</span> x.equals(((EntryPair&lt;X,Y&gt;)o).getX()) &amp;&amp; y.equals(((EntryPair&lt;X,Y&gt;)o).getY());&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> (x==<span class="keyword">null</span>? <span class="number">0</span>:x.hashCode()) ^ (y==<span class="keyword">null</span>? <span class="number">0</span>:y.hashCode());&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CountedString27-java"><a href="#CountedString27-java" class="headerlink" title="CountedString27.java"></a>CountedString27.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountedString27</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;EntryPair&lt;Character,String&gt;&gt; created = <span class="keyword">new</span> ArrayList&lt;EntryPair&lt;Character,String&gt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span> type;</span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountedString27</span><span class="params">(<span class="keyword">char</span> c, String str)</span> </span>&#123;</span><br><span class="line">        type=c;</span><br><span class="line">        s=str;</span><br><span class="line">        EntryPair&lt;Character,String&gt; newEntry=<span class="keyword">new</span> EntryPair&lt;Character,String&gt;(c,str);</span><br><span class="line">        created.add(newEntry);</span><br><span class="line">        <span class="keyword">for</span>(EntryPair&lt;Character,String&gt; entry : created)&#123;</span><br><span class="line">            <span class="keyword">if</span>(entry.equals(newEntry))&#123;</span><br><span class="line">                id++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Type: "</span> + type + <span class="string">" String: "</span> + s + <span class="string">" id: "</span> + id + <span class="string">" hashCode(): "</span> + hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//hashCode()和id解绑</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">17</span>;</span><br><span class="line">        result = <span class="number">37</span> * result + ((Character)type).hashCode();</span><br><span class="line">        result = <span class="number">37</span> * result + s.hashCode();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o <span class="keyword">instanceof</span> CountedString27 &amp;&amp;</span><br><span class="line">        s.equals(((CountedString27)o).s) &amp;&amp;</span><br><span class="line">        ((Character)type).equals(((CountedString27)o).type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise27-java"><a href="#Exercise27-java" class="headerlink" title="Exercise27.java"></a>Exercise27.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise27</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;CountedString27,Integer&gt; map = <span class="keyword">new</span> HashMap&lt;CountedString27,Integer&gt;();</span><br><span class="line">        CountedString27[] cs = <span class="keyword">new</span> CountedString27[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cs.length; i++) &#123;</span><br><span class="line">            cs[i] = <span class="keyword">new</span> CountedString27(<span class="string">'A'</span>,<span class="string">"hi"</span>);</span><br><span class="line">            map.put(cs[i], i); <span class="comment">// Autobox int -&gt; Integer</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        <span class="keyword">for</span>(CountedString27 cstring : cs) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Looking up "</span> + cstring);</span><br><span class="line">            System.out.println(map.get(cstring));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-28"><a href="#Exercise-28" class="headerlink" title="Exercise 28"></a>Exercise 28</h4><ul>
<li><strong>Exercise 28</strong>: (4) Modify net/mindview/util/Tuple.java to make it a general-purpose class by adding hashCode( ), equals( ), and implementing Comparable for each type of Tuple.</li>
</ul>
<h5 id="Tuple-java"><a href="#Tuple-java" class="headerlink" title="Tuple.java"></a>Tuple.java</h5><p>这里实现的是Comparable<tuple>接口。有一个缺点：高级的Tuple和低级的Tuple比较的时候，容易出Bug。</tuple></p>
<p>比如TupleFive和TupleTwo比较的时候，如果前两个元素相等，就会开始比较第三个元素。会调用TupleThree的compareTo()方法。就会把TupleTwo强制转型成TupleThree，会出ClassCastException。</p>
<p>所以只能拿低级的和高级的比，或者同级之间比较。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TwoTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>&gt; <span class="keyword">extends</span> <span class="title">Tuple</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Tuple</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> A first;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> B second;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TwoTuple</span><span class="params">(A a, B b)</span> </span>&#123; first = a; second = b; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"("</span> + first + <span class="string">", "</span> + second + <span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> first.equals(((TwoTuple&lt;A,B&gt;)o).first) &amp;&amp; second.equals(((TwoTuple&lt;A,B&gt;)o).second);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">int</span> hash=<span class="number">17</span>;</span><br><span class="line">            hash=<span class="number">37</span>*hash+first.hashCode();</span><br><span class="line">            hash=<span class="number">37</span>*hash+second.hashCode();</span><br><span class="line">            <span class="keyword">return</span> hash;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Tuple t)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(((Comparable&lt;A&gt;)<span class="keyword">this</span>.first).compareTo(((TwoTuple&lt;A,B&gt;)t).first)==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> ((Comparable&lt;B&gt;)<span class="keyword">this</span>.second).compareTo(((TwoTuple&lt;A,B&gt;)t).second);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> ((Comparable&lt;A&gt;)<span class="keyword">this</span>.first).compareTo(((TwoTuple&lt;A,B&gt;)t).first);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>,<span class="title">C</span>&gt; <span class="keyword">extends</span> <span class="title">TwoTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> C third;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ThreeTuple</span><span class="params">(A a, B b, C c)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(a, b);</span><br><span class="line">            third = c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"("</span> + first + <span class="string">", "</span> + second + <span class="string">", "</span> + third +<span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.equals(o) &amp;&amp; third.equals(((ThreeTuple&lt;A,B,C&gt;)o).third);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">int</span> hash=<span class="keyword">super</span>.hashCode();</span><br><span class="line">            hash=<span class="number">37</span>*hash+third.hashCode();</span><br><span class="line">            <span class="keyword">return</span> hash;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Tuple t)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">super</span>.compareTo(((TwoTuple&lt;A,B&gt;)t))==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> ((Comparable&lt;C&gt;)<span class="keyword">this</span>.third).compareTo(((ThreeTuple&lt;A,B,C&gt;)t).third);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.compareTo((TwoTuple&lt;A,B&gt;)t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FourTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>,<span class="title">C</span>,<span class="title">D</span>&gt; <span class="keyword">extends</span> <span class="title">ThreeTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>,<span class="title">C</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> D fourth;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FourTuple</span><span class="params">(A a, B b, C c, D d)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(a, b, c);</span><br><span class="line">            fourth = d;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"("</span> + first + <span class="string">", "</span> + second + <span class="string">", "</span> +</span><br><span class="line">            third + <span class="string">", "</span> + fourth + <span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.equals(o) &amp;&amp; fourth.equals(((FourTuple&lt;A,B,C,D&gt;)o).fourth);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">int</span> hash=<span class="keyword">super</span>.hashCode();</span><br><span class="line">            hash=<span class="number">37</span>*hash+fourth.hashCode();</span><br><span class="line">            <span class="keyword">return</span> hash;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Tuple t)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">super</span>.compareTo(((ThreeTuple&lt;A,B,C&gt;)t))==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> ((Comparable&lt;D&gt;)<span class="keyword">this</span>.fourth).compareTo(((FourTuple&lt;A,B,C,D&gt;)t).fourth);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.compareTo((ThreeTuple&lt;A,B,C&gt;)t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FiveTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>,<span class="title">C</span>,<span class="title">D</span>,<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">FourTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>,<span class="title">C</span>,<span class="title">D</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> E fifth;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FiveTuple</span><span class="params">(A a, B b, C c, D d, E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(a, b, c, d);</span><br><span class="line">            fifth = e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"("</span> + first + <span class="string">", "</span> + second + <span class="string">", "</span> +</span><br><span class="line">            third + <span class="string">", "</span> + fourth + <span class="string">", "</span> + fifth + <span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.equals(o) &amp;&amp; fifth.equals(((FiveTuple&lt;A,B,C,D,E&gt;)o).fifth);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">int</span> hash=<span class="keyword">super</span>.hashCode();</span><br><span class="line">            hash=<span class="number">37</span>*hash+fifth.hashCode();</span><br><span class="line">            <span class="keyword">return</span> hash;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Tuple t)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">super</span>.compareTo(((FourTuple&lt;A,B,C,D&gt;)t))==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> ((Comparable&lt;E&gt;)<span class="keyword">this</span>.fifth).compareTo(((FiveTuple&lt;A,B,C,D,E&gt;)t).fifth);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.compareTo((FourTuple&lt;A,B,C,D&gt;)t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A,B&gt; Tuple.TwoTuple&lt;A,B&gt; tuple(A a, B b) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple.TwoTuple&lt;A,B&gt;(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A,B,C&gt; Tuple.ThreeTuple&lt;A,B,C&gt; tuple(A a, B b, C c) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple.ThreeTuple&lt;A,B,C&gt;(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A,B,C,D&gt; Tuple.FourTuple&lt;A,B,C,D&gt; tuple(A a, B b, C c, D d) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple.FourTuple&lt;A,B,C,D&gt;(a, b, c, d);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;A,B,C,D,E&gt; Tuple.FiveTuple&lt;A,B,C,D,E&gt; tuple(A a, B b, C c, D d, E e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple.FiveTuple&lt;A,B,C,D,E&gt;(a, b, c, d, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise28-java"><a href="#Exercise28-java" class="headerlink" title="Exercise28.java"></a>Exercise28.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Amphibian</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Amphibian</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Amphibian</span><span class="params">(String s)</span></span>&#123;name=s;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"Amphibian: "</span>+name;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Amphibian a)</span></span>&#123;<span class="keyword">return</span> name.compareTo(a.name);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Vehicle</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Vehicle</span><span class="params">(String s)</span></span>&#123;name=s;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"Vehicle: "</span>+name;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Vehicle v)</span></span>&#123;<span class="keyword">return</span> name.compareTo(v.name);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise28</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  测试</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">static</span> Tuple.TwoTuple&lt;String,Integer&gt; f() &#123;</span><br><span class="line">        <span class="keyword">return</span> Tuple.tuple(<span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="keyword">static</span> Tuple.<span class="function">TwoTuple <span class="title">f2</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> Tuple.tuple(<span class="string">"hi"</span>, <span class="number">47</span>); &#125;</span><br><span class="line">    <span class="keyword">static</span> Tuple.ThreeTuple&lt;Amphibian,String,Integer&gt; g() &#123;</span><br><span class="line">        <span class="keyword">return</span> Tuple.tuple(<span class="keyword">new</span> Amphibian(<span class="string">"AmphiToTo"</span>), <span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> Tuple.FourTuple&lt;Vehicle,Amphibian,String,Integer&gt; h() &#123;</span><br><span class="line">        <span class="keyword">return</span> Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiJiJi"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiPaPa"</span>), <span class="string">"hi"</span>, <span class="number">47</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> Tuple.FiveTuple&lt;Vehicle,Amphibian,String,Integer,Double&gt; k() &#123;</span><br><span class="line">        <span class="keyword">return</span> Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiBiuBiu"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiQQ"</span>), <span class="string">"hi"</span>, <span class="number">47</span>, <span class="number">11.1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Tuple.TwoTuple&lt;String,Integer&gt; ttsi = Exercise28.f();</span><br><span class="line">        System.out.println(ttsi);</span><br><span class="line">        System.out.println(Exercise28.f2());</span><br><span class="line">        System.out.println(Exercise28.g());</span><br><span class="line">        System.out.println(Exercise28.h());</span><br><span class="line">        System.out.println(Exercise28.k());</span><br><span class="line">       </span><br><span class="line">        Set&lt;Tuple.FiveTuple&lt;Vehicle,Amphibian,String,Integer,Double&gt;&gt; set=<span class="keyword">new</span> TreeSet&lt;Tuple.FiveTuple&lt;Vehicle,Amphibian,String,Integer,Double&gt;&gt;();</span><br><span class="line"></span><br><span class="line">        set.add(Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiBiuBiu"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiQQ"</span>), <span class="string">"hi"</span>, <span class="number">47</span>, <span class="number">11.1</span>));</span><br><span class="line">        set.add(Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiBiuBiu"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiQQ"</span>), <span class="string">"hi"</span>, <span class="number">47</span>, <span class="number">111.1</span>));</span><br><span class="line">        set.add(Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiBiuBiu"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiQQ"</span>), <span class="string">"hi"</span>, <span class="number">1000</span>, <span class="number">5555.5</span>));</span><br><span class="line">        set.add(Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiBiuBiu"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiQQ"</span>), <span class="string">"hello"</span>, <span class="number">433</span>, <span class="number">1234.5</span>));</span><br><span class="line">        set.add(Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiBiuBiu"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiBMW"</span>), <span class="string">"world"</span>, <span class="number">9</span>, <span class="number">865.8</span>));</span><br><span class="line">        set.add(Tuple.tuple(<span class="keyword">new</span> Vehicle(<span class="string">"VehiGoogle"</span>), <span class="keyword">new</span> Amphibian(<span class="string">"AmphiBenz"</span>), <span class="string">"Java"</span>, <span class="number">765</span>, <span class="number">11.1</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="package-com-ciaoshen-thinkinjava-chapter17-testframework"><a href="#package-com-ciaoshen-thinkinjava-chapter17-testframework" class="headerlink" title="package com.ciaoshen.thinkinjava.chapter17.testframework"></a>package com.ciaoshen.thinkinjava.chapter17.testframework</h4><p>练习29-33，依赖com.ciaoshen.thinkinjava.chapter17.testframework包中部分组件才能运行。这个包就是书中介绍的容器测试框架。具体组件如下：</p>
<h5 id="Test-java"><a href="#Test-java" class="headerlink" title="Test.java"></a>Test.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块1：封装测试类</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  每种测试一个类</span><br><span class="line"> *  有名字，有test()方法</span><br><span class="line"> *  test()方法给个容器，给点参数就能运行</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>&lt;<span class="title">C</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String name)</span></span>&#123;<span class="keyword">this</span>.name=name;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(C container, TestParam tp)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="TestParam-java"><a href="#TestParam-java" class="headerlink" title="TestParam.java"></a>TestParam.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块2：封装测试参数。</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  TestParam类负责批量解析原始数据，生成参数包。</span><br><span class="line"> *  每个参数包有两个参数：size-代表容器大小。loops-代表测试迭代次数。</span><br><span class="line"> *  两个array()方法切割参数包。</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestParam</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> loops;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestParam</span><span class="params">(<span class="keyword">int</span> size, <span class="keyword">int</span> loops)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size=size;</span><br><span class="line">        <span class="keyword">this</span>.loops=loops;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TestParam[] array(<span class="keyword">int</span>... values)&#123;</span><br><span class="line">        <span class="keyword">int</span> size=values.length/<span class="number">2</span>;</span><br><span class="line">        TestParam[] result=<span class="keyword">new</span> TestParam[size];</span><br><span class="line">        <span class="keyword">int</span> cursor=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            result[i]=<span class="keyword">new</span> TestParam(values[cursor++],values[cursor++]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TestParam[] array(String... values)&#123;</span><br><span class="line">        <span class="keyword">int</span>[] result=<span class="keyword">new</span> <span class="keyword">int</span>[values.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;values.length;i++)&#123;</span><br><span class="line">            result[i]=Integer.parseInt(values[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Tester-java"><a href="#Tester-java" class="headerlink" title="Tester.java"></a>Tester.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块3：运行测试工具包。</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  Tester类是负责运行Test测试类的单元。</span><br><span class="line"> *  用户调用run()方法。</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tester</span>&lt;<span class="title">C</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  构造函数</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tester</span><span class="params">(C container, List&lt;Test&lt;C&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.container = container;</span><br><span class="line">        <span class="keyword">this</span>.tests = tests;</span><br><span class="line">        <span class="keyword">if</span>(container != <span class="keyword">null</span>)</span><br><span class="line">            headline = container.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tester</span><span class="params">(C container, List&lt;Test&lt;C&gt;&gt; tests,</span><br><span class="line">                  TestParam[] paramList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(container, tests);</span><br><span class="line">        <span class="keyword">this</span>.paramList = paramList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  基本参数初始化相关域和方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TestParam[] defaultParams= TestParam.array(<span class="number">10</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">5000</span>, <span class="number">1000</span>, <span class="number">5000</span>, <span class="number">10000</span>, <span class="number">500</span>);</span><br><span class="line">    <span class="keyword">private</span> TestParam[] paramList = defaultParams;</span><br><span class="line">    <span class="keyword">protected</span> C container;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Test&lt;C&gt;&gt; tests;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> C <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123; <span class="keyword">return</span> container; &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  输出打印相关域和方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> String headline = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> fieldWidth = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> sizeWidth = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String sizeField = <span class="string">"%"</span> + sizeWidth + <span class="string">"s"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">stringField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%"</span> + fieldWidth + <span class="string">"s"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">numberField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%"</span> + fieldWidth + <span class="string">"d"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeadline</span><span class="params">(String newHeadline)</span> </span>&#123;</span><br><span class="line">        headline = newHeadline;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">displayHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> width = fieldWidth * tests.size() + sizeWidth;</span><br><span class="line">        <span class="keyword">int</span> dashLength = width - headline.length() - <span class="number">1</span>;</span><br><span class="line">        StringBuilder head = <span class="keyword">new</span> StringBuilder(width);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dashLength/<span class="number">2</span>; i++)</span><br><span class="line">            head.append(<span class="string">'-'</span>);</span><br><span class="line">        head.append(<span class="string">' '</span>);</span><br><span class="line">        head.append(headline);</span><br><span class="line">        head.append(<span class="string">' '</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dashLength/<span class="number">2</span>; i++)</span><br><span class="line">            head.append(<span class="string">'-'</span>);</span><br><span class="line">        System.out.println(head);</span><br><span class="line">        <span class="comment">// Print column headers:</span></span><br><span class="line">        System.out.format(sizeField, <span class="string">"size"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Test test : tests)</span><br><span class="line">            System.out.format(stringField(), test.name);</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  实际运行测试方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;C&gt; <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(C cntnr, List&lt;Test&lt;C&gt;&gt; tests)</span></span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Tester&lt;C&gt;(cntnr, tests).timedTest();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;C&gt; <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">(C cntnr, List&lt;Test&lt;C&gt;&gt; tests, TestParam[] paramList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Tester&lt;C&gt;(cntnr, tests, paramList).timedTest();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//最终执行者：对每组不同的参数配置，跑全套测试。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">timedTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        displayHeader();</span><br><span class="line">        <span class="keyword">for</span>(TestParam param : paramList) &#123;</span><br><span class="line">            System.out.format(sizeField, param.size);</span><br><span class="line">            <span class="keyword">for</span>(Test&lt;C&gt; test : tests) &#123;</span><br><span class="line">                C kontainer = initialize(param.size);</span><br><span class="line">                <span class="keyword">long</span> start = System.nanoTime();</span><br><span class="line">                <span class="comment">// Call the overriden method:</span></span><br><span class="line">                <span class="keyword">int</span> reps = test.test(kontainer, param);</span><br><span class="line">                <span class="keyword">long</span> duration = System.nanoTime() - start;</span><br><span class="line">                <span class="keyword">long</span> timePerRep = duration / reps; <span class="comment">// Nanoseconds</span></span><br><span class="line">                System.out.format(numberField(), timePerRep);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="package-com-ciaoshen-thinkinjava-chapter17-testframework-gen"><a href="#package-com-ciaoshen-thinkinjava-chapter17-testframework-gen" class="headerlink" title="package com.ciaoshen.thinkinjava.chapter17.testframework.gen"></a>package com.ciaoshen.thinkinjava.chapter17.testframework.gen</h4><p>练习29-33，也依赖com.ciaoshen.thinkinjava.chapter17.testframework.gen包中部分组件才能运行。gen包是用来自动生成测试用随机数据的工具包。具体组件如下：</p>
<h5 id="Generator-java"><a href="#Generator-java" class="headerlink" title="Generator.java"></a>Generator.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块4：模拟数据生成器</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="RandomGenerator-java-2"><a href="#RandomGenerator-java-2" class="headerlink" title="RandomGenerator.java"></a>RandomGenerator.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  RandomGenerator随机生成填充常用类型。</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Boolean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextBoolean();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Integer</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Integer</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Long</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Long</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextLong();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Short</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Short</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Short</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">short</span>)rand.nextInt((<span class="keyword">int</span>)java.lang.Short.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Float</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Float</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Float</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextFloat();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Double</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Double</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Double</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rand.nextDouble();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Byte</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Byte</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Byte</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">byte</span>[] b=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            rand.nextBytes(b);</span><br><span class="line">            <span class="keyword">return</span> b[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Charactor</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] CS=(<span class="string">"abcdefghijklmnopqrstuvwxyz"</span>+<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>).toCharArray();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Character</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Character</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> CS[rand.nextInt(CS.length)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> size=<span class="number">7</span>;</span><br><span class="line">        <span class="keyword">private</span> Generator&lt;java.lang.Character&gt; c=<span class="keyword">new</span> Character();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;<span class="keyword">this</span>.size=size;&#125;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">String <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                sb.append(c.next());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  测试</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[] args)</span></span>&#123;</span><br><span class="line">        RandomGenerator.String s=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        System.out.println(s.next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Generated-java"><a href="#Generated-java" class="headerlink" title="Generated.java"></a>Generated.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块4：模拟数据生成器</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Generated</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Fill an existing array:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T[] array(T[] a, Generator&lt;T&gt; gen) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CollectionData&lt;T&gt;(gen, a.length).toArray(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Create a new array:</span></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T[] array(Class&lt;T&gt; type, Generator&lt;T&gt; gen, <span class="keyword">int</span> size) &#123;</span><br><span class="line">        T[] a = (T[])java.lang.reflect.Array.newInstance(type, size);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CollectionData&lt;T&gt;(gen, size).toArray(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CountingIntegerList-java"><a href="#CountingIntegerList-java" class="headerlink" title="CountingIntegerList.java"></a>CountingIntegerList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块4：模拟数据生成器</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingIntegerList</span> <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountingIntegerList</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size &lt; <span class="number">0</span> ? <span class="number">0</span> : size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> CountingIntegerList(<span class="number">30</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CountingStringList-java"><a href="#CountingStringList-java" class="headerlink" title="CountingStringList.java"></a>CountingStringList.java</h5><p>com.ciaoshen.thinkinjava.chapter17.testframework.gen生成器包里还要加一个新的List<string>生成器。为了减小生成List本身时间上的影响，这个CountingStringList和CountingIntegerList一样是没有数据主体的。每次get()方法都随机生成一个String。</string></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingStringList</span> <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Generator&lt;java.lang.String&gt; rand=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountingStringList</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size &lt; <span class="number">0</span> ? <span class="number">0</span> : size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountingStringList</span><span class="params">(<span class="keyword">int</span> size, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size &lt; <span class="number">0</span> ? <span class="number">0</span> : size;</span><br><span class="line">        rand=<span class="keyword">new</span> RandomGenerator.String(length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rand.next();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> CountingStringList(<span class="number">30</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CountingGenerator-java"><a href="#CountingGenerator-java" class="headerlink" title="CountingGenerator.java"></a>CountingGenerator.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块4：模拟数据生成器</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountingGenerator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> value = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Boolean <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            value = !value; <span class="comment">// Just flips back and forth</span></span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Byte</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Byte</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">byte</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Byte <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value++; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span>[] chars = (<span class="string">"abcdefghijklmnopqrstuvwxyz"</span> + <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>).toCharArray();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Character</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Character</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Character <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            index = (index + <span class="number">1</span>) % chars.length;</span><br><span class="line">            <span class="keyword">return</span> chars[index];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> length = <span class="number">7</span>;</span><br><span class="line">        Generator&lt;java.lang.Character&gt; cg = <span class="keyword">new</span> Character();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">int</span> length)</span> </span>&#123; <span class="keyword">this</span>.length = length; &#125;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">String <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">char</span>[] buf = <span class="keyword">new</span> <span class="keyword">char</span>[length];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">                buf[i] = cg.next();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> java.lang.String(buf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Short</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Short</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">short</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Short <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value++; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Integer</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Integer <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value++; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Long</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Long <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value++; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Float</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Float</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">float</span> value = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Float <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">float</span> result = value;</span><br><span class="line">            value += <span class="number">1.0</span>;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Double</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">Double</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> value = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">public</span> java.lang.<span class="function">Double <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> result = value;</span><br><span class="line">            value += <span class="number">1.0</span>;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CollectionData-java"><a href="#CollectionData-java" class="headerlink" title="CollectionData.java"></a>CollectionData.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  容器测试框架</span><br><span class="line"> *  框架模块4：模拟数据生成器</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@SuppressWarnings</span>(<span class="string">"serial"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionData</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CollectionData</span><span class="params">(Generator&lt;T&gt; gen, <span class="keyword">int</span> quantity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; quantity; i++)</span><br><span class="line">            add(gen.next());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// A generic convenience method:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">CollectionData&lt;T&gt; <span class="title">list</span><span class="params">(Generator&lt;T&gt; gen, <span class="keyword">int</span> quantity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CollectionData&lt;T&gt;(gen, quantity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-29"><a href="#Exercise-29" class="headerlink" title="Exercise 29"></a>Exercise 29</h4><ul>
<li><strong>Exercise 29</strong>: (2) Modify ListPerformance.java so that the Lists hold String objects instead of Integers. Use a Generator from the Arrays chapter to create test values.</li>
</ul>
<h5 id="Exercise29-java"><a href="#Exercise29-java" class="headerlink" title="Exercise29.java"></a>Exercise29.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise29</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">static</span> Generator&lt;java.lang.String&gt; strRand = <span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> reps = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;List&lt;String&gt;&gt;&gt; tests = <span class="keyword">new</span> ArrayList&lt;Test&lt;List&lt;String&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;LinkedList&lt;String&gt;&gt;&gt; qTests = <span class="keyword">new</span> ArrayList&lt;Test&lt;LinkedList&lt;String&gt;&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  实际测试类在这里定义</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"add"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> listSize = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    list.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; listSize; j++)</span><br><span class="line">                        list.add(strRand.next());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * listSize;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"get"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * reps;</span><br><span class="line">                <span class="keyword">int</span> listSize = list.size();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    list.get(rand.nextInt(listSize));</span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"set"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * reps;</span><br><span class="line">                <span class="keyword">int</span> listSize = list.size();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    list.set(rand.nextInt(listSize), strRand.next());</span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"iteradd"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> LOOPS = <span class="number">1000000</span>;</span><br><span class="line">                <span class="keyword">int</span> half = list.size() / <span class="number">2</span>;</span><br><span class="line">                ListIterator&lt;String&gt; it = list.listIterator(half);</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LOOPS; i++)</span><br><span class="line">                    it.add(strRand.next());</span><br><span class="line">                <span class="keyword">return</span> LOOPS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"insert"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    list.add(<span class="number">5</span>, strRand.next()); <span class="comment">// Minimize random-access cost</span></span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"remove"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    list.clear();</span><br><span class="line">                    list.addAll(<span class="keyword">new</span> CountingStringList(size));</span><br><span class="line">                    <span class="keyword">while</span>(list.size() &gt; <span class="number">5</span>)</span><br><span class="line">                        list.remove(<span class="number">5</span>); <span class="comment">// Minimize random-access cost</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// Tests for queue behavior:</span></span><br><span class="line">        qTests.add(<span class="keyword">new</span> Test&lt;LinkedList&lt;String&gt;&gt;(<span class="string">"addFirst"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(LinkedList&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    list.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++)</span><br><span class="line">                        list.addFirst(strRand.next());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        qTests.add(<span class="keyword">new</span> Test&lt;LinkedList&lt;String&gt;&gt;(<span class="string">"addLast"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(LinkedList&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    list.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++)</span><br><span class="line">                        list.addLast(strRand.next());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        qTests.add(<span class="keyword">new</span> Test&lt;LinkedList&lt;String&gt;&gt;(<span class="string">"rmFirst"</span>) &#123;</span><br><span class="line">                       <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(LinkedList&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                           <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                           <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                           <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                               list.clear();</span><br><span class="line">                               list.addAll(<span class="keyword">new</span> CountingStringList(size));</span><br><span class="line">                               <span class="keyword">while</span>(list.size() &gt; <span class="number">0</span>)</span><br><span class="line">                                   list.removeFirst();</span><br><span class="line">                           &#125;</span><br><span class="line">                           <span class="keyword">return</span> loops * size;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line">        qTests.add(<span class="keyword">new</span> Test&lt;LinkedList&lt;String&gt;&gt;(<span class="string">"rmLast"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(LinkedList&lt;String&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    list.clear();</span><br><span class="line">                    list.addAll(<span class="keyword">new</span> CountingStringList(size));</span><br><span class="line">                    <span class="keyword">while</span>(list.size() &gt; <span class="number">0</span>)</span><br><span class="line">                        list.removeLast();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ListTester</span> <span class="keyword">extends</span> <span class="title">Tester</span>&lt;<span class="title">List</span>&lt;<span class="title">String</span>&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ListTester</span><span class="params">(List&lt;String&gt; container, List&lt;Test&lt;List&lt;String&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">            container.clear();</span><br><span class="line">            container.addAll(<span class="keyword">new</span> CountingStringList(size));</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(List&lt;String&gt; list, List&lt;Test&lt;List&lt;String&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">new</span> ListTester(list, tests).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;</span><br><span class="line">        Tester&lt;List&lt;String&gt;&gt; arrayTest = <span class="keyword">new</span> Tester&lt;List&lt;String&gt;&gt;(<span class="keyword">null</span>, tests.subList(<span class="number">1</span>, <span class="number">3</span>))&#123;</span><br><span class="line">            <span class="annotation">@Override</span> <span class="function"><span class="keyword">protected</span></span><br><span class="line">            List&lt;String&gt; <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">                String[] ia = Generated.array(String.class, <span class="keyword">new</span> CountingGenerator.String(), size);</span><br><span class="line">                <span class="keyword">return</span> Arrays.asList(ia);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        arrayTest.setHeadline(<span class="string">"Array as List"</span>);</span><br><span class="line">        arrayTest.timedTest();</span><br><span class="line">        Tester.defaultParams= TestParam.array(<span class="number">10</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">5000</span>, <span class="number">1000</span>, <span class="number">1000</span>, <span class="number">10000</span>, <span class="number">200</span>);</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;</span><br><span class="line">        ListTester.run(<span class="keyword">new</span> ArrayList&lt;String&gt;(), tests);</span><br><span class="line">        ListTester.run(<span class="keyword">new</span> LinkedList&lt;String&gt;(), tests);</span><br><span class="line">        ListTester.run(<span class="keyword">new</span> Vector&lt;String&gt;(), tests);</span><br><span class="line">        Tester.fieldWidth = <span class="number">12</span>;</span><br><span class="line">        Tester&lt;LinkedList&lt;String&gt;&gt; qTest = <span class="keyword">new</span> Tester&lt;LinkedList&lt;String&gt;&gt;(<span class="keyword">new</span> LinkedList&lt;String&gt;(), qTests);</span><br><span class="line">        qTest.setHeadline(<span class="string">"Queue tests"</span>);</span><br><span class="line">        qTest.timedTest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-30"><a href="#Exercise-30" class="headerlink" title="Exercise 30"></a>Exercise 30</h4><ul>
<li><strong>Exercise 30</strong>: (3) Compare the performance of Collections.sort( ) between an ArrayList and a LinkedList.<br>ArrayList和LinkedList在较大规模的测试下，效率基本一致。</li>
</ul>
<p>因为，Collections.sort()的源码是把List统一转换成数组，然后用Arrays.sort()来排序的。所以两个效率的差距只有前面转换成数组的效率高低。后面排序完全一样。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise30</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;List&lt;String&gt;&gt;&gt; tests=<span class="keyword">new</span> ArrayList&lt;Test&lt;List&lt;String&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> TestParam[] params= TestParam.array(<span class="number">10</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">10</span>, <span class="number">1000</span>, <span class="number">10</span>, <span class="number">2000</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"sort"</span>)&#123;</span><br><span class="line">            String name=<span class="string">"sort"</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; container, TestParam tp)</span></span>&#123;</span><br><span class="line">                <span class="keyword">int</span> size=tp.size;</span><br><span class="line">                <span class="keyword">int</span> loops=tp.loops;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;loops;i++)&#123;</span><br><span class="line">                    container.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                        container.addAll(<span class="keyword">new</span> CountingStringList(size,<span class="number">5</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                    Collections.sort(container);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> size*loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Tester.run(<span class="keyword">new</span> ArrayList&lt;String&gt;(),tests,params);</span><br><span class="line">        Tester.run(<span class="keyword">new</span> LinkedList&lt;String&gt;(),tests,params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- ArrayList -</span><br><span class="line"> size    sort</span><br><span class="line">   <span class="number">10</span>   <span class="number">14125</span></span><br><span class="line">  <span class="number">100</span>   <span class="number">39813</span></span><br><span class="line"> <span class="number">1000</span>  <span class="number">294339</span></span><br><span class="line"><span class="number">10000</span> <span class="number">3639676</span></span><br><span class="line">- LinkedList -</span><br><span class="line"> size    sort</span><br><span class="line">   <span class="number">10</span>    <span class="number">3246</span></span><br><span class="line">  <span class="number">100</span>   <span class="number">24711</span></span><br><span class="line"> <span class="number">1000</span>  <span class="number">306514</span></span><br><span class="line"><span class="number">10000</span> <span class="number">4026489</span></span><br></pre></td></tr></table></figure>
<p>但这个测试的结果中，container.addAll(）对List填充这一步的时间也被计算到运行时间里。对结果的影响比较大。<br>不排序，光填充的时间：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- ArrayList -</span><br><span class="line"> size    sort</span><br><span class="line">   <span class="number">10</span>   <span class="number">12761</span></span><br><span class="line">  <span class="number">100</span>   <span class="number">18892</span></span><br><span class="line"> <span class="number">1000</span>  <span class="number">169804</span></span><br><span class="line"><span class="number">10000</span> <span class="number">1349499</span></span><br><span class="line">- LinkedList -</span><br><span class="line"> size    sort</span><br><span class="line">   <span class="number">10</span>    <span class="number">1858</span></span><br><span class="line">  <span class="number">100</span>   <span class="number">14822</span></span><br><span class="line"> <span class="number">1000</span>  <span class="number">139999</span></span><br><span class="line"><span class="number">10000</span> <span class="number">1406752</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Exercise-31"><a href="#Exercise-31" class="headerlink" title="Exercise 31"></a>Exercise 31</h4><ul>
<li><strong>Exercise 31</strong>: (5) Create a container that encapsulates an array of String, and that only allows adding Strings and getting Strings, so that there are no casting issues during use. If the internal array isn’t big enough for the next add, your container should automatically resize it. In main( ), compare the performance of your container with an ArrayList<string>.</string></li>
</ul>
<h5 id="StringList-java"><a href="#StringList-java" class="headerlink" title="StringList.java"></a>StringList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringList</span> <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> String[] list;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> max=SIZE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> cursor=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list=<span class="keyword">new</span> String[max];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringList</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">        max=size;</span><br><span class="line">        list=<span class="keyword">new</span> String[max];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//add last</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(String s)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cursor==max)&#123;</span><br><span class="line">            resize();</span><br><span class="line">        &#125;</span><br><span class="line">        list[cursor]=s;</span><br><span class="line">        cursor++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//get first</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size()==<span class="number">0</span>? <span class="keyword">null</span>:list[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index&lt;<span class="number">0</span> || index&gt;=max)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list[index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//size*2</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span></span>&#123;</span><br><span class="line">        max*=<span class="number">2</span>;</span><br><span class="line">        String[] newList=Arrays.copyOf(list,max);</span><br><span class="line">        list=newList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cursor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list=<span class="keyword">new</span> String[SIZE];</span><br><span class="line">        max=SIZE;</span><br><span class="line">        cursor=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> StringList();</span><br><span class="line">        list.addAll(<span class="keyword">new</span> CountingStringList(<span class="number">50</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> index=rand.nextInt(<span class="number">50</span>);</span><br><span class="line">            System.out.println(<span class="string">"String No."</span>+index+<span class="string">":    "</span>+list.get(index));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise31-java"><a href="#Exercise31-java" class="headerlink" title="Exercise31.java"></a>Exercise31.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise31</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;List&lt;String&gt;&gt;&gt; tests=<span class="keyword">new</span> ArrayList&lt;Test&lt;List&lt;String&gt;&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"add"</span>)&#123;</span><br><span class="line">            String name=<span class="string">"sort"</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; container, TestParam tp)</span></span>&#123;</span><br><span class="line">                <span class="keyword">int</span> size=tp.size;</span><br><span class="line">                <span class="keyword">int</span> loops=tp.loops;</span><br><span class="line">                Generator&lt;String&gt; gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;loops;i++)&#123;</span><br><span class="line">                    container.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                        container.add(gen.next());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> size*loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;String&gt;&gt;(<span class="string">"get"</span>)&#123;</span><br><span class="line">            String name=<span class="string">"sort"</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;String&gt; container, TestParam tp)</span></span>&#123;</span><br><span class="line">                <span class="keyword">int</span> size=tp.size;</span><br><span class="line">                <span class="keyword">int</span> loops=tp.loops;</span><br><span class="line">                Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">                container.addAll(<span class="keyword">new</span> CountingStringList(size,<span class="number">5</span>));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;loops;i++)&#123;</span><br><span class="line">                    container.get(rand.nextInt(size));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Tester.run(<span class="keyword">new</span> ArrayList&lt;String&gt;(),tests);</span><br><span class="line">        Tester.run(<span class="keyword">new</span> StringList(),tests);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h5><p>不泛型的简单StringList和ArrayList比，add()方法差不多，get()方法快一倍多。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">----- ArrayList -----</span><br><span class="line"> size     add     get</span><br><span class="line">   <span class="number">10</span>    <span class="number">1115</span>     <span class="number">579</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">229</span>     <span class="number">173</span></span><br><span class="line"> <span class="number">1000</span>     <span class="number">211</span>     <span class="number">362</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">180</span>   <span class="number">11722</span></span><br><span class="line">----- StringList -----</span><br><span class="line"> size     add     get</span><br><span class="line">   <span class="number">10</span>     <span class="number">409</span>     <span class="number">187</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">193</span>      <span class="number">78</span></span><br><span class="line"> <span class="number">1000</span>     <span class="number">176</span>     <span class="number">101</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">175</span>    <span class="number">4020</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-32"><a href="#Exercise-32" class="headerlink" title="Exercise 32"></a>Exercise 32</h4><ul>
<li><strong>Exercise 32</strong>: (2) Repeat the previous exercise for a container of int, and compare the performance to an ArrayList<integer>. In your performance comparison, include the process of incrementing each object in the container.</integer></li>
</ul>
<h5 id="IntList-java"><a href="#IntList-java" class="headerlink" title="IntList.java"></a>IntList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntList</span> <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] list;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> max=SIZE;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> cursor=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IntList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list=<span class="keyword">new</span> <span class="keyword">int</span>[max];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IntList</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">        max=size;</span><br><span class="line">        list=<span class="keyword">new</span> <span class="keyword">int</span>[max];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//add last</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Integer i)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cursor==max)&#123;</span><br><span class="line">            resize();</span><br><span class="line">        &#125;</span><br><span class="line">        list[cursor]=i;</span><br><span class="line">        cursor++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//get first</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size()==<span class="number">0</span>? <span class="keyword">null</span>:list[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index&lt;<span class="number">0</span> || index&gt;=max)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list[index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, Integer i)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index&lt;<span class="number">0</span> || index&gt;=max)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list[index]=i;</span><br><span class="line">        <span class="keyword">return</span> list[index];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//size*2</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span></span>&#123;</span><br><span class="line">        max*=<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span>[] newList=Arrays.copyOf(list,max);</span><br><span class="line">        list=newList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cursor;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list=<span class="keyword">new</span> <span class="keyword">int</span>[SIZE];</span><br><span class="line">        max=SIZE;</span><br><span class="line">        cursor=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> IntList();</span><br><span class="line">        list.addAll(<span class="keyword">new</span> CountingIntegerList(<span class="number">50</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> index=rand.nextInt(<span class="number">50</span>);</span><br><span class="line">            System.out.println(<span class="string">"Int No."</span>+index+<span class="string">":    "</span>+list.get(index));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise32-java"><a href="#Exercise32-java" class="headerlink" title="Exercise32.java"></a>Exercise32.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise32</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;List&lt;Integer&gt;&gt;&gt; tests=<span class="keyword">new</span> ArrayList&lt;Test&lt;List&lt;Integer&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"add"</span>)&#123;</span><br><span class="line">            String name=<span class="string">"sort"</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; container, TestParam tp)</span></span>&#123;</span><br><span class="line">                <span class="keyword">int</span> size=tp.size;</span><br><span class="line">                <span class="keyword">int</span> loops=tp.loops;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;loops;i++)&#123;</span><br><span class="line">                    container.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                        container.add(rand.nextInt(size));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> size*loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"get"</span>)&#123;</span><br><span class="line">            String name=<span class="string">"sort"</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; container, TestParam tp)</span></span>&#123;</span><br><span class="line">                <span class="keyword">int</span> size=tp.size;</span><br><span class="line">                <span class="keyword">int</span> loops=tp.loops;</span><br><span class="line">                Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">                container.addAll(<span class="keyword">new</span> CountingIntegerList(size));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;loops;i++)&#123;</span><br><span class="line">                    container.get(rand.nextInt(size));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"plus"</span>)&#123;</span><br><span class="line">            String name=<span class="string">"sort"</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; container, TestParam tp)</span></span>&#123;</span><br><span class="line">                <span class="keyword">int</span> size=tp.size;</span><br><span class="line">                <span class="keyword">int</span> loops=tp.loops;</span><br><span class="line">                Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">                container.addAll(<span class="keyword">new</span> CountingIntegerList(size));</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;loops;i++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">                        container.set(j,container.get(j)+<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops*size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Tester.run(<span class="keyword">new</span> ArrayList&lt;Integer&gt;(),tests);</span><br><span class="line">        Tester.run(<span class="keyword">new</span> IntList(),tests);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">--------- ArrayList ---------</span><br><span class="line"> size     add     get    plus</span><br><span class="line">   <span class="number">10</span>     <span class="number">193</span>     <span class="number">312</span>     <span class="number">221</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">38</span>      <span class="number">68</span>      <span class="number">30</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">22</span>     <span class="number">154</span>      <span class="number">10</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">15</span>    <span class="number">1762</span>      <span class="number">10</span></span><br><span class="line">---------- IntList ----------</span><br><span class="line"> size     add     get    plus</span><br><span class="line">   <span class="number">10</span>      <span class="number">61</span>     <span class="number">137</span>     <span class="number">234</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">24</span>      <span class="number">67</span>      <span class="number">41</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">20</span>      <span class="number">80</span>       <span class="number">8</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">27</span>    <span class="number">3006</span>       <span class="number">7</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-33"><a href="#Exercise-33" class="headerlink" title="Exercise 33"></a>Exercise 33</h4><ul>
<li><strong>Exercise 33</strong>: (5) Create a FastTraversalLinkedList that internally uses a LinkedList for rapid insertions and removals, and an ArrayList for rapid traversals and get( ) operations. Test it by modifying ListPerformance.java.</li>
</ul>
<ol>
<li>插入，移除用LinkdList</li>
<li>遍历，set(),get()用ArrayList</li>
<li>ListIterator(int index)接口用来返回LinkedList的迭代器</li>
<li>iterator()接口用来返回ArrayList的迭代器</li>
</ol>
<h5 id="FastTraversalLinkedList-java"><a href="#FastTraversalLinkedList-java" class="headerlink" title="FastTraversalLinkedList.java"></a>FastTraversalLinkedList.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@SuppressWarnings</span>(<span class="string">"serial"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastTraversalLinkedList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;E&gt; list=<span class="keyword">new</span> ArrayList&lt;E&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">synArrayList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        list.clear();</span><br><span class="line">        ListIterator&lt;E&gt; ite=listIterator(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            list.add(ite.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">synLinkedList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        clear();</span><br><span class="line">        ListIterator&lt;E&gt; ite=listIterator(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            add(ite.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  四个用ArrayList的方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> list.isEmpty()? <span class="keyword">null</span>:list.iterator();&#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.isEmpty()? <span class="keyword">null</span>:list.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.size()&gt;index?  list.set(index,element):<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise33-java"><a href="#Exercise33-java" class="headerlink" title="Exercise33.java"></a>Exercise33.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise33</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> reps = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;List&lt;Integer&gt;&gt;&gt; tests = <span class="keyword">new</span> ArrayList&lt;Test&lt;List&lt;Integer&gt;&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  实际测试类在这里定义</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  用LinkedList的3个方法</span><br><span class="line">         */</span></span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"add"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> listSize = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    list.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; listSize; j++)</span><br><span class="line">                        list.add(j);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * listSize;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"insert"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    list.add(<span class="number">5</span>, <span class="number">47</span>); <span class="comment">// Minimize random-access cost</span></span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"remove"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    list.clear();</span><br><span class="line">                    list.addAll(<span class="keyword">new</span> CountingIntegerList(size));</span><br><span class="line">                    <span class="keyword">while</span>(list.size() &gt; <span class="number">5</span>)</span><br><span class="line">                        list.remove(<span class="number">5</span>); <span class="comment">// Minimize random-access cost</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         *  用ArrayList的4个方法</span><br><span class="line">         */</span></span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"get"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * reps;</span><br><span class="line">                <span class="keyword">int</span> listSize = list.size();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    list.get(rand.nextInt(listSize));</span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"set"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * reps;</span><br><span class="line">                <span class="keyword">int</span> listSize = list.size();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    list.set(rand.nextInt(listSize), <span class="number">47</span>);</span><br><span class="line">                <span class="keyword">return</span> loops;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;List&lt;Integer&gt;&gt;(<span class="string">"iter"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(List&lt;Integer&gt; list, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = list.size();</span><br><span class="line">                Iterator&lt;Integer&gt; it = list.iterator();</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)&#123;</span><br><span class="line">                    <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">                        it.next();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops*size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ListTester</span> <span class="keyword">extends</span> <span class="title">Tester</span>&lt;<span class="title">List</span>&lt;<span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ListTester</span><span class="params">(List&lt;Integer&gt; container, List&lt;Test&lt;List&lt;Integer&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"uchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> List&lt;Integer&gt; <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">            container.clear();</span><br><span class="line">            container.addAll(<span class="keyword">new</span> CountingIntegerList(size));</span><br><span class="line">            <span class="keyword">if</span>(container <span class="keyword">instanceof</span> FastTraversalLinkedList)&#123;</span><br><span class="line">                ((FastTraversalLinkedList)container).synArrayList();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(List&lt;Integer&gt; list, List&lt;Test&lt;List&lt;Integer&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">new</span> ListTester(list, tests).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;</span><br><span class="line">        Tester.defaultParams= TestParam.array(<span class="number">10</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">5000</span>, <span class="number">1000</span>, <span class="number">1000</span>, <span class="number">10000</span>, <span class="number">200</span>);</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;</span><br><span class="line">        ListTester.run(<span class="keyword">new</span> ArrayList&lt;Integer&gt;(), tests);</span><br><span class="line">        ListTester.run(<span class="keyword">new</span> LinkedList&lt;Integer&gt;(), tests);</span><br><span class="line">        ListTester.run(<span class="keyword">new</span> FastTraversalLinkedList&lt;Integer&gt;(), tests);</span><br><span class="line">        Tester.fieldWidth = <span class="number">12</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h5><p>虽然测试成绩是各取ArrayList和LinkedList的优点，但实际使用的时候因为有synchronize同步两个列表的开销，所以综合开销还是不沾优的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">--------------------- ArrayList ---------------------</span><br><span class="line"> size     add  insert  remove     get     <span class="built_in">set</span>    iter</span><br><span class="line">   <span class="number">10</span>      <span class="number">91</span>    <span class="number">1172</span>     <span class="number">245</span>      <span class="number">15</span>      <span class="number">14</span>       <span class="number">8</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">13</span>     <span class="number">290</span>      <span class="number">31</span>      <span class="number">14</span>      <span class="number">15</span>       <span class="number">0</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">16</span>     <span class="number">198</span>      <span class="number">93</span>      <span class="number">11</span>      <span class="number">13</span>       <span class="number">0</span></span><br><span class="line"><span class="number">10000</span>       <span class="number">8</span>    <span class="number">1605</span>     <span class="number">497</span>      <span class="number">12</span>      <span class="number">17</span>       <span class="number">0</span></span><br><span class="line">--------------------- LinkedList ---------------------</span><br><span class="line"> size     add  insert  remove     get     <span class="built_in">set</span>    iter</span><br><span class="line">   <span class="number">10</span>     <span class="number">110</span>     <span class="number">322</span>     <span class="number">110</span>      <span class="number">32</span>      <span class="number">27</span>      <span class="number">10</span></span><br><span class="line">  <span class="number">100</span>       <span class="number">8</span>     <span class="number">119</span>      <span class="number">14</span>      <span class="number">41</span>      <span class="number">41</span>       <span class="number">0</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">10</span>      <span class="number">61</span>      <span class="number">15</span>     <span class="number">379</span>     <span class="number">374</span>       <span class="number">2</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">18</span>      <span class="number">75</span>      <span class="number">19</span>    <span class="number">4720</span>    <span class="number">4428</span>       <span class="number">0</span></span><br><span class="line">-------------- FastTraversalLinkedList --------------</span><br><span class="line"> size     add  insert  remove     get     <span class="built_in">set</span>    iter</span><br><span class="line">   <span class="number">10</span>      <span class="number">70</span>      <span class="number">87</span>      <span class="number">30</span>      <span class="number">14</span>      <span class="number">15</span>       <span class="number">3</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">11</span>      <span class="number">58</span>      <span class="number">21</span>      <span class="number">14</span>      <span class="number">15</span>       <span class="number">0</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">29</span>      <span class="number">80</span>      <span class="number">35</span>      <span class="number">13</span>      <span class="number">12</span>       <span class="number">0</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">17</span>      <span class="number">64</span>      <span class="number">21</span>      <span class="number">12</span>      <span class="number">13</span>       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-34"><a href="#Exercise-34" class="headerlink" title="Exercise 34"></a>Exercise 34</h4><ul>
<li><strong>Exercise 34</strong>: (1) Modify SetPerformance.java so that the Sets hold String objects instead of Integers. Use a Generator from the Arrays chapter to create test values.</li>
</ul>
<h5 id="Exercise34-java"><a href="#Exercise34-java" class="headerlink" title="Exercise34.java"></a>Exercise34.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise34</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;Set&lt;String&gt;&gt;&gt; tests = <span class="keyword">new</span> ArrayList&lt;Test&lt;Set&lt;String&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> Generator&lt;String&gt; gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Set&lt;String&gt;&gt;(<span class="string">"add"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Set&lt;String&gt; set, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    set.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++)</span><br><span class="line">                        set.add(gen.next());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Set&lt;String&gt;&gt;(<span class="string">"contains"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Set&lt;String&gt; set, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> span = tp.size * <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; span; j++)</span><br><span class="line">                        set.contains(<span class="string">"xxxxxxx"</span>);</span><br><span class="line">                <span class="keyword">return</span> loops * span;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Set&lt;String&gt;&gt;(<span class="string">"iterate"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Set&lt;String&gt; set, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    Iterator&lt;String&gt; it = set.iterator();</span><br><span class="line">                    <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">                        it.next();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * set.size();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Tester34</span> <span class="keyword">extends</span> <span class="title">Tester</span>&lt;<span class="title">Set</span>&lt;<span class="title">String</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester34</span><span class="params">(Set&lt;String&gt; container, List&lt;Test&lt;Set&lt;String&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester34</span><span class="params">(Set&lt;String&gt; container, List&lt;Test&lt;Set&lt;String&gt;&gt;&gt; tests, TestParam[] paramList)</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests, paramList);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Set&lt;String&gt; cntnr, List&lt;Test&lt;Set&lt;String&gt;&gt;&gt; tests)</span></span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester34(cntnr, tests).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Set&lt;String&gt; cntnr, List&lt;Test&lt;Set&lt;String&gt;&gt;&gt; tests, TestParam[] paramList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester34(cntnr, tests, paramList).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Set&lt;String&gt; <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">            Generator&lt;String&gt; gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                container.add(gen.next());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;</span><br><span class="line">        Tester34.fieldWidth = <span class="number">10</span>;</span><br><span class="line">        Tester34.run(<span class="keyword">new</span> TreeSet&lt;String&gt;(), tests);</span><br><span class="line">        Tester34.run(<span class="keyword">new</span> HashSet&lt;String&gt;(), tests);</span><br><span class="line">        Tester34.run(<span class="keyword">new</span> LinkedHashSet&lt;String&gt;(), tests);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试结果-1"><a href="#测试结果-1" class="headerlink" title="测试结果"></a>测试结果</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">------------- TreeSet -------------</span><br><span class="line"> size       add  contains   iterate</span><br><span class="line">   <span class="number">10</span>      <span class="number">1538</span>        <span class="number">71</span>        <span class="number">39</span></span><br><span class="line">  <span class="number">100</span>       <span class="number">325</span>        <span class="number">29</span>         <span class="number">6</span></span><br><span class="line"> <span class="number">1000</span>       <span class="number">312</span>        <span class="number">39</span>         <span class="number">8</span></span><br><span class="line"><span class="number">10000</span>       <span class="number">412</span>        <span class="number">49</span>        <span class="number">20</span></span><br><span class="line">------------- HashSet -------------</span><br><span class="line"> size       add  contains   iterate</span><br><span class="line">   <span class="number">10</span>       <span class="number">478</span>        <span class="number">63</span>        <span class="number">89</span></span><br><span class="line">  <span class="number">100</span>       <span class="number">190</span>        <span class="number">12</span>         <span class="number">7</span></span><br><span class="line"> <span class="number">1000</span>       <span class="number">180</span>         <span class="number">4</span>         <span class="number">8</span></span><br><span class="line"><span class="number">10000</span>       <span class="number">199</span>         <span class="number">2</span>        <span class="number">14</span></span><br><span class="line">---------- LinkedHashSet ----------</span><br><span class="line"> size       add  contains   iterate</span><br><span class="line">   <span class="number">10</span>       <span class="number">279</span>        <span class="number">52</span>        <span class="number">25</span></span><br><span class="line">  <span class="number">100</span>       <span class="number">193</span>         <span class="number">5</span>         <span class="number">7</span></span><br><span class="line"> <span class="number">1000</span>       <span class="number">200</span>         <span class="number">5</span>         <span class="number">6</span></span><br><span class="line"><span class="number">10000</span>       <span class="number">202</span>         <span class="number">7</span>        <span class="number">11</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-35"><a href="#Exercise-35" class="headerlink" title="Exercise 35"></a>Exercise 35</h4><ul>
<li><strong>Exercise 35</strong>: (1) Modify MapPerformance.java to include tests of SlowMap.</li>
</ul>
<p>SlowMap真的非常慢。</p>
<h5 id="Exercise35-java"><a href="#Exercise35-java" class="headerlink" title="Exercise35.java"></a>Exercise35.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise35</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests = <span class="keyword">new</span> ArrayList&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"put"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    map.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++)</span><br><span class="line">                        map.put(j, j);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"get"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> span = tp.size * <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; span; j++)</span><br><span class="line">                        map.get(j);</span><br><span class="line">                <span class="keyword">return</span> loops * span;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"iterate"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i ++) &#123;</span><br><span class="line">                    Iterator&lt;Map.Entry&lt;Integer,Integer&gt;&gt; it = map.entrySet().iterator();</span><br><span class="line">                    <span class="keyword">while</span>(it.hasNext())</span><br><span class="line">                        it.next();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * map.size();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Tester35</span> <span class="keyword">extends</span> <span class="title">Tester</span>&lt;<span class="title">Map</span>&lt;<span class="title">Integer</span>,<span class="title">Integer</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester35</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester35</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests, paramList);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span></span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester35(cntnr, tests).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester35(cntnr, tests, paramList).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Map&lt;Integer,Integer&gt; initialize(<span class="keyword">int</span> size)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                container.put(i,i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;</span><br><span class="line">        Tester35.defaultParams= TestParam.array(<span class="number">10</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">1000</span>, <span class="number">10000</span>, <span class="number">20</span>);</span><br><span class="line">        Tester35.run(<span class="keyword">new</span> TreeMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester35.run(<span class="keyword">new</span> HashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester35.run(<span class="keyword">new</span> LinkedHashMap&lt;Integer,Integer&gt;(),tests);</span><br><span class="line">        Tester35.run(</span><br><span class="line">                     <span class="keyword">new</span> IdentityHashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester35.run(<span class="keyword">new</span> WeakHashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester35.run(<span class="keyword">new</span> Hashtable&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester35.run(<span class="keyword">new</span> BetterSlowMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester35.run(<span class="keyword">new</span> SortedSlowMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试结果-2"><a href="#测试结果-2" class="headerlink" title="测试结果"></a>测试结果</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">---------- TreeMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">424</span>      <span class="number">98</span>      <span class="number">32</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">60</span>      <span class="number">26</span>       <span class="number">8</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">69</span>      <span class="number">46</span>       <span class="number">5</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">94</span>      <span class="number">58</span>       <span class="number">8</span></span><br><span class="line">---------- HashMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">205</span>      <span class="number">97</span>      <span class="number">71</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">10</span>       <span class="number">3</span>       <span class="number">8</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">16</span>       <span class="number">5</span>       <span class="number">5</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">15</span>       <span class="number">5</span>       <span class="number">6</span></span><br><span class="line">------- LinkedHashMap -------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">290</span>      <span class="number">46</span>      <span class="number">14</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">32</span>      <span class="number">11</span>       <span class="number">7</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">26</span>      <span class="number">10</span>       <span class="number">6</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">27</span>      <span class="number">11</span>       <span class="number">6</span></span><br><span class="line">------ IdentityHashMap ------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>      <span class="number">89</span>      <span class="number">33</span>      <span class="number">24</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">20</span>      <span class="number">41</span>      <span class="number">15</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">81</span>      <span class="number">84</span>      <span class="number">16</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">95</span>     <span class="number">133</span>      <span class="number">16</span></span><br><span class="line">-------- WeakHashMap --------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">126</span>      <span class="number">57</span>      <span class="number">28</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">42</span>       <span class="number">7</span>      <span class="number">10</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">29</span>      <span class="number">10</span>      <span class="number">14</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">25</span>      <span class="number">11</span>      <span class="number">16</span></span><br><span class="line">--------- Hashtable ---------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>      <span class="number">63</span>      <span class="number">37</span>      <span class="number">21</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">53</span>      <span class="number">22</span>       <span class="number">9</span></span><br><span class="line"> <span class="number">1000</span>      <span class="number">28</span>      <span class="number">27</span>       <span class="number">8</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">30</span>      <span class="number">23</span>       <span class="number">9</span></span><br><span class="line">---------- SlowMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">316</span>     <span class="number">135</span>      <span class="number">53</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">195</span>     <span class="number">120</span>      <span class="number">12</span></span><br><span class="line"> <span class="number">1000</span>    <span class="number">1334</span>     <span class="number">820</span>      <span class="number">11</span></span><br><span class="line"><span class="number">10000</span>   <span class="number">15946</span>    <span class="number">8691</span>      <span class="number">11</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-36"><a href="#Exercise-36" class="headerlink" title="Exercise 36"></a>Exercise 36</h4><ul>
<li><strong>Exercise 36</strong>: (5) Modify SlowMap so that instead of two ArrayLists, it holds a single ArrayList of MapEntry objects. Verify that the modified version works correctly. Using MapPerformance.java, test the speed of your new Map. Now change the put( ) method so that it performs a sort( ) after each pair is entered, and modify get( ) to use Collections.binarySearch( ) to look up the key. Compare the performance of the new version with the old ones.</li>
</ul>
<h5 id="BetterSlowMap-java"><a href="#BetterSlowMap-java" class="headerlink" title="BetterSlowMap.java"></a>BetterSlowMap.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BetterSlowMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MPair</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> K key;</span><br><span class="line">        <span class="keyword">private</span> V value;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MPair</span><span class="params">(K k, V v)</span></span>&#123;key=k;value=v;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> key;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> value;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span></span>&#123;V old=value;value=v;<span class="keyword">return</span> old;&#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(! (o <span class="keyword">instanceof</span> Map.Entry))&#123;<span class="keyword">return</span> <span class="keyword">false</span>;&#125;</span><br><span class="line">            Map.Entry&lt;K,V&gt; entry=(Map.Entry&lt;K,V&gt;)o;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            (key==<span class="keyword">null</span>? entry.getKey()==<span class="keyword">null</span> : entry.getKey().equals(key))</span><br><span class="line">            &amp;&amp;</span><br><span class="line">            (value==<span class="keyword">null</span>? entry.getValue()==<span class="keyword">null</span> : entry.getValue().equals(value));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">int</span> hash=<span class="number">17</span>*<span class="number">37</span>;</span><br><span class="line">            hash+= (key==<span class="keyword">null</span>)? <span class="number">0</span>:key.hashCode();</span><br><span class="line">            hash*=<span class="number">37</span>;</span><br><span class="line">            hash+= (value==<span class="keyword">null</span>)? <span class="number">0</span>:value.hashCode();</span><br><span class="line">            <span class="keyword">return</span> hash;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;Map.Entry&lt;K,V&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue=<span class="keyword">null</span>;</span><br><span class="line">        Map.Entry&lt;K,V&gt; entry=<span class="keyword">new</span> MPair&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">int</span> index=list.indexOf(entry);</span><br><span class="line">        <span class="keyword">if</span>(index==-<span class="number">1</span>)&#123;</span><br><span class="line">            list.add(entry);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            oldValue=list.get(index).getValue();</span><br><span class="line">            list.set(index,entry);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        V value=<span class="keyword">null</span>;</span><br><span class="line">        K k=(K)key;</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;K,V&gt; entry:list)&#123;</span><br><span class="line">            <span class="keyword">if</span>(entry.getKey().equals(k))&#123;</span><br><span class="line">                value=entry.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySet();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator()&#123;</span><br><span class="line">            <span class="keyword">return</span> list.iterator();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> list.size();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SlowMap&lt;String,String&gt; m= <span class="keyword">new</span> SlowMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(MyCountries.capitals(<span class="number">15</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"BULGARIA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="SortedSlowMap-java"><a href="#SortedSlowMap-java" class="headerlink" title="SortedSlowMap.java"></a>SortedSlowMap.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  持有MPair对象数组的SlowMap</span><br><span class="line"> *  每次put()完，用sort()排序</span><br><span class="line"> *  get()的时候用binarySearch()</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SlowMapComparator</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt;</span>&#123;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Map.Entry&lt;K,V&gt; a, Map.Entry&lt;K,V&gt; b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((Comparable&lt;K&gt;)a.getKey()).compareTo(b.getKey());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortedSlowMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MPair</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Comparable</span>&lt;<span class="title">MPair</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> K key;</span><br><span class="line">        <span class="keyword">private</span> V value;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MPair</span><span class="params">(K k, V v)</span></span>&#123;key=k;value=v;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> key;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> value;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span></span>&#123;V old=value;value=v;<span class="keyword">return</span> old;&#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(! (o <span class="keyword">instanceof</span> Map.Entry))&#123;<span class="keyword">return</span> <span class="keyword">false</span>;&#125;</span><br><span class="line">            Map.Entry&lt;K,V&gt; entry=(Map.Entry&lt;K,V&gt;)o;</span><br><span class="line">            <span class="keyword">return</span> key==<span class="keyword">null</span>? entry.getKey()==<span class="keyword">null</span> : entry.getKey().equals(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">int</span> hash=<span class="number">17</span>*<span class="number">37</span>;</span><br><span class="line">            hash+= (key==<span class="keyword">null</span>)? <span class="number">0</span>:key.hashCode();</span><br><span class="line">            <span class="keyword">return</span> hash;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(MPair&lt;K,V&gt; entry)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ((Comparable&lt;K&gt;)entry.getKey()).compareTo(key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;Map.Entry&lt;K,V&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        Map.Entry&lt;K,V&gt; entry=<span class="keyword">new</span> MPair&lt;K,V&gt;(key,value);</span><br><span class="line">        V oldValue=<span class="keyword">null</span>;</span><br><span class="line">        Comparator&lt;Map.Entry&lt;K,V&gt;&gt; comp=<span class="keyword">new</span> SlowMapComparator&lt;K,V&gt;();</span><br><span class="line">        <span class="keyword">int</span> index=Collections.binarySearch(list,entry,comp);</span><br><span class="line">        <span class="keyword">if</span>(index&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            oldValue=list.set(index,entry).getValue();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            list.add(entry);</span><br><span class="line">            Collections.sort(list,comp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        V value=<span class="keyword">null</span>;</span><br><span class="line">        Map.Entry&lt;K,V&gt; entry=<span class="keyword">new</span> MPair&lt;K,V&gt;((K)key,<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">int</span> index=Collections.binarySearch(list,entry,<span class="keyword">new</span> SlowMapComparator&lt;K,V&gt;());</span><br><span class="line">        <span class="keyword">if</span>(index&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            value=list.get(index).getValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EntrySet();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">EntrySet</span> <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator()&#123;</span><br><span class="line">            <span class="keyword">return</span> list.iterator();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> list.size();&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SlowMap&lt;String,String&gt; m= <span class="keyword">new</span> SlowMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(MyCountries.capitals(<span class="number">15</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"BULGARIA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise36-java"><a href="#Exercise36-java" class="headerlink" title="Exercise36.java"></a>Exercise36.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise36</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests = <span class="keyword">new</span> ArrayList&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"put"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    map.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++)</span><br><span class="line">                        map.put(j, j);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"get"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> span = tp.size * <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; span; j++)</span><br><span class="line">                        map.get(j);</span><br><span class="line">                <span class="keyword">return</span> loops * span;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"iterate"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i ++) &#123;</span><br><span class="line">                    Iterator&lt;Map.Entry&lt;Integer,Integer&gt;&gt; it = map.entrySet().iterator();</span><br><span class="line">                    <span class="keyword">while</span>(it.hasNext())</span><br><span class="line">                        it.next();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * map.size();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Tester36</span> <span class="keyword">extends</span> <span class="title">Tester</span>&lt;<span class="title">Map</span>&lt;<span class="title">Integer</span>,<span class="title">Integer</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester36</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester36</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests, paramList);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span></span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester36(cntnr, tests).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester36(cntnr, tests, paramList).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Map&lt;Integer,Integer&gt; initialize(<span class="keyword">int</span> size)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                container.put(i,i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;</span><br><span class="line">        Tester36.defaultParams= TestParam.array(<span class="number">10</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">1000</span>, <span class="number">10000</span>, <span class="number">20</span>);</span><br><span class="line">        Tester36.run(<span class="keyword">new</span> TreeMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester36.run(<span class="keyword">new</span> HashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester36.run(<span class="keyword">new</span> LinkedHashMap&lt;Integer,Integer&gt;(),tests);</span><br><span class="line">        Tester36.run(</span><br><span class="line">                   <span class="keyword">new</span> IdentityHashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester36.run(<span class="keyword">new</span> WeakHashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester36.run(<span class="keyword">new</span> Hashtable&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester36.run(<span class="keyword">new</span> BetterSlowMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester36.run(<span class="keyword">new</span> SortedSlowMap&lt;Integer,Integer&gt;(), tests);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="SortedSlowMap-V2-java-不需要用sort-排序"><a href="#SortedSlowMap-V2-java-不需要用sort-排序" class="headerlink" title="SortedSlowMap_V2.java 不需要用sort()排序"></a>SortedSlowMap_V2.java 不需要用sort()排序</h5><p>因为Collections.binarySearch()如果没有找到元素，返回值是(-(insertion point) - 1)。其中insertion point就是代表这个元素在原集合中应该插入的位置。利用这个数字新插入的元素就可以保持集合的排序。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    Map.Entry&lt;K,V&gt; entry=<span class="keyword">new</span> MPair&lt;K,V&gt;(key,value);</span><br><span class="line">    V oldValue=<span class="keyword">null</span>;</span><br><span class="line">    Comparator&lt;Map.Entry&lt;K,V&gt;&gt; comp=<span class="keyword">new</span> SlowMapComparator&lt;K,V&gt;();</span><br><span class="line">    <span class="keyword">int</span> index=Collections.binarySearch(list,entry,comp);</span><br><span class="line">    <span class="keyword">if</span>(index&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        oldValue=list.set(index,entry).getValue();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        list.add(Math.abs(index+<span class="number">1</span>),entry);</span><br><span class="line">        <span class="comment">//Collections.sort(list,comp);	//不需要排序</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="测试结果-3"><a href="#测试结果-3" class="headerlink" title="测试结果"></a>测试结果</h5><p>结果是用MPair做元素的BetterSlowMap没有比原来的SlowMap更快。尤其是get()方法因为要遍历所有MPair变得更慢了。</p>
<p>用了sort()和binarySearch()之后，SortedSlowMap最大的变化就是get()操作的开销指数级缩小。但代价是sort()的开销也不小。put()方法更慢了。</p>
<p>最后利用binarySearch()返回值的位置保持排序的SortedSlowMap_V2，put()和get()方法都显著优化。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">---------- TreeMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">366</span>     <span class="number">112</span>      <span class="number">48</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">61</span>      <span class="number">30</span>       <span class="number">6</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">67</span>      <span class="number">19</span>       <span class="number">3</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">74</span>      <span class="number">69</span>       <span class="number">8</span></span><br><span class="line">---------- HashMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">193</span>     <span class="number">157</span>      <span class="number">73</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">18</span>       <span class="number">4</span>       <span class="number">8</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">11</span>       <span class="number">3</span>       <span class="number">9</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">28</span>      <span class="number">35</span>      <span class="number">10</span></span><br><span class="line">------- LinkedHashMap -------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">404</span>      <span class="number">57</span>      <span class="number">24</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">43</span>      <span class="number">12</span>       <span class="number">7</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">25</span>      <span class="number">10</span>       <span class="number">7</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">27</span>      <span class="number">11</span>       <span class="number">7</span></span><br><span class="line">------ IdentityHashMap ------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">133</span>      <span class="number">54</span>      <span class="number">39</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">32</span>      <span class="number">36</span>      <span class="number">15</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">13</span>      <span class="number">29</span>      <span class="number">13</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">114</span>      <span class="number">86</span>      <span class="number">17</span></span><br><span class="line">-------- WeakHashMap --------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">119</span>      <span class="number">38</span>      <span class="number">22</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">33</span>       <span class="number">8</span>      <span class="number">10</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">18</span>       <span class="number">8</span>      <span class="number">10</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">26</span>      <span class="number">14</span>      <span class="number">11</span></span><br><span class="line">--------- Hashtable ---------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>      <span class="number">65</span>      <span class="number">39</span>      <span class="number">21</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">34</span>      <span class="number">21</span>      <span class="number">10</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">27</span>      <span class="number">18</span>       <span class="number">9</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">59</span>      <span class="number">34</span>      <span class="number">10</span></span><br><span class="line">---------- SlowMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">480</span>     <span class="number">172</span>      <span class="number">43</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">146</span>      <span class="number">91</span>      <span class="number">11</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">151</span>      <span class="number">94</span>      <span class="number">15</span></span><br><span class="line"><span class="number">10000</span>   <span class="number">11191</span>   <span class="number">10775</span>      <span class="number">11</span></span><br><span class="line">------- BetterSlowMap -------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">313</span>      <span class="number">77</span>      <span class="number">13</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">153</span>     <span class="number">155</span>       <span class="number">8</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">168</span>     <span class="number">183</span>       <span class="number">9</span></span><br><span class="line"><span class="number">10000</span>   <span class="number">12001</span>   <span class="number">17013</span>       <span class="number">7</span></span><br><span class="line">------- SortedSlowMap -------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">580</span>     <span class="number">146</span>      <span class="number">21</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">288</span>      <span class="number">25</span>       <span class="number">7</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">201</span>      <span class="number">28</span>       <span class="number">7</span></span><br><span class="line"><span class="number">10000</span>   <span class="number">28663</span>      <span class="number">74</span>       <span class="number">7</span></span><br><span class="line">------- SortedSlowMap_V2 -------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">465</span>     <span class="number">147</span>      <span class="number">10</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">38</span>      <span class="number">32</span>       <span class="number">7</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">47</span>      <span class="number">29</span>       <span class="number">8</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">561</span>      <span class="number">69</span>       <span class="number">7</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-37"><a href="#Exercise-37" class="headerlink" title="Exercise 37"></a>Exercise 37</h4><ul>
<li><strong>Exercise 37</strong>: (2) Modify SimpleHashMap to use ArrayLists instead of LinkedLists. Modify MapPerformance.java to compare the performance of the two implementations.</li>
</ul>
<h4 id="SimpleHashMap37-java"><a href="#SimpleHashMap37-java" class="headerlink" title="SimpleHashMap37.java"></a>SimpleHashMap37.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap37</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    List&lt;MapEntry&lt;K,V&gt;&gt;[] buckets = <span class="keyword">new</span> ArrayList[SIZE];</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)&#123;</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> ArrayList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;MapEntry&lt;K,V&gt;&gt; bucket = buckets[index];</span><br><span class="line">        MapEntry&lt;K,V&gt; pair = <span class="keyword">new</span> MapEntry&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;MapEntry&lt;K,V&gt;&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            MapEntry&lt;K,V&gt; iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair); <span class="comment">// Replace old with new</span></span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)</span><br><span class="line">            buckets[index].add(pair);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(MapEntry&lt;K,V&gt; iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(List&lt;MapEntry&lt;K,V&gt;&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(MapEntry&lt;K,V&gt; mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleHashMap37&lt;String,String&gt; m = <span class="keyword">new</span> SimpleHashMap37&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise37-java"><a href="#Exercise37-java" class="headerlink" title="Exercise37.java"></a>Exercise37.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise37</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests = <span class="keyword">new</span> ArrayList&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"put"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> size = tp.size;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++) &#123;</span><br><span class="line">                    map.clear();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++)</span><br><span class="line">                        map.put(j, j);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * size;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"get"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> span = tp.size * <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; span; j++)</span><br><span class="line">                        map.get(j);</span><br><span class="line">                <span class="keyword">return</span> loops * span;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"iterate"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops * <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i ++) &#123;</span><br><span class="line">                    Iterator&lt;Map.Entry&lt;Integer,Integer&gt;&gt; it = map.entrySet().iterator();</span><br><span class="line">                    <span class="keyword">while</span>(it.hasNext())</span><br><span class="line">                        it.next();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> loops * map.size();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Tester37</span> <span class="keyword">extends</span> <span class="title">Tester</span>&lt;<span class="title">Map</span>&lt;<span class="title">Integer</span>,<span class="title">Integer</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester37</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester37</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests, paramList);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span></span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester37(cntnr, tests).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester37(cntnr, tests, paramList).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Map&lt;Integer,Integer&gt; initialize(<span class="keyword">int</span> size)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                container.put(i,i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(<span class="number">10</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">5000</span>, <span class="number">100</span>, <span class="number">1000</span>, <span class="number">10000</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> TreeMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> HashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> LinkedHashMap&lt;Integer,Integer&gt;(),tests);</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> IdentityHashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> WeakHashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> Hashtable&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> SimpleHashMap&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">        Tester37.run(<span class="keyword">new</span> SimpleHashMap37&lt;Integer,Integer&gt;(), tests);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试结果-4"><a href="#测试结果-4" class="headerlink" title="测试结果"></a>测试结果</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">---------- TreeMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">524</span>     <span class="number">117</span>      <span class="number">38</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">56</span>      <span class="number">27</span>       <span class="number">7</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">72</span>      <span class="number">18</span>       <span class="number">3</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">101</span>      <span class="number">85</span>       <span class="number">8</span></span><br><span class="line">---------- HashMap ----------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">146</span>     <span class="number">114</span>      <span class="number">74</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">11</span>       <span class="number">4</span>       <span class="number">8</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">28</span>       <span class="number">3</span>       <span class="number">7</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">90</span>     <span class="number">175</span>      <span class="number">71</span></span><br><span class="line">------- LinkedHashMap -------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">477</span>      <span class="number">46</span>      <span class="number">21</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">24</span>      <span class="number">10</span>       <span class="number">6</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">21</span>       <span class="number">9</span>       <span class="number">5</span></span><br><span class="line"><span class="number">10000</span>      <span class="number">94</span>      <span class="number">11</span>       <span class="number">6</span></span><br><span class="line">------ IdentityHashMap ------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">115</span>      <span class="number">32</span>      <span class="number">23</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">21</span>      <span class="number">30</span>      <span class="number">15</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">13</span>      <span class="number">35</span>      <span class="number">20</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">252</span>      <span class="number">75</span>      <span class="number">19</span></span><br><span class="line">-------- WeakHashMap --------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">113</span>      <span class="number">39</span>      <span class="number">21</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">27</span>       <span class="number">7</span>      <span class="number">10</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">18</span>       <span class="number">8</span>      <span class="number">10</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">148</span>      <span class="number">54</span>      <span class="number">18</span></span><br><span class="line">--------- Hashtable ---------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>      <span class="number">91</span>      <span class="number">28</span>      <span class="number">20</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">35</span>      <span class="number">19</span>       <span class="number">9</span></span><br><span class="line">  <span class="number">100</span>      <span class="number">19</span>      <span class="number">16</span>       <span class="number">8</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">130</span>      <span class="number">19</span>       <span class="number">8</span></span><br><span class="line">------- SimpleHashMap -------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>    <span class="number">1220</span>      <span class="number">49</span>     <span class="number">115</span></span><br><span class="line">  <span class="number">100</span>    <span class="number">1075</span>      <span class="number">11</span>     <span class="number">823</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">996</span>       <span class="number">9</span>     <span class="number">805</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">533</span>     <span class="number">261</span>  <span class="number">142641</span></span><br><span class="line">------ SimpleHashMap37 ------</span><br><span class="line"> size     put     get iterate</span><br><span class="line">   <span class="number">10</span>     <span class="number">761</span>      <span class="number">62</span>     <span class="number">113</span></span><br><span class="line">  <span class="number">100</span>     <span class="number">972</span>       <span class="number">8</span>     <span class="number">797</span></span><br><span class="line">  <span class="number">100</span>    <span class="number">1007</span>       <span class="number">8</span>     <span class="number">852</span></span><br><span class="line"><span class="number">10000</span>     <span class="number">756</span>     <span class="number">289</span>  <span class="number">145136</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-38"><a href="#Exercise-38" class="headerlink" title="Exercise 38"></a>Exercise 38</h4><ul>
<li><strong>Exercise 38</strong>: (3) Look up the HashMap class in the JDK documentation. Create a HashMap, fill it with elements, and determine the load factor. Test the lookup speed with this map, then attempt to increase the speed by making a new HashMap with a larger initial capacity and copying the old map into the new one, then run your lookup speed test again on the new map.</li>
</ul>
<p>#####Exercise38.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter17.testframework.gen.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise38</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests = <span class="keyword">new</span> ArrayList&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        tests.add(<span class="keyword">new</span> Test&lt;Map&lt;Integer,Integer&gt;&gt;(<span class="string">"get"</span>) &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">(Map&lt;Integer,Integer&gt; map, TestParam tp)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> loops = tp.loops;</span><br><span class="line">                <span class="keyword">int</span> span = tp.size * <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; loops; i++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; span; j++)</span><br><span class="line">                        map.get(j);</span><br><span class="line">                <span class="keyword">return</span> loops * span;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Tester38</span> <span class="keyword">extends</span> <span class="title">Tester</span>&lt;<span class="title">Map</span>&lt;<span class="title">Integer</span>,<span class="title">Integer</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester38</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Tester38</span><span class="params">(Map&lt;Integer,Integer&gt; container, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(container, tests, paramList);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests)</span></span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester38(cntnr, tests).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Map&lt;Integer,Integer&gt; cntnr, List&lt;Test&lt;Map&lt;Integer,Integer&gt;&gt;&gt; tests, TestParam[] paramList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">new</span> Tester38(cntnr, tests, paramList).timedTest();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Map&lt;Integer,Integer&gt; initialize(<span class="keyword">int</span> size)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                container.put(i,i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(args);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Tester.defaultParams = TestParam.array(<span class="number">10000</span>, <span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Tester38.run(<span class="keyword">new</span> HashMap&lt;Integer,Integer&gt;(<span class="number">16384</span>), tests);	<span class="comment">//负载因子：10000/16384=0.61</span></span><br><span class="line">        Tester38.run(<span class="keyword">new</span> HashMap&lt;Integer,Integer&gt;(<span class="number">65536</span>), tests);	<span class="comment">//负载因子：10000/65536=0.15</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试结果-5"><a href="#测试结果-5" class="headerlink" title="测试结果"></a>测试结果</h5><p>当负载因子等于0.15的时候，查询速度明显比负载因子是0.61的时候快。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- HashMap --</span><br><span class="line"> size     get</span><br><span class="line"><span class="number">10000</span>      <span class="number">97</span></span><br><span class="line">-- HashMap --</span><br><span class="line"> size     get</span><br><span class="line"><span class="number">10000</span>      <span class="number">17</span></span><br></pre></td></tr></table></figure>
<h4 id="Exercise-39"><a href="#Exercise-39" class="headerlink" title="Exercise 39"></a>Exercise 39</h4><ul>
<li><strong>Exercise 39</strong>: (6) Add a private rehash( ) method to SimpleHashMap that is invoked when the load factor exceeds 0.75. During rehashing, double the number of buckets, then search for the first prime number greater than that to determine the new number of buckets.</li>
</ul>
<h5 id="RehashSimpleHashMap-java"><a href="#RehashSimpleHashMap-java" class="headerlink" title="RehashSimpleHashMap.java"></a>RehashSimpleHashMap.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RehashSimpleHashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> LOAD_FACTOR=<span class="number">0.75</span>;</span><br><span class="line">    <span class="keyword">int</span> SIZE = <span class="number">16</span>;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedList&lt;MapEntry&lt;K,V&gt;&gt;[] buckets = <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">        LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket = buckets[index];</span><br><span class="line">        MapEntry&lt;K,V&gt; pair = <span class="keyword">new</span> MapEntry&lt;K,V&gt;(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;MapEntry&lt;K,V&gt;&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            MapEntry&lt;K,V&gt; iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair);</span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            <span class="keyword">if</span>((size()/(<span class="keyword">double</span>)SIZE)&gt;=LOAD_FACTOR)&#123;</span><br><span class="line">                rehash();</span><br><span class="line">                index=Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">                <span class="keyword">if</span>(buckets[index]==<span class="keyword">null</span>)&#123;buckets[index] = <span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();&#125;</span><br><span class="line">                buckets[index].add(pair);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                buckets[index].add(pair);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(MapEntry&lt;K,V&gt; iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;K,V&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;K,V&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(MapEntry&lt;K,V&gt; mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rehash</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//double size</span></span><br><span class="line">        SIZE*=<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(isPrime(++SIZE))&#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Resize to "</span>+SIZE);</span><br><span class="line">        <span class="comment">//transfer elements</span></span><br><span class="line">        LinkedList&lt;MapEntry&lt;K,V&gt;&gt;[] newBuckets = <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;MapEntry&lt;K,V&gt;&gt; bucket:buckets)&#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                ListIterator&lt;MapEntry&lt;K,V&gt;&gt; ite=bucket.listIterator();</span><br><span class="line">                <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">                    MapEntry&lt;K,V&gt; entry=ite.next();</span><br><span class="line">                    <span class="keyword">int</span> h=entry.getHash();</span><br><span class="line">                    <span class="keyword">if</span>(h==<span class="number">0</span>)&#123;</span><br><span class="line">                        h=entry.getKey().hashCode();</span><br><span class="line">                        entry.setHash(h);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">int</span> ticket=Math.abs(h)%SIZE;</span><br><span class="line">                    <span class="keyword">if</span>(newBuckets[ticket]==<span class="keyword">null</span>)&#123;</span><br><span class="line">                        newBuckets[ticket]=<span class="keyword">new</span> LinkedList&lt;MapEntry&lt;K,V&gt;&gt;();</span><br><span class="line">                        newBuckets[ticket].add(entry);</span><br><span class="line">                    &#125;</span><br><span class="line">                    newBuckets[ticket].add(entry);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        buckets=newBuckets;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPrime</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(num&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Give me a number positive!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(num==<span class="number">1</span> || num==<span class="number">2</span>)&#123;<span class="keyword">return</span> <span class="keyword">true</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;num-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(num%i==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RehashSimpleHashMap&lt;String,String&gt; m = <span class="keyword">new</span> RehashSimpleHashMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">50</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise39-java"><a href="#Exercise39-java" class="headerlink" title="Exercise39.java"></a>Exercise39.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise39</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RehashSimpleHashMap&lt;String,String&gt; m = <span class="keyword">new</span> RehashSimpleHashMap&lt;String,String&gt;();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">50</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"ERITREA"</span>));</span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-40"><a href="#Exercise-40" class="headerlink" title="Exercise 40"></a>Exercise 40</h4><ul>
<li><strong>Exercise 40</strong>: (5) Create a class containing two String objects and make it Comparable so that the comparison only cares about the first String. Fill an array and an ArrayList with objects of your class, using the RandomGenerator generator. Demonstrate that sorting works properly. Now make a Comparator that only cares about the second String, and demonstrate that sorting works properly. Also perform a binary search using your Comparator.</li>
</ul>
<h5 id="Pair-java"><a href="#Pair-java" class="headerlink" title="Pair.java"></a>Pair.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String a;</span><br><span class="line">    <span class="keyword">protected</span> String b;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(String a,String b)</span></span>&#123;<span class="keyword">this</span>.a=a;<span class="keyword">this</span>.b=b;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getA</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> a;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getB</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> b;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"("</span>+a+<span class="string">","</span>+b+<span class="string">")"</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PairA-java"><a href="#PairA-java" class="headerlink" title="PairA.java"></a>PairA.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairA</span> <span class="keyword">extends</span> <span class="title">Pair</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">PairA</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PairA</span><span class="params">(String x, String y)</span></span>&#123;<span class="keyword">super</span>(x,y);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PairA pair)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.compareTo(pair.getA());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PairB-java"><a href="#PairB-java" class="headerlink" title="PairB.java"></a>PairB.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairB</span> <span class="keyword">extends</span> <span class="title">Pair</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">PairB</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PairB</span><span class="params">(String x, String y)</span></span>&#123;<span class="keyword">super</span>(x,y);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PairB pair)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.compareTo(pair.getB());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise40-java"><a href="#Exercise40-java" class="headerlink" title="Exercise40.java"></a>Exercise40.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompPairA</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">PairA</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(PairA x, PairA y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.compareTo(y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompPairB</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">PairB</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(PairB x, PairB y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.compareTo(y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise40</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Generator&lt;String&gt; gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        PairA[] array=<span class="keyword">new</span> PairA[<span class="number">10</span>];</span><br><span class="line">        List&lt;PairA&gt; list=<span class="keyword">new</span> ArrayList&lt;PairA&gt;();</span><br><span class="line">        </span><br><span class="line">        String arrayNo4=<span class="keyword">null</span>;</span><br><span class="line">        String listNo8=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            String x=gen.next();</span><br><span class="line">            String y=gen.next();</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">3</span>)&#123;</span><br><span class="line">                arrayNo4=x;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">7</span>)&#123;</span><br><span class="line">                listNo8=y;</span><br><span class="line">            &#125;</span><br><span class="line">            array[i]=<span class="keyword">new</span> PairA(x,y);</span><br><span class="line">            list.add(<span class="keyword">new</span> PairA(y,x));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        CompPairA cpa=<span class="keyword">new</span> CompPairA();</span><br><span class="line">        Arrays.sort(array,cpa);</span><br><span class="line">        System.out.println(Arrays.toString(array));</span><br><span class="line">        PairA newArrayNode=<span class="keyword">new</span> PairA(arrayNo4,gen.next());</span><br><span class="line">        <span class="keyword">int</span> indexArray=Arrays.binarySearch(array,newArrayNode,cpa);</span><br><span class="line">        <span class="keyword">if</span>(indexArray&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(newArrayNode+<span class="string">"=="</span>+array[indexArray]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Collections.sort(list);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        PairA newListNode=<span class="keyword">new</span> PairA(listNo8,gen.next());</span><br><span class="line">        <span class="keyword">int</span> indexList=Collections.binarySearch(list,newListNode,cpa);</span><br><span class="line">        <span class="keyword">if</span>(indexList&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(newListNode+<span class="string">"=="</span>+list.get(indexList));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-41"><a href="#Exercise-41" class="headerlink" title="Exercise 41"></a>Exercise 41</h4><ul>
<li><strong>Exercise 41</strong>: (3) Modify the class in the previous exercise so that it will work with HashSets and as a key in HashMaps.</li>
</ul>
<h5 id="Pair-java-1"><a href="#Pair-java-1" class="headerlink" title="Pair.java"></a>Pair.java</h5><p>Pair基类不变</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String a;</span><br><span class="line">    <span class="keyword">protected</span> String b;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(String a,String b)</span></span>&#123;<span class="keyword">this</span>.a=a;<span class="keyword">this</span>.b=b;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getA</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> a;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getB</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> b;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"("</span>+a+<span class="string">","</span>+b+<span class="string">")"</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PairA-java-1"><a href="#PairA-java-1" class="headerlink" title="PairA.java"></a>PairA.java</h5><p>为了在Set里使用，最好实现equals()和hashCode()方法。<br>为了在Map里使用，需要实现Map.Entry接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairA</span> <span class="keyword">extends</span> <span class="title">Pair</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">PairA</span>&gt;, <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PairA</span><span class="params">(String x, String y)</span></span>&#123;<span class="keyword">super</span>(x,y);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PairA pair)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.compareTo(pair.getA());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  For the Map</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> a;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> b;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String v)</span></span>&#123;</span><br><span class="line">        String old=b;</span><br><span class="line">        b=v;</span><br><span class="line">        <span class="keyword">return</span> old;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  For the Set</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> PairA))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a.equals(((PairA)o).getA());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PairB-java-1"><a href="#PairB-java-1" class="headerlink" title="PairB.java"></a>PairB.java</h5><p>和PairA同理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairB</span> <span class="keyword">extends</span> <span class="title">Pair</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">PairB</span>&gt;,<span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PairB</span><span class="params">(String x, String y)</span></span>&#123;<span class="keyword">super</span>(x,y);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PairB pair)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.compareTo(pair.getB());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  For the Map</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> b;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> a;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">setValue</span><span class="params">(String v)</span></span>&#123;</span><br><span class="line">        String old=a;</span><br><span class="line">        a=v;</span><br><span class="line">        <span class="keyword">return</span> old;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  For the Set</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> PairB))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b.equals(((PairB)o).getB());</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="SimpleHashMap41-java"><a href="#SimpleHashMap41-java" class="headerlink" title="SimpleHashMap41.java"></a>SimpleHashMap41.java</h5><p>为了使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleHashMap41</span> <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">String</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">997</span>;</span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(value=&#123;<span class="string">"unchecked"</span>,<span class="string">"rawtypes"</span>&#125;)</span><br><span class="line">    LinkedList&lt;PairA&gt;[] buckets = <span class="keyword">new</span> LinkedList[SIZE];</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">put</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        String oldValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>)</span><br><span class="line">            buckets[index] = <span class="keyword">new</span> LinkedList&lt;PairA&gt;();</span><br><span class="line">        LinkedList&lt;PairA&gt; bucket = buckets[index];</span><br><span class="line">        PairA pair = <span class="keyword">new</span> PairA(key, value);</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        ListIterator&lt;PairA&gt; it = bucket.listIterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            PairA iPair = it.next();</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key)) &#123;</span><br><span class="line">                oldValue = iPair.getValue();</span><br><span class="line">                it.set(pair); <span class="comment">// Replace old with new</span></span><br><span class="line">                found = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)</span><br><span class="line">            buckets[index].add(pair);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = Math.abs(key.hashCode()) % SIZE;</span><br><span class="line">        <span class="keyword">if</span>(buckets[index] == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(PairA iPair : buckets[index])</span><br><span class="line">            <span class="keyword">if</span>(iPair.getKey().equals(key))</span><br><span class="line">                <span class="keyword">return</span> iPair.getValue();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Set&lt;Map.Entry&lt;String,String&gt;&gt; entrySet() &#123;</span><br><span class="line">        Set&lt;Map.Entry&lt;String,String&gt;&gt; set= <span class="keyword">new</span> HashSet&lt;Map.Entry&lt;String,String&gt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(LinkedList&lt;PairA&gt; bucket : buckets) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bucket == <span class="keyword">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(PairA mpair : bucket)</span><br><span class="line">                set.add(mpair);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise41-java"><a href="#Exercise41-java" class="headerlink" title="Exercise41.java"></a>Exercise41.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise41</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">runMap</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Map&lt;String,String&gt; m = <span class="keyword">new</span> SimpleHashMap41();</span><br><span class="line">        m.putAll(Countries.capitals(<span class="number">25</span>));</span><br><span class="line">        System.out.println(m);</span><br><span class="line">        System.out.println(m.get(<span class="string">"BENIN"</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(m.entrySet());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">runSet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Set&lt;PairA&gt; set1=<span class="keyword">new</span> LinkedHashSet&lt;PairA&gt;();</span><br><span class="line">        Set&lt;PairA&gt; set2=<span class="keyword">new</span> TreeSet&lt;PairA&gt;();</span><br><span class="line">        RandomGenerator.String gen=<span class="keyword">new</span> RandomGenerator.String(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">            set1.add(<span class="keyword">new</span> PairA(gen.next(),gen.next()));</span><br><span class="line">            set2.add(<span class="keyword">new</span> PairA(gen.next(),gen.next()));</span><br><span class="line">        &#125;</span><br><span class="line">        Sets.test(set1,set2);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Exercise41.runMap();</span><br><span class="line">        Exercise41.runSet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-42"><a href="#Exercise-42" class="headerlink" title="Exercise 42"></a>Exercise 42</h4><ul>
<li><strong>Exercise 42</strong>: (2) Modify Exercise 40 so that an alphabetic sort is used.</li>
</ul>
<p>PairA和PairB都不变。</p>
<h5 id="Pair-java-2"><a href="#Pair-java-2" class="headerlink" title="Pair.java"></a>Pair.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String a;</span><br><span class="line">    <span class="keyword">protected</span> String b;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(String a,String b)</span></span>&#123;<span class="keyword">this</span>.a=a;<span class="keyword">this</span>.b=b;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getA</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> a;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getB</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> b;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"("</span>+a+<span class="string">","</span>+b+<span class="string">")"</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PairA-java-2"><a href="#PairA-java-2" class="headerlink" title="PairA.java"></a>PairA.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairA</span> <span class="keyword">extends</span> <span class="title">Pair</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">PairA</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PairA</span><span class="params">(String x, String y)</span></span>&#123;<span class="keyword">super</span>(x,y);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PairA pair)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.compareTo(pair.getA());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PairB-java-2"><a href="#PairB-java-2" class="headerlink" title="PairB.java"></a>PairB.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PairB</span> <span class="keyword">extends</span> <span class="title">Pair</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">PairB</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PairB</span><span class="params">(String x, String y)</span></span>&#123;<span class="keyword">super</span>(x,y);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(PairB pair)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.compareTo(pair.getB());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Exercise42-java"><a href="#Exercise42-java" class="headerlink" title="Exercise42.java"></a>Exercise42.java</h5><p>就是把Comparator改成用String自带的忽略大小写的CASE_INSENSITIVE_ORDER。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter17;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompPairA</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">PairA</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(PairA x, PairA y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.CASE_INSENSITIVE_ORDER.compare(x.getA(),y.getA());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompPairB</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">PairB</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(PairB x, PairB y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.CASE_INSENSITIVE_ORDER.compare(x.getB(),y.getB());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise42</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Generator&lt;String&gt; gen=<span class="keyword">new</span> RandomGenerator.String();</span><br><span class="line">        PairA[] array=<span class="keyword">new</span> PairA[<span class="number">10</span>];</span><br><span class="line">        List&lt;PairA&gt; list=<span class="keyword">new</span> ArrayList&lt;PairA&gt;();</span><br><span class="line">        </span><br><span class="line">        String arrayNo4=<span class="keyword">null</span>;</span><br><span class="line">        String listNo8=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            String x=gen.next();</span><br><span class="line">            String y=gen.next();</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">3</span>)&#123;</span><br><span class="line">                arrayNo4=x;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">7</span>)&#123;</span><br><span class="line">                listNo8=y;</span><br><span class="line">            &#125;</span><br><span class="line">            array[i]=<span class="keyword">new</span> PairA(x,y);</span><br><span class="line">            list.add(<span class="keyword">new</span> PairA(y,x));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        CompPairA cpa=<span class="keyword">new</span> CompPairA();</span><br><span class="line">        Arrays.sort(array,cpa);</span><br><span class="line">        System.out.println(Arrays.toString(array));</span><br><span class="line">        PairA newArrayNode=<span class="keyword">new</span> PairA(arrayNo4,gen.next());</span><br><span class="line">        <span class="keyword">int</span> indexArray=Arrays.binarySearch(array,newArrayNode,cpa);</span><br><span class="line">        <span class="keyword">if</span>(indexArray&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(newArrayNode+<span class="string">"=="</span>+array[indexArray]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Collections.sort(list);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        PairA newListNode=<span class="keyword">new</span> PairA(listNo8,gen.next());</span><br><span class="line">        <span class="keyword">int</span> indexList=Collections.binarySearch(list,newListNode,cpa);</span><br><span class="line">        <span class="keyword">if</span>(indexList&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(newListNode+<span class="string">"=="</span>+list.get(indexList));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Container/" rel="tag">#Container</a>
          
            <a href="/tags/容器/" rel="tag">#容器</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/09/08/convariat/" rel="next" title="Java中，数组为什么要设计为协变？">
                <i class="fa fa-chevron-left"></i> Java中，数组为什么要设计为协变？
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/09/09/anonymous/" rel="prev" title="Anonymous Inner Class (匿名内部类) 是否可以extends(继承)其它类,是否可以implements(实现)interface(接口)?">
                Anonymous Inner Class (匿名内部类) 是否可以extends(继承)其它类,是否可以implements(实现)interface(接口)? <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/09/09/tij4-17/"
           data-title="Thinking in Java 读书笔记：第十七章 - 容器深入研究" data-url="www.ciaoshen.com/2016/09/09/tij4-17/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/shenAvatar.jpg"
               alt="沈玮 | Wei SHEN" />
          <p class="site-author-name" itemprop="name">沈玮 | Wei SHEN</p>
          <p class="site-description motion-element" itemprop="description">Coder & Designer</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">58</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">193</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/helloShen" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/72441576/" target="_blank">
                  
                    <i class="fa fa-globe"></i> DouBan
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/pang-pang-37-37" target="_blank">
                  
                    <i class="fa fa-globe"></i> ZhiHu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#容器的填充"><span class="nav-number">1.</span> <span class="nav-text">容器的填充</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#实现容器抽象类"><span class="nav-number">1.1.</span> <span class="nav-text">实现容器抽象类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#看看keySet-方法的源代码，看它是怎么实现的"><span class="nav-number">1.1.1.</span> <span class="nav-text">看看keySet( )方法的源代码，看它是怎么实现的</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#用匿名内部类覆盖某方法，有奇效"><span class="nav-number">1.1.2.</span> <span class="nav-text">用匿名内部类覆盖某方法，有奇效</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Collection接口"><span class="nav-number">2.</span> <span class="nav-text">Collection接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可选操作"><span class="nav-number">3.</span> <span class="nav-text">可选操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#可选操作是坑？还是良好的设计？"><span class="nav-number">3.1.</span> <span class="nav-text">可选操作是坑？还是良好的设计？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AbstractCollection抽象类"><span class="nav-number">4.</span> <span class="nav-text">AbstractCollection抽象类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List"><span class="nav-number">5.</span> <span class="nav-text">List</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#单向链表设计思路"><span class="nav-number">5.1.</span> <span class="nav-text">单向链表设计思路</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set"><span class="nav-number">6.</span> <span class="nav-text">Set</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Set对内部元素的要求"><span class="nav-number">6.1.</span> <span class="nav-text">Set对内部元素的要求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义Set"><span class="nav-number">6.2.</span> <span class="nav-text">自定义Set</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#队列（Queue）"><span class="nav-number">7.</span> <span class="nav-text">队列（Queue）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#双端队列（Deque）"><span class="nav-number">8.</span> <span class="nav-text">双端队列（Deque）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#映射（Map）"><span class="nav-number">9.</span> <span class="nav-text">映射（Map）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义Map"><span class="nav-number">9.1.</span> <span class="nav-text">自定义Map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#唯一性"><span class="nav-number">9.2.</span> <span class="nav-text">唯一性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#散列值（hashCode-）"><span class="nav-number">9.3.</span> <span class="nav-text">散列值（hashCode()）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单容器测试框架"><span class="nav-number">10.</span> <span class="nav-text">简单容器测试框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于垃圾回收再唐僧几句"><span class="nav-number">11.</span> <span class="nav-text">关于垃圾回收再唐僧几句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GC不是什么都管"><span class="nav-number">11.1.</span> <span class="nav-text">GC不是什么都管</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#finalize-方法作为GC的补充"><span class="nav-number">11.2.</span> <span class="nav-text">finalize( )方法作为GC的补充</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#finalize-方法靠不住，不要用"><span class="nav-number">11.3.</span> <span class="nav-text">finalize( )方法靠不住，不要用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#finalize-只能被调用一次"><span class="nav-number">11.4.</span> <span class="nav-text">finalize( )只能被调用一次</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#引用的不同强度"><span class="nav-number">12.</span> <span class="nav-text">引用的不同强度</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ReferenceQueue"><span class="nav-number">12.1.</span> <span class="nav-text">ReferenceQueue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WeakHashMap"><span class="nav-number">12.2.</span> <span class="nav-text">WeakHashMap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exercise"><span class="nav-number">13.</span> <span class="nav-text">Exercise</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MyCountries-java"><span class="nav-number">13.1.</span> <span class="nav-text">MyCountries.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RandomGenerator-java"><span class="nav-number">13.2.</span> <span class="nav-text">RandomGenerator.java</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-1"><span class="nav-number">13.3.</span> <span class="nav-text">Exercise 1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-2"><span class="nav-number">13.4.</span> <span class="nav-text">Exercise 2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MyCountries-java-1"><span class="nav-number">13.4.1.</span> <span class="nav-text">MyCountries.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise2-java"><span class="nav-number">13.4.2.</span> <span class="nav-text">Exercise2.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-3"><span class="nav-number">13.5.</span> <span class="nav-text">Exercise 3</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise3-java"><span class="nav-number">13.5.1.</span> <span class="nav-text">Exercise3.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MyCountries-java-2"><span class="nav-number">13.5.2.</span> <span class="nav-text">MyCountries.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-4"><span class="nav-number">13.6.</span> <span class="nav-text">Exercise 4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-5"><span class="nav-number">13.7.</span> <span class="nav-text">Exercise 5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-6"><span class="nav-number">13.8.</span> <span class="nav-text">Exercise 6</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-7"><span class="nav-number">13.9.</span> <span class="nav-text">Exercise 7</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-8"><span class="nav-number">13.10.</span> <span class="nav-text">Exercise 8</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#单头节点版本"><span class="nav-number">13.10.1.</span> <span class="nav-text">单头节点版本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#双头节点版本"><span class="nav-number">13.10.2.</span> <span class="nav-text">双头节点版本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#无头节点版本"><span class="nav-number">13.10.3.</span> <span class="nav-text">无头节点版本</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-9"><span class="nav-number">13.11.</span> <span class="nav-text">Exercise 9</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RandomGenerator-java-1"><span class="nav-number">13.11.1.</span> <span class="nav-text">RandomGenerator.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise9-java"><span class="nav-number">13.11.2.</span> <span class="nav-text">Exercise9.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-10"><span class="nav-number">13.12.</span> <span class="nav-text">Exercise 10</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise10-java"><span class="nav-number">13.12.1.</span> <span class="nav-text">Exercise10.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-11"><span class="nav-number">13.13.</span> <span class="nav-text">Exercise 11</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-12"><span class="nav-number">13.14.</span> <span class="nav-text">Exercise 12</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-13"><span class="nav-number">13.15.</span> <span class="nav-text">Exercise 13</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-14"><span class="nav-number">13.16.</span> <span class="nav-text">Exercise 14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-15"><span class="nav-number">13.17.</span> <span class="nav-text">Exercise 15</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SlowMap-java"><span class="nav-number">13.17.1.</span> <span class="nav-text">SlowMap.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise15-java"><span class="nav-number">13.17.2.</span> <span class="nav-text">Exercise15.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-16"><span class="nav-number">13.18.</span> <span class="nav-text">Exercise 16</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SlowMap-java-1"><span class="nav-number">13.18.1.</span> <span class="nav-text">SlowMap.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MapEntry-java"><span class="nav-number">13.18.2.</span> <span class="nav-text">MapEntry.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Maps-java"><span class="nav-number">13.18.3.</span> <span class="nav-text">Maps.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise16-java"><span class="nav-number">13.18.4.</span> <span class="nav-text">Exercise16.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-17"><span class="nav-number">13.19.</span> <span class="nav-text">Exercise 17</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SlowMapComplete-java"><span class="nav-number">13.19.1.</span> <span class="nav-text">SlowMapComplete.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MapEntry-java-1"><span class="nav-number">13.19.2.</span> <span class="nav-text">MapEntry.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise17-java"><span class="nav-number">13.19.3.</span> <span class="nav-text">Exercise17.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-18"><span class="nav-number">13.20.</span> <span class="nav-text">Exercise 18</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-19"><span class="nav-number">13.21.</span> <span class="nav-text">Exercise 19</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise19-java"><span class="nav-number">13.21.1.</span> <span class="nav-text">Exercise19.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashMap-java"><span class="nav-number">13.21.2.</span> <span class="nav-text">SimpleHashMap.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MapEntry-java-2"><span class="nav-number">13.21.3.</span> <span class="nav-text">MapEntry.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-20"><span class="nav-number">13.22.</span> <span class="nav-text">Exercise 20</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashMap20-java"><span class="nav-number">13.22.1.</span> <span class="nav-text">SimpleHashMap20.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MapEntry-java-3"><span class="nav-number">13.22.2.</span> <span class="nav-text">MapEntry.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise20-java"><span class="nav-number">13.22.3.</span> <span class="nav-text">Exercise20.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-21"><span class="nav-number">13.23.</span> <span class="nav-text">Exercise 21</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashMap21-java"><span class="nav-number">13.23.1.</span> <span class="nav-text">SimpleHashMap21.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MapEntry-java-4"><span class="nav-number">13.23.2.</span> <span class="nav-text">MapEntry.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise21-java"><span class="nav-number">13.23.3.</span> <span class="nav-text">Exercise21.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-22"><span class="nav-number">13.24.</span> <span class="nav-text">Exercise 22</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashMap22-java"><span class="nav-number">13.24.1.</span> <span class="nav-text">SimpleHashMap22.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MapEntry-java-5"><span class="nav-number">13.24.2.</span> <span class="nav-text">MapEntry.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise22-java"><span class="nav-number">13.24.3.</span> <span class="nav-text">Exercise22.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-23"><span class="nav-number">13.25.</span> <span class="nav-text">Exercise 23</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashMap23-java"><span class="nav-number">13.25.1.</span> <span class="nav-text">SimpleHashMap23.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MapEntry-java-6"><span class="nav-number">13.25.2.</span> <span class="nav-text">MapEntry.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Maps-java-1"><span class="nav-number">13.25.3.</span> <span class="nav-text">Maps.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CountingMapData-java"><span class="nav-number">13.25.4.</span> <span class="nav-text">CountingMapData.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise23-java"><span class="nav-number">13.25.5.</span> <span class="nav-text">Exercise23.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-24"><span class="nav-number">13.26.</span> <span class="nav-text">Exercise 24</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashSet-java"><span class="nav-number">13.26.1.</span> <span class="nav-text">SimpleHashSet.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Sets-java"><span class="nav-number">13.26.2.</span> <span class="nav-text">Sets.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise24-java"><span class="nav-number">13.26.3.</span> <span class="nav-text">Exercise24.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-25"><span class="nav-number">13.27.</span> <span class="nav-text">Exercise 25</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#LinkedMapEntryV2-java"><span class="nav-number">13.27.1.</span> <span class="nav-text">LinkedMapEntryV2.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashMap25V2-java"><span class="nav-number">13.27.2.</span> <span class="nav-text">SimpleHashMap25V2.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Maps-java-2"><span class="nav-number">13.27.3.</span> <span class="nav-text">Maps.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise25-java"><span class="nav-number">13.27.4.</span> <span class="nav-text">Exercise25.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-26"><span class="nav-number">13.28.</span> <span class="nav-text">Exercise 26</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#EntryPair-java"><span class="nav-number">13.28.1.</span> <span class="nav-text">EntryPair.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CountedString-java"><span class="nav-number">13.28.2.</span> <span class="nav-text">CountedString.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise26-java"><span class="nav-number">13.28.3.</span> <span class="nav-text">Exercise26.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-27"><span class="nav-number">13.29.</span> <span class="nav-text">Exercise 27</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#EntryPair-java-1"><span class="nav-number">13.29.1.</span> <span class="nav-text">EntryPair.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CountedString27-java"><span class="nav-number">13.29.2.</span> <span class="nav-text">CountedString27.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise27-java"><span class="nav-number">13.29.3.</span> <span class="nav-text">Exercise27.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-28"><span class="nav-number">13.30.</span> <span class="nav-text">Exercise 28</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Tuple-java"><span class="nav-number">13.30.1.</span> <span class="nav-text">Tuple.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise28-java"><span class="nav-number">13.30.2.</span> <span class="nav-text">Exercise28.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#package-com-ciaoshen-thinkinjava-chapter17-testframework"><span class="nav-number">13.31.</span> <span class="nav-text">package com.ciaoshen.thinkinjava.chapter17.testframework</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Test-java"><span class="nav-number">13.31.1.</span> <span class="nav-text">Test.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TestParam-java"><span class="nav-number">13.31.2.</span> <span class="nav-text">TestParam.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Tester-java"><span class="nav-number">13.31.3.</span> <span class="nav-text">Tester.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#package-com-ciaoshen-thinkinjava-chapter17-testframework-gen"><span class="nav-number">13.32.</span> <span class="nav-text">package com.ciaoshen.thinkinjava.chapter17.testframework.gen</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Generator-java"><span class="nav-number">13.32.1.</span> <span class="nav-text">Generator.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RandomGenerator-java-2"><span class="nav-number">13.32.2.</span> <span class="nav-text">RandomGenerator.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Generated-java"><span class="nav-number">13.32.3.</span> <span class="nav-text">Generated.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CountingIntegerList-java"><span class="nav-number">13.32.4.</span> <span class="nav-text">CountingIntegerList.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CountingStringList-java"><span class="nav-number">13.32.5.</span> <span class="nav-text">CountingStringList.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CountingGenerator-java"><span class="nav-number">13.32.6.</span> <span class="nav-text">CountingGenerator.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CollectionData-java"><span class="nav-number">13.32.7.</span> <span class="nav-text">CollectionData.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-29"><span class="nav-number">13.33.</span> <span class="nav-text">Exercise 29</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise29-java"><span class="nav-number">13.33.1.</span> <span class="nav-text">Exercise29.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-30"><span class="nav-number">13.34.</span> <span class="nav-text">Exercise 30</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-31"><span class="nav-number">13.35.</span> <span class="nav-text">Exercise 31</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#StringList-java"><span class="nav-number">13.35.1.</span> <span class="nav-text">StringList.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise31-java"><span class="nav-number">13.35.2.</span> <span class="nav-text">Exercise31.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#结果"><span class="nav-number">13.35.3.</span> <span class="nav-text">结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-32"><span class="nav-number">13.36.</span> <span class="nav-text">Exercise 32</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#IntList-java"><span class="nav-number">13.36.1.</span> <span class="nav-text">IntList.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise32-java"><span class="nav-number">13.36.2.</span> <span class="nav-text">Exercise32.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#结果-1"><span class="nav-number">13.36.3.</span> <span class="nav-text">结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-33"><span class="nav-number">13.37.</span> <span class="nav-text">Exercise 33</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#FastTraversalLinkedList-java"><span class="nav-number">13.37.1.</span> <span class="nav-text">FastTraversalLinkedList.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise33-java"><span class="nav-number">13.37.2.</span> <span class="nav-text">Exercise33.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试结果"><span class="nav-number">13.37.3.</span> <span class="nav-text">测试结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-34"><span class="nav-number">13.38.</span> <span class="nav-text">Exercise 34</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise34-java"><span class="nav-number">13.38.1.</span> <span class="nav-text">Exercise34.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试结果-1"><span class="nav-number">13.38.2.</span> <span class="nav-text">测试结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-35"><span class="nav-number">13.39.</span> <span class="nav-text">Exercise 35</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise35-java"><span class="nav-number">13.39.1.</span> <span class="nav-text">Exercise35.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试结果-2"><span class="nav-number">13.39.2.</span> <span class="nav-text">测试结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-36"><span class="nav-number">13.40.</span> <span class="nav-text">Exercise 36</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#BetterSlowMap-java"><span class="nav-number">13.40.1.</span> <span class="nav-text">BetterSlowMap.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SortedSlowMap-java"><span class="nav-number">13.40.2.</span> <span class="nav-text">SortedSlowMap.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise36-java"><span class="nav-number">13.40.3.</span> <span class="nav-text">Exercise36.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SortedSlowMap-V2-java-不需要用sort-排序"><span class="nav-number">13.40.4.</span> <span class="nav-text">SortedSlowMap_V2.java 不需要用sort()排序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试结果-3"><span class="nav-number">13.40.5.</span> <span class="nav-text">测试结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-37"><span class="nav-number">13.41.</span> <span class="nav-text">Exercise 37</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SimpleHashMap37-java"><span class="nav-number">13.42.</span> <span class="nav-text">SimpleHashMap37.java</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise37-java"><span class="nav-number">13.42.1.</span> <span class="nav-text">Exercise37.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#测试结果-4"><span class="nav-number">13.42.2.</span> <span class="nav-text">测试结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-38"><span class="nav-number">13.43.</span> <span class="nav-text">Exercise 38</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#测试结果-5"><span class="nav-number">13.43.1.</span> <span class="nav-text">测试结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-39"><span class="nav-number">13.44.</span> <span class="nav-text">Exercise 39</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RehashSimpleHashMap-java"><span class="nav-number">13.44.1.</span> <span class="nav-text">RehashSimpleHashMap.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise39-java"><span class="nav-number">13.44.2.</span> <span class="nav-text">Exercise39.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-40"><span class="nav-number">13.45.</span> <span class="nav-text">Exercise 40</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Pair-java"><span class="nav-number">13.45.1.</span> <span class="nav-text">Pair.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PairA-java"><span class="nav-number">13.45.2.</span> <span class="nav-text">PairA.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PairB-java"><span class="nav-number">13.45.3.</span> <span class="nav-text">PairB.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise40-java"><span class="nav-number">13.45.4.</span> <span class="nav-text">Exercise40.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-41"><span class="nav-number">13.46.</span> <span class="nav-text">Exercise 41</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Pair-java-1"><span class="nav-number">13.46.1.</span> <span class="nav-text">Pair.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PairA-java-1"><span class="nav-number">13.46.2.</span> <span class="nav-text">PairA.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PairB-java-1"><span class="nav-number">13.46.3.</span> <span class="nav-text">PairB.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SimpleHashMap41-java"><span class="nav-number">13.46.4.</span> <span class="nav-text">SimpleHashMap41.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise41-java"><span class="nav-number">13.46.5.</span> <span class="nav-text">Exercise41.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-42"><span class="nav-number">13.47.</span> <span class="nav-text">Exercise 42</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Pair-java-2"><span class="nav-number">13.47.1.</span> <span class="nav-text">Pair.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PairA-java-2"><span class="nav-number">13.47.2.</span> <span class="nav-text">PairA.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PairB-java-2"><span class="nav-number">13.47.3.</span> <span class="nav-text">PairB.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exercise42-java"><span class="nav-number">13.47.4.</span> <span class="nav-text">Exercise42.java</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沈玮 | Wei SHEN</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>

</br>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div>
  <span id="busuanzi_container_site_pv">
  Visited  <span id="busuanzi_value_site_pv"></span>  times
  </span>

<span id="busuanzi_container_site_pv">&nbsp; &nbsp; | &nbsp; &nbsp;</span>

  <span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span>  Visitors
  </span>
<div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ciaoshen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  





  
  

  
  


</body>
</html>
