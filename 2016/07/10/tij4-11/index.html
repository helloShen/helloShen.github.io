<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="array,containor,list,map,queue,set,容器,数组,映射,表,队列,集合," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="摘要容器，容器，容器我对容器感兴趣的一个重要原因是，我对java.util库的内部实现感兴趣。创造Java的一群人写的java代码，是学习java少有的靠谱的捷径。
Array不是一般意义上的“容器”讲容器之前，请允许我先把Array和其他所有的容器区分开来。它是Java语言内置(compiler-supported type)的数据类型，它是唯一可以存放基本型的容器。而且Array非常地高效。这">
<meta property="og:type" content="article">
<meta property="og:title" content="Thinking in Java 读书笔记：第十一章 - 容器">
<meta property="og:url" content="www.ciaoshen.com/2016/07/10/tij4-11/index.html">
<meta property="og:site_name" content="玮 | Wei">
<meta property="og:description" content="摘要容器，容器，容器我对容器感兴趣的一个重要原因是，我对java.util库的内部实现感兴趣。创造Java的一群人写的java代码，是学习java少有的靠谱的捷径。
Array不是一般意义上的“容器”讲容器之前，请允许我先把Array和其他所有的容器区分开来。它是Java语言内置(compiler-supported type)的数据类型，它是唯一可以存放基本型的容器。而且Array非常地高效。这">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/ArrayMemory1.jpg">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/ArrayMemory2.jpg">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/ArrayMemory3.gif">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/container.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/ll_al.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/linkedlist.jpg">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/hashMap.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/hashMapComplexity.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-11/1000000times.png">
<meta property="og:updated_time" content="2016-10-15T17:29:02.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Thinking in Java 读书笔记：第十一章 - 容器">
<meta name="twitter:description" content="摘要容器，容器，容器我对容器感兴趣的一个重要原因是，我对java.util库的内部实现感兴趣。创造Java的一群人写的java代码，是学习java少有的靠谱的捷径。
Array不是一般意义上的“容器”讲容器之前，请允许我先把Array和其他所有的容器区分开来。它是Java语言内置(compiler-supported type)的数据类型，它是唯一可以存放基本型的容器。而且Array非常地高效。这">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>



  <meta name="baidu-site-verification" content="3iRy3UFlpa" />


<script>
  (function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


  <title> Thinking in Java 读书笔记：第十一章 - 容器 | 玮 | Wei </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74473715-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">玮 | Wei</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Coder & Designer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hDG3wYskg4CYKGSXw8x7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Thinking in Java 读书笔记：第十一章 - 容器
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-07-10T14:32:36-04:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/10/tij4-11/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/10/tij4-11/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span id="busuanzi_container_page_pv">&nbsp; |  &nbsp; &nbsp; Viewed <span id="busuanzi_value_page_pv"></span> times</span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>容器，容器，容器<br>我对容器感兴趣的一个重要原因是，我对java.util库的内部实现感兴趣。创造Java的一群人写的java代码，是学习java少有的靠谱的捷径。</p>
<h3 id="Array不是一般意义上的“容器”"><a href="#Array不是一般意义上的“容器”" class="headerlink" title="Array不是一般意义上的“容器”"></a>Array不是一般意义上的“容器”</h3><p>讲容器之前，请允许我先把Array和其他所有的容器区分开来。它是Java语言内置(compiler-supported type)的数据类型，它是<strong>唯一可以存放基本型的容器</strong>。而且Array非常地高效。<br>这里有一篇好文章：<a href="http://www.ibm.com/developerworks/cn/java/j-arrays/" target="_blank" rel="external"><strong>《历史上的 Collection 类 ― 数组》</strong></a>，可以帮助我们了解Array的基本情况。</p>
<p>Array为什么效率高呢？这要从Array本身在内存中的结构说起（下图）：<br><img src="/uploads/tij4-11/ArrayMemory1.jpg" alt="ArrayMemory1"><br>对于Array的具体实现，有下面几个重要事实：</p>
<ul>
<li>Array是一个对象<strong>Object</strong></li>
<li>Array在Stack栈区只占一个“<strong>long</strong>”型，储存指向在Heap堆区的实际数据首地址的<strong>引用</strong></li>
<li>Array在Heap堆区的具体数据，所占的是“<strong>连续空间</strong>”</li>
</ul>
<p><img src="/uploads/tij4-11/ArrayMemory2.jpg" alt="ArrayMemory2"><br>如上图，多维数组的实现方式，是靠一个“引用的数组”来过度的。第一层数组的每一个地址，只储存指向具体数据数组的一个引用。</p>
<p>Array效率高的秘密，就在于它在内存中占据的空间是连续的。因此如下图，只要掌握了在内存中的首地址，以及数组的长度，对于任意想要的元素，数组只要在首地址基础上加上偏移值，就能找到该元素。而对内存的操作，seek偏移值的开销是非常小的。<br><img src="/uploads/tij4-11/ArrayMemory3.gif" alt="ArrayMemory2"></p>
<p>但连续空间是把双刃剑，副作用是Array<strong>声明的时候必须固定长度，之后不能修改</strong>。这极大地限制了Array的使用，因为大多数的使用场景，声明数据的时候，并不知道我们需要多大的容器。这才导致了后面其他容器的出现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] myArray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br></pre></td></tr></table></figure></p>
<p>由于Java类库已经经历了近20年的改进和打磨，java容器的效率已经有了明显的提升，尤其随着应用场景的复杂化，说Array的效率完胜容器已经不合时宜了。对一些常用的操作，比如说批量插入，或者遍历，容器提供的现成方法的效率，已经可以完胜我们自己用Array慢慢瞎捣鼓的代码了。更不用说对于更复杂的比如说并发应用。自己动手造轮子的时代已经过去了。</p>
<h3 id="java-util类库中的容器"><a href="#java-util类库中的容器" class="headerlink" title="java.util类库中的容器"></a>java.util类库中的容器</h3><p>先声明，这一章只负责告诉读者一些关于util类库定义的容器的一些有用的结论，来帮助我们在编程的时候尽量选择正确合适的容器。至于容器内部的一些算法细节，会在之后的《容器深谈》这一章中探讨。</p>
<p>Java类库java.util提供的容器到底有哪些？下面这张图略简陋，但有助于整理思路。<br><img src="/uploads/tij4-11/container.png" alt="container"></p>
<h4 id="容器两大分支：Collection和Map"><a href="#容器两大分支：Collection和Map" class="headerlink" title="容器两大分支：Collection和Map"></a>容器两大分支：Collection和Map</h4><p>uitl类库容器的共同特征是：<strong>动态调节长度</strong>。为了弥补Array固定长度的遗憾。<br>但鱼和熊掌不可兼得。实现动态扩展数组长度，必然就要牺牲效率，为它们的弹性付出代价。因此它们的效率都不如Array。但它们之所以存在，除了动态长度外，都具备各自特色的功能，各有所长。</p>
<p>总的来说，容器分为两大类，都以接口形式存在，</p>
<ol>
<li><strong>Collection</strong>指的是一组元素的集合。强调的是元素本身。</li>
<li><strong>Map</strong>的特殊功用在于它为每个元素维护的一组“KEY-VALUE”对。Key用来搜索value值。典型的应用就是“词典”。</li>
</ol>
<h4 id="Collection的三大将"><a href="#Collection的三大将" class="headerlink" title="Collection的三大将"></a>Collection的三大将</h4><p>它们也都是接口，而且各有所长，</p>
<ol>
<li><strong>List</strong>：最正统。强调“<strong>一组元素的序列</strong>”。通常是元素插入集合时候的顺序。</li>
<li><strong>Set</strong>：的特点是其中<strong>元素的唯一性</strong>。插入新元素前会检查已有列表，如果已经有了，就不会再插入。</li>
<li><strong>Queue</strong>：虽然也强调的是序列，但更主要的是“<strong>获取下一个元素的顺序</strong>”。最简单的一种就是“FIFO(First In First Out)”先进先出。</li>
</ol>
<h4 id="关于List"><a href="#关于List" class="headerlink" title="关于List"></a>关于List</h4><p>事实上最常用的List只需要记住两种，</p>
<ol>
<li>ArrayList</li>
<li>LinkedList</li>
</ol>
<p>剩下一个<strong>Vector</strong>被作者说成是过时的容器，不推荐使用。而另一个<strong>CopyOnWriteList</strong>是用于并发系统，确保多线程访问时数据同步安全性的，不属于常规使用。</p>
<p>ArrayList和LinkedList它们俩个经常被拿来比较性能。互为对方一生的羁绊。关于它们俩，需要记住的重要事实是，</p>
<ol>
<li>ArrayList的实现基于Array。<strong>精髓在于：随机访问get(int index)方法。复杂度是常数</strong>O(1)。**但缺点是:add(int index, <e> element)，remove(int index)的时候要逐个前移或后移操作位后面的所有元素，所以复杂度是O(n)。</e></li>
<li><strong>LinkedList的精髓在于同时实现了Queue的接口。</strong>在Queue只是个接口，以及Java官方枪毙Stack的情况下，无论是FIFO还是LIFO，都要靠LinkedList来扛起大旗。</li>
<li><strong>总体性能ArrayList完胜。</strong>并不像传说的LinkedList更善于插入和删除动作。LinkedList的add(int index, <e> element)和remove(int index)方法，复杂度要实现O(1)的前提是，你必须提前获得操作元素的引用。不然LinkedList还是需要遍历到那个元素，最坏的情况下仍然是O(n)复杂度。StackOverFlow上关于这个问题的回答：<a href="http://stackoverflow.com/questions/15732334/how-is-linkedlists-addint-e-of-o1-complexity" target="_blank" rel="external"><strong>《How is LinkedList’s add(int, E) of O(1) complexity?》</strong></a></e></li>
</ol>
<p>这里附上1. ArrayList和LinkedList的几个重要操作的复杂度对比：<br><img src="/uploads/tij4-11/ll_al.png" alt="ll_al"></p>
<h4 id="ArrayList的实现"><a href="#ArrayList的实现" class="headerlink" title="ArrayList的实现"></a>ArrayList的实现</h4><p>虽然说好了这章不细究具体实现。但还是忍不住看了一眼java.util.ArrayList的源代码。贴几个重要的片段上来，共赏。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;  <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure>
<p>英雄先问出处，ArrayList继承自AbstractList<e>，是对List接口的一个通用实现。后面实现了4种接口，除了最重要的List<e>之外，Cloneable接口为了调用Object.clone()方法。其他两个RandomAccess和Serializable都是标记型接口，只为了语义功能，并没有定义任何内容。</e></e></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * The array buffer into which the elements of the ArrayList are stored.</span><br><span class="line"> * The capacity of the ArrayList is the length of this array buffer.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Object[] elementData;	<span class="comment">//ArrayList基于Array实现</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * The size of the ArrayList (the number of elements it contains).</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@serial</span></span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size;</span><br></pre></td></tr></table></figure>
<p>接下来看成员字段。关键看到<strong>Object[] elementData</strong>，就知道ArrayList和传说中一样，是基于Array实现的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">    * Constructs an empty list with the specified initial capacity.</span><br><span class="line">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>();</span><br><span class="line">       <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span>+</span><br><span class="line">                                              initialCapacity);</span><br><span class="line">   <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span><br><span class="line">    * Constructs an empty list with an initial capacity of ten.</span><br><span class="line">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>(<span class="number">10</span>);	<span class="comment">//默认长度10</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span><br><span class="line">    * Constructs a list containing the elements of the specified</span><br><span class="line">    * collection, in the order they are returned by the collection's</span><br><span class="line">    * iterator.</span><br><span class="line">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">   elementData = c.toArray();</span><br><span class="line">   size = elementData.length;</span><br><span class="line">   <span class="comment">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class="line">   <span class="keyword">if</span> (elementData.getClass() != Object[].class)</span><br><span class="line">       elementData = Arrays.copyOf(elementData, size, Object[].class);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>3种构造函数，对应于3种不同的声明方式。可以看到，ArrayList的默认初始大小是10。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    ensureCapacity(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!! 可变长度由这个方法实现</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一段是add()方法。看到ensureCapacity(size + 1)这里，ArrayList的可变长度的功能就在这个方法里了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">     * Increases the capacity of this &lt;tt&gt;ArrayList&lt;/tt&gt; instance, if</span><br><span class="line">     * necessary, to ensure that it can hold at least the number of elements</span><br><span class="line">     * specified by the minimum capacity argument.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span>   minCapacity   the desired minimum capacity</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &gt; oldCapacity) &#123;</span><br><span class="line">        Object oldData[] = elementData;</span><br><span class="line">        <span class="keyword">int</span> newCapacity = (oldCapacity * <span class="number">3</span>)/<span class="number">2</span> + <span class="number">1</span>;	<span class="comment">//关键算法：不够了长度就乘以1.5</span></span><br><span class="line">            <span class="keyword">if</span> (newCapacity &lt; minCapacity)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">            <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">            elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可变长度ensureCapacity()方法长这样，代码里一行关键的算法，透露了ArrayList的动态控制长度功能，是在长度不够的时候扩展为原来的1.5倍。不要小看这个简单的1.5倍。肯定是无数次实验的最优配置。智慧的结晶啊。</p>
<p>不能再写下去了，这没有底。以后专门写一个读JDK源代码的笔记吧。</p>
<h5 id="LinkedList的实现"><a href="#LinkedList的实现" class="headerlink" title="LinkedList的实现"></a>LinkedList的实现</h5><p>java.util.LinkedList的源代码也只贴几个重要的片段上来，共赏。先看一个LinkedList数据结构的简单图解，</p>
<p><img src="/uploads/tij4-11/linkedlist.jpg" alt="linkedlist"><br>双链LinkedList的数据结构很简单，由一系列节点组成。每个节点包含一个数据储存单元，和两个指针，分别指向序列中的前一个节点，以及下一个节点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 链表的表头，表头不包含任何数据。Entry是个链表类数据结构。</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Entry&lt;E&gt; header = <span class="keyword">new</span> Entry&lt;E&gt;(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// LinkedList中元素个数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>上面两行就能看出，LinkedList里的节点名叫Entry<e>。初始化的时候只有一个header节点。下面再看节点的数据结构，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 双向链表的节点所对应的数据结构。</span></span><br><span class="line"><span class="comment">// 包含3部分：上一节点，下一节点，当前节点值。</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// 当前节点所包含的值</span></span><br><span class="line">E element;</span><br><span class="line"><span class="comment">// 下一个节点</span></span><br><span class="line">Entry&lt;E&gt; next;</span><br><span class="line"><span class="comment">// 上一个节点</span></span><br><span class="line">Entry&lt;E&gt; previous;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	* 链表节点的构造函数。</span><br><span class="line">	* 参数说明：</span><br><span class="line">	*   element  —— 节点所包含的数据</span><br><span class="line">	*   next      —— 下一个节点</span><br><span class="line">	*   previous —— 上一个节点</span><br><span class="line">	*/</span></span><br><span class="line">	Entry(E element, Entry&lt;E&gt; next, Entry&lt;E&gt; previous) &#123;</span><br><span class="line">    	<span class="keyword">this</span>.element = element;</span><br><span class="line">    	<span class="keyword">this</span>.next = next;</span><br><span class="line">    	<span class="keyword">this</span>.previous = previous;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></e></p>
<p>也很简单，就像之前说的，中间一个element泛型数据本体，一前一后两个指向前一个和下一个节点的指针。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将节点从链表中删除</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">remove</span><span class="params">(Entry&lt;E&gt; e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e == header)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line"></span><br><span class="line">    E result = e.element;	<span class="comment">//复制本体</span></span><br><span class="line">    e.previous.next = e.next;	<span class="comment">//让前一节点的指针跳过它，直接连到它的下一个节点。</span></span><br><span class="line">	e.next.previous = e.previous;	<span class="comment">//相反操作</span></span><br><span class="line">	e.next = e.previous = <span class="keyword">null</span>;	<span class="comment">//消灭节点</span></span><br><span class="line">	e.element = <span class="keyword">null</span>;	<span class="comment">//消灭节点</span></span><br><span class="line">	size--;</span><br><span class="line">	modCount++;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>LinkedList所谓效率胜过ArrayList的remove()方法，每次删除都分两步走：</p>
<ul>
<li>给目标节点的前一结点，和后一节点牵线搭桥，架空目标节点</li>
<li>删除目标节点</li>
</ul>
<h4 id="关于Map"><a href="#关于Map" class="headerlink" title="关于Map"></a>关于Map</h4><p>已经说过，Map的特殊功用在于它为每个元素维护的一组“KEY-VALUE”对。Key用来搜索value值。选用Map的目的在于用户关心根据元素key搜寻元素value值的速度，而对元素在容器中的顺序不在乎。Map就相当于一个小型的搜索引擎。</p>
<p>Map手下最常用的是HashMap。它的<strong>get(Object key)</strong>方法效率最高。大多数情况下，能达到Array的<strong>O(1)</strong>的表现。我这里不想太深入，简单讲几点HashMap实现的大致原理，但实际上HashMap实现的每一步都是值得深究的。</p>
<p><img src="/uploads/tij4-11/hashMap.png" alt="hashMap"><br>如上图，</p>
<ul>
<li>HashMap是由Array和LinkedList共同组成的。(Java 8当链表太长的时候，会自动变成红黑树。)</li>
<li>先开一个很大的Array数组(size=capacity)。</li>
<li>元素直接存放在以hash值为下标的Array槽内。</li>
<li>如果碰撞了，以链表的形式存在Array槽后；</li>
</ul>
<p><strong>put(K key, V value)</strong>方法的步骤如下，</p>
<ul>
<li>对key的hashCode()做hash，然后再计算index;（都是简单的位操作，常数复杂度 O(1)）</li>
<li>直接根据hash值来访问Array的下标。如果没碰撞直接放到bucket里；O(1)；</li>
<li>如果碰撞了，以链表的形式存在buckets后；往后插的过程是要遍历链表每个节点的。所以碰撞严重的话，对HashMap的性能影响严重。</li>
<li>如果碰撞导致链表过长(大于等于TREEIFY_THRESHOLD)，就把链表转换成红黑树；O(logn)；</li>
<li>如果节点已经存在就替换old value(保证key的唯一性)</li>
<li>如果bucket满了(超过load factor*current capacity)，就要resize。</li>
</ul>
<p>综上所述，Java 8开始改成红黑树以后，一般情况下，put(K key, V value)动作是常数复杂度O(1)。最坏情况碰撞严重，最多O(logn)。还是可以接受的。</p>
<p><strong>get(Object key)</strong>方法的步骤如下，</p>
<ul>
<li>bucket里的第一个节点，直接命中，O(1)；</li>
<li>如果有冲突，则通过key.equals(k)去查找对应的entry</li>
<li>若为树，则在树中通过key.equals(k)查找，O(logn)；</li>
<li>若为链表，则在链表中通过key.equals(k)查找，O(n)。</li>
</ul>
<p>综上所述，和插入put()方法一样，Java 8开始改成红黑树以后，一般情况下，搜索get(Object key)动作是常数复杂度O(1)。最坏情况碰撞严重，最多O(logn)。</p>
<p>看下面的HashMap的源码，可以清楚地看到HashMap也是基于Array实现复杂度为O(1)的快速随机访问。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal initial capacity: "</span> +</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal load factor: "</span> +</span><br><span class="line">                                           loadFactor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Find a power of 2 &gt;= initialCapacity</span></span><br><span class="line">    <span class="keyword">int</span> capacity = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (capacity &lt; initialCapacity)</span><br><span class="line">        capacity &lt;&lt;= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">    threshold = (<span class="keyword">int</span>)Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + <span class="number">1</span>);</span><br><span class="line">    table = <span class="keyword">new</span> Entry[capacity];	<span class="comment">//这一行，证明HashMap也是基于Array实现复杂度为O(1)的快速随机访问</span></span><br><span class="line">    useAltHashing = sun.misc.VM.isBooted() &amp;&amp;</span><br><span class="line">            (capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);</span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面这个是HashMap的hash算法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (useAltHashing) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="keyword">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">        &#125;</span><br><span class="line">        h = hashSeed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h ^= k.hashCode();	<span class="comment">//k的哈希值和哈希种子做异或运算（哈希种子为零，就相当于保留哈希值）</span></span><br><span class="line">			<span class="comment">//异或：相同则结果为0，不同则结果为1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// This function ensures that hashCodes that differ only by</span></span><br><span class="line">    <span class="comment">// constant multiples at each bit position have a bounded</span></span><br><span class="line">    <span class="comment">// number of collisions (approximately 8 at default load factor).</span></span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);	<span class="comment">//h和他自己的右位移20位做异或，再和它的右位移12为做异或。</span></span><br><span class="line">    <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);	<span class="comment">//h再和他自己的右位移7位做异或，再和它的右位移4为做异或。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>HashMap的Hash算法具体过程如下，</p>
<ul>
<li>前面一个if先不管它。</li>
<li>通过hashCode()方法获取key的哈希值，和哈希种子做异或运算（哈希种子为零，就相当于保留哈希值）（hashCode()函数先当他黑箱）</li>
<li>h和他自己的右位移20位做异或，再和它的右位移12为做异或。</li>
<li>h再和他自己的右位移7位做异或，再和它的右位移4为做异或。</li>
</ul>
<p>我还不太明白这算法背后的数学意义，但一点是肯定的，从java的hash()算法因为只是简单的位操作，复杂度是常数O(1)。</p>
<p>我另外一个好奇的事是这个Java每个对象自带的<strong>Object.hashCode()</strong>方法，到底是怎么返回哈希值的。毕竟HashMap的代码也都只是在系统给的哈希值的基础上做文章。StackOverFlow该问题的最高票答案<a href="http://stackoverflow.com/questions/2427631/how-is-hashcode-calculated-in-java" target="_blank" rel="external"><strong>《How is hashCode() calculated in Java?》</strong></a>是这样说的：</p>
<blockquote>
<p>hashCode()是每个对象自带的方法。但几乎每个类都会重写这个方法。所以hashCode()的哈希值计算方法每种数据类型都是不同的。</p>
</blockquote>
<p>下面举两个最常用的例子，int整型的哈希值等于它本身。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>String的哈希值算法稍微复杂一点，基本就是根据它自身的长度迭代，每次都乘以31再加上它的偏移值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> off = offset;</span><br><span class="line">        <span class="keyword">char</span> val[] = value;</span><br><span class="line">        <span class="keyword">int</span> len = count;</span><br><span class="line">  <span class="comment">//关键算法在这里</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            h = <span class="number">31</span>*h + val[off++];</span><br><span class="line">        &#125;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对于HashMap具体的工作原理，会在以后的章节深入研究。下图总结一下HashMap的put(K key, V value)方法和get(Object key)方法的具体复杂度：<br><img src="/uploads/tij4-11/hashMapComplexity.png" alt="hashMapComplexity"></p>
<p>最后，如果我们希望Map中元素以某种特殊的比较顺序排列，可以用<strong>TreeMap</strong>。如果希望元素保持插入时的顺序，可以用<strong>LinkedHashMap</strong>。但效率方面就要打一点折扣了。</p>
<h5 id="关于Set"><a href="#关于Set" class="headerlink" title="关于Set"></a>关于Set</h5><p>前文说了Set是为了保持集合中元素的唯一性。和Map一样，同样有三种不同的实现：</p>
<ul>
<li><strong>HashSet</strong>：非插入顺序，重点是get()搜索的高效。</li>
<li><strong>TreeSet</strong>：按元素的比较顺序排列。</li>
<li><strong>LinkedSet</strong>：保持插入顺序。</li>
</ul>
<p>其中最常用的还是HashSet。TreeSet主要用于排序。排序算法取决于给定的<strong>Comparator</strong>。比如<strong>String.CASE_INSENSITIVE_ORDER</strong>.(按字母升序)</p>
<p>#####关于Queue<br>Queue接口有两个主要实现：</p>
<ul>
<li><strong>LinkedList</strong>：不算Queue的嫡系，但却是最常用的。经常被用来面向Queue接口编程。</li>
<li><strong>PriorityQueue</strong>：和TreeSet一样，可以根据给出的Comparator维持特定的排序。</li>
</ul>
<h5 id="关于Iterator迭代器和容器接口"><a href="#关于Iterator迭代器和容器接口" class="headerlink" title="关于Iterator迭代器和容器接口"></a>关于Iterator迭代器和容器接口</h5><p>设计Iterator迭代器的最重要原因不是为了迭代的效率。因为用普通的for语句迭代同样高效。</p>
<p><strong>Iterator的真正目的是为了让使用不同容器的代码之间可以去耦合。</strong></p>
<p>容器根据功能用途的不同，都被统一设计成了接口。Collection，List, Set, Map最常用的四大接口。和Iterator一样，为使用不同容器的代码去耦合才是设计这些接口的真正用意。</p>
<p>实际上，对于程序员自己开发的新容器而言，实现Iterator接口远比实现Collection接口要容易。因为Iterator接口只定义了hasNext()和next()两大方法。而Collection则复杂地多。因此Iterator才是简单去耦合的最佳方法。C++没有Collection接口，只有Iterator。</p>
<p>另外一个关于Iterator，我必须知道的是是：Java的foreach语法是面向Iterable接口的。任何类只要实现了Iterable接口都可以用foreach语法。foreach语法长这样，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Element e : Collection&lt;Element&gt;)&#123;</span><br><span class="line">	<span class="comment">//do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>记住，所有Collection接口都实现了Iterable接口。但Maps和Array没有。</p>
<h5 id="关于过时的容器"><a href="#关于过时的容器" class="headerlink" title="关于过时的容器"></a>关于过时的容器</h5><p>书中作者提到的明确过时的容器有三个，这三个好汉分别是：</p>
<ul>
<li><strong>Vector</strong></li>
<li><strong>HashTable</strong></li>
<li><strong>Stack</strong></li>
</ul>
<h4 id="关于Utilities"><a href="#关于Utilities" class="headerlink" title="关于Utilities"></a>关于Utilities</h4><p>Utilities就是对于容器的一组实用静态方法。本身不需要实例化，专门用来操作对应类型的容器实例。<br>三大Utilities，分别用来专门操作各自的对应容器，</p>
<ul>
<li><strong>Collections</strong></li>
<li><strong>Arrays</strong></li>
<li><strong>Maps</strong></li>
</ul>
<p>里面都是静态的方法。</p>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><h4 id="Exercise-16"><a href="#Exercise-16" class="headerlink" title="Exercise 16"></a>Exercise 16</h4><p>(5) Create a Set of the vowels. Working from UniqueWords.Java, count and display the number of vowels in each input word, and also display the total number of vowels in the input file.</p>
<h5 id="1-0版：成绩-30-997490毫秒"><a href="#1-0版：成绩-30-997490毫秒" class="headerlink" title="1.0版：成绩 30.997490毫秒"></a>1.0版：成绩 30.997490毫秒</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter11;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UniqueWords</span> </span>&#123;</span><br><span class="line">    <span class="comment">//the main function</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">(String address)</span></span>&#123;</span><br><span class="line">        <span class="comment">//calculate the time</span></span><br><span class="line">        <span class="keyword">long</span> start_time = System.nanoTime();</span><br><span class="line">        <span class="comment">//my action</span></span><br><span class="line">        countVowels(toWords(getStream(address)));</span><br><span class="line">        <span class="keyword">long</span> end_time = System.nanoTime();</span><br><span class="line">        <span class="keyword">double</span> difference = (end_time - start_time)/<span class="number">1e6</span>;</span><br><span class="line">        System.out.println(difference);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//read the text into a string from a text file</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getStream</span><span class="params">(String address)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>(BufferedReader br=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(address)))&#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">            String line=br.readLine();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//read file line by line and add them to te StringBuilder</span></span><br><span class="line">            <span class="keyword">while</span>(line!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                sb.append(line+System.lineSeparator());</span><br><span class="line">                line=br.readLine();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//just for test</span></span><br><span class="line">            <span class="comment">//System.out.println(sb.toString());</span></span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            <span class="comment">// insert code to run when exception occurs</span></span><br><span class="line">            System.out.println(<span class="string">"We cannot find your file! Please check and try again!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//segement the string stream to a list of words</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">toWords</span><span class="params">(String inStream)</span></span>&#123;</span><br><span class="line">        List&lt;String&gt; linesList=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        List&lt;String&gt; wordsList=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//cut line by line</span></span><br><span class="line">        linesList.addAll(Arrays.asList(inStream.split(System.lineSeparator())));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//split each line into list of words</span></span><br><span class="line">        <span class="keyword">for</span>(String line : linesList)&#123;</span><br><span class="line">            wordsList.addAll(Arrays.asList(line.split(<span class="string">" "</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//just for test</span></span><br><span class="line">        <span class="comment">//System.out.println(wordsList.toString());</span></span><br><span class="line">        <span class="keyword">return</span> wordsList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//optional step: I had hoped to optimize the effectiveness</span></span><br><span class="line">    <span class="comment">//sort each words in the word list</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">sortWords</span><span class="params">(List&lt;String&gt; wordsList)</span></span>&#123;</span><br><span class="line">        <span class="comment">//output sorted words list</span></span><br><span class="line">        List&lt;String&gt; sortedWords=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="comment">//store the words already sorted</span></span><br><span class="line">        Map&lt;String,String&gt; sortedMap=<span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//sort only one time for each word</span></span><br><span class="line">        <span class="keyword">for</span>(String word : wordsList)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sortedMap.containsKey(word))&#123;</span><br><span class="line">                sortedWords.add(sortedMap.get(word));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">char</span>[] wordChars=word.toCharArray();</span><br><span class="line">                Arrays.sort(wordChars);</span><br><span class="line">                String sorted=String.valueOf(wordChars);</span><br><span class="line">                sortedWords.add(sorted);</span><br><span class="line">                sortedMap.put(word,sorted);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//just for test</span></span><br><span class="line">        <span class="comment">//System.out.println(sortedWords.toString());</span></span><br><span class="line">        <span class="keyword">return</span> sortedWords;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//count and display the number of vowels in each word</span></span><br><span class="line">    <span class="comment">//count and display the total number of vowels in the input file</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">countVowels</span><span class="params">(List&lt;String&gt; wordsList)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> totalVowelNum=<span class="number">0</span>;</span><br><span class="line">        List&lt;Integer&gt; numList=<span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span>(String word : wordsList)&#123;</span><br><span class="line">            <span class="comment">//call countVowelsForEachWord()</span></span><br><span class="line">            <span class="keyword">int</span> vowelNum=countVowelsForEachWord(word);</span><br><span class="line">            numList.add(<span class="keyword">new</span> Integer(vowelNum));</span><br><span class="line">            <span class="comment">//calculate the total num</span></span><br><span class="line">            totalVowelNum+=vowelNum;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//print</span></span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt; Number of vowel in each word:   "</span>);</span><br><span class="line">        System.out.println(numList.toString());</span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt; Total number of vowel in this file:   "</span>);</span><br><span class="line">        System.out.println(totalVowelNum);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//calculate the number of vowel of a given word</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">countVowelsForEachWord</span><span class="params">(String inWord)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> vowelNum=<span class="number">0</span>;</span><br><span class="line">        String[] wordChars=inWord.split(<span class="string">""</span>);</span><br><span class="line">        <span class="keyword">for</span>(String s : wordChars)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Vowels.VOWEL.contains(s))&#123;</span><br><span class="line">                vowelNum++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> vowelNum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//test action</span></span><br><span class="line">        UniqueWords.action(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter11/UniqueWords.java"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="官方答案：-成绩：12-664569毫秒"><a href="#官方答案：-成绩：12-664569毫秒" class="headerlink" title="官方答案： 成绩：12.664569毫秒"></a>官方答案： 成绩：12.664569毫秒</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Vowels16</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">vowelCounter</span><span class="params">(Set&lt;String&gt; st)</span> </span>&#123;</span><br><span class="line">        Set&lt;Character&gt; vowels = <span class="keyword">new</span> TreeSet&lt;Character&gt;();</span><br><span class="line">        Collections.addAll(vowels,</span><br><span class="line">                           <span class="string">'A'</span>, <span class="string">'E'</span>, <span class="string">'I'</span>, <span class="string">'O'</span>, <span class="string">'U'</span>, <span class="string">'a'</span>, <span class="string">'e'</span>, <span class="string">'i'</span>, <span class="string">'o'</span>, <span class="string">'u'</span>);</span><br><span class="line">        <span class="keyword">int</span> allVowels = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(String s : st) &#123;</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(Character v : s.toCharArray()) &#123;</span><br><span class="line">                <span class="keyword">if</span>(vowels.contains(v)) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                    allVowels++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//System.out.print(s + ": " + count + ", ");</span></span><br><span class="line">            <span class="comment">//System.out.print(count + ", ");</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"Total vowels: "</span> + allVowels);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//calculate the time</span></span><br><span class="line">        <span class="keyword">long</span> start_time = System.nanoTime();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//main action begin</span></span><br><span class="line">        Set&lt;String&gt; words = <span class="keyword">new</span> TreeSet&lt;String&gt;(UniqueWords.toWords(UniqueWords.getStream(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter11/UniqueWords.java"</span>)));</span><br><span class="line">        <span class="comment">//System.out.println(words);</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        vowelCounter(words);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//calculate the time</span></span><br><span class="line">        <span class="keyword">long</span> end_time = System.nanoTime();</span><br><span class="line">        <span class="keyword">double</span> difference = (end_time - start_time)/<span class="number">1e6</span>;</span><br><span class="line">        System.out.println(difference);</span><br><span class="line">    &#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="优化之后：6-171586毫秒-String-V-s-Char"><a href="#优化之后：6-171586毫秒-String-V-s-Char" class="headerlink" title="优化之后：6.171586毫秒    String V.s. Char"></a>优化之后：6.171586毫秒    String V.s. Char</h5><p>我的用时是答案的3倍。我完败！为什么呢？</p>
<p>查看答案源码，发现一个重要差别是我的元音集合是一个字符串集合Set<string>。而答案用的是Set<char>。因此每次比较字母和元音集合的时候用的是TreeSet的contains()方法，我都是在比较两个String，而答案比较的是两个char。明显另外，每次把单词切割成字母的时候，我用split()，答案用toCharArray()。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//calculate the number of vowel of a given word</span></span><br><span class="line"><span class="comment">//V2.0: Char + toCharArray()</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">countVowelsForEachCharWord</span><span class="params">(String inWord)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> vowelNum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span>[] wordChars=inWord.toCharArray();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">char</span> c : wordChars)&#123;</span><br><span class="line">        <span class="keyword">if</span>(VOWELCHAR.contains(c))&#123;</span><br><span class="line">            vowelNum++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vowelNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></char></string></p>
<p>所以我重写了一个用Set<character>来储存元音字母，然后检查每个字母是否在元音集合中的时候比较两个char类型。</character></p>
<p>结果速度一下子快了5倍：<strong>6.171586</strong>毫秒。说明比较两个char的效率要比比较两个String快多了。具体原因，以后再说。</p>
<h4 id="Exercise-20"><a href="#Exercise-20" class="headerlink" title="Exercise 20"></a>Exercise 20</h4><p><strong>Exercise 20</strong>: (3) Modify Exercise 16 so that you keep a count of the occurrence of each vowel.</p>
<p>之前的读取文本文件字符流的方法不变，只改一下两个计数函数。因为结果要按每个元音计数，所以容器改用HashMap。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//count and display the total number of each vowels in the input file</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">countEachVowels</span><span class="params">(List&lt;String&gt; wordsList)</span></span>&#123;</span><br><span class="line">    <span class="comment">//initialize the result container</span></span><br><span class="line">    Map&lt;Character,Integer&gt; resultMap=<span class="keyword">new</span> HashMap&lt;Character,Integer&gt;();</span><br><span class="line">    <span class="comment">//count for each word</span></span><br><span class="line">    <span class="keyword">for</span>(String word : wordsList)&#123;</span><br><span class="line">        <span class="comment">//call method countEachVowelsForEachCharWord()</span></span><br><span class="line">        countEachVowelsForEachCharWord(word, resultMap);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//print</span></span><br><span class="line">    System.out.println(resultMap.toString());</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//calculate the number of each vowel of a given word</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">countEachVowelsForEachCharWord</span><span class="params">(String inWord, Map&lt;Character,Integer&gt; resultMap)</span></span>&#123;</span><br><span class="line">    <span class="comment">//cut words into char[]</span></span><br><span class="line">    <span class="keyword">for</span>(Character c : inWord.toCharArray())&#123;</span><br><span class="line">        <span class="keyword">if</span>(VOWELCHAR.contains(c))&#123;</span><br><span class="line">            <span class="keyword">for</span>(Character ch : VOWELCHAR)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ch.equals(c))&#123;</span><br><span class="line">                    Integer i=resultMap.get(ch);</span><br><span class="line">                    resultMap.put(ch,i==<span class="keyword">null</span> ? <span class="number">1</span> : i+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>速度是：<strong>12.101357毫秒</strong>。</p>
<h4 id="Exercise-21"><a href="#Exercise-21" class="headerlink" title="Exercise 21"></a>Exercise 21</h4><p><strong>Exercise 21</strong>: (3) Using a Map<string,integer>, follow the form of UniqueWords.java to create a program that counts the occurrence of words in a file. Sort the results using Collections.sort( ) with a second argument of String.CASE_INSENSITIVE_ORDER (to produce an alphabetic sort), and display the result.</string,integer></p>
<p>改成统计单词，原理还是一样的，还是用HashMap。切成单词一个个往里put。最后计算完，单独把Map的key部分完整的拿出来，放到一个List里，开始用Collections.sort()方法排序。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//counts the occurrence of words in a file</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">countWordsOccurence</span><span class="params">(List&lt;String&gt; wordsList)</span></span>&#123;</span><br><span class="line">    Map&lt;String, Integer&gt; wordsMap=<span class="keyword">new</span> HashMap&lt;String,Integer&gt;();</span><br><span class="line">    <span class="keyword">for</span>(String word : wordsList)&#123;</span><br><span class="line">        Integer i=wordsMap.get(word);</span><br><span class="line">        wordsMap.put(word, i==<span class="keyword">null</span>? <span class="number">1</span>:i+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//sort key of the wordsMap</span></span><br><span class="line">    List&lt;String&gt; keyList=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    keyList.addAll(wordsMap.keySet());</span><br><span class="line">    Collections.sort(keyList,String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//print</span></span><br><span class="line">    <span class="keyword">for</span>(String s : keyList)&#123;</span><br><span class="line">        Integer i=wordsMap.get(s);</span><br><span class="line">        System.out.println(s+<span class="string">":     "</span>+(i==<span class="keyword">null</span>? <span class="number">0</span>:i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>速度是：<strong>17.703760毫秒</strong>。</p>
<h4 id="Exercise-22"><a href="#Exercise-22" class="headerlink" title="Exercise 22"></a>Exercise 22</h4><p><strong>Exercise 22</strong>: (5) Modify the previous exercise so that it uses a class containing a String and a count field to store each different word, and a Set of these objects to maintain the list of words.</p>
<p>这道题就有故事了。答案竟然是错的。</p>
<p>题要我们要我们自己写一个包含一个String字段和int字段的数据类型。姑且叫它StrEntry。然后创建一个以此数据类型为元素的Set集合。然后仍然用这个集合做上一题一样的单词频率统计。</p>
<p>因为做过了上一题，就知道干这事儿，Map是最好的选择。因为只需要切好词以后，一个一个往HashMap里put就好。不一样的单词，因为单词本身是Map的key，所以第一不会出现Key值单词重复的情况。第二，还有一个value值可以储存频率。</p>
<p>但如果用Set就麻烦了，首先Set不像HashMap是二维的，说白了它只有一个数组。就算我们的元素StrEntry设计成既能存单词，又能存频率。但马上另一个问题就来了，Set的add()方法，既然能保持元素的单一性，就肯定要有个比较是不是相等的过程。String的”比较”方法都是自带的，我们自己设计的数据类型就没有了。</p>
<p>所以难点在于，弄清楚Set内部保持元素单一性的机制。看它在add()方法插入新元素的时候，是如何判断此元素是否存在的。</p>
<p>经过反复上网查，反复读源代码，发现下面几个重要事实，</p>
<ul>
<li>Set的后台是基于HashMap来去重的。</li>
<li>Set元素整个被当成HashMap的key，插入HashMap。利用HashMap的key不重复的特性，去重。</li>
<li>HashMap确定一个元素是否是”同一个“元素看两点：<strong>第一，哈希函数hashCode()返回的哈希值</strong>。<strong>第二，元素的equal()函数返回true</strong>。两个条件必须同时满足。</li>
</ul>
<p>根据这篇文章，<a href="http://nicholas.ren/2010/09/27/unique-element-in-set.html" target="_blank" rel="external"><strong>《Set中如何保证元素的唯一性》</strong></a>，HashMap判断元素“相同”的两个依据，就在下面这段代码中，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)  &#123;</span><br><span class="line">        <span class="keyword">return</span> putForNullKey(value);  </span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">int</span> hash = hash(key.hashCode());  </span><br><span class="line">    <span class="keyword">int</span> i = indexFor(hash, table.length);  </span><br><span class="line">    <span class="keyword">for</span> (Entry e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;  </span><br><span class="line">        Object k;  </span><br><span class="line">        <span class="comment">/** </span><br><span class="line">        * 1. 先判断A.hashCode() == B.hashCode(); </span><br><span class="line">        * 2. 再判断 A和B要么是同一个对象(比较难达成)，要么equals()函数返回ture</span><br><span class="line">		* 1,2两个条件同时满足是，才说明A和B的值是相同的。</span><br><span class="line">        */</span>      </span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;  </span><br><span class="line">                V oldValue = e.value;  </span><br><span class="line">                e.value = value;  </span><br><span class="line">                e.recordAccess(<span class="keyword">this</span>);  </span><br><span class="line">                <span class="keyword">return</span> oldValue;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        modCount++;  </span><br><span class="line">        addEntry(hash, key, value, i);  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>知道了这两个线索，证明在我的StrEntry元素里只要我重写hashCode()和equals()两个函数，就可以让HashMap能判断他们的唯一性。我的策略是让这两个函数都依据StrEntry里的String字段来计算。下面是我的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrEntry</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWord</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> word;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOccurence</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> occurence;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String inWord, <span class="keyword">int</span> inOccurence)</span></span>&#123;</span><br><span class="line">        word=inWord;</span><br><span class="line">        occurence=inOccurence;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"[Word: "</span>+word+<span class="string">";   Frequence: "</span>+occurence+<span class="string">"]   "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//必须重写equals()函数</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(obj==<span class="keyword">null</span> || getClass()!=obj.getClass())&#123;	<span class="comment">//用getClass()获取runtime参数的实际类型</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            StrEntry se=(StrEntry)obj;	<span class="comment">//向下转型，做窄化处理。也可以用getClass()来获取runtime数据类型</span></span><br><span class="line">            <span class="keyword">if</span>(word.equals(se.getWord()))&#123;	<span class="comment">//只针对String型的word字段计算equals()返回值</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//必须重写hashCode()函数。</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> word.hashCode();	<span class="comment">//只针对String型的word字段计算哈希值</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StrEntry</span><span class="params">(String inWord,<span class="keyword">int</span> inFreq)</span></span>&#123;</span><br><span class="line">        word=inWord;</span><br><span class="line">        occurence=inFreq;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StrEntry</span><span class="params">(String inWord)</span></span>&#123;</span><br><span class="line">        word=inWord;</span><br><span class="line">        occurence=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> String word=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> occurence=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里对equals()函数要解释一下，因为它的参数定义成了Object接口，所以里面要用getClass()获取runtime参数的实际类型，向下转型，做窄化处理。这是<a href="http://stackoverflow.com/questions/8180430/how-to-override-equals-method-in-java" target="_blank" rel="external"><strong>《StackOverFlow对这个问题的答案》</strong></a>。</p>
<p>下面是调用StrEntry元素的字数统计函数的代码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//counts the occurrence of words in a file</span></span><br><span class="line"><span class="comment">//use Set&lt;StrEntry&gt; as the result container</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">countWordsOccurenceWithStrEntry</span><span class="params">(List&lt;String&gt; wordsList)</span></span>&#123;</span><br><span class="line">    <span class="comment">//initialize Set&lt;StrEntry&gt;</span></span><br><span class="line">    Set&lt;StrEntry&gt; resultSet=<span class="keyword">new</span> HashSet&lt;StrEntry&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(String word : wordsList)&#123;</span><br><span class="line">        Iterator&lt;StrEntry&gt; it = resultSet.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            StrEntry se=it.next();</span><br><span class="line">            <span class="keyword">if</span>(se.getWord().equals(word))&#123;</span><br><span class="line">                se.set(word, se.getOccurence()+<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        resultSet.add(<span class="keyword">new</span> StrEntry(word,<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(resultSet.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后我的成绩是：<strong>20.779154毫秒</strong>。</p>
<h5 id="答案错了"><a href="#答案错了" class="headerlink" title="答案错了"></a>答案错了</h5><p>奇怪的是，答案里有两个怪的地方：<br>第一，它重写hashCode()和equals()两个方法，导致往Set里插的时候，Set无法知道元素是否相等，每个都插入，有好多重复，完全失去了Set的作用。<br>第二，我对每个单词只遍历一遍复杂度O(n)，它是两个遍历的for，复杂度O(n平方)。这样的低级错误，这本书里不该犯啊。</p>
<p>最后的结果，它的程序跑了<strong>72.885607毫秒</strong>。我完胜！<br>下面是答案的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Word</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> totalWords = <span class="number">0</span>;</span><br><span class="line">    String s;</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">    Word(String s, <span class="keyword">int</span> count) &#123;</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">        totalWords++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> s + <span class="string">": "</span> + count; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Word22</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//calculate the time</span></span><br><span class="line">        <span class="keyword">long</span> start_time = System.nanoTime();</span><br><span class="line">        <span class="comment">//action</span></span><br><span class="line">        List&lt;String&gt; words = <span class="keyword">new</span> ArrayList&lt;String&gt;(UniqueWords.toWords(UniqueWords.getStream(<span class="string">"/Users/Wei/java/com/ciaoshen/thinkinjava/chapter11/UniqueWords.java"</span>)));</span><br><span class="line">        Collections.sort(words, String.CASE_INSENSITIVE_ORDER);</span><br><span class="line">        System.out.println(<span class="string">"Words to count, sorted: "</span> + words);</span><br><span class="line">        Set&lt;Word&gt; wordObjects = <span class="keyword">new</span> HashSet&lt;Word&gt;();</span><br><span class="line">        Iterator&lt;String&gt; it = words.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">            String s = it.next();</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.size(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(s.equals(words.get(i))) count++;</span><br><span class="line">            &#125;</span><br><span class="line">            Word w = <span class="keyword">new</span> Word(s, count);</span><br><span class="line">            wordObjects.add(w);</span><br><span class="line">        &#125;		</span><br><span class="line">        System.out.println(<span class="string">"Word count: "</span> + wordObjects);</span><br><span class="line">        System.out.println(<span class="string">"Total words: "</span> + Word.totalWords);</span><br><span class="line">        <span class="comment">//calculate time</span></span><br><span class="line">        <span class="keyword">long</span> end_time = System.nanoTime();</span><br><span class="line">        <span class="keyword">double</span> difference = (end_time - start_time)/<span class="number">1e6</span>;</span><br><span class="line">        System.out.println(difference);</span><br><span class="line"></span><br><span class="line">    &#125;		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>####Exercise 30</p>
<blockquote>
<p>(5) Modify CollectionSequence.java so that it does not inherit from AbstractCollection, but instead implements Collection.</p>
</blockquote>
<p>这道题很麻烦。Implement整个Collection真的很麻烦。所以作者是对的，实现Iterator简单多了。</p>
<p>问题是我对泛型还有点问题。尤其是对<strong>Collection&lt;?&gt;</strong>这样的表达还有点不习惯。所以只能简单地在我的容器<strong>StrEntrySequence</strong>里放了一个ArrayList，然后所有的方法都基于ArrayList来完成。等于套了一个proxy代理类。</p>
<p>简单说就是我的StrEntrySequence是专门用来储存StrEntry类型数据的一个列表。StrEntry是一个有一个String字段和一个int字段的符合数据类型。这是很奇怪的一个数据结构，不具有实用性，只是为了练习。</p>
<p>然后<strong>contains()</strong>方法，我做了点特殊处理，接受一个String 做参数。只比较StrEntry的word字段，有相同的String就返回true。相当于查字典。</p>
<h5 id="StrEntrySequence-java"><a href="#StrEntrySequence-java" class="headerlink" title="StrEntrySequence.java"></a>StrEntrySequence.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrEntrySequence</span> <span class="keyword">implements</span> <span class="title">Collection</span>&lt;<span class="title">StrEntry</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  IMPLEMENT COLLECTION INTERFACE</span><br><span class="line">     *  ALL BASED ON ARRAYLIST</span><br><span class="line">     */</span></span><br><span class="line">    <span class="comment">//Ensures that this collection contains the specified element (optional operation).</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(StrEntry se)</span></span>&#123;</span><br><span class="line">        sel.add(se);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Adds all of the elements in the specified collection to this collection (optional operation).</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span>	<span class="title">addAll</span><span class="params">(Collection&lt;? extends StrEntry&gt; c)</span></span>&#123;</span><br><span class="line">        sel.addAll(c);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Removes all of the elements from this collection (optional operation).</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(StrEntry se : sel)&#123;</span><br><span class="line">            sel.remove(se);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Returns true if this collection contains the specified element.</span></span><br><span class="line">    <span class="comment">//here I only check the "word" field of the element.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(StrEntry se : sel)&#123;</span><br><span class="line">            <span class="keyword">if</span>(se.getWord().equals((String)o))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this collection contains all of the elements in the specified collection.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span>	<span class="title">containsAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(c.getClass()==getClass())&#123;</span><br><span class="line">            <span class="keyword">for</span>(Object o : c)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!sel.contains((String)o))&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Compares the specified object with this collection for equality.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span>	<span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(getClass()!=o.getClass())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!sel.containsAll((Collection)o))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns the hash code value for this collection.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span>	<span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hashValue=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(StrEntry se : sel)&#123;</span><br><span class="line">            hashValue+=se.hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hashValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns true if this collection contains no elements.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span>	<span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sel.size()==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns an iterator over the elements in this collection.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;StrEntry&gt;	<span class="title">iterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;StrEntry&gt;()&#123;</span><br><span class="line">            <span class="keyword">int</span> pointer=<span class="number">0</span>;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> pointer==sel.size();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> StrEntry <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> sel.get(pointer++);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(pointer&lt;sel.size())&#123;</span><br><span class="line">                    sel.remove(pointer);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Removes a single instance of the specified element from this collection, if it is present (optional operation).</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span>	<span class="title">remove</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!sel.contains((StrEntry)o))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sel.remove((StrEntry)o);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Removes all of this collection's elements that are also contained in the specified collection (optional operation)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span>	<span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!sel.containsAll(c))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(Object o : c)&#123;</span><br><span class="line">                sel.remove((StrEntry)o);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Retains only the elements in this collection that are contained in the specified collection (optional operation).</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span>	<span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(StrEntry se : sel)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!c.contains(se))&#123;</span><br><span class="line">                sel.remove(se);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns the number of elements in this collection.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span>	<span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sel.size();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns an array containing all of the elements in this collection.</span></span><br><span class="line">    <span class="keyword">public</span> Object[] toArray()&#123;</span><br><span class="line">        <span class="keyword">return</span> sel.toArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Returns an array containing all of the elements in this collection; the runtime type of the returned array is that of the specified array.</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T[]	toArray(T[] a)&#123;</span><br><span class="line">        <span class="keyword">return</span> a;   <span class="comment">//do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.isEmpty())&#123;</span><br><span class="line">            String result=<span class="string">""</span>;</span><br><span class="line">            <span class="keyword">for</span>(StrEntry se : sel)&#123;</span><br><span class="line">                result=result+<span class="string">"["</span>+se.getWord()+<span class="string">": "</span>+se.getOccurence()+<span class="string">"]    "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;StrEntry&gt; sel=<span class="keyword">new</span> ArrayList&lt;StrEntry&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//container &amp; iterator</span></span><br><span class="line">        StrEntrySequence sesTest=<span class="keyword">new</span> StrEntrySequence();</span><br><span class="line">        Iterator&lt;StrEntry&gt; it=sesTest.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//fil container</span></span><br><span class="line">        StrEntry.StrEntries generator=StrEntry.getGenerator();</span><br><span class="line">        generator.generate(<span class="number">10</span>, sesTest);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//print</span></span><br><span class="line">        System.out.println(sesTest.toString());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//test contains() method</span></span><br><span class="line">        String fakeName=<span class="string">"kajihamata"</span>;</span><br><span class="line">        String realName=it.next().getWord();</span><br><span class="line">        </span><br><span class="line">        System.out.println(fakeName+<span class="string">"?  "</span>+sesTest.contains(fakeName));</span><br><span class="line">        System.out.println(realName+<span class="string">"?  "</span>+sesTest.contains(realName));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="StrEntry-java"><a href="#StrEntry-java" class="headerlink" title="StrEntry.java"></a>StrEntry.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter11;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter9.RandomJpName;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrEntry</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWord</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> word;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOccurence</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> occurence;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String inWord, <span class="keyword">int</span> inOccurence)</span></span>&#123;</span><br><span class="line">        word=inWord;</span><br><span class="line">        occurence=inOccurence;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"[Word: "</span>+word+<span class="string">";   Frequence: "</span>+occurence+<span class="string">"]   "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(obj==<span class="keyword">null</span> || getClass()!=obj.getClass())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            StrEntry se=(StrEntry)obj;</span><br><span class="line">            <span class="keyword">if</span>(word.equals(se.getWord()))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> word.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  INNER FACTORY CLASS</span><br><span class="line">     *  fil a list container with random japanese name</span><br><span class="line">	 *	import the RndomJpName class in chapter 9</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StrEntries</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generate</span><span class="params">(<span class="keyword">int</span> inNum, Collection&lt;StrEntry&gt; container)</span></span>&#123;</span><br><span class="line">            Scanner s = <span class="keyword">new</span> Scanner(RandomJpName.createJpNameGenerator(inNum));</span><br><span class="line">            <span class="keyword">while</span>(s.hasNext())&#123;</span><br><span class="line">                container.add(<span class="keyword">new</span> StrEntry(s.next(),<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StrEntries <span class="title">getGenerator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StrEntry.StrEntries();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StrEntry</span><span class="params">(String inWord,<span class="keyword">int</span> inFreq)</span></span>&#123;</span><br><span class="line">        word=inWord;</span><br><span class="line">        occurence=inFreq;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StrEntry</span><span class="params">(String inWord)</span></span>&#123;</span><br><span class="line">        word=inWord;</span><br><span class="line">        occurence=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> String word=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> occurence=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="这题的答案很偷懒"><a href="#这题的答案很偷懒" class="headerlink" title="这题的答案很偷懒"></a>这题的答案很偷懒</h5><p>对于大多数要使用到泛型的方法，都直接用一个runtime exception跳过了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionSequence30</span> <span class="keyword">implements</span> <span class="title">Collection</span>&lt;<span class="title">Pet</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Pet[] pets = Pets.createArray(<span class="number">8</span>);</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> pets.length; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator&lt;Pet&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Iterator&lt;Pet&gt;() &#123;</span><br><span class="line">			<span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> index &lt; pets.length; </span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> Pet <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> pets[index++]; &#125;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123; <span class="comment">// not implemented</span></span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.size() != <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">for</span>(Pet p : pets)</span><br><span class="line">			p = <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends Pet&gt; c)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span> </span>&#123;	</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">this</span>.size() == <span class="number">0</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Pet p)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">		<span class="keyword">return</span> pets;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">       &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		CollectionSequence30 c = <span class="keyword">new</span> CollectionSequence30();</span><br><span class="line">		InterfaceVsIterator.display(c);</span><br><span class="line">		InterfaceVsIterator.display(c.iterator());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Exercise-4"><a href="#Exercise-4" class="headerlink" title="Exercise 4"></a>Exercise 4</h4><blockquote>
<p>(3) Create a generator class that produces character names (as String objects) from your favorite movie (you can use Snow White or Star Wars as a fallback) each time you call next( ), and loops around to the beginning of the character list when it runs out of names. Use this generator to fill an array, an ArrayList, a LinkedList, a HashSet, a LinkedHashSet, and a TreeSet, then print each container.</p>
</blockquote>
<p>这题很简单，关键是测试一下各个容器间的速度对比，<br><img src="/uploads/tij4-11/1000000times.png" alt="1000000times"></p>
<p>如上图，结果非常符合实际情况。首先Array直接下标随机访问，必须是最快的。然后三个Set，因为Set是去重的，所以表空间并不大，一共也就30多部电影。然后ArrayList因为add()是插在最后，不是插在中间，也是O(1),比Array多的也就是维护动态表长的开销。LinkedList的速度是最慢的，因为每个节点都有开销。</p>
<h5 id="Generator-java"><a href="#Generator-java" class="headerlink" title="Generator.java"></a>Generator.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Generator <span class="title">getFilmGenerator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String[] FILMNAME=&#123;<span class="string">"肖申克的救赎"</span>, <span class="string">"这个杀手不太冷"</span>, <span class="string">"阿甘正传"</span>, <span class="string">"霸王别姬"</span>, <span class="string">"美丽人生"</span>, <span class="string">"千与千寻"</span>, <span class="string">"辛德勒的名单"</span>, <span class="string">"海上钢琴师"</span>, <span class="string">"机器人总动员"</span>, <span class="string">"盗梦空间"</span>, <span class="string">"泰坦尼克号"</span>, <span class="string">"三傻大闹宝莱坞"</span>, <span class="string">"放牛班的春天"</span>, <span class="string">"忠犬八公的故事"</span>, <span class="string">"大话西游"</span>, <span class="string">"龙猫"</span>, <span class="string">"教父"</span>, <span class="string">"乱世佳人"</span>, <span class="string">"天堂电影院"</span>, <span class="string">"当幸福来敲门"</span>, <span class="string">"搏击俱乐部"</span>, <span class="string">"楚门的世界"</span>, <span class="string">"触不可及"</span>, <span class="string">"指环王3"</span>, <span class="string">"罗马假日"</span>&#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Generator(FILMNAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHOD</span><br><span class="line">     */</span></span><br><span class="line">    <span class="comment">//loops around to the beginning of the character list when it runs out of names</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(it.hasNext())&#123;</span><br><span class="line">                <span class="keyword">return</span> it.next();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                it=strList.iterator();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//fil array</span></span><br><span class="line">    <span class="keyword">public</span> String[] filArray(<span class="keyword">int</span> times)&#123;</span><br><span class="line">        <span class="keyword">long</span> begin=System.nanoTime();</span><br><span class="line">        String[] resultArray=<span class="keyword">new</span> String[times];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;times;i++)&#123;</span><br><span class="line">            resultArray[i]=next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end=System.nanoTime();</span><br><span class="line">        <span class="keyword">double</span> diff=(end-begin)/<span class="number">1e6</span>;</span><br><span class="line">        System.out.println(diff);</span><br><span class="line">        <span class="keyword">return</span> resultArray;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//fil arraylist</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">filCollection</span><span class="params">(Collection&lt;String&gt; c, <span class="keyword">int</span> times)</span></span>&#123;</span><br><span class="line">        <span class="keyword">long</span> begin=System.nanoTime();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;times;i++)&#123;</span><br><span class="line">            c.add(next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end=System.nanoTime();</span><br><span class="line">        <span class="keyword">double</span> diff=(end-begin)/<span class="number">1e6</span>;</span><br><span class="line">        System.out.println(diff);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> strList.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Generator</span><span class="params">(List&lt;String&gt; inList)</span></span>&#123;</span><br><span class="line">        strList=inList;</span><br><span class="line">        it=strList.iterator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Generator</span><span class="params">(String[] inArray)</span></span>&#123;</span><br><span class="line">        strList.addAll(Arrays.asList(inArray));</span><br><span class="line">        it=strList.iterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FILEDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; strList=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    Iterator&lt;String&gt; it=strList.iterator();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Generator fg=Generator.getFilmGenerator();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//fil array</span></span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;Array:  "</span>);</span><br><span class="line">        String[] a=fg.filArray(<span class="number">1000000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//fil arraylist</span></span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;ArrayList:  "</span>);</span><br><span class="line">        List&lt;String&gt; al=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        fg.filCollection(al,<span class="number">1000000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//fil lindelist</span></span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;LinkedList:  "</span>);</span><br><span class="line">        List&lt;String&gt; ll=<span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line">        fg.filCollection(ll,<span class="number">1000000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//fil hashset</span></span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;HashSet:  "</span>);</span><br><span class="line">        Set&lt;String&gt; hs=<span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        fg.filCollection(hs,<span class="number">1000000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//fil linkedhashset</span></span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;LinkedHashSet:  "</span>);</span><br><span class="line">        Set&lt;String&gt; lhs=<span class="keyword">new</span> LinkedHashSet&lt;String&gt;();</span><br><span class="line">        fg.filCollection(lhs,<span class="number">1000000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//fil treeset</span></span><br><span class="line">        System.out.println(<span class="string">"&gt;&gt;&gt;TreeSet:  "</span>);</span><br><span class="line">        Set&lt;String&gt; ts=<span class="keyword">new</span> TreeSet&lt;String&gt;();</span><br><span class="line">        fg.filCollection(ts,<span class="number">1000000</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-9"><a href="#Exercise-9" class="headerlink" title="Exercise 9"></a>Exercise 9</h4><p>Iterator只是个接口</p>
<p>在ArrayList里，iterator()方法的代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Itr();	<span class="comment">//指向内部类Itr</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Itr实现Iterator接口</p>
<p>modCount表示的是容器被修改的次数。为了防止容器再遍历的过程中被修改。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            checkForComodification();</span><br><span class="line">            <span class="keyword">int</span> i = cursor;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">            Object[] elementData = ArrayList.<span class="keyword">this</span>.elementData;	<span class="comment">//拷贝整个List</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">            cursor = i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>注意next()是要拷贝整个List的。开销不小。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewSequence</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NewSequence</span><span class="params">(<span class="keyword">int</span> inSize)</span> </span>&#123;</span><br><span class="line">        items = <span class="keyword">new</span> Object[inSize];</span><br><span class="line">        size=inSize;</span><br><span class="line">        next=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Object x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(next &lt; items.length)&#123;</span><br><span class="line">            items[next++] = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            String s=<span class="keyword">new</span> String(<span class="string">""</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">                s=s+items[i]+<span class="string">" "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 关掉</span><br><span class="line">    //return inner class reference</span><br><span class="line">    public Selector selector() &#123;</span><br><span class="line">        return new SequenceSelector();</span><br><span class="line">    &#125;</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;Object&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Itr();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object[] items;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> next;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  INNER CLASS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> cursor=<span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor&lt;size;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor&lt;size)&#123;</span><br><span class="line">                <span class="keyword">return</span> items[cursor++];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 关掉</span><br><span class="line">     /**</span><br><span class="line">     *  INNER CLASS</span><br><span class="line">     private class SequenceSelector implements Selector &#123;</span><br><span class="line">     private int i = 0;</span><br><span class="line">     public boolean end() &#123; return i == items.length; &#125;</span><br><span class="line">     public Object current() &#123; return items[i]; &#125;</span><br><span class="line">     public void next() &#123; if(i &lt; items.length) i++; &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        NewSequence ns = <span class="keyword">new</span> NewSequence(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            ns.add(Integer.toString(i));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(ns);</span><br><span class="line">        Iterator&lt;Object&gt; it = ns.iterator();</span><br><span class="line">        <span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">            System.out.print(it.next() + <span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-15"><a href="#Exercise-15" class="headerlink" title="Exercise 15"></a>Exercise 15</h4><blockquote>
<p>(4) Stacks are often used to evaluate expressions in programming languages. Using net.mindview.util.Stack, evaluate the following expression, where’+’ means “push the following letter onto the stack,” and’-’ means “pop the top of the stack and print it”: “+U+n+c—+e+r+t—+a-+i-+n+t+y—+ -+r+u—+l+e+s—“</p>
</blockquote>
<p>这题我用LinkedList自己实现了一个Stack。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  INNER CLASS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> cursor;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor&lt;ls.size();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(cursor&gt;=ls.size())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> ls.get(cursor++);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Itr</span><span class="params">()</span></span>&#123;cursor=<span class="number">0</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        ls.addFirst(str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ls.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            String s=ls.getFirst();</span><br><span class="line">            ls.removeFirst();</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(String command)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(command.length()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">char</span>[] s=command.toCharArray();</span><br><span class="line">            <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> max=s.length;</span><br><span class="line">            <span class="keyword">while</span>(i&lt;max)&#123;</span><br><span class="line">                <span class="keyword">if</span>(Character.compare(s[i],<span class="string">'+'</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(i+<span class="number">1</span>&lt;max)&#123;</span><br><span class="line">                        push(String.valueOf(s[++i]));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(Character.compare(s[i],<span class="string">'-'</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">                    System.out.print(pop());</span><br><span class="line">                &#125;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Itr <span class="title">iterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Itr();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ls.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            String result=<span class="string">""</span>;</span><br><span class="line">            <span class="keyword">for</span>(String s : ls)&#123;</span><br><span class="line">                result=result+s+<span class="string">" "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;String&gt; ls =<span class="keyword">new</span> LinkedList&lt;String&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//just for test</span></span><br><span class="line">        <span class="comment">//LinkedStack ls=new LinkedStack();</span></span><br><span class="line">        <span class="comment">//ls.push("A");</span></span><br><span class="line">        <span class="comment">//ls.push("B");</span></span><br><span class="line">        <span class="comment">//ls.push("C");</span></span><br><span class="line">        <span class="comment">//System.out.println(ls);</span></span><br><span class="line">        <span class="comment">//System.out.println(ls.pop());</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//excise 15</span></span><br><span class="line">        String command=<span class="string">"+U+n+c---+e+r+t---+a+i+n+t+y---+ -+r+u--+l+e+s---"</span>;</span><br><span class="line">        LinkedStack ls=<span class="keyword">new</span> LinkedStack();</span><br><span class="line">        ls.read(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/array/" rel="tag">#array</a>
          
            <a href="/tags/containor/" rel="tag">#containor</a>
          
            <a href="/tags/list/" rel="tag">#list</a>
          
            <a href="/tags/map/" rel="tag">#map</a>
          
            <a href="/tags/queue/" rel="tag">#queue</a>
          
            <a href="/tags/set/" rel="tag">#set</a>
          
            <a href="/tags/容器/" rel="tag">#容器</a>
          
            <a href="/tags/数组/" rel="tag">#数组</a>
          
            <a href="/tags/映射/" rel="tag">#映射</a>
          
            <a href="/tags/表/" rel="tag">#表</a>
          
            <a href="/tags/队列/" rel="tag">#队列</a>
          
            <a href="/tags/集合/" rel="tag">#集合</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/05/tij4-10/" rel="next" title="Thinking in Java 读书笔记：第十章 - 内部类">
                <i class="fa fa-chevron-left"></i> Thinking in Java 读书笔记：第十章 - 内部类
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/07/16/hash/" rel="prev" title="Java HashMap的哈希值是怎么计算的？">
                Java HashMap的哈希值是怎么计算的？ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/07/10/tij4-11/"
           data-title="Thinking in Java 读书笔记：第十一章 - 容器" data-url="www.ciaoshen.com/2016/07/10/tij4-11/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/shenAvatar.jpg"
               alt="沈玮 | Wei SHEN" />
          <p class="site-author-name" itemprop="name">沈玮 | Wei SHEN</p>
          <p class="site-description motion-element" itemprop="description">Coder & Designer</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">61</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">198</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/helloShen" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/72441576/" target="_blank">
                  
                    <i class="fa fa-globe"></i> DouBan
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/pang-pang-37-37" target="_blank">
                  
                    <i class="fa fa-globe"></i> ZhiHu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#摘要"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Array不是一般意义上的“容器”"><span class="nav-number">2.</span> <span class="nav-text">Array不是一般意义上的“容器”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-util类库中的容器"><span class="nav-number">3.</span> <span class="nav-text">java.util类库中的容器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#容器两大分支：Collection和Map"><span class="nav-number">3.1.</span> <span class="nav-text">容器两大分支：Collection和Map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Collection的三大将"><span class="nav-number">3.2.</span> <span class="nav-text">Collection的三大将</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于List"><span class="nav-number">3.3.</span> <span class="nav-text">关于List</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ArrayList的实现"><span class="nav-number">3.4.</span> <span class="nav-text">ArrayList的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#LinkedList的实现"><span class="nav-number">3.4.1.</span> <span class="nav-text">LinkedList的实现</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于Map"><span class="nav-number">3.5.</span> <span class="nav-text">关于Map</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#关于Set"><span class="nav-number">3.5.1.</span> <span class="nav-text">关于Set</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#关于Iterator迭代器和容器接口"><span class="nav-number">3.5.2.</span> <span class="nav-text">关于Iterator迭代器和容器接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#关于过时的容器"><span class="nav-number">3.5.3.</span> <span class="nav-text">关于过时的容器</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于Utilities"><span class="nav-number">3.6.</span> <span class="nav-text">关于Utilities</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习"><span class="nav-number">4.</span> <span class="nav-text">练习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-16"><span class="nav-number">4.1.</span> <span class="nav-text">Exercise 16</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-0版：成绩-30-997490毫秒"><span class="nav-number">4.1.1.</span> <span class="nav-text">1.0版：成绩 30.997490毫秒</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#官方答案：-成绩：12-664569毫秒"><span class="nav-number">4.1.2.</span> <span class="nav-text">官方答案： 成绩：12.664569毫秒</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#优化之后：6-171586毫秒-String-V-s-Char"><span class="nav-number">4.1.3.</span> <span class="nav-text">优化之后：6.171586毫秒    String V.s. Char</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-20"><span class="nav-number">4.2.</span> <span class="nav-text">Exercise 20</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-21"><span class="nav-number">4.3.</span> <span class="nav-text">Exercise 21</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-22"><span class="nav-number">4.4.</span> <span class="nav-text">Exercise 22</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#答案错了"><span class="nav-number">4.4.1.</span> <span class="nav-text">答案错了</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#StrEntrySequence-java"><span class="nav-number">4.4.2.</span> <span class="nav-text">StrEntrySequence.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#StrEntry-java"><span class="nav-number">4.4.3.</span> <span class="nav-text">StrEntry.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#这题的答案很偷懒"><span class="nav-number">4.4.4.</span> <span class="nav-text">这题的答案很偷懒</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-4"><span class="nav-number">4.5.</span> <span class="nav-text">Exercise 4</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Generator-java"><span class="nav-number">4.5.1.</span> <span class="nav-text">Generator.java</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-9"><span class="nav-number">4.6.</span> <span class="nav-text">Exercise 9</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-15"><span class="nav-number">4.7.</span> <span class="nav-text">Exercise 15</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沈玮 | Wei SHEN</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>

</br>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div>
  <span id="busuanzi_container_site_pv">
  Visited  <span id="busuanzi_value_site_pv"></span>  times
  </span>

<span id="busuanzi_container_site_pv">&nbsp; &nbsp; | &nbsp; &nbsp;</span>

  <span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span>  Visitors
  </span>
<div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/lib/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ciaoshen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  





  
  

  
  


</body>
</html>
