<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="anonymous inner class,callback,closure,inner class,lambda expression,lambda表达式,λ演算,内部类,匿名内部类,回调,闭包," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="摘要内部类之前我用的不多，但在java类库里却经常看到，是java的常用技术。这章主要围绕内部类和匿名内部类，同时也涉及到“闭包”，“回调”，“lambda表达式”这些常见概念。最后，讨论了内部类常见的使用场景，以及优缺点。
一个最简单的内部类：外部类的一个“备选”组件这是一个最简单的套嵌结构，Outer是一个外部类，里面有一个Inner内部类。外部类有个方法，创建并返回一个内部类。
123456">
<meta property="og:type" content="article">
<meta property="og:title" content="Think in Java 读书笔记：第十章 - 内部类">
<meta property="og:url" content="www.ciaoshen.com/2016/07/05/tij4-10/index.html">
<meta property="og:site_name" content="沈玮 | Wei SHEN">
<meta property="og:description" content="摘要内部类之前我用的不多，但在java类库里却经常看到，是java的常用技术。这章主要围绕内部类和匿名内部类，同时也涉及到“闭包”，“回调”，“lambda表达式”这些常见概念。最后，讨论了内部类常见的使用场景，以及优缺点。
一个最简单的内部类：外部类的一个“备选”组件这是一个最简单的套嵌结构，Outer是一个外部类，里面有一个Inner内部类。外部类有个方法，创建并返回一个内部类。
123456">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-10/closure.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-10/combinator.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-10/callback.png">
<meta property="og:updated_time" content="2016-08-02T00:57:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Think in Java 读书笔记：第十章 - 内部类">
<meta name="twitter:description" content="摘要内部类之前我用的不多，但在java类库里却经常看到，是java的常用技术。这章主要围绕内部类和匿名内部类，同时也涉及到“闭包”，“回调”，“lambda表达式”这些常见概念。最后，讨论了内部类常见的使用场景，以及优缺点。
一个最简单的内部类：外部类的一个“备选”组件这是一个最简单的套嵌结构，Outer是一个外部类，里面有一个Inner内部类。外部类有个方法，创建并返回一个内部类。
123456">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>



  <meta name="baidu-site-verification" content="3iRy3UFlpa" />


<script>
  (function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


  <title> Think in Java 读书笔记：第十章 - 内部类 | 沈玮 | Wei SHEN </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74473715-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">沈玮 | Wei SHEN</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Coder & Designer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hDG3wYskg4CYKGSXw8x7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Think in Java 读书笔记：第十章 - 内部类
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-07-05T13:10:53-04:00" content="2016-07-05">
              2016-07-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/05/tij4-10/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/05/tij4-10/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span id="busuanzi_container_page_pv">&nbsp; |  &nbsp; &nbsp; Viewed <span id="busuanzi_value_page_pv"></span> times</span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>内部类之前我用的不多，但在java类库里却经常看到，是java的常用技术。这章主要围绕内部类和匿名内部类，同时也涉及到“闭包”，“回调”，“lambda表达式”这些常见概念。最后，讨论了内部类常见的使用场景，以及优缺点。</p>
<h3 id="一个最简单的内部类：外部类的一个“备选”组件"><a href="#一个最简单的内部类：外部类的一个“备选”组件" class="headerlink" title="一个最简单的内部类：外部类的一个“备选”组件"></a>一个最简单的内部类：外部类的一个“备选”组件</h3><p>这是一个最简单的套嵌结构，Outer是一个外部类，里面有一个Inner内部类。外部类有个方法，创建并返回一个内部类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  INNER CLASS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Inner</span><span class="params">()</span> </span>&#123;System.out.println(<span class="string">"Hello I am Inner Class!"</span>);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">Inner <span class="title">getInner</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> Inner();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    Outer()&#123;System.out.println(<span class="string">"Hello I am Outer Class!"</span>);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  FIELDS</span><br><span class="line">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单创建一个外部类，然后通过外部类创建内部类。观察初始化顺序。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer testOuter=<span class="keyword">new</span> Outer();</span><br><span class="line">        Inner myInner=testOuter.getInner();		<span class="comment">//实例化内部类，方法一</span></span><br><span class="line">		Inner newInner=testOuter.new Inner();	<span class="comment">//实例化内部类，方法二</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line">Hello I am Outer Class!</span><br><span class="line">Hello I am Inner Class!</span><br><span class="line">Hello I am Inner Class!</span><br></pre></td></tr></table></figure></p>
<p>因此得出两个重要事实：</p>
<ul>
<li><strong>在初始化外部类Outer的时候，并不会自动初始化内部类Inner</strong></li>
<li><strong>Inner类不是静态的，要实例化内部Inner类，必须通过外部Outer类的实例</strong></li>
</ul>
<p>由第一条可以得出，内部类的性质就像外部类的一个“组件”。很类似compositon。但不同在于这个组件不是必须的，而是备选的。平时不需要的时候它不会被初始化，只有必要的时候，才实例化出来使用。</p>
<p>需要当心第二条，想当然的new Outer.Inner()是不能实例化内部类的。因为内部类并不是静态的。因此必须通过外部类的一个实例来实例化，无论是否用new。</p>
<p>另外，在编译层面，Outer类编译完会产生3个class文件。我们以后再探讨这三个文件的具体作用。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Outer<span class="variable">$1</span>.class		Outer.class</span><br><span class="line">Outer<span class="variable">$Inner</span>.class	Outer.java</span><br></pre></td></tr></table></figure></p>
<h3 id="内部类是一个“闭包”，自由访问外部类所有字段"><a href="#内部类是一个“闭包”，自由访问外部类所有字段" class="headerlink" title="内部类是一个“闭包”，自由访问外部类所有字段"></a>内部类是一个“闭包”，自由访问外部类所有字段</h3><p>第二个实验前，需要指出：内部类和普通类不同，可以用<strong>private</strong>, protected, public修饰。</p>
<p>第二个实验：主角是外部Outer类的一个字段：字符串<strong>info</strong>，以及一个方法<strong>outerMethod()</strong>。</p>
<ul>
<li>内部Inner类的toString()方法访问并修改字符串</li>
<li>然后内部Inner类直接调用外部类方法outerMethod()</li>
<li>outerMethod()负责输出Outer类的info字段</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE INNER CLASS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        <span class="comment">//直接访问并修改Outer的info字段，能行吗？</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">			info=<span class="string">"苍天还没有死"</span>;</span><br><span class="line">		&#125;	</span><br><span class="line"></span><br><span class="line">        <span class="comment">//constructor of inner</span></span><br><span class="line">        Inner() &#123;System.out.println(<span class="string">"Hello I am Inner Class!"</span>);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Inner <span class="title">getInner</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> Inner();&#125;</span><br><span class="line">	<span class="comment">//显示Outer的info</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outerMethod</span><span class="params">()</span></span>&#123;System.out.println(info);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    Outer(String inStr)&#123;</span><br><span class="line">        info=inStr;</span><br><span class="line">        System.out.println(<span class="string">"Hello I am Outer Class!"</span>);</span><br><span class="line">		System.out.println(info);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果显示，内部Inner类能够访问外部Outer类的所有字段和方法，哪怕是private私有的。不是继承，而是完全指向同一个对象。也就是说内部类完全共享外部类的所有信息，而且能直接对外部类的字段做修改，哪怕是private的字段。 这是因为，<strong>在内部类中，会自动被加上了一个指向外部类的引用</strong>。所以内部类能够直接对外部类成员字段操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer testOuter=<span class="keyword">new</span> Outer(<span class="string">"苍天已死，黄天当立！"</span>);</span><br><span class="line">        Inner myInner=testOuter.getInner();</span><br><span class="line">        myInner.toString();</span><br><span class="line">		myInner.outerMethod();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line">Hello I am Outer Class!</span><br><span class="line">苍天已死，黄天当立</span><br><span class="line">Hello I am Inner Class!</span><br><span class="line">苍天还没有死</span><br></pre></td></tr></table></figure></p>
<h4 id="闭包（Closure）"><a href="#闭包（Closure）" class="headerlink" title="闭包（Closure）"></a>闭包（Closure）</h4><p>讲到内部类自动包含指向外部类的引用，就引出了“<strong>闭包(Closure)</strong>”这个概念。</p>
<p>其实闭包的概念非常简单，不严肃地，一句话定义闭包就是，</p>
<blockquote>
<p><strong>定义中含有自由变量的函数叫“闭包”。</strong></p>
</blockquote>
<p><img src="/uploads/tij4-10/closure.png" alt="closure"></p>
<p>什么叫“<strong>自由变量</strong>”？ 如上图所示，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(x)=x+y</span><br></pre></td></tr></table></figure></p>
<p>函数中，x是约束变量，y就是自由变量。也就是函数的返回值不仅取决于约束变量x，还取决于环境变量y。代码写出来就是下面这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> y=<span class="number">50</span>;</span><br><span class="line">add(<span class="keyword">int</span> x)&#123;</span><br><span class="line">	<span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以如果我们单独调用add()函数，是计算不出最后的结果的，因为缺了自由变量y。所以add()函数为了能完成计算，必须随身携带自由变量y，这时候add()函数就可以称为一个“闭包”。这里“闭”的意思其实是封闭，封装了外部自由变量，所以叫“闭包”。</p>
<p>和闭包相对的一个概念叫“<strong>组合子(Combinator)</strong>”,定义为，</p>
<blockquote>
<p><strong>不含有自由变量的函数叫“组合子”。</strong></p>
</blockquote>
<p><img src="/uploads/tij4-10/combinator.png" alt="closure"><br>很简单，如果add()函数有x和y两个参数，不依赖于外部自由变量的话，就是一个组合子。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="keyword">int</span> x, <span class="keyword">int</span> y)&#123;</span><br><span class="line">	<span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>讲到这里，很容易就看出来，内部类就是一个典型的“闭包”！因为它自带创建它的环境（外部类）的全部变量。</p>
<h4 id="由此引出的一个常用的-“迭代器模式（Interator-Pattern）”"><a href="#由此引出的一个常用的-“迭代器模式（Interator-Pattern）”" class="headerlink" title="由此引出的一个常用的 “迭代器模式（Interator Pattern）”"></a>由此引出的一个常用的 “迭代器模式（Interator Pattern）”</h4><p>根据内部类这两条特性，就引出了每个类库里都会有的<strong>迭代器（Iterator）</strong>。其实它一点也不神秘, 就是一个简单的内部类，唯一的字段就是一个整型计数器index。就像挂在主序列上的一个指针，表示现在遍历到哪儿了。原理就是利用了内部类自动继承外部类字段的特性，通过访问这个指针，可以直接对外部主序列进行操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE INNER CLASS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Pointer</span> </span>&#123;</span><br><span class="line">        <span class="comment">//methods</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> index!=charSeq.length;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(index&lt;charSeq.length)&#123;index++;&#125;</span><br><span class="line">            <span class="keyword">return</span> charSeq[index-<span class="number">1</span>];            </span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//constructor of inner</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Pointer</span><span class="params">()</span> </span>&#123;index=<span class="number">0</span>;&#125;</span><br><span class="line">        </span><br><span class="line">		<span class="comment">//fields</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index;	<span class="comment">//迭代器的主体“指针”</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pointer <span class="title">getPointer</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> Pointer();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Sequence</span><span class="params">(String inStr)</span></span>&#123;</span><br><span class="line">        charSeq=inStr.toCharArray();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span>[] charSeq;	<span class="comment">//主体字符串</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试一下，遍历并打印字符串的每一个字符，并用”-“间隔。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Sequence testSeq=<span class="keyword">new</span> Sequence(<span class="string">"So an inner class has automatic access to the members of the enclosing class."</span>);</span><br><span class="line">        Pointer testPointer=testSeq.getPointer();</span><br><span class="line">        <span class="keyword">while</span>(testPointer.hasNext())&#123;</span><br><span class="line">            System.out.print(testPointer.next()+<span class="string">"-"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line">S-o- -a-n- -i-n-n-e-r- -c-l-a-s-s- -h-a-s- -a-u-t-o-m-a-t-i-c- -a-c-c-e-s-s- -t-o- -t-h-e- -m-e-m-b-e-r-s- -o-f- -t-h-e- -e-n-c-l-o-s-i-n-g- -c-l-a-s-s-.-</span><br></pre></td></tr></table></figure></p>
<p>但问题来了，同样的事情，我不用内部类的形式，而是把指针直接作为一个字段放进字符串类照样能实现功能：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不用内部类，直接用“组合”</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SequenceComp</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> index!=charSeq.length;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index&lt;charSeq.length)&#123;index++;&#125;</span><br><span class="line">        <span class="keyword">return</span> charSeq[index-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SequenceComp</span><span class="params">(String inStr)</span></span>&#123;</span><br><span class="line">        charSeq=inStr.toCharArray();</span><br><span class="line">        index=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span>[] charSeq;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;	<span class="comment">//迭代器直接作为组件</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="更进一步：外部类对内部类的访问也畅通无阻"><a href="#更进一步：外部类对内部类的访问也畅通无阻" class="headerlink" title="更进一步：外部类对内部类的访问也畅通无阻"></a>更进一步：外部类对内部类的访问也畅通无阻</h3><p>实验三在实验二的基础上更进一步，外部类访问内部类私有构造器和私有方法。反过来内部类私有方法再访问外部类的私有字段和方法。</p>
<ul>
<li>内部类的构造器Inner()为private。</li>
<li>外部类callPrivateInner()方法调用内部类私有构造器，创建内部类实例。并调用私有内部方法privateInnerMethod()。</li>
<li>privateInnerMethod()访问外部类的私有字段info和方法privateOuterMethod()。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE INNER CLASS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">        <span class="comment">//methods</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateInnerMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">            privateOuterMethod();</span><br><span class="line">            info=<span class="string">"privatedInnerMethod visit info!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//constructor of inner</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Inner</span><span class="params">()</span> </span>&#123;System.out.println(<span class="string">"Hello I am Inner Class!"</span>);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Inner <span class="title">getInner</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> Inner();&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callPrivateInner</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Inner theInner=getInner();</span><br><span class="line">        theInner.privateInnerMethod();</span><br><span class="line">        System.out.println(info);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateOuterMethod</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"Private Outer Method visited!"</span>);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Outer</span><span class="params">(String inStr)</span></span>&#123;</span><br><span class="line">        info=inStr;</span><br><span class="line">        System.out.println(<span class="string">"Hello I am Outer Class!"</span>);</span><br><span class="line">        System.out.println(info);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br></pre></td></tr></table></figure>
<p>从外部另一个包运行这个实验。结果显示，外部类对内部类私有构造器和私有方法都无障碍访问。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer testOuter=<span class="keyword">new</span> Outer(<span class="string">"Inner class haven't visited me!"</span>);</span><br><span class="line">        testOuter.callPrivateInner();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line">Hello I am Outer Class!</span><br><span class="line">Inner <span class="class"><span class="keyword">class</span> <span class="title">haven</span>'<span class="title">t</span> <span class="title">visited</span> <span class="title">me</span>!</span><br><span class="line"><span class="title">Hello</span> <span class="title">I</span> <span class="title">am</span> <span class="title">Inner</span> <span class="title">Class</span>!</span><br><span class="line"><span class="title">Private</span> <span class="title">Outer</span> <span class="title">Method</span> <span class="title">visited</span>!</span><br><span class="line"><span class="title">privatedInnerMethod</span> <span class="title">visit</span> <span class="title">info</span>!</span></span><br></pre></td></tr></table></figure></p>
<p>最后的结果显示,</p>
<ul>
<li>内部类可以访问外部类的私有成员</li>
<li>外部类可以访问内部类的私有成员</li>
<li>内部类共享外部类所有字段</li>
</ul>
<p>所以内部类和外部类之间的访问一切畅行无阻。如果外部类是一个姑娘，那内部类就像姑娘颈上的项链，手上的戒指。是附属品也是整体的一部分。可以带，也可以不带。</p>
<h3 id="内部类向上层接口转型，对外隐藏内部实现"><a href="#内部类向上层接口转型，对外隐藏内部实现" class="headerlink" title="内部类向上层接口转型，对外隐藏内部实现"></a>内部类向上层接口转型，对外隐藏内部实现</h3><p>外部有个公开接口Destination，private内部类PDestination实现了这个接口。然后只要外部类在实例化内部类的时候向上转型成为公开接口类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外部公开接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Destination</span> </span>&#123;</span><br><span class="line">	<span class="function">String <span class="title">readLabel</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parcel</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">PContents</span> <span class="keyword">implements</span> <span class="title">Contents</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">11</span>;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> i; &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//内部类实现外部接口</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="class"><span class="keyword">class</span> <span class="title">PDestination</span> <span class="keyword">implements</span> <span class="title">Destination</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> String label;</span><br><span class="line">		<span class="function"><span class="keyword">private</span> <span class="title">PDestination</span><span class="params">(String whereTo)</span> </span>&#123;</span><br><span class="line">			label = whereTo;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">readLabel</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> label; &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//关键：外部类实例化内部类的时候向上转型</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Destination <span class="title">destination</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PDestination(s);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Contents <span class="title">contents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PContents();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样做的好处是，<strong>在公开类的内部对内部类的访问非常自由，但是从外部类的外面访问内部类的时候，就只能看到公开接口定义的方法。这样的结构非常适合对外隐藏内部实现。</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	Parcel4 p = <span class="keyword">new</span> Parcel4();</span><br><span class="line">	Contents c = p.contents();</span><br><span class="line">	Destination d = p.destination(<span class="string">"Tasmania"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="内部类“回调”外部类，实现多继承"><a href="#内部类“回调”外部类，实现多继承" class="headerlink" title="内部类“回调”外部类，实现多继承"></a>内部类“回调”外部类，实现多继承</h3><p>例子很简单，我是一个学生，我的work()函数是写作业。但有一天我接到一个助教的活，可是老师接口也有work()函数。显然作为老师我的work()函数应该是上课。但如果我又想同时保持我写作业的work()函数呢？能不能同时有两个行为不同的work()函数呢？这时候内部类就是个很好的选择。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//老师的work()接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Teacher</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Students</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"do home work"</span>);&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Me</span> <span class="keyword">extends</span> <span class="title">Students</span></span>&#123;</span><br><span class="line">	<span class="comment">//作为老师的teach()函数已经写好，放在外部类，等待内部类回调</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">teach</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"give lessons"</span>);&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//内部类实现老师接口，work()函数回调外部类teach()函数</span></span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeachAssistant</span> <span class="keyword">implements</span> <span class="title">Teacher</span></span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">work</span><span class="params">()</span></span>&#123;teach();&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//返回内部类的引用，向上转型到老师接口</span></span><br><span class="line">	<span class="keyword">public</span> Teacher becomeTA&#123;<span class="keyword">return</span> <span class="keyword">new</span> TeachAssistant();&#125; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Me shen = <span class="keyword">new</span> Me();</span><br><span class="line">		<span class="comment">//作为学生工作</span></span><br><span class="line">		shen.work();</span><br><span class="line">		<span class="comment">//作为助教上课</span></span><br><span class="line">		Teacher ta = shen.becomeTA();</span><br><span class="line">		ta.work();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line">do homework</span><br><span class="line">give lessons</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我的基本身份是个学生，所以我继承了学生基类，自带的work()函数是做作业。但我同时也具备教课teach()的能力，平时不施展。只有当我的隐藏身份（内部类）“助教”被调用的时候，我的work()函数，回调我的teach()技能。这就是“<strong>回调</strong>”在java内部类上的应用。</p>
<p>从例子可以看出，利用内部类“回调”，可以让外部类在基本身份之外，有很多不同的新身份，以不同的接口来调用。而且最大的好处就像之前讲的，每个接口只对外暴露接口约定的几个方法，隐藏了内部的其他实现。</p>
<h4 id="回调（Callback）"><a href="#回调（Callback）" class="headerlink" title="回调（Callback）"></a>回调（Callback）</h4><p>“<strong>回调</strong>”是很常用的一种技术，回调的方式有很多种，上面讲的内部类只是其中比较常用的一种方式罢了。回调说起来其实很简单，如下图所示，</p>
<p><img src="/uploads/tij4-10/callback.png" alt="callback"><br>应用层的程序调用函数库的某一函数，但这个函数说某个具体步骤我不会做，需要应用层告诉我怎么做。所以最好就是应用层写好这个方法，等库函数回调。关于回调其他的形式，以及常见的使用场景可以参考知乎上futeng的一个用心的回答<a href="https://www.zhihu.com/question/19801131" target="_blank" rel="external"><strong>《回调函数(callback)是什么？》</strong></a>。其中提到，匿名内部类的示例才是开源工具中常见到的使用方式。而且回调方法最大的优势在于，异步回调，这样是其最被广为使用的原因。</p>
<h3 id="更重口味：匿名内部类"><a href="#更重口味：匿名内部类" class="headerlink" title="更重口味：匿名内部类"></a>更重口味：匿名内部类</h3><p>像我这样的初学者可能会觉得内部类语法很怪，但其实到现在为止的都还属于小清新，Java语法允许的口味要重得多。</p>
<p>首先，<strong>内部类可以在外部类的某个成员方法里</strong>，简单结构如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外部类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outerMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//内部类</span></span><br><span class="line">		<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">innerMethod</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>甚至，<strong>内部类可以在外部类某成员方法的某个域(花括号)里</strong>，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外部类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outerMethod</span><span class="params">(<span class="keyword">boolean</span> needInner)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(needInner)&#123;</span><br><span class="line">			<span class="comment">//内部类</span></span><br><span class="line">			<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">innerMethod</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>比较常用的是更鬼畜的一种：<strong>匿名内部类</strong>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外部接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Info</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">printInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//外部类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Info <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//现场制作并返回匿名内部类</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Info()&#123;</span><br><span class="line">			<span class="keyword">private</span> String info=<span class="string">"Hello World"</span>;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="title">printInfo</span><span class="params">()</span></span>&#123;System.out.println(info)&#125;;</span><br><span class="line">		&#125;;	<span class="comment">//冒号不能省</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最常见的匿名类使用场景，当参数。有的时候参数的类型很不常用，比如只用1，2次，专门写个类文件太麻烦。就可以现场制作这样一个匿名类。只不过，看上去对用户相当不友好呢:&gt;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//外部接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Info</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">printInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//外部类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">	<span class="comment">//函数需要一个Info类型的参数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Info <span class="title">showNews</span><span class="params">(Info inputInfo)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Today's news: "</span>);</span><br><span class="line">		inputInfo.printInfo();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Outer myOuter=<span class="keyword">new</span> Outer();</span><br><span class="line">		<span class="comment">//要用到Info型的参数的时候，才现场制作</span></span><br><span class="line">		myOuter.showNews(<span class="keyword">new</span> Info()&#123;</span><br><span class="line">				<span class="keyword">private</span> String info=<span class="string">"Hello World"</span>;</span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="title">printInfo</span><span class="params">()</span></span>&#123;System.out.println(info)&#125;;</span><br><span class="line">			&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="匿名内部类从java-8开始能访问非final的参数了"><a href="#匿名内部类从java-8开始能访问非final的参数了" class="headerlink" title="匿名内部类从java 8开始能访问非final的参数了"></a>匿名内部类从java 8开始能访问非final的参数了</h4><p>Java 8之前为保护外部类的变量不被破坏，java硬性规定匿名内部类只能访问final类型的外部对象。作者写书的时候Java 8还没有发布。但从Java 8开始，访问非final对象编译器也不会报错了。但匿名内部类内部仍然不能改变这些对象，因为匿名内部类内部会对这些对象做一份拷贝。所有操作都在这个镜像上进行。</p>
<h4 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h4><p>以匿名内部类作为函数的参数，其实是Lambda表达式的一种形式。Java8中已经正式引入了Lambda表达式。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">		<span class="comment">//之前的匿名内部类的写法</span></span><br><span class="line">		myOuter.showNews(<span class="keyword">new</span> Info()&#123;</span><br><span class="line">				<span class="keyword">private</span> String info=<span class="string">"Hello World"</span>;</span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="title">printInfo</span><span class="params">()</span></span>&#123;System.out.println(info)&#125;;</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Lambda表达式替代内部匿名类</span></span><br><span class="line">		myOuter.showNews(()-&gt;&#123;</span><br><span class="line">				System.out.println(<span class="string">"Hello World!"</span>);</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的例子里，看上去使用Lambda表达式的条件还是挺苛刻的。首先Info接口就规定了一个printInfo()方法，还没有成员字段。</p>
<h4 id="λ演算"><a href="#λ演算" class="headerlink" title="λ演算"></a>λ演算</h4><p><strong>“Lambda 表达式”(lambda expression)</strong>是一个匿名函数，基于数学中的<strong>λ演算</strong>得名，直接对应于其中的lambda抽象(lambda abstraction)，是一个匿名函数，即没有函数名的函数。</p>
<p>那<strong>λ演算</strong>到底是个什么鬼？这就要涉及到编程语言最核心的话题了：其实<strong>编程语言的本质是关于{逻辑学，语言学，数学}</strong>。λ演算是一套用于研究函数定义、函数应用和递归的形式系统。</p>
<p>首先Lambda表达式的基本形式如下：</p>
<blockquote>
<p><strong>λ[变量].[表达式]</strong></p>
</blockquote>
<p>任何函数都只能带一个参数，如果想表达一个加2函数，</p>
<ul>
<li>传统函数表达式：f(x)=x+2</li>
<li>Lambda表达式：λx.x+2 </li>
</ul>
<p>其中的<strong>λ</strong>就是lambda抽象，代表一个抽象的匿名函数。<strong>x</strong>是这个函数的唯一参数。<strong>x+2</strong>代表对函数参数x所做的操作，也就是函数的返回值。</p>
<p>λ演算的函数都只能带一个参数。那想表示带两个或两个以上参数的函数呢？可以用Currying技术：</p>
<ul>
<li>传统函数表达式：f(x)=x+y</li>
<li>Lambda表达式：λx.(λy.+xy)</li>
</ul>
<p>变量x的函数的返回值本身是另一个函数y。然后调用的环境变量x也被传入了函数y。形成了<strong>闭包</strong>。</p>
<p>其实说到这里，也就理解了为什么匿名内部类被称为Lambda表达式了。除了有“闭包”这样的共同形式之外，其实λ演算还透露了另外一种重要的“<strong>函数式编程</strong>”思想或者说范式：“<strong>一切都是函数</strong>”。</p>
<p>实际上λ演算的强大之处在于，它是可以用来表达所有函数的一套形式系统。不但是函数，甚至还有一切我们编程用到的变量，数据结构。具体细节可以看<a href="https://zh.wikipedia.org/wiki/Λ演算" target="_blank" rel="external"><strong>《维基百科-λ演算》</strong></a>的介绍。以及另一篇科普文<a href="http://liujiacai.net/blog/2014/10/12/lambda-calculus-introduction/" target="_blank" rel="external"><strong>《编程语言的基石——Lambda calculus》</strong></a>。</p>
<h3 id="继承内部类"><a href="#继承内部类" class="headerlink" title="继承内部类"></a>继承内部类</h3><p>如果想在外部类的外面，继承内部类，需要给继承类的构造器像这样加一个外部类的引用作为参数。注意继承类内部实际包含的是外部类的基类构造器super()。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InheritInner</span> <span class="keyword">extends</span> <span class="title">Outer</span>.<span class="title">Inner</span> </span>&#123;</span><br><span class="line">	<span class="comment">//! InheritInner() &#123;&#125; // Won’t compile</span></span><br><span class="line">	InheritInner(Outer o) &#123;</span><br><span class="line">		o.<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="继承外部类，内部类不会被覆盖"><a href="#继承外部类，内部类不会被覆盖" class="headerlink" title="继承外部类，内部类不会被覆盖"></a>继承外部类，内部类不会被覆盖</h3><p>继承外部类，如果直接再定义一遍内部类，并不会覆盖原有内部类。若想覆盖原有内部类，必须连同外部类一起，同时显式地继承内部类，然后再重写内部类子类的方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">innerMethod</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"Outer.Inner.innerMethod()"</span>)&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InheritOuter</span> <span class="keyword">extends</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InheritInner</span> <span class="keyword">extends</span> <span class="title">Outer</span>.<span class="title">Inner</span> </span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">innerMethod</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"InheritOuter.InheritInner.innerMethod()"</span>)&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Why-Inner-Class"><a href="#Why-Inner-Class" class="headerlink" title="Why Inner Class?"></a>Why Inner Class?</h3><p>内部类最直观的一个替代者，就是平时最常用的“组合”。只是需要一个内部组件的时候，用组合就好了，干嘛还非要用内部类呢？</p>
<p>作者给出的答案是：“<strong>多重继承</strong>”。</p>
<blockquote>
<p>Each inner class can independently inherit from an implementation. Thus, the inner class is not limited by whether the outer class is already inheriting from an implementation.</p>
</blockquote>
<p>在外部类已经继承了某个基类之后，内部类仍然可以继承别的类。不是简单多实现几个接口，而是实实在在地继承基类。</p>
<p>相较于组合，内部类的另一个优势在于，内部类不会像组合这样被强制和外部类一起被初始化。只有在我们需要用到的时候才去初始化内部类。这就是内部类的“可选组件”的地位，这点我们从上面“迭代器Iterator”的例子就能看出来。从设计的角度，内部类没有被逻辑绑定成外部类的一部分”IS-A”的关系。因此设计上更加灵活。</p>
<blockquote>
<p>The point of creation of the inner-class object is not tied to the creation of the outer-class object.</p>
</blockquote>
<p>另外，对于内部匿名类，它的好处在于简便，在一些类的使用次数非常有限，几乎是一次性的情况下，匿名类可以减轻工作量。</p>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><h4 id="Exercise-23"><a href="#Exercise-23" class="headerlink" title="Exercise 23"></a>Exercise 23</h4><blockquote>
<p>(4) Create an interface U with three methods. Create a class A with a method that produces a reference to a U by building an anonymous inner class. Create a second class B that contains an array of U. B should have one method that accepts and stores a reference to a U in the array, a second method that sets a reference in the array (specified by the method argument) to null, and a third method that moves through the array and calls the methods in U. In main( ), create a group of A objects and a single B. Fill the B with U references produced by the A objects. Use the B to call back into all the A objects. Remove some of the U references from the B.</p>
</blockquote>
<p>结构很简单：</p>
<ul>
<li>A类的getU()方法负责生产U类实例。</li>
<li>B类是U类实例的容器。负责插入，删除，遍历U实例。</li>
<li>runtime用不同的A类实例生产U类实例，插入B容器。</li>
</ul>
<p>每个U实例都被标记上了生产它的A实例的ID和它自己的ID。这里体现出了匿名内部类作为闭包的性质：自带一个指向创建环境的指针，能访问创建者的全部信息。因此，每个U实例的三个方法根据创建环境ID参数的变化，都是全新的实现。这样的结构，很适合做工厂方法，批量生产特殊类。</p>
<h5 id="匿名内部类接收现在可以接收非final参数了"><a href="#匿名内部类接收现在可以接收非final参数了" class="headerlink" title="匿名内部类接收现在可以接收非final参数了"></a>匿名内部类接收现在可以接收非final参数了</h5><p>练习的过程中，我做了个实验，想要验证关于匿名内部类只能访问final参数的问题。结果没想到Java 8已经取消了final参数的规定。但是看起来java编译器还是给每个传入匿名内部类的参数做了一份拷贝，因此匿名内部类对参数的操作，并不能改变外部参数。虽然保证了外部参数的安全性，但怎么觉得反而是个坑呢，不报错的隐蔽bug才最麻烦啊。</p>
<p>我实验的时候把容器B当成参数传给getU()函数，然后在匿名内部类中每次都重新初始化容器B。因此，按理最后容器B永远只能保存最后一个写入的U实例。但实际上最后容器B里的列表活得好好的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> U <span class="title">getU</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//Anonymous inner class</span></span><br><span class="line"><span class="comment">//传入非Final容器B为参数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> U(B inputB)&#123;</span><br><span class="line">	inputB=B.getB();	<span class="comment">//每次都把B重新指向一个新的空容器</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod1</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"&#123;A-"</span>+aId+<span class="string">"&#125;.&#123;U-"</span>+uId+<span class="string">"&#125;.method1"</span>);&#125;</span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod2</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"&#123;A-"</span>+aId+<span class="string">"&#125;.&#123;U-"</span>+uId+<span class="string">"&#125;.method2"</span>);&#125;</span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod3</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"&#123;A-"</span>+aId+<span class="string">"&#125;.&#123;U-"</span>+uId+<span class="string">"&#125;.method3"</span>);&#125;</span><br><span class="line">          <span class="keyword">private</span> <span class="keyword">int</span> uId=uCount++;</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="U-java"><a href="#U-java" class="headerlink" title="U.java"></a>U.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">U</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod2</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod3</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="A-java"><a href="#A-java" class="headerlink" title="A.java"></a>A.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//facotry of the object of type U</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">//maintain a counter to generate the ID for each A</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> aCount=<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> A <span class="title">getA</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> A(aCount++);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> U <span class="title">getU</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//Anonymous inner class</span></span><br><span class="line">		<span class="comment">//闭包：匿名内部类自带创建者A的信息。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> U()&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod1</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"&#123;A-"</span>+aId+<span class="string">"&#125;.&#123;U-"</span>+uId+<span class="string">"&#125;.method1"</span>);&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod2</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"&#123;A-"</span>+aId+<span class="string">"&#125;.&#123;U-"</span>+uId+<span class="string">"&#125;.method2"</span>);&#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uMethod3</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"&#123;A-"</span>+aId+<span class="string">"&#125;.&#123;U-"</span>+uId+<span class="string">"&#125;.method3"</span>);&#125;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> uId=uCount++;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">A</span><span class="params">(<span class="keyword">int</span> inputAId)</span></span>&#123;aId=inputAId;&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> aId;</span><br><span class="line">    <span class="comment">//maintain a counter to generate the ID for each U</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uCount=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="B-java"><a href="#B-java" class="headerlink" title="B.java"></a>B.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//containor of created objects of type U</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> B <span class="title">getB</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> B();&#125;</span><br><span class="line">    <span class="comment">//insert an U at the end of the uArray</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addU</span><span class="params">(U inputU)</span></span>&#123;</span><br><span class="line">        uArray.add(inputU);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//remove a U from uArray by their id</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeU</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index&lt;uArray.size() &amp;&amp; uArray.get(index)!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            uArray.remove(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//pass through the U in uArray and call all three methods</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">uIteration</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(U u : uArray)&#123;</span><br><span class="line">            u.uMethod1();</span><br><span class="line">            u.uMethod2();</span><br><span class="line">            u.uMethod3();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//containor: List of U object</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;U&gt; uArray=<span class="keyword">new</span> ArrayList&lt;U&gt;();</span><br></pre></td></tr></table></figure>
<h5 id="Test-java"><a href="#Test-java" class="headerlink" title="Test.java"></a>Test.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//list of A</span></span><br><span class="line">        A[] aArray=<span class="keyword">new</span> A[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;aArray.length;i++)&#123;</span><br><span class="line">            aArray[i]=A.getA();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//B is list of U</span></span><br><span class="line">        B b=B.getB();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//A create U, insert into B</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;aArray.length;j++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=j+<span class="number">1</span>;i++)&#123;</span><br><span class="line">                b.addU(aArray[j].getU());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//show content in B</span></span><br><span class="line">        b.uIteration();</span><br><span class="line">        b.removeU(<span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">"================================"</span>);</span><br><span class="line">        b.uIteration();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//每个A类实例都有ID，他们生产的U也有各自ID。每个U都是一个独一无二的类。</span></span><br><span class="line"><span class="comment">//output:</span></span><br><span class="line">&#123;A-<span class="number">0</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">0</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">0</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">2</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">2</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">2</span>&#125;.method3</span><br><span class="line">================================</span><br><span class="line">&#123;A-<span class="number">0</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">0</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">0</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">0</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">1</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">1</span>&#125;.method3</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">2</span>&#125;.method1</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">2</span>&#125;.method2</span><br><span class="line">&#123;A-<span class="number">2</span>&#125;.&#123;U-<span class="number">2</span>&#125;.method3</span><br></pre></td></tr></table></figure>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/anonymous-inner-class/" rel="tag">#anonymous inner class</a>
          
            <a href="/tags/callback/" rel="tag">#callback</a>
          
            <a href="/tags/closure/" rel="tag">#closure</a>
          
            <a href="/tags/inner-class/" rel="tag">#inner class</a>
          
            <a href="/tags/lambda-expression/" rel="tag">#lambda expression</a>
          
            <a href="/tags/lambda表达式/" rel="tag">#lambda表达式</a>
          
            <a href="/tags/λ演算/" rel="tag">#λ演算</a>
          
            <a href="/tags/内部类/" rel="tag">#内部类</a>
          
            <a href="/tags/匿名内部类/" rel="tag">#匿名内部类</a>
          
            <a href="/tags/回调/" rel="tag">#回调</a>
          
            <a href="/tags/闭包/" rel="tag">#闭包</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/04/facotryMethodPattern/" rel="next" title="为什么要使用“工厂”模式？">
                <i class="fa fa-chevron-left"></i> 为什么要使用“工厂”模式？
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/07/10/tij4-11/" rel="prev" title="Think in Java 读书笔记：第十一章 - 容器">
                Think in Java 读书笔记：第十一章 - 容器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/07/05/tij4-10/"
           data-title="Think in Java 读书笔记：第十章 - 内部类" data-url="www.ciaoshen.com/2016/07/05/tij4-10/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/shenAvatar.jpg"
               alt="沈玮 | Wei SHEN" />
          <p class="site-author-name" itemprop="name">沈玮 | Wei SHEN</p>
          <p class="site-description motion-element" itemprop="description">Coder & Designer</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">117</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/helloShen" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/72441576/" target="_blank">
                  
                    <i class="fa fa-globe"></i> DouBan
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/pang-pang-37-37" target="_blank">
                  
                    <i class="fa fa-globe"></i> ZhiHu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#摘要"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一个最简单的内部类：外部类的一个“备选”组件"><span class="nav-number">2.</span> <span class="nav-text">一个最简单的内部类：外部类的一个“备选”组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内部类是一个“闭包”，自由访问外部类所有字段"><span class="nav-number">3.</span> <span class="nav-text">内部类是一个“闭包”，自由访问外部类所有字段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#闭包（Closure）"><span class="nav-number">3.1.</span> <span class="nav-text">闭包（Closure）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#由此引出的一个常用的-“迭代器模式（Interator-Pattern）”"><span class="nav-number">3.2.</span> <span class="nav-text">由此引出的一个常用的 “迭代器模式（Interator Pattern）”</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更进一步：外部类对内部类的访问也畅通无阻"><span class="nav-number">4.</span> <span class="nav-text">更进一步：外部类对内部类的访问也畅通无阻</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内部类向上层接口转型，对外隐藏内部实现"><span class="nav-number">5.</span> <span class="nav-text">内部类向上层接口转型，对外隐藏内部实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内部类“回调”外部类，实现多继承"><span class="nav-number">6.</span> <span class="nav-text">内部类“回调”外部类，实现多继承</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#回调（Callback）"><span class="nav-number">6.1.</span> <span class="nav-text">回调（Callback）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更重口味：匿名内部类"><span class="nav-number">7.</span> <span class="nav-text">更重口味：匿名内部类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#匿名内部类从java-8开始能访问非final的参数了"><span class="nav-number">7.1.</span> <span class="nav-text">匿名内部类从java 8开始能访问非final的参数了</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lambda表达式"><span class="nav-number">7.2.</span> <span class="nav-text">Lambda表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#λ演算"><span class="nav-number">7.3.</span> <span class="nav-text">λ演算</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#继承内部类"><span class="nav-number">8.</span> <span class="nav-text">继承内部类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#继承外部类，内部类不会被覆盖"><span class="nav-number">9.</span> <span class="nav-text">继承外部类，内部类不会被覆盖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Why-Inner-Class"><span class="nav-number">10.</span> <span class="nav-text">Why Inner Class?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习"><span class="nav-number">11.</span> <span class="nav-text">练习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-23"><span class="nav-number">11.1.</span> <span class="nav-text">Exercise 23</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#匿名内部类接收现在可以接收非final参数了"><span class="nav-number">11.1.1.</span> <span class="nav-text">匿名内部类接收现在可以接收非final参数了</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#U-java"><span class="nav-number">11.1.2.</span> <span class="nav-text">U.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#A-java"><span class="nav-number">11.1.3.</span> <span class="nav-text">A.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#B-java"><span class="nav-number">11.1.4.</span> <span class="nav-text">B.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Test-java"><span class="nav-number">11.1.5.</span> <span class="nav-text">Test.java</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沈玮 | Wei SHEN</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>

</br>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div>
  <span id="busuanzi_container_site_pv">
  Visited  <span id="busuanzi_value_site_pv"></span>  times
  </span>

<span id="busuanzi_container_site_pv">&nbsp; &nbsp; | &nbsp; &nbsp;</span>

  <span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span>  Visitors
  </span>
<div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ciaoshen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  





  
  

  
  


</body>
</html>
