<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Access Control,package,包,访问权限," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="摘要这章就Java对代码块的组织做了一个详细的描述。其中package包的内容，可以参看我的《Mac上自搭舒服的Java环境，别总是用IDE》这篇文章。
后一部分详细介绍了public,protected,default和private四种不同的访问权限等级。描述了一种以private为字段基本面，default包可见为基本方法调用权限的谨慎的编程风格。特别还举例说明了singleton设计模式，">
<meta property="og:type" content="article">
<meta property="og:title" content="Thinking in Java 读书笔记：第六章 - 访问权限控制">
<meta property="og:url" content="www.ciaoshen.com/2016/03/16/tij4-6/index.html">
<meta property="og:site_name" content="沈玮 | Wei SHEN">
<meta property="og:description" content="摘要这章就Java对代码块的组织做了一个详细的描述。其中package包的内容，可以参看我的《Mac上自搭舒服的Java环境，别总是用IDE》这篇文章。
后一部分详细介绍了public,protected,default和private四种不同的访问权限等级。描述了一种以private为字段基本面，default包可见为基本方法调用权限的谨慎的编程风格。特别还举例说明了singleton设计模式，">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-7/auxiliaryClass.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-6/packagePrivateClass.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-6/exercise8.png">
<meta property="og:updated_time" content="2016-10-15T17:29:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Thinking in Java 读书笔记：第六章 - 访问权限控制">
<meta name="twitter:description" content="摘要这章就Java对代码块的组织做了一个详细的描述。其中package包的内容，可以参看我的《Mac上自搭舒服的Java环境，别总是用IDE》这篇文章。
后一部分详细介绍了public,protected,default和private四种不同的访问权限等级。描述了一种以private为字段基本面，default包可见为基本方法调用权限的谨慎的编程风格。特别还举例说明了singleton设计模式，">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>



  <meta name="baidu-site-verification" content="3iRy3UFlpa" />


<script>
  (function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


  <title> Thinking in Java 读书笔记：第六章 - 访问权限控制 | 沈玮 | Wei SHEN </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74473715-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">沈玮 | Wei SHEN</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Coder & Designer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hDG3wYskg4CYKGSXw8x7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Thinking in Java 读书笔记：第六章 - 访问权限控制
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-16T19:21:59-04:00" content="2016-03-16">
              2016-03-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/16/tij4-6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/16/tij4-6/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span id="busuanzi_container_page_pv">&nbsp; |  &nbsp; &nbsp; Viewed <span id="busuanzi_value_page_pv"></span> times</span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>这章就Java对代码块的组织做了一个详细的描述。其中package包的内容，可以参看我的<a href="http://www.ciaoshen.com/2016/03/04/javaEnvi/"><strong>《Mac上自搭舒服的Java环境，别总是用IDE》</strong></a>这篇文章。</p>
<p>后一部分详细介绍了public,protected,default和private四种不同的访问权限等级。描述了一种以private为字段基本面，default包可见为基本方法调用权限的谨慎的编程风格。特别还举例说明了singleton设计模式，通过私有化构造器，拒绝外部实例化。全局只留唯一的静态对象，而且对这个静态对象的操作也只留下一组特定的接口方法。管理非常到位。</p>
<h3 id="包"><a href="#包" class="headerlink" title="包"></a>包</h3><p>这里关于package以及CLASSPATH的内容，我在<a href="http://www.ciaoshen.com/2016/03/04/javaEnvi/"><strong>《Mac上自搭舒服的Java环境，别总是用IDE》</strong></a>里已经系统介绍过，这里不再重复。</p>
<h4 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a>练习1</h4><p>Create a class in a package. Create an instance of your class outside of that package.<br>第五章关于finalize()的练习里，我的HowlingDog类从第三章的Dog类继承过来，当时就在导入了第三章的package。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter3.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  Inherit the Dog class in Chapter 3</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HowlingDog</span> <span class="keyword">extends</span> <span class="title">com</span>.<span class="title">ciaoshen</span>.<span class="title">thinkinjava</span>.<span class="title">chapter3</span>.<span class="title">Dog</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//tag to notice if the dog howls</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> itHowls = <span class="keyword">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HowlingDog</span><span class="params">(String inName, String inSays)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(inName,inSays);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="静态import"><a href="#静态import" class="headerlink" title="静态import"></a>静态import</h4><p>比如说我的工具包<strong><code>com.ciaoshen.util</code></strong>里有静态方法<strong><code>print()</code></strong>来实现<strong><code>System.out.println()</code></strong>的功能。当我静态导入我的工具包以后，就可以用<strong><code>print()</code></strong>代替<strong><code>System.out.println()</code></strong>了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.ciaoshen.util</span><br></pre></td></tr></table></figure></p>
<h4 id="练习-2"><a href="#练习-2" class="headerlink" title="练习 2"></a>练习 2</h4><p>Take the code fragments in this section and turn them into a program, and verify that collisions do in fact occur.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter6;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="comment">//chapter6下面的debug和debugoff包有两个同名类DebugClass。导致冲突。</span></span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter6.*;	</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SameNameClass</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  main method</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        DebugClass.debug();     <span class="comment">//  - 1 -</span></span><br><span class="line">        com.ciaoshen.thinkinjava.chapter6.debug.DebugClass.debug();     <span class="comment">//  - 2 -</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行 - 1 -，编译器发现同名类DebugClass，报错。</span></span><br><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter6/SameNameClass.java:<span class="number">20</span>: error: cannot find symbol</span><br><span class="line">        DebugClass.debug();     <span class="comment">//  - 1 -</span></span><br><span class="line">        ^</span><br><span class="line">  symbol:   variable DebugClass</span><br><span class="line">  location: <span class="class"><span class="keyword">class</span> <span class="title">SameNameClass</span></span><br><span class="line">1 <span class="title">error</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//执行 - 2 -，正常</span><br><span class="line"><span class="title">I</span> <span class="title">am</span> <span class="title">com</span>.<span class="title">ciaoshen</span>.<span class="title">thinkinjava</span>.<span class="title">chapter6</span>.<span class="title">debug</span>.<span class="title">DebugClass</span>.<span class="title">debug</span>()</span></span><br></pre></td></tr></table></figure></p>
<h3 id="访问权限"><a href="#访问权限" class="headerlink" title="访问权限"></a>访问权限</h3><p>这是一个很严肃的话题。刚学Java的时候还没顾得上管这个，程序能跑就行。但工业级别的代码，没有访问控制肯定要乱套。</p>
<p>我觉得设访问权限，一定要有思路，一个个类，成员去考虑设什么权限肯定是不行的。一个整体的头绪和层次能让这个问题简单很多。首先，全public肯定是太不安全，全private根本调用不动。</p>
<p>书里推荐的一个方法不错，我看官方类库都在用：也就是变量尽量保护起来，然后通过accesor（访问器）和mutator（变异器）的get和set公开方法访问。这样比较优雅。</p>
<p>作者推荐在源代码中，将成员按可见度由高到低的排列方法，更易读，也让其他程序员和客户，关注更需要他们关注的部分。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类中先列public再protected再private成员</span></span><br><span class="line"><span class="comment">//这样的风格更易读</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrganizedByAccess</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pub1</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pub2</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pub3</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">priv1</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">priv2</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">priv3</span><span class="params">()</span> </span>&#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br></pre></td></tr></table></figure></p>
<h4 id="练习-4"><a href="#练习-4" class="headerlink" title="练习 4"></a>练习 4</h4><p>Show that protected methods have package access but are not public.<br>调用两个相同的protectedDebug()方法，一个和调用类在同一个包里，另一个不是。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//I call two methods, one in the same package another not.</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    <span class="comment">//in another package</span></span><br><span class="line">    DebugClass.protectedDebug();</span><br><span class="line">    <span class="comment">//in the same package</span></span><br><span class="line">    SameNameClass.protectedDebug();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//protectedDebug() method in the same package</span></span><br><span class="line"><span class="comment">//com.ciaoshen.thinkinjava.chapter6包</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">protectedDebug</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"I am protectedDebug() method in chapter6.SameNameClass"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//protectedDebug() method in another package</span></span><br><span class="line"><span class="comment">//com.ciaoshen.thinkinjava.chapter6.debug包</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">protectedDebug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am protectedDebug() method in chapter6.debug.DebugClass"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>调用结果：在同一个包里方法调用成功，不同包的调用失败。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter6/CallProtected.java:<span class="number">23</span>: error: protectedDebug() has <span class="keyword">protected</span> access in DebugClass</span><br><span class="line">        DebugClass.protectedDebug();</span><br><span class="line">                  ^</span><br><span class="line"><span class="number">1</span> <span class="function">error</span><br><span class="line">I am <span class="title">protectedDebug</span><span class="params">()</span> method in chapter6.SameNameClass</span></span><br></pre></td></tr></table></figure></p>
<h4 id="练习-5"><a href="#练习-5" class="headerlink" title="练习 5"></a>练习 5</h4><p>Create a class with public, private, protected, and package-access fields and method members. Create an object of this class and see what kind of compiler messages you get when you try to access all the class members. Be aware that classes in the same directory are part of the “default” package.</p>
<p>一个类中分别定义了三种public,protectd,private访问权限的成员方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///Users/Wei/java/com/ciaoshen/thinkinjava/chapter6/SameNameClass.java</span></span><br><span class="line">    <span class="comment">//public method</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">publicDebug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am publicDebug() method in chapter6.SameNameClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//protected method</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">protectedDebug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am protectedDebug() method in chapter6.SameNameClass"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//private method</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">privateDebug</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"I am privateDebug() method in chapter6.SameNameClass"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>同一个包里另外一个类调用这三种方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///Users/Wei/java/com/ciaoshen/thinkinjava/chapter6/CallProtected.java</span></span><br><span class="line">        <span class="comment">//exercise 5</span></span><br><span class="line">        <span class="comment">//in the same package</span></span><br><span class="line">        SameNameClass.publicDebug();</span><br><span class="line">        <span class="comment">//in the same package</span></span><br><span class="line">        SameNameClass.protectedDebug();</span><br><span class="line">        <span class="comment">//in the same package</span></span><br><span class="line">        SameNameClass.privateDebug();</span><br></pre></td></tr></table></figure></p>
<p>结果编译在privateDebug()方法这里通不过。证明同一个包可以访问public和protected但private不行。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter6/CallProtected.java:<span class="number">35</span>: error: privateDebug() has <span class="keyword">private</span> access in SameNameClass</span><br><span class="line">        SameNameClass.privateDebug();</span><br><span class="line">                     ^</span><br><span class="line"><span class="number">1</span> error</span><br></pre></td></tr></table></figure></p>
<h4 id="练习-6"><a href="#练习-6" class="headerlink" title="练习 6"></a>练习 6</h4><p>Create a class with protected data. Create a second class in the same file with a method that manipulates the protected data in the first class.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> String protectedValue = <span class="string">"Protected Value"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//exercise 6</span></span><br><span class="line">        System.out.println(CallProtected.protectedValue + <span class="string">" is visited!"</span>);   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//output: Protected Value is visited!</span></span><br></pre></td></tr></table></figure></p>
<h4 id="类的访问权限"><a href="#类的访问权限" class="headerlink" title="类的访问权限"></a>类的访问权限</h4><p>可以直接设置整个类的访问权限。但类的访问权限只有两种public和默认(package-private)。是没有private和protected的。而且每个<strong><code>.java</code></strong>文件里只能有一个public class。</p>
<ol>
<li><strong>public class</strong>：公开，谁都能访问。每个类里仅限一个。</li>
<li><strong>class</strong>：包访问权限。默认只有包内方法才能访问。</li>
</ol>
<p><strong>！！！注意</strong>：作者说每个<strong><code>.java</code></strong>文件里只能有一个public class，但实际不要把很多非公有类放到一个文件里。这样会导致”<strong><code>Auxiliary Class</code></strong>“问题。不是一个好的编程风格。正确的做法是，<strong>为每个类，创建一个单独的<code>.java</code>文件</strong>。下面是一个简单的测试：<br><strong><code>PublicClass.java</code></strong>文件里有两个类。一个公开，一个非公开。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter7;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//My public class</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PublicClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">//default constructor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PublicClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello, I am PublicClass."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Non public class</span></span><br><span class="line"><span class="comment">//It should be package reachable</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PackageReachableClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">//default constructor</span></span><br><span class="line">    PackageReachableClass()&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hi, I am PackageReachableClass."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我在同一个包的另一个文件<code>InPackageClass.java</code>文件里调用这两个类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InPackageClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span><br><span class="line"> 	*  MAIN</span><br><span class="line">		*  <span class="doctag">@param</span> args void</span><br><span class="line"> 	*/</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    	<span class="comment">//pubic class can be reached from anywhere</span></span><br><span class="line">    	PublicClass newPublicClass=<span class="keyword">new</span> PublicClass();</span><br><span class="line">    	<span class="comment">//non-public-class should be accessable in the same package</span></span><br><span class="line">    	PackageReachableClass newPackageReachableClass =<span class="keyword">new</span> PackageReachableClass();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>系统会提出警告：Auxiliary Class(辅助类)不应该在他所在的<code>.java</code>文件外被调用。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter7/InPackageClass.java:<span class="number">22</span>: warning: auxiliary <span class="class"><span class="keyword">class</span> <span class="title">PackageReachableClass</span> <span class="title">in</span> ./<span class="title">com</span>/<span class="title">ciaoshen</span>/<span class="title">thinkinjava</span>/<span class="title">chapter7</span>/<span class="title">PublicClass</span>.<span class="title">java</span> <span class="title">should</span> <span class="title">not</span> <span class="title">be</span> <span class="title">accessed</span> <span class="title">from</span> <span class="title">outside</span> <span class="title">its</span> <span class="title">own</span> <span class="title">source</span> <span class="title">file</span></span><br><span class="line">        <span class="title">PackageReachableClass</span> <span class="title">newPackageReachableClass</span> </span>=<span class="keyword">new</span> PackageReachableClass();</span><br><span class="line">        ^</span><br><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter7/InPackageClass.java:<span class="number">22</span>: warning: auxiliary <span class="class"><span class="keyword">class</span> <span class="title">PackageReachableClass</span> <span class="title">in</span> ./<span class="title">com</span>/<span class="title">ciaoshen</span>/<span class="title">thinkinjava</span>/<span class="title">chapter7</span>/<span class="title">PublicClass</span>.<span class="title">java</span> <span class="title">should</span> <span class="title">not</span> <span class="title">be</span> <span class="title">accessed</span> <span class="title">from</span> <span class="title">outside</span> <span class="title">its</span> <span class="title">own</span> <span class="title">source</span> <span class="title">file</span></span><br><span class="line">        <span class="title">PackageReachableClass</span> <span class="title">newPackageReachableClass</span> </span>=<span class="keyword">new</span> PackageReachableClass();</span><br><span class="line">                                                            ^</span><br><span class="line"><span class="number">2</span> warnings</span><br><span class="line">Hello, I am PublicClass.</span><br><span class="line">Hi, I am PackageReachableClass.</span><br></pre></td></tr></table></figure></p>
<p>在StackOverFlow里有专门的回答：一个java文件里塞多个非公开类，叫Auxiliary Class（辅助类），虽然包内也能调用，但这不是一个好的编程风格。最好为每个类都创建一个单独的java文件。<br><img src="/uploads/tij4-7/auxiliaryClass.png" alt="auxiliaryClass"></p>
<h5 id="非公开类中的公开成员"><a href="#非公开类中的公开成员" class="headerlink" title="非公开类中的公开成员"></a>非公开类中的公开成员</h5><p>没有public修饰符的非公开类，他们里面的public成员，在包外能调用吗？又做了一个实验：</p>
<ol>
<li>非公开类</li>
<li>private字段</li>
<li>public方法</li>
<li>还有一个public static公开静态方法<br>包外的类能调用吗？</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter5;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="comment">//非公开类，没有public修饰符</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InPackageTank</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//公开构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InPackageTank</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name=name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//公开静态方法public static</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"Show Time!"</span>);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//普通公开方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shot</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bullet --;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.bullet==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.isEmpty=<span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//私有字段</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isEmpty = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bullet = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> String name = <span class="keyword">new</span> String();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外一个包里，调用坦克类：<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> com.ciaoshen.thinkinjava.chapter5.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> CallTank &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  @param args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String args[])&#123;</span><br><span class="line">        <span class="comment">//静态方法，不实例化</span></span><br><span class="line">        InPackageTank.show();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//实例化</span></span><br><span class="line">        Tank tank1 = <span class="keyword">new</span> Tank(<span class="string">"Tank1"</span>);</span><br><span class="line">        System.<span class="keyword">out</span>.println(tank1.bullet);</span><br><span class="line">        tank1.shot();</span><br><span class="line">        System.<span class="keyword">out</span>.println(tank1.bullet);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>静态方法都调用不动：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter7/CallTank.java:<span class="number">21</span>: error: InPackageTank is not public <span class="keyword">in</span> com.ciaoshen.thinkinjava.chapter5; cannot be accessed from outside package</span><br><span class="line">        InPackageTank.show();</span><br><span class="line">        ^</span><br><span class="line"><span class="number">1</span> error</span><br><span class="line">Erreur : impossible de trouver ou charger la classe principale com.ciaoshen.thinkinjava.chapter7.CallTank</span><br></pre></td></tr></table></figure></p>
<p>更不用说需要实例化的普通方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter7/CallTank.java:<span class="number">21</span>: error: InPackageTank is not <span class="keyword">public</span> in com.ciaoshen.thinkinjava.chapter5; cannot be accessed from outside <span class="keyword">package</span></span><br><span class="line">        InPackageTank.show();</span><br><span class="line">        ^</span><br><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter7/CallTank.java:<span class="number">24</span>: error: InPackageTank is not <span class="keyword">public</span> in com.ciaoshen.thinkinjava.chapter5; cannot be accessed from outside <span class="keyword">package</span></span><br><span class="line">        InPackageTank tank1 = <span class="keyword">new</span> InPackageTank(<span class="string">"Tank1"</span>);</span><br><span class="line">        ^</span><br><span class="line">/Users/Wei/java/com/ciaoshen/thinkinjava/chapter7/CallTank.java:<span class="number">24</span>: error: InPackageTank is not <span class="keyword">public</span> in com.ciaoshen.thinkinjava.chapter5; cannot be accessed from outside <span class="keyword">package</span></span><br><span class="line">        InPackageTank tank1 = <span class="keyword">new</span> InPackageTank(<span class="string">"Tank1"</span>);</span><br><span class="line">                                  ^</span><br><span class="line"><span class="number">3</span> errors</span><br><span class="line">Erreur : impossible de trouver ou charger la classe principale com.ciaoshen.thinkinjava.chapter7.CallTank</span><br></pre></td></tr></table></figure></p>
<p>所以，包内可见类内的公开成员，还是只能包可见。<br><strong>！！！注意</strong>：一个好的编程风格是：尽量少用包可见类。不得不用的时候，也要像对待公开类一样，保护好它的内部成员。保持字段私有，接口方法公开的原则。同样的原则还适用于给类加final修饰符的时候。这主要基于以下两个事实：</p>
<ol>
<li>如果包内可见类被另一个公开类继承，那它内部成员的属性就开始具有意义了。包内可见类里面乱设访问限制就麻烦大了。</li>
<li>包内可见类经常被用来临时关闭一个类的可见性。必要的时候我们会重新加上public，或者去掉final，重启可见性，和可继承性。这时候，我们绝对不会想每次都重设所有成员的访问级别。所以一个好的习惯是：假装这个类是对外开放的，永远保持好内部所有的细节。</li>
</ol>
<p><img src="/uploads/tij4-6/packagePrivateClass.png" alt="packagePrivateClass"></p>
<h5 id="类的隐身斗篷"><a href="#类的隐身斗篷" class="headerlink" title="类的隐身斗篷"></a>类的隐身斗篷</h5><p>在这里作者给出了一个我认为绝佳的Practice，怎么隐藏你的类。思路层次非常清楚：</p>
<ol>
<li>类只有包可见。</li>
<li>包可见类里的成员，基本都设成private。尤其是构造器。这样没人能创建此类的对象。你的类别人根本没法实例化，也没法继承，它就像穿了一件隐身斗篷：<strong>DON’T TOUCH ME!!!</strong></li>
<li>可以留两个static静态访问方法。在这个访问方法里，你就是上帝！可以设各种限制。比如加个计数器，实例数量超过阈值就拒绝再创建对象。更绝的，做成个singleton（单例器），保证heap堆里永远只有一个实例。哪天不高兴了，就把静态访问器关掉，闭门谢客。好拽。</li>
</ol>
<h6 id="普通静态访问器"><a href="#普通静态访问器" class="headerlink" title="普通静态访问器"></a>普通静态访问器</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包访问类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Soup1</span> </span>&#123;</span><br><span class="line">  <span class="comment">//私有构造器</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Soup1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="comment">//静态访问器</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Soup1 <span class="title">makeSoup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//返回实例前，可以做各种统计，控制</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Soup1();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="singleton（单例器）模式"><a href="#singleton（单例器）模式" class="headerlink" title="singleton（单例器）模式"></a>singleton（单例器）模式</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他都和普通访问器相同，尽可能地私有化</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Soup2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Soup2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="comment">//全局唯一的静态实例</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Soup2 ps1 = <span class="keyword">new</span> Soup2();</span><br><span class="line">  <span class="comment">//访问器只能访问这个唯一的静态实例。本宫给你们个皮球，你们玩儿去吧。</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Soup2 <span class="title">access</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> ps1; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="练习-8"><a href="#练习-8" class="headerlink" title="练习 8"></a>练习 8</h4><p>Following the form of the example Lunch.java, create a class called ConnectionManager that manages a fixed array of Connection objects. The client programmer must not be able to explicitly create Connection objects, but can only get them via a static method in ConnectionManager. When the ConnectionManager runs out of objects, it returns a null reference. Test the classes in main( ).</p>
<p>singleton的模式还是挺好玩的，这道题我把<strong><code>ConnectionManager</code></strong>做成了一个singleton模式。构造函数设为私有，用户无法初始化<strong><code>ConnectionManager</code></strong>的任何实例。唯一的访问途径是我的公开<strong><code>singleton()</code></strong>方法，返回全局唯一的一个<strong><code>ConnectionManager</code></strong>静态对象：<strong><code>theOnlyManager</code></strong>。<strong><code>Connection</code></strong>类被设置成本包可见，拒绝任何外部访问。</p>
<p>通过这道题，我体会到了权限控制的重要性。假设ConnectionManager类是一个游戏服务器管理用户网络连接的组件，如果一切成员都是public，那意味着其他程序员可以从其他组件中跳过ConnectionManager的控制，直接接触到我底层的每个Connection，可以随意地篡改连接的属性，甚至直接删除任意玩家已建立的连接。最直接的两个灾难性后果是：</p>
<ol>
<li>只要任何一个模块不小心误操作底层connection，玩家的连接就会崩溃。</li>
<li>一旦我的ConnectionManager内部做任何细小的改动，比如connection的某个字段改个名字，其他程序员调用我数据的部分就无法正常工作。</li>
</ol>
<p>设计ConnectionManager的目的，就是把底层connection的细节全部隐藏起来，只留下我想让大家操作的几个接口。这样也便于模块间的耦合。</p>
<p>另外singleton的好处是，强制全局只有theSingleManager这一个控制器的实例。保证所有对connection的操作都作用于theSingleManager这个全局唯一的静态实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  ConnectionManager manage the Connections.</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter6;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  Only the ConnectionManager class is public visible.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionManager</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*********************</span><br><span class="line">     *  public methods</span><br><span class="line">     *********************/</span></span><br><span class="line">    <span class="comment">//the only public Object available for users</span></span><br><span class="line">    <span class="comment">//the static interface of singleton pattern</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConnectionManager <span class="title">singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> theOnlyManager;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//reset the local IP</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocalIp</span><span class="params">(String nowIp)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.localIp=nowIp;</span><br><span class="line">        System.out.println(<span class="string">"Success! Now local IP is:   "</span>+<span class="keyword">this</span>.localIp);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//show everthing about the connection we have so far.</span></span><br><span class="line">    <span class="comment">//print the connection info line by line</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showConn</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//print the number of connection</span></span><br><span class="line">        System.out.println(<span class="string">"=============================="</span>);</span><br><span class="line">        System.out.println(<span class="string">"We have "</span>+<span class="keyword">this</span>.connNum+<span class="string">" connections now!   |"</span>);</span><br><span class="line">        System.out.println(<span class="string">"=============================="</span>);</span><br><span class="line">        <span class="comment">//print line by line</span></span><br><span class="line">        <span class="keyword">for</span>(Connection ele : <span class="keyword">this</span>.connArray)&#123;</span><br><span class="line">            System.out.println(<span class="string">"||"</span>+ele.toString()+<span class="string">"\t\t||"</span>);</span><br><span class="line">            System.out.println(<span class="string">"----------------------------------------------------------------------------------------------------------------------------------"</span>);</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//create a new connection and insert it into the table</span></span><br><span class="line">    <span class="comment">//check if the connection already exist before create it</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addConn</span><span class="params">(String clientIp)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.hasConn(<span class="keyword">this</span>.localIp, clientIp)==-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.connArray.add(<span class="keyword">new</span> Connection(<span class="keyword">this</span>.idCounter, <span class="keyword">this</span>.localIp, clientIp));</span><br><span class="line">            System.out.println(<span class="string">"Connection created!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"This connection already exist. Give me another IP please!"</span>);</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.connArray.get(<span class="keyword">this</span>.hasConn(<span class="keyword">this</span>.localIp, clientIp)).toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.connNum=<span class="keyword">this</span>.connArray.size();</span><br><span class="line">        <span class="keyword">this</span>.idCounter ++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//kill a connection if it exists</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">killConn</span><span class="params">(<span class="keyword">int</span> connId)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.hasId(connId)!=-<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"This connection has been killed!"</span>);</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.connArray.get(<span class="keyword">this</span>.hasId(connId)).toString());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">this</span>.connArray.remove(<span class="keyword">this</span>.hasId(connId));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"We cannot find this ID: "</span>+connId+<span class="string">". Please try another one!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.connNum=<span class="keyword">this</span>.connArray.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**************************************</span><br><span class="line">     *  private fields and constructor</span><br><span class="line">     **************************************/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//table of Connections</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> idCounter=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> String localIp=<span class="string">"127.0.0.1"</span>;  <span class="comment">//default</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Connection&gt; connArray=<span class="keyword">new</span> ArrayList&lt;Connection&gt;();</span><br><span class="line">    <span class="comment">//the number of connections</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> connNum=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//the only static connectionManager object</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConnectionManager theOnlyManager=<span class="keyword">new</span> ConnectionManager();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//static block: initialization</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//private constructor: useless for creating static member</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ConnectionManager</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*********************</span><br><span class="line">     *  private methods</span><br><span class="line">     *********************/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//check if this connection id already exist</span></span><br><span class="line">    <span class="comment">//return the index if find the id, otherwise return -1</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hasId</span><span class="params">(<span class="keyword">int</span> theId)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> contains = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(Connection ele : <span class="keyword">this</span>.connArray)&#123;</span><br><span class="line">            <span class="keyword">if</span> (ele.id==theId)&#123;</span><br><span class="line">                contains = connArray.indexOf(ele);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> contains;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//check if a certain connetion is already exist</span></span><br><span class="line">    <span class="comment">//return the index if find the connection, otherwise return -1</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hasConn</span><span class="params">(String localIp, String directIp)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> contains = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(Connection ele : <span class="keyword">this</span>.connArray)&#123;</span><br><span class="line">            <span class="keyword">if</span> (ele.myIp==localIp &amp;&amp; ele.directIp==directIp)&#123;</span><br><span class="line">                contains = connArray.indexOf(ele);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> contains;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  main test method: for the tests</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//create connection</span></span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"234.52.234.34"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"234.52.234.34"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"34.342.54.345"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"86.3.34.423.4"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"37.356.7.4"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//reset current local IP</span></span><br><span class="line">        ConnectionManager.singleton().setLocalIp(<span class="string">"192.168.2.1"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//create some connections again</span></span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"37.565.25.2"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"678.4.13.889"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"565.785.243.676"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"797.224.666.234"</span>);</span><br><span class="line">        ConnectionManager.singleton().addConn(<span class="string">"45.23.4.85"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//kill connection</span></span><br><span class="line">        ConnectionManager.singleton().killConn(<span class="number">34</span>);</span><br><span class="line">        ConnectionManager.singleton().killConn(<span class="number">3</span>);</span><br><span class="line">        ConnectionManager.singleton().killConn(<span class="number">8</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//show all connection</span></span><br><span class="line">        ConnectionManager.singleton().showConn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  The Connection class is only accessable in this package.</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  important fields of a connection</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    String myIp;</span><br><span class="line">    String directIp;</span><br><span class="line">    Date birthday;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//simple constructor. Private, no one can create the connection except me!</span></span><br><span class="line">    Connection(<span class="keyword">int</span> connId, String localIp, String clientIp)&#123;</span><br><span class="line">        <span class="keyword">this</span>.id=connId;</span><br><span class="line">        <span class="keyword">this</span>.myIp=localIp;</span><br><span class="line">        <span class="keyword">this</span>.directIp=clientIp;</span><br><span class="line">        <span class="keyword">this</span>.birthday=<span class="keyword">new</span> Date();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Full constructor. Private, no one can create the connection except me!</span></span><br><span class="line">    Connection(<span class="keyword">int</span> connId, String localIp, String clientIp, Date timeNow)&#123;</span><br><span class="line">        <span class="keyword">this</span>.id=connId;</span><br><span class="line">        <span class="keyword">this</span>.myIp=localIp;</span><br><span class="line">        <span class="keyword">this</span>.directIp=clientIp;</span><br><span class="line">        <span class="keyword">this</span>.birthday=timeNow;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//the toString() method in Object class is public, it cannot be protected or friendly here.</span></span><br><span class="line">    <span class="comment">//prepare the info stream for the printer</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//to get the template of the date</span></span><br><span class="line">        DateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy/MM/dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">        String result=<span class="string">"  ID: "</span>+<span class="keyword">this</span>.id+<span class="string">"  \t| Local IP: "</span>+<span class="keyword">this</span>.myIp+<span class="string">"\t\t| Direct IP: "</span>+<span class="keyword">this</span>.directIp+<span class="string">"  \t| Etablished At: "</span>+dateFormat.format(<span class="keyword">this</span>.birthday);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  main test method: nothing in it.</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<ol>
<li>尝试10次建立连接，成功9次。1次拒绝，因为连接已存在。</li>
<li>尝试3次断开连接，成功2次。1次失败，因为ID不存在。</li>
<li>最后打印剩下的全部7个连接。<br><img src="/uploads/tij4-6/exercise8.png" alt="exercise8"></li>
</ol>
<h4 id="练习-9"><a href="#练习-9" class="headerlink" title="练习 9"></a>练习 9</h4><p>Exercise 9: (2) Create the following file in the access/local directory (presumably in your CLASSPATH):<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// access/local/PackagedClass.java</span></span><br><span class="line"><span class="keyword">package</span> access.local;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PackagedClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PackagedClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Creating a packaged class"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Then create the following file in a directory other than access/local:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// access/foreign/Foreign.java</span></span><br><span class="line"><span class="keyword">package</span> access.foreign;</span><br><span class="line"><span class="keyword">import</span> access.local.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foreign</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      PackagedClass pc = <span class="keyword">new</span> PackagedClass();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是因为<strong><code>PackagedClass</code></strong>类没有设成public，只是包可见。所以包外的<strong><code>Foreign</code></strong>类无法创建它的实例。把Foreign类放到<strong><code>access/local</code></strong>包里，问题就解决了。</p>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Access-Control/" rel="tag">#Access Control</a>
          
            <a href="/tags/package/" rel="tag">#package</a>
          
            <a href="/tags/包/" rel="tag">#包</a>
          
            <a href="/tags/访问权限/" rel="tag">#访问权限</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/15/javaGC/" rel="next" title="Java垃圾回收初探">
                <i class="fa fa-chevron-left"></i> Java垃圾回收初探
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/03/17/tij4-7/" rel="prev" title="Thinking in Java 读书笔记：第七章 - 复用类">
                Thinking in Java 读书笔记：第七章 - 复用类 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/03/16/tij4-6/"
           data-title="Thinking in Java 读书笔记：第六章 - 访问权限控制" data-url="www.ciaoshen.com/2016/03/16/tij4-6/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/shenAvatar.jpg"
               alt="沈玮 | Wei SHEN" />
          <p class="site-author-name" itemprop="name">沈玮 | Wei SHEN</p>
          <p class="site-description motion-element" itemprop="description">Coder & Designer</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">49</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">163</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/helloShen" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/72441576/" target="_blank">
                  
                    <i class="fa fa-globe"></i> DouBan
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/pang-pang-37-37" target="_blank">
                  
                    <i class="fa fa-globe"></i> ZhiHu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#摘要"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#包"><span class="nav-number">2.</span> <span class="nav-text">包</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#练习1"><span class="nav-number">2.1.</span> <span class="nav-text">练习1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态import"><span class="nav-number">2.2.</span> <span class="nav-text">静态import</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习-2"><span class="nav-number">2.3.</span> <span class="nav-text">练习 2</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#访问权限"><span class="nav-number">3.</span> <span class="nav-text">访问权限</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#练习-4"><span class="nav-number">3.1.</span> <span class="nav-text">练习 4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习-5"><span class="nav-number">3.2.</span> <span class="nav-text">练习 5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习-6"><span class="nav-number">3.3.</span> <span class="nav-text">练习 6</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类的访问权限"><span class="nav-number">3.4.</span> <span class="nav-text">类的访问权限</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#非公开类中的公开成员"><span class="nav-number">3.4.1.</span> <span class="nav-text">非公开类中的公开成员</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类的隐身斗篷"><span class="nav-number">3.4.2.</span> <span class="nav-text">类的隐身斗篷</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#普通静态访问器"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">普通静态访问器</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#singleton（单例器）模式"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">singleton（单例器）模式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习-8"><span class="nav-number">3.5.</span> <span class="nav-text">练习 8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#练习-9"><span class="nav-number">3.6.</span> <span class="nav-text">练习 9</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沈玮 | Wei SHEN</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>

</br>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div>
  <span id="busuanzi_container_site_pv">
  Visited  <span id="busuanzi_value_site_pv"></span>  times
  </span>

<span id="busuanzi_container_site_pv">&nbsp; &nbsp; | &nbsp; &nbsp;</span>

  <span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span>  Visitors
  </span>
<div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ciaoshen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  





  
  

  
  


</body>
</html>
