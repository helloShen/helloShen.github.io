<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="generic,泛型," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="泛型的语法泛型的基本动机之一：让容器适应不同的数据类型。
语法：用一对尖括号“”，表示泛型，中间的T就是“类型参数”。然后编程的时候，需要用到泛化类型的地方，就用这个T表示。
下面这个Holder类是一个最简单的用例，可以储存一泛化类型的对象。12345678910111213141516171819202122//类型声明要把“类型参数”写出来public class Holder&amp;lt;T&amp;g">
<meta property="og:type" content="article">
<meta property="og:title" content="（草稿中）">
<meta property="og:url" content="www.ciaoshen.com/2016/08/09/tij4-15/index.html">
<meta property="og:site_name" content="沈玮 | Wei SHEN">
<meta property="og:description" content="泛型的语法泛型的基本动机之一：让容器适应不同的数据类型。
语法：用一对尖括号“”，表示泛型，中间的T就是“类型参数”。然后编程的时候，需要用到泛化类型的地方，就用这个T表示。
下面这个Holder类是一个最简单的用例，可以储存一泛化类型的对象。12345678910111213141516171819202122//类型声明要把“类型参数”写出来public class Holder&amp;lt;T&amp;g">
<meta property="og:updated_time" content="2016-08-20T17:13:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="（草稿中）">
<meta name="twitter:description" content="泛型的语法泛型的基本动机之一：让容器适应不同的数据类型。
语法：用一对尖括号“”，表示泛型，中间的T就是“类型参数”。然后编程的时候，需要用到泛化类型的地方，就用这个T表示。
下面这个Holder类是一个最简单的用例，可以储存一泛化类型的对象。12345678910111213141516171819202122//类型声明要把“类型参数”写出来public class Holder&amp;lt;T&amp;g">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>



  <meta name="baidu-site-verification" content="3iRy3UFlpa" />


<script>
  (function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


  <title> （草稿中） | 沈玮 | Wei SHEN </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74473715-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">沈玮 | Wei SHEN</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Coder & Designer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hDG3wYskg4CYKGSXw8x7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                （草稿中）
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-09T10:24:15-04:00" content="2016-08-09">
              2016-08-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/09/tij4-15/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/09/tij4-15/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span id="busuanzi_container_page_pv">&nbsp; |  &nbsp; &nbsp; Viewed <span id="busuanzi_value_page_pv"></span> times</span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="泛型的语法"><a href="#泛型的语法" class="headerlink" title="泛型的语法"></a>泛型的语法</h3><p>泛型的基本动机之一：让容器适应不同的数据类型。</p>
<p><strong>语法</strong>：用一对尖括号“<t>”，表示泛型，中间的T就是<strong>“类型参数”</strong>。然后编程的时候，需要用到泛化类型的地方，就用这个T表示。</t></p>
<p>下面这个Holder类是一个最简单的用例，可以储存一泛化类型的对象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类型声明要把“类型参数”写出来</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Holder</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Pet</span></span>&#123;<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"A Pet!"</span>;&#125;&#125;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Pet</span></span>&#123;<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"A Dog!"</span>;&#125;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//类的内部，就用类型参数替代实际类型</span></span><br><span class="line">    <span class="keyword">private</span> T t;</span><br><span class="line">    <span class="comment">//构造函数和方法里也是一样。但前后就不用再用尖括号&lt;T&gt;标出类型参数了</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Holder</span><span class="params">(T inT)</span></span>&#123;t=inT;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T inT)</span></span>&#123;t=inT;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> t.toString();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Pet p=<span class="keyword">new</span> Pet();</span><br><span class="line">        Dog d=<span class="keyword">new</span> Dog();</span><br><span class="line">		<span class="comment">//使用的时候，在尖括号&lt;&gt;里声明实际使用的参数类型。原先Holder源码中所有的T都会被Pet替代。</span></span><br><span class="line">        Holder&lt;Pet&gt; h=<span class="keyword">new</span> Holder&lt;Pet&gt;(p);</span><br><span class="line">        System.out.println(h);</span><br><span class="line">        h.set(d);</span><br><span class="line">        System.out.println(h);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>记住三个关键点：</p>
<ol>
<li>类型声明的时候，后面在尖括号&lt;&gt;里加上“类型参数”，比如说T(什么名字都行)。</li>
<li>构造函数和方法里用到泛化类型的地方，都用尖括号&lt;&gt;里声明的类型参数符号代替。</li>
<li>但构造函数和方法声明名称的前后就不用再加尖括号&lt;&gt;和类型参数了。</li>
</ol>
<h3 id="一些需要注意的点"><a href="#一些需要注意的点" class="headerlink" title="一些需要注意的点"></a>一些需要注意的点</h3><h4 id="类型参数接受向上转型"><a href="#类型参数接受向上转型" class="headerlink" title="类型参数接受向上转型"></a>类型参数接受向上转型</h4><p>刚才的例子里，小狗是宠物的派生类。当我Holder<pet>声明的泛化类型是基类Pet的时候，也能向下兼容接受Dog类型。</pet></p>
<h4 id="数组不接受泛型"><a href="#数组不接受泛型" class="headerlink" title="数组不接受泛型"></a>数组不接受泛型</h4><h4 id="基本型无法作为类型参数"><a href="#基本型无法作为类型参数" class="headerlink" title="基本型无法作为类型参数"></a>基本型无法作为类型参数</h4><h4 id="静态方法不能访问类型参数"><a href="#静态方法不能访问类型参数" class="headerlink" title="静态方法不能访问类型参数"></a>静态方法不能访问类型参数</h4><h3 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h3><p>和泛型类一样的用法</p>
<h3 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h3><p>语法只需要把泛型参数列表置于返回类型之前</p>
<h4 id="参数类型推断（Type-Argument-Inference）"><a href="#参数类型推断（Type-Argument-Inference）" class="headerlink" title="参数类型推断（Type Argument Inference）"></a>参数类型推断（Type Argument Inference）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> &lt;T&gt; f(T t)&#123;System.out.println(t.getClass().getName();)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用泛型方法的时候，不需要像泛型类那样显式的标明参数类型。而是直接调用方法就行：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Test.f(<span class="string">"hello"</span>);</span><br><span class="line">Test.f(<span class="number">1</span>);</span><br><span class="line">Test.f(<span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//OutPut:</span></span><br><span class="line"><span class="comment">//java.lang.String</span></span><br><span class="line"><span class="comment">//java.lang.Integer</span></span><br><span class="line"><span class="comment">//java.lang.Double</span></span><br></pre></td></tr></table></figure></p>
<h3 id="一个结合接口，内部类的比较复杂的场景"><a href="#一个结合接口，内部类的比较复杂的场景" class="headerlink" title="一个结合接口，内部类的比较复杂的场景"></a>一个结合接口，内部类的比较复杂的场景</h3><p>当一个泛化的类实现了一个泛化的接口，而且类内部还有一个泛化的内部类的时候，怎么处理？ 看下面这个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface</span>&lt;<span class="title">U</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> U <span class="title">getLast</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericsDemo</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//一个泛化表作为成员字段</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; content=<span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">	<span class="comment">//成员方法也得接受泛型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T t)</span></span>&#123;content.add(t);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> (content.size()&gt;<span class="number">0</span>)? content.get(<span class="number">0</span>) : <span class="keyword">null</span>;&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//！！！注意：这里不能写成Inner&lt;T&gt;。不然编译器会误解T代表另一个新的类型参数，而不是外部主类中的类型参数T。</span></span><br><span class="line">	<span class="comment">//内部类也接受泛型，而且实现了另外一个泛化接口。</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> <span class="keyword">implements</span> <span class="title">Interface</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">getLast</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> (content.size()&gt;<span class="number">0</span>)? content.get(content.size()-<span class="number">1</span>) : <span class="keyword">null</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//获取内部类引用的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Interface&lt;T&gt; <span class="title">getInterface</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>.new Inner();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        GenericsDemo&lt;String&gt; gd=<span class="keyword">new</span> GenericsDemo&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            gd.add(String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(gd.getFirst());</span><br><span class="line">        </span><br><span class="line">        GenericsDemo&lt;String&gt;.Inner i1=gd.new Inner();</span><br><span class="line">        Interface&lt;String&gt; i2=gd.new Inner();</span><br><span class="line">        Interface&lt;String&gt; i3=gd.getInterface();</span><br><span class="line">        </span><br><span class="line">        System.out.println(i1.getLast());</span><br><span class="line">        System.out.println(i2.getLast());</span><br><span class="line">        System.out.println(i3.getLast());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>GenericsDemo<t></t></strong>是一个泛化类，它有一个泛化的容器作为成员字段。它的说有方法都接受泛型。它还有个内部类Inner也要接受泛型，而且内部类实现了一个泛化的接口。</p>
<p>这个场景的关键问题在于：GenericsDemo<t>的类型参数<strong>“T”</strong>，怎么在这个类的内部得到承认。换句话说，这个<strong>“T”</strong>什么时候会被认为是外部类的类型参数，什么时候不是。</t></p>
<p>关键要记住一点：</p>
<blockquote>
<p>如果希望外部类的类型参数T<strong>“T”</strong>在内部类里也保持相同的含义，在声明内部函数Inner的时候，就不要再设一个<x>类型参数。</x></p>
</blockquote>
<p>如果声明Inner<t>或Inner<u>，就不再代表外部类的类型参数<strong>“T”</strong>。而是代表内部类自己的一个类型参数。</u></t></p>
<p>书里LinkedStack的例子里的内部类Node<u>，就是一个例子，<strong>“U”</strong>代表的是内部类自己的类型参数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedStack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">U</span>&gt; </span>&#123;</span><br><span class="line">        U item;</span><br><span class="line">        Node&lt;U&gt; next;</span><br><span class="line">        Node() &#123; item = <span class="keyword">null</span>; next = <span class="keyword">null</span>; &#125;</span><br><span class="line">        Node(U item, Node&lt;U&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.item = item;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> item == <span class="keyword">null</span> &amp;&amp; next == <span class="keyword">null</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; top = <span class="keyword">new</span> Node&lt;T&gt;(); <span class="comment">// End sentinel</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        top = <span class="keyword">new</span> Node&lt;T&gt;(item, top);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        T result = top.item;</span><br><span class="line">        <span class="keyword">if</span>(!top.end())</span><br><span class="line">            top = top.next;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LinkedStack&lt;String&gt; lss = <span class="keyword">new</span> LinkedStack&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span>(String s : <span class="string">"Phasers on stun!"</span>.split(<span class="string">" "</span>))</span><br><span class="line">            lss.push(s);</span><br><span class="line">        String s;</span><br><span class="line">        <span class="keyword">while</span>((s = lss.pop()) != <span class="keyword">null</span>)</span><br><span class="line">            System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></u></p>
<h3 id="另一个实现多个接口，以及内部类的场景：迭代器"><a href="#另一个实现多个接口，以及内部类的场景：迭代器" class="headerlink" title="另一个实现多个接口，以及内部类的场景：迭代器"></a>另一个实现多个接口，以及内部类的场景：迭代器</h3><p>一个迭代器的关键在于实现两个接口。外部类IterableFibonacci实现<strong>Iterable<integer></integer></strong>接口，内部类FibIte实现<strong>Iterator<integer></integer></strong>接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> fib(count++); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> fib(n-<span class="number">2</span>) + fib(n-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IterableFibonacci</span> <span class="keyword">extends</span> <span class="title">Fibonacci</span> <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IterableFibonacci</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123; n = count; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>.new FibIte();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FibIte</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> n &gt; <span class="number">0</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            n--;</span><br><span class="line">            <span class="keyword">return</span> IterableFibonacci.<span class="keyword">this</span>.next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123; <span class="comment">// Not implemented</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IterableFibonacci iteFib=<span class="keyword">new</span> IterableFibonacci(<span class="number">18</span>);</span><br><span class="line">        Iterator&lt;Integer&gt; ite=iteFib.iterator();</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            System.out.print(ite.next()+<span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="擦除"><a href="#擦除" class="headerlink" title="擦除"></a>擦除</h3><blockquote>
<p><strong>在泛型代码内部,无法获取任何有关泛型参数类型的信息.</strong></p>
</blockquote>
<p>看两个例子。第一个例子中，两个存放不同类型的ArrayList，比较它们的Class对象，结果存String和存Integer的ArrayList的类型相同。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class c1 = <span class="keyword">new</span> ArrayList&lt;String&gt;().getClass();</span><br><span class="line">Class c2 = <span class="keyword">new</span> ArrayList&lt;Integer&gt;().getClass();</span><br><span class="line">System.out.println(c1 == c2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Output: true</span></span><br></pre></td></tr></table></figure></p>
<p>第二个例子，我们尝试用Class#getTypeParameters()方法获得泛型的类型参数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;A&gt; list = <span class="keyword">new</span> ArrayList&lt;A&gt;();</span><br><span class="line">		System.out.println(Arrays.toString(list.getClass().getTypeParameters()));</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// Output:[E]</span></span><br></pre></td></tr></table></figure></p>
<p>结果返回的并不是真正的类型参数A，而是定义ArrayList<e>时候的占位符。</e></p>
<p>事实证明，Java是用<strong>“擦除”</strong>来实现的。运行时，任何泛化具体信息都被擦除了List<string>被擦成<strong>“List”</strong>。所以，<strong>在运行时List<string>和List<integer>在JVM看来都是List。</integer></string></strong></string></p>
<p>擦除以后剩下的List，叫他们的<strong>“原生”类型</strong>。</p>
<h4 id="因为擦除，Java泛型做不了什么？"><a href="#因为擦除，Java泛型做不了什么？" class="headerlink" title="因为擦除，Java泛型做不了什么？"></a>因为擦除，Java泛型做不了什么？</h4><p>对Java来说，像下面这样，调用泛型对象的fff()方法，编译器是通不过的。因为编译器在Runtime之前，无法知道泛型T的具体类型，是否有fff()方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span> </span>&#123;<span class="function"><span class="keyword">public</span> <span class="title">fff</span><span class="params">()</span></span>&#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AAA</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	T t;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AAA</span><span class="params">(T t)</span></span>&#123;<span class="keyword">this</span>.t=t;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">callF</span><span class="params">()</span></span>&#123;</span><br><span class="line">		t.fff();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="泛型类型参数擦除到第一个边界"><a href="#泛型类型参数擦除到第一个边界" class="headerlink" title="泛型类型参数擦除到第一个边界"></a>泛型类型参数擦除到第一个边界</h4><p>还是上面这个例子，如果声明AAA类的泛型参数T的时候，加上一个<strong>“边界”</strong>：extends BBB。编译就能通过了。因为这时候编译器会<strong>把<t extends="" bbb="">从左往右擦除</t></strong>，直到第一个边界“BBB”。所以，剩下的就是<strong>“public class AAA<bbb>”</bbb></strong>。这时候，编译器就能检查BBB类有没有实现fff()方法了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBB</span> </span>&#123;<span class="function"><span class="keyword">public</span> <span class="title">fff</span><span class="params">()</span></span>&#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AAA</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BBB</span>&gt; </span>&#123;</span><br><span class="line">	T t;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AAA</span><span class="params">(T t)</span></span>&#123;<span class="keyword">this</span>.t=t;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">callF</span><span class="params">()</span></span>&#123;</span><br><span class="line">		t.fff();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="擦除式泛型怎么创建参数类型实例？"><a href="#擦除式泛型怎么创建参数类型实例？" class="headerlink" title="擦除式泛型怎么创建参数类型实例？"></a>擦除式泛型怎么创建参数类型实例？</h3><h4 id="不传递Class对象，改而传递工厂。"><a href="#不传递Class对象，改而传递工厂。" class="headerlink" title="不传递Class对象，改而传递工厂。"></a>不传递Class对象，改而传递工厂。</h4><h4 id="“模板方法”模式"><a href="#“模板方法”模式" class="headerlink" title="“模板方法”模式"></a>“模板方法”模式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericWithCreate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> T element;</span><br><span class="line">    GenericWithCreate() &#123; element = create(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> T <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Creator</span> <span class="keyword">extends</span> <span class="title">GenericWithCreate</span>&lt;<span class="title">X</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">X <span class="title">create</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> X(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(element.getClass().getSimpleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreatorGeneric</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Creator c = <span class="keyword">new</span> Creator();</span><br><span class="line">        c.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="泛型数组"><a href="#泛型数组" class="headerlink" title="泛型数组"></a>泛型数组</h3><p>Java不允许泛型数组的原因是数组是强类型的，在运行时必须检测到实际数据类型，但泛型比如<t>擦除之后，数组无法知道自己的实际数据类型。所以Java设计人员把范型数组的功能禁止。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generic</span>&lt;<span class="title">T</span>&gt;</span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayOfGenerics</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIZE = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">static</span> Generic&lt;Integer&gt;[] gia;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">        gia = (Generic&lt;Integer&gt;[])<span class="keyword">new</span> Object[SIZE];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//运行时rawtypes警告</span></span><br><span class="line">        <span class="comment">//但用了泛型</span></span><br><span class="line">        gia = (Generic&lt;Integer&gt;[])<span class="keyword">new</span> Generic[SIZE];</span><br><span class="line">        </span><br><span class="line">        System.out.println(gia.getClass().getSimpleName());</span><br><span class="line">        gia[<span class="number">0</span>] = <span class="keyword">new</span> Generic&lt;Integer&gt;();</span><br><span class="line">        <span class="comment">//! gia[1] = new Object(); // Compile-time error</span></span><br><span class="line">        <span class="comment">// Discovers type mismatch at compile time:</span></span><br><span class="line">        <span class="comment">//! gia[2] = new Generic&lt;Double&gt;();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></t></p>
<h4 id="两种方法声明泛型数组"><a href="#两种方法声明泛型数组" class="headerlink" title="两种方法声明泛型数组"></a>两种方法声明泛型数组</h4><h5 id="接受检查的强类型方法（理论上更好的方法）"><a href="#接受检查的强类型方法（理论上更好的方法）" class="headerlink" title="接受检查的强类型方法（理论上更好的方法）"></a>接受检查的强类型方法（理论上更好的方法）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenSet</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> E[] a;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenSet</span><span class="params">(Class&lt;E&gt; c, <span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Use Array native method to create array</span></span><br><span class="line">        <span class="comment">// of a type only known at run time</span></span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="keyword">final</span> E[] a = (E[]) Array.newInstance(c, s);</span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">E <span class="title">get</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="不接受检查的弱类型方法（JDK里普遍使用）"><a href="#不接受检查的弱类型方法（JDK里普遍使用）" class="headerlink" title="不接受检查的弱类型方法（JDK里普遍使用）"></a>不接受检查的弱类型方法（JDK里普遍使用）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenSet</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object[] a;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenSet</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        a = <span class="keyword">new</span> Object[s];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">E <span class="title">get</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        <span class="keyword">final</span> E e = (E) a[i];</span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="第二种方法里需要注意"><a href="#第二种方法里需要注意" class="headerlink" title="第二种方法里需要注意"></a>第二种方法里需要注意</h5><p>不能给对象数组Object[]转型。因为String[]和Object[]之间不存在IS-A的关系。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object[] o=<span class="keyword">new</span> Object[<span class="number">1</span>];</span><br><span class="line">String[] s=<span class="keyword">new</span> String[<span class="number">1</span>];</span><br><span class="line">s[<span class="number">0</span>]=<span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line">s=(String)o;</span><br></pre></td></tr></table></figure></p>
<p>所以，下面例子里的操作是不允许的。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class Test&lt;T&gt;&#123;</span><br><span class="line">    private Object[] o;</span><br><span class="line">    public Test3(int num)&#123;o=new Object[num];&#125;</span><br><span class="line">    </span><br><span class="line">    public void add(T t, int index)&#123;</span><br><span class="line">        if(index&lt;o.length)&#123;</span><br><span class="line">            o[index]=t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	//单个元素转型：可以</span><br><span class="line">    public T get(int index)&#123;return (index&lt;o.length)? (T)o[index] : null;&#125;</span><br><span class="line">	//对数组转型：报错</span><br><span class="line">    public T[] getAll()&#123;return (T[])o;&#125;	//Error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 边界Bounds</span><br><span class="line">#### 一个泛型最多能有一个实际类和多个接口作为边界</span><br><span class="line">#### 声明的时候类必须写在接口之前</span><br><span class="line"></span><br><span class="line">### @SuppressWarnings("unchecked")</span><br><span class="line"></span><br><span class="line">### 桥方法</span><br><span class="line">Java核心技术卷1：P536</span><br><span class="line"></span><br><span class="line">### 通配符</span><br><span class="line">一篇IBM Developer上的文章</span><br><span class="line">http://www.ibm.com/developerworks/cn/java/j-jtp04298.html</span><br><span class="line">#### 通配子类边界：" ? extends XXX"</span><br><span class="line"></span><br><span class="line">用通配符让泛型类之间有了继承的关系。这是通配符被设计出来的最大动机。</span><br><span class="line"></span><br><span class="line">但使用通配符的时候，要小心这会导致一些使用到通配符做参数的方法失效。</span><br><span class="line"></span><br><span class="line">比如下面这个例子，对于ArrayList&lt;? extends Fruit&gt;的实例对象来说，它的add()方法的一个参数就变成了"? extends Fruit"，但实际上编译器是不知道这代表哪个确切类型的。所以add()方法就无法被调用。导致flist对象无法接受任何新的元素。</span><br><span class="line">```java</span><br><span class="line">public class GenericsAndCovariance &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		//把含有通配符的泛型List指向一个具体类型的List</span><br><span class="line">		List&lt;? extends Fruit&gt; flist = new ArrayList&lt;Apple&gt;();</span><br><span class="line">		// 这个List失去添加新对象的能力</span><br><span class="line">		// flist.add(new Apple());</span><br><span class="line">		// flist.add(new Fruit());</span><br><span class="line">		// flist.add(new Object());</span><br><span class="line">		//只能添加null对象，然并卵</span><br><span class="line">		flist.add(null); </span><br><span class="line">		// 只能往外取对象</span><br><span class="line">		Fruit f = flist.get(0);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但参数不涉及通配符的方法是不会受影响的。</p>
<h4 id="通配超类边界：”-super-XXX”"><a href="#通配超类边界：”-super-XXX”" class="headerlink" title="通配超类边界：” ? super XXX”"></a>通配超类边界：” ? super XXX”</h4><p>通配超类正好和通配全子类的相反。可以放心地做参数，但不能用来做返回值的类型。因为” ? super XXX”表明列表里的元素是XXX的超类，所以往里添加XXX或XXX的子类一定是安全的。但反过来，把取出来的对象赋值给XXX类型对象，就不行了，因为有可能取出的是XXX的超类。</p>
<p>这样刚才的flist.add(new Apple())就是合法的，但Fruit f=flist.get(0)是非法的。</p>
<h4 id="考虑怎样“放入”和“取出”元素对象，来确定是使用子类边界还是超类边界。"><a href="#考虑怎样“放入”和“取出”元素对象，来确定是使用子类边界还是超类边界。" class="headerlink" title="考虑怎样“放入”和“取出”元素对象，来确定是使用子类边界还是超类边界。"></a>考虑怎样“放入”和“取出”元素对象，来确定是使用子类边界还是超类边界。</h4><h4 id="无界通配符：-lt-gt"><a href="#无界通配符：-lt-gt" class="headerlink" title="无界通配符：&lt;?&gt;"></a>无界通配符：&lt;?&gt;</h4><p>比如说容器里的列表List<t>。</t></p>
<p>原生类“List”（没有泛型）：代表持有任何Object类型的原生List。<br>持有无界通配符的“List&lt;?&gt;”：表示持有“某种类型”的非原生List。只是我们不知道那种类型是什么。</p>
<h4 id="关于通配符最好的一个例子"><a href="#关于通配符最好的一个例子" class="headerlink" title="关于通配符最好的一个例子"></a>关于通配符最好的一个例子</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Holder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T t;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span> </span>&#123; <span class="keyword">this</span>.t = t; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> t; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wildcards</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 原生类：无泛型，就用Object代替</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rawArgs</span><span class="params">(Holder holder, Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//可以。raw type警告</span></span><br><span class="line">        holder.set(arg); <span class="comment">// raw type Warning:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 可以。raw type警告</span></span><br><span class="line">        holder.set(<span class="keyword">new</span> Wildcards()); <span class="comment">// raw type warning</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 不行。这里没有泛型T</span></span><br><span class="line">        <span class="comment">//T t = holder.get();</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 可以。但原先holder里的类型信息丢失。</span></span><br><span class="line">        Object obj = holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 无边界通配符</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">unboundedArg</span><span class="params">(Holder&lt;?&gt; holder, Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//报错。因为Holder&lt;capture of ?&gt; 里的set(capture of ?)方法，代表某种不知道类型的参数，不能接受Object类型，也不接受任何类型。</span></span><br><span class="line">        <span class="comment">//holder.set(arg); // Error:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//报错。因为Holder&lt;capture of ?&gt; 里的set(capture of ?)方法，代表某种不知道类型的参数，不能接受Object类型，也不接受任何类型。</span></span><br><span class="line">        <span class="comment">//holder.set(new Wildcards()); // Same error</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 不行，没有泛型T</span></span><br><span class="line">        <span class="comment">//T t = holder.get();</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 可以。只有Object型可以接受通配符型&lt;?&gt;的赋值。但原先holder里的类型信息丢失。</span></span><br><span class="line">        Object obj = holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 正常泛型&lt;T&gt;，没问题</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">exact1</span><span class="params">(Holder&lt;T&gt; holder)</span> </span>&#123;</span><br><span class="line">        T t = holder.get();</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 正常泛型&lt;T&gt;，没问题</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">exact2</span><span class="params">(Holder&lt;T&gt; holder, T arg)</span> </span>&#123;</span><br><span class="line">        holder.set(arg);</span><br><span class="line">        T t = holder.get();</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//子类边界</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">wildSubtype</span><span class="params">(Holder&lt;? extends T&gt; holder, T arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//报错。Holder&lt;? extends T&gt; 里的set(? extends T)方法，不能接受T类型</span></span><br><span class="line">        <span class="comment">//holder.set(arg); // Error:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//可以。holder.get()返回T或T的子类，可以赋值给T类型。</span></span><br><span class="line">        T t = holder.get();</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//超类边界</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">wildSupertype</span><span class="params">(Holder&lt;? <span class="keyword">super</span> T&gt; holder, T arg)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//可以。因为set(? super T)接受T或T的超类为参数。无论如何都能接受T类型。</span></span><br><span class="line">        holder.set(arg);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//报错。holder.get()返回T或T的超类，无法放进T类型里。</span></span><br><span class="line">        <span class="comment">//T t = holder.get(); // Error:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 可以。但原先holder里的类型信息丢失。</span></span><br><span class="line">        Object obj = holder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Holder raw = new Holder&lt;Long&gt;();</span></span><br><span class="line">        <span class="comment">// Or:</span></span><br><span class="line">        Long lng = <span class="number">1L</span>;</span><br><span class="line">        Object o=<span class="keyword">new</span> Object();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//四种不同程度泛化的Holder对象</span></span><br><span class="line">        Holder raw = <span class="keyword">new</span> Holder();</span><br><span class="line">        Holder&lt;Long&gt; qualified = <span class="keyword">new</span> Holder&lt;Long&gt;();</span><br><span class="line">        Holder&lt;?&gt; unbounded = <span class="keyword">new</span> Holder&lt;Long&gt;();</span><br><span class="line">        Holder&lt;? extends Long&gt; bounded = <span class="keyword">new</span> Holder&lt;Long&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//原生类Holder为参数：四种Holder放进去都没问题</span></span><br><span class="line">        rawArgs(raw, lng);</span><br><span class="line">        rawArgs(qualified, lng);</span><br><span class="line">        rawArgs(unbounded, lng);</span><br><span class="line">        rawArgs(bounded, lng);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//无边界通配符Holder：无论放什么都不行，编译期已经报错</span></span><br><span class="line">        unboundedArg(raw, lng);</span><br><span class="line">        unboundedArg(qualified, lng);</span><br><span class="line">        unboundedArg(unbounded, lng);</span><br><span class="line">        unboundedArg(bounded, lng);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//警告：用Holder当Holder&lt;T&gt;类型参数</span></span><br><span class="line">        Object r1 = exact1(raw); <span class="comment">// Warnings: unchecked</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//没问题</span></span><br><span class="line">        Long r2 = exact1(qualified);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//只有Object可以接受&lt;?&gt;通配符的返回类型</span></span><br><span class="line">        Object r3 = exact1(unbounded); <span class="comment">// Must return Object</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//没问题</span></span><br><span class="line">        Long r4 = exact1(bounded);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//警告：用Holder当Holder&lt;Long&gt;</span></span><br><span class="line">        Long r5 = exact2(raw, lng); <span class="comment">// Warnings: unchecked</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//没问题</span></span><br><span class="line">        Long r6 = exact2(qualified, lng);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//报错：exact2(Holder&lt;T&gt;,T)方法不能用（Holder&lt;capture of ?&gt;,Long）这两个参数。</span></span><br><span class="line">        Long r7 = exact2(unbounded, lng); <span class="comment">// Error:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//报错：exact2(Holder&lt;T&gt;,T)方法不能用（Holder&lt;capture of ? extends Long&gt;,Long）这两个参数。</span></span><br><span class="line">        Long r8 = exact2(bounded, lng); <span class="comment">// Error:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//警告：改用holder&lt;Long&gt;的地方用了holder原生类</span></span><br><span class="line">        Long r9 = wildSubtype(raw, lng); <span class="comment">// Warnings: unchecked</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//警告：该给(Holder&lt;? extends T&gt;,T)参数的，给了(Holder,Long)</span></span><br><span class="line">        Long r10 = wildSubtype(qualified, lng);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//没问题，但只能用Object来接收返回值</span></span><br><span class="line">        Object r11 = wildSubtype(unbounded, lng);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//没问题</span></span><br><span class="line">        Long r12 = wildSubtype(bounded, lng);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//警告：该给(Holder&lt;? super T&gt;,T)参数的，给了(Holder,Long)</span></span><br><span class="line">        wildSupertype(raw, lng); <span class="comment">// Warnings:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//没问题</span></span><br><span class="line">        wildSupertype(qualified, lng);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//报错：该给(Holder&lt;? super T&gt;,T)参数的，给了(Holder&lt;capture of ?&gt;,Long)</span></span><br><span class="line">        wildSupertype(unbounded, lng); <span class="comment">// Error:</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//报错：该给(Holder&lt;? super T&gt;,T)参数的，给了(Holder&lt;capture of ? extends Long&gt;,Long)</span></span><br><span class="line">        wildSupertype(bounded, lng); <span class="comment">// Error:</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="协变和自限定"><a href="#协变和自限定" class="headerlink" title="协变和自限定"></a>协变和自限定</h3><h4 id="协变"><a href="#协变" class="headerlink" title="协变"></a>协变</h4><p>根据Override重写的规则，被重写方法的参数和返回值都不能变。</p>
<p>Java 5.0开始允许在派生类中继承自基类的方法改变返回值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">OrdinaryGetter</span> </span>&#123;</span><br><span class="line">    <span class="function">Base <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">DerivedGetter</span> <span class="keyword">extends</span> <span class="title">OrdinaryGetter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Return type of overridden method is allowed to vary:</span></span><br><span class="line">    <span class="function">Derived <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="自限定"><a href="#自限定" class="headerlink" title="自限定"></a>自限定</h4><p>自限定的本质是：<strong>基类用导出类替代其参数</strong>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GenericGetter</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">GenericGetter</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Getter</span> <span class="keyword">extends</span> <span class="title">GenericGetter</span>&lt;<span class="title">Getter</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">DerivedGetter</span> <span class="keyword">extends</span> <span class="title">OrdinaryGetter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Return type of overridden method is allowed to vary:</span></span><br><span class="line">    <span class="function">Derived <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="自限定自带协变特性"><a href="#自限定自带协变特性" class="headerlink" title="自限定自带协变特性"></a>自限定自带协变特性</h4><p>Getter g的g.get()方法的返回值是派生类Getter类型，而不是基类GenericGetter类型。而且和普通的继承规则不同，g.get()方法不是被重载(overload)而是重写(override)。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GenericGetter</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">GenericGetter</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Getter</span> <span class="keyword">extends</span> <span class="title">GenericGetter</span>&lt;<span class="title">Getter</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericsAndReturnTypes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(Getter g)</span> </span>&#123;</span><br><span class="line">        Getter result = g.get();</span><br><span class="line">        GenericGetter gg = g.get(); <span class="comment">// Also the base type</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><p>想要抛出根据泛型变化的异常，就需要把异常当成类型参数写进函数里。然后由throws关键字抛出。</p>
<h3 id="Java缺乏“潜在类型机制”"><a href="#Java缺乏“潜在类型机制”" class="headerlink" title="Java缺乏“潜在类型机制”"></a>Java缺乏“潜在类型机制”</h3><h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><h4 id="如果只是用泛型方法可以取代将整个类泛型化，就应该只使用泛型方法。"><a href="#如果只是用泛型方法可以取代将整个类泛型化，就应该只使用泛型方法。" class="headerlink" title="如果只是用泛型方法可以取代将整个类泛型化，就应该只使用泛型方法。"></a>如果只是用泛型方法可以取代将整个类泛型化，就应该只使用泛型方法。</h4><h4 id="只有当想实现跨越多个类的应用，才应该使用泛型。"><a href="#只有当想实现跨越多个类的应用，才应该使用泛型。" class="headerlink" title="只有当想实现跨越多个类的应用，才应该使用泛型。"></a>只有当想实现跨越多个类的应用，才应该使用泛型。</h4><h3 id="记住"><a href="#记住" class="headerlink" title="记住"></a>记住</h3><h4 id="虚拟机里没有泛型，只有普通的类和方法"><a href="#虚拟机里没有泛型，只有普通的类和方法" class="headerlink" title="虚拟机里没有泛型，只有普通的类和方法"></a>虚拟机里没有泛型，只有普通的类和方法</h4><h4 id="所有类型的参数都用他们的限定类型替换"><a href="#所有类型的参数都用他们的限定类型替换" class="headerlink" title="所有类型的参数都用他们的限定类型替换"></a>所有类型的参数都用他们的限定类型替换</h4><h4 id="桥方法被合成保持多态"><a href="#桥方法被合成保持多态" class="headerlink" title="桥方法被合成保持多态"></a>桥方法被合成保持多态</h4><h4 id="为了保持类型安全性，必要时插入强制类型转换"><a href="#为了保持类型安全性，必要时插入强制类型转换" class="headerlink" title="为了保持类型安全性，必要时插入强制类型转换"></a>为了保持类型安全性，必要时插入强制类型转换</h4><h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><h4 id="编译时类型检查，运行时类型检查都还不够。还需要一个良好的命名，以及良好的测试，来保证类型安全。"><a href="#编译时类型检查，运行时类型检查都还不够。还需要一个良好的命名，以及良好的测试，来保证类型安全。" class="headerlink" title="编译时类型检查，运行时类型检查都还不够。还需要一个良好的命名，以及良好的测试，来保证类型安全。"></a>编译时类型检查，运行时类型检查都还不够。还需要一个良好的命名，以及良好的测试，来保证类型安全。</h4><h4 id="类型安全并不是泛型的根本目的。增加代码的通用性才是。类型安全反而是编写通用代码带来的副作用。"><a href="#类型安全并不是泛型的根本目的。增加代码的通用性才是。类型安全反而是编写通用代码带来的副作用。" class="headerlink" title="类型安全并不是泛型的根本目的。增加代码的通用性才是。类型安全反而是编写通用代码带来的副作用。"></a>类型安全并不是泛型的根本目的。增加代码的通用性才是。类型安全反而是编写通用代码带来的副作用。</h4><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><h4 id="Exercise-1-2"><a href="#Exercise-1-2" class="headerlink" title="Exercise 1,2"></a>Exercise 1,2</h4><ul>
<li><strong>Exercise 1</strong>: (1) Use Holders with the typeinfo.pets library to show that a Holders that is specified to hold a base type can also hold a derived type.</li>
<li><strong>Exercise 2</strong>: (1) Create a holder class that holds three objects of the same type, along with the methods to store and fetch those objects and a constructor to initialize all three.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pet</span></span>&#123;<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"A Pet!"</span>;&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Pet</span></span>&#123;<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"A Dog!"</span>;&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Pet</span></span>&#123;<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"A Cat!"</span>;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Holder</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T t1;</span><br><span class="line">    <span class="keyword">private</span> T t2;</span><br><span class="line">    <span class="keyword">private</span> T t3;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Holder</span><span class="params">(T one,T two,T three)</span></span>&#123;t1=one;t2=two;t3=three;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(t1,t2,t3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"["</span>+t1.toString()+<span class="string">"],"</span>+<span class="string">"["</span>+t2.toString()+<span class="string">"],"</span>+<span class="string">"["</span>+t3.toString()+<span class="string">"]"</span>;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Pet p=<span class="keyword">new</span> Pet();</span><br><span class="line">        Dog d=<span class="keyword">new</span> Dog();</span><br><span class="line">        Cat c=<span class="keyword">new</span> Cat();</span><br><span class="line">        Holder&lt;Pet&gt; h=<span class="keyword">new</span> Holder&lt;Pet&gt;(p,d,c);</span><br><span class="line">        System.out.println(h);</span><br><span class="line">        List&lt;Pet&gt; l=h.get();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;l.size();i++)&#123;</span><br><span class="line">            System.out.println(l.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-3"><a href="#Exercise-3" class="headerlink" title="Exercise 3"></a>Exercise 3</h4><ul>
<li><strong>Exercise 3</strong> : (1) Create and test a SixTuple generic.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SixTuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>,<span class="title">C</span>,<span class="title">D</span>,<span class="title">E</span>,<span class="title">F</span>&gt;</span>&#123;</span><br><span class="line">    A a; B b; C c; D d; E e; F f;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SixTuple</span><span class="params">(A inA,B inB,C inC,D inD,E inE,F inF)</span></span>&#123;a=inA;b=inB;c=inC;d=inD;e=inE;f=inF;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> a.toString()+b.toString()+c.toString()+d.toString()+e.toString()+f.toString();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        SixTuple&lt;Integer,Long,Float,Double,String,Boolean&gt; mySix=<span class="keyword">new</span> SixTuple&lt;Integer,Long,Float,Double,String,Boolean&gt;(<span class="number">1</span>,<span class="number">2l</span>,<span class="number">3f</span>,<span class="number">4</span>d,<span class="string">"five"</span>,<span class="keyword">true</span>);</span><br><span class="line">        System.out.println(mySix.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Exercise-4"><a href="#Exercise-4" class="headerlink" title="Exercise 4"></a>Exercise 4</h4><ul>
<li><strong>Exercise 4</strong>: (3) “Generify” innerclasses/Sequence.java.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Selector</span>&lt;<span class="title">U</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">end</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">U <span class="title">current</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceInnerSelector</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; items;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> next = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SequenceInnerSelector</span><span class="params">()</span> </span>&#123; items = <span class="keyword">new</span> ArrayList&lt;T&gt;(); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        items.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String r=<span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span>(T item : items)&#123;</span><br><span class="line">            r+=item;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SequenceSelector</span> <span class="keyword">implements</span> <span class="title">Selector</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> i == items.size(); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">current</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> items.get(i); &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">if</span>(i &lt; items.size())&#123;i++;&#125; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Selector&lt;T&gt; <span class="title">selector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SequenceSelector();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SequenceInnerSelector&lt;String&gt; sequence = <span class="keyword">new</span> SequenceInnerSelector&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            sequence.add(Integer.toString(i));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sequence);</span><br><span class="line">        </span><br><span class="line">        Selector&lt;String&gt; selector = sequence.selector();</span><br><span class="line">        <span class="keyword">while</span>(!selector.end()) &#123;</span><br><span class="line">            System.out.print(selector.current() + <span class="string">" "</span>);</span><br><span class="line">            selector.next();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-5"><a href="#Exercise-5" class="headerlink" title="Exercise 5"></a>Exercise 5</h4><ul>
<li><strong>Exercise 5</strong>: (2) Remove the type parameter on the Node class and modify the rest of the code in LinkedStack.java to show that an inner class has access to the generic type parameters of its outer class.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedStackExercise4</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        T item;</span><br><span class="line">        Node next;</span><br><span class="line">        Node() &#123; item = <span class="keyword">null</span>; next = <span class="keyword">null</span>; &#125;</span><br><span class="line">        Node(T item, Node next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.item = item;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> item == <span class="keyword">null</span> &amp;&amp; next == <span class="keyword">null</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node top = <span class="keyword">new</span> Node(); <span class="comment">// End sentinel</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        top = <span class="keyword">new</span> Node(item, top);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        T result = top.item;</span><br><span class="line">        <span class="keyword">if</span>(!top.end())</span><br><span class="line">            top = top.next;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LinkedStackExercise4&lt;String&gt; lss = <span class="keyword">new</span> LinkedStackExercise4&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span>(String s : <span class="string">"Phasers on stun!"</span>.split(<span class="string">" "</span>))</span><br><span class="line">            lss.push(s);</span><br><span class="line">        String s;</span><br><span class="line">        <span class="keyword">while</span>((s = lss.pop()) != <span class="keyword">null</span>)</span><br><span class="line">            System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-6"><a href="#Exercise-6" class="headerlink" title="Exercise 6"></a>Exercise 6</h4><ul>
<li><strong>Exercise 6</strong>: (1) Use RandomList with two more types in addition to the one shown in main( ).</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;T&gt; storage = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">    <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T item)</span> </span>&#123; storage.add(item); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">select</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> storage.get(rand.nextInt(storage.size()));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RandomList&lt;String&gt; rs = <span class="keyword">new</span> RandomList&lt;String&gt;();</span><br><span class="line">        RandomList&lt;Integer&gt; ri=<span class="keyword">new</span> RandomList&lt;Integer&gt;();</span><br><span class="line">        RandomList&lt;Float&gt; rf=<span class="keyword">new</span> RandomList&lt;Float&gt;();</span><br><span class="line">        <span class="keyword">for</span>(String s: (<span class="string">"The quick brown fox jumped over "</span> +</span><br><span class="line">                       <span class="string">"the lazy brown dog"</span>).split(<span class="string">" "</span>))&#123;</span><br><span class="line">            rs.add(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>; i++)&#123;</span><br><span class="line">            System.out.print(rs.select() + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            ri.add(i);</span><br><span class="line">            rf.add((<span class="keyword">float</span>)i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            System.out.println(ri.select());</span><br><span class="line">            System.out.println(rf.select());</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-7"><a href="#Exercise-7" class="headerlink" title="Exercise 7"></a>Exercise 7</h4><ul>
<li><strong>Exercise 7</strong>: (2) Use composition instead of inheritance to adapt Fibonacci to make it Iterable.</li>
</ul>
<p>这题的关键在于实现两个接口。外部类IterableFibonacci实现Iterable<integer>接口，内部类FibIte实现Iterator<integer>接口。</integer></integer></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> fib(count++); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> fib(n-<span class="number">2</span>) + fib(n-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IterableFibonacci</span> <span class="keyword">extends</span> <span class="title">Fibonacci</span> <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IterableFibonacci</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123; n = count; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>.new FibIte();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FibIte</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> n &gt; <span class="number">0</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            n--;</span><br><span class="line">            <span class="keyword">return</span> IterableFibonacci.<span class="keyword">this</span>.next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123; <span class="comment">// Not implemented</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IterableFibonacci iteFib=<span class="keyword">new</span> IterableFibonacci(<span class="number">18</span>);</span><br><span class="line">        Iterator&lt;Integer&gt; ite=iteFib.iterator();</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            System.out.print(ite.next()+<span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-8"><a href="#Exercise-8" class="headerlink" title="Exercise 8"></a>Exercise 8</h4><ul>
<li><strong>Exercise 8</strong>: (2) Following the form of the Coffee example, create a hierarchy of StoryCharacters from your favorite movie, dividing them into GoodGuys and BadGuys. Create a generator for StoryCharacters, following the form of CoffeeGenerator.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StoryCharactors</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StoryCharactors</span><span class="params">(String inName)</span></span>&#123;name=inName;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodGuys</span> <span class="keyword">extends</span> <span class="title">StoryCharactors</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GoodGuys</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"Good "</span>+String.valueOf(System.nanoTime()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadGuys</span> <span class="keyword">extends</span> <span class="title">StoryCharactors</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BadGuys</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"Bad "</span>+String.valueOf(System.nanoTime()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoryCharactorsGenerator</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">StoryCharactors</span>&gt;, <span class="title">Iterable</span>&lt;<span class="title">StoryCharactors</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&lt;? extends StoryCharactors&gt;&gt; factories=<span class="keyword">new</span> ArrayList&lt;Class&lt;? extends StoryCharactors&gt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        factories.add(GoodGuys.class);</span><br><span class="line">        factories.add(BadGuys.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> max;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StoryCharactorsGenerator</span><span class="params">(<span class="keyword">int</span> inNum)</span></span>&#123;max=inNum;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;StoryCharactors&gt; <span class="title">iterator</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>.new ChIte(max);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> StoryCharactors <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (StoryCharactors)(factories.get(rand.nextInt(factories.size())).newInstance());</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Cannot make the new instance of StoryCharactors!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ChIte</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">StoryCharactors</span>&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ChIte</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;n=num;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> n&gt;<span class="number">0</span>;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> StoryCharactors <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            n--;</span><br><span class="line">            <span class="keyword">return</span> StoryCharactorsGenerator.<span class="keyword">this</span>.next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StoryCharactorsGenerator scg=<span class="keyword">new</span> StoryCharactorsGenerator(<span class="number">10</span>);</span><br><span class="line">        Iterator&lt;StoryCharactors&gt; ite=scg.iterator();</span><br><span class="line">        <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">            System.out.println(ite.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-9-10"><a href="#Exercise-9-10" class="headerlink" title="Exercise 9,10"></a>Exercise 9,10</h4><ul>
<li><strong>Exercise 9</strong>: (1) Modify GenericMethods.java so that f( ) accepts three arguments, all of which are of a different parameterized type.</li>
<li><strong>Exercise 10</strong>: (1) Modify the previous exercise so that one of f( )’s arguments is non-parameterized.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericMethods</span> </span>&#123;</span><br><span class="line">    <span class="comment">//Exercise 9</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T,U,V&gt; <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(T t, U u, V v)</span> </span>&#123;</span><br><span class="line">        System.out.println(t.getClass().getName());</span><br><span class="line">        System.out.println(u.getClass().getName());</span><br><span class="line">        System.out.println(v.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Exercise 10</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T,U&gt; <span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(T t, U u, String s)</span> </span>&#123;</span><br><span class="line">        System.out.println(t.getClass().getName());</span><br><span class="line">        System.out.println(u.getClass().getName());</span><br><span class="line">        System.out.println(s.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GenericMethods gm = <span class="keyword">new</span> GenericMethods();</span><br><span class="line">        gm.f(<span class="string">""</span>,<span class="number">1</span>,<span class="number">1.0</span>);</span><br><span class="line">        gm.g(<span class="number">1</span>,<span class="number">1.0</span>,<span class="string">"2.0"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-11"><a href="#Exercise-11" class="headerlink" title="Exercise 11"></a>Exercise 11</h4><ul>
<li><strong>Exercise 11</strong>: (1) Test New.java by creating your own classes and ensuring that New will work properly with them.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GenericOne</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T t;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericOne</span><span class="params">(T inT)</span></span>&#123;t=inT;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> t.toString()+<span class="string">": "</span>+ t.getClass().getName();&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leveraging</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">GenericOne&lt;T&gt; <span class="title">getOne</span><span class="params">(T inT)</span></span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> GenericOne&lt;T&gt;(inT);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        GenericOne&lt;String&gt; go= Leveraging.getOne(<span class="string">"Hello"</span>);</span><br><span class="line">        System.out.println(go);</span><br><span class="line">        </span><br><span class="line">        GenericOne&lt;Integer&gt; gi = Leveraging.getOne(<span class="number">100</span>);</span><br><span class="line">        System.out.println(gi);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-13"><a href="#Exercise-13" class="headerlink" title="Exercise 13"></a>Exercise 13</h4><ul>
<li><strong>Exercise 13</strong>: (4) Overload the fill( ) method so that the arguments and return types are the specific subtypes of Collection: List, Queue and Set. This way, you don’t lose the type of container. Can you overload to distinguish between List and LinkedList?</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coffee</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> count;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Coffee</span><span class="params">()</span></span>&#123;id=count++;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">showId</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> id;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Latte</span> <span class="keyword">extends</span> <span class="title">Coffee</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"No."</span>+String.valueOf(showId())+<span class="string">"&gt;&gt;&gt; I am Latte!"</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mocha</span> <span class="keyword">extends</span> <span class="title">Coffee</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"No."</span>+String.valueOf(showId())+<span class="string">"&gt;&gt;&gt; I am Mocha!"</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Capuccino</span> <span class="keyword">extends</span> <span class="title">Coffee</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"No."</span>+String.valueOf(showId())+<span class="string">"&gt;&gt;&gt; I am Capuccino!"</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoffeeGenerator</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">Coffee</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&lt;? extends Coffee&gt;&gt; c=<span class="keyword">new</span> ArrayList&lt;Class&lt;? extends Coffee&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        c.add(Latte.class);</span><br><span class="line">        c.add(Mocha.class);</span><br><span class="line">        c.add(Capuccino.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Coffee <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=rand.nextInt(c.size());</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> c.get(i).newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Generators</span> </span>&#123;</span><br><span class="line">    <span class="comment">//collection</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">fill</span><span class="params">(Collection&lt;T&gt; coll, Generator&lt;T&gt; gen, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            coll.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> coll;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//list</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">fill</span><span class="params">(List&lt;T&gt; list, Generator&lt;T&gt; gen, <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            list.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//queue</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Queue&lt;T&gt; <span class="title">fill</span><span class="params">(Queue&lt;T&gt; queue, Generator&lt;T&gt; gen, <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            queue.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//set</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Set&lt;T&gt; <span class="title">fill</span><span class="params">(Set&lt;T&gt; set, Generator&lt;T&gt; gen, <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            set.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Coffee&gt; manyCoffee=<span class="keyword">new</span> ArrayList&lt;Coffee&gt;();</span><br><span class="line">        manyCoffee=Generators.fill(manyCoffee, <span class="keyword">new</span> CoffeeGenerator(), <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">for</span>(Coffee cup : manyCoffee)&#123;</span><br><span class="line">            System.out.println(cup);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-14"><a href="#Exercise-14" class="headerlink" title="Exercise 14"></a>Exercise 14</h4><ul>
<li><strong>Exercise 14</strong>: (1) Modify BasicGeneratorDemo.java to use the explicit form of creation for the Generator (that is, use the explicit constructor instead of the generic create( ) method).</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountedObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">id</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"CountedObject "</span> + id;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicGenerator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; type;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasicGenerator</span><span class="params">(Class&lt;T&gt; type)</span></span>&#123; <span class="keyword">this</span>.type = type; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Assumes type is a public class:</span></span><br><span class="line">            <span class="keyword">return</span> type.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Produce a Default generator given a type token:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Generator&lt;T&gt; <span class="title">create</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BasicGenerator&lt;T&gt;(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicGeneratorDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BasicGenerator&lt;CountedObject&gt; bg=<span class="keyword">new</span> BasicGenerator&lt;CountedObject&gt;(CountedObject.class);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">            System.out.println(bg.next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-17"><a href="#Exercise-17" class="headerlink" title="Exercise 17"></a>Exercise 17</h4><ul>
<li><strong>Exercise 17</strong>: (4) Study the JDK documentation for EnumSet. You’ll see that there’s a clone( ) method defined. However, you cannot clone( ) from the reference to the Set interface passed in Sets.java. Can you modify Sets.java to handle both the general case of a Set interface as shown, and the special case of an EnumSet, using clone( ) instead of creating a new HashSet?</li>
</ul>
<p>这道题关键是练习泛型方法怎么声明：</p>
<blockquote>
<p><strong>public static <t extends="" enum<t="">&gt; EnumSet<t> union(EnumSet<t> a, EnumSet<t> b) {… …}</t></t></t></t></strong></p>
</blockquote>
<p><strong>注意！</strong>在函数的参数以及返回值的地方直接用泛型替换符T来表示，但是在最前面参数列表的地方，要定义参数T的具体边界。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Watercolors &#123; ZINC, LEMON_YELLOW, MEDIUM_YELLOW, DEEP_YELLOW, ORANGE, BRILLIANT_RED, CRIMSON, MAGENTA, ROSE_MADDER, VIOLET, CERULEAN_BLUE_HUE, PHTHALO_BLUE, ULTRAMARINE, COBALT_BLUE_HUE, PERMANENT_GREEN, VIRIDIAN_HUE, SAP_GREEN, YELLOW_OCHRE, BURNT_SIENNA, RAW_UMBER, BURNT_UMBER, PAYNES_GRAY, IVORY_BLACK &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sets</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt;&gt; <span class="function">EnumSet&lt;T&gt; <span class="title">union</span><span class="params">(EnumSet&lt;T&gt; a, EnumSet&lt;T&gt; b)</span> </span>&#123;</span><br><span class="line">        EnumSet&lt;T&gt; result = a.clone();</span><br><span class="line">        result.addAll(b);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt;&gt; <span class="function">EnumSet&lt;T&gt; <span class="title">intersection</span><span class="params">(EnumSet&lt;T&gt; a, EnumSet&lt;T&gt; b)</span> </span>&#123;</span><br><span class="line">        EnumSet&lt;T&gt; result = a.clone();</span><br><span class="line">        result.retainAll(b);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Subtract subset from superset:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt;&gt; <span class="function">EnumSet&lt;T&gt; <span class="title">difference</span><span class="params">(EnumSet&lt;T&gt; superset, EnumSet&lt;T&gt; subset)</span> </span>&#123;</span><br><span class="line">        EnumSet&lt;T&gt; result = superset.clone();</span><br><span class="line">        result.removeAll(subset);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Reflexive--everything not in the intersection:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Enum&lt;T&gt;&gt; <span class="function">EnumSet&lt;T&gt; <span class="title">complement</span><span class="params">(EnumSet&lt;T&gt; a, EnumSet&lt;T&gt; b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> difference(union(a, b), intersection(a, b));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        EnumSet&lt;Watercolors&gt; set1=EnumSet.range(Watercolors.MEDIUM_YELLOW, Watercolors.MAGENTA);</span><br><span class="line">        EnumSet&lt;Watercolors&gt; set2=EnumSet.range(Watercolors.ZINC,Watercolors.ORANGE);</span><br><span class="line">        </span><br><span class="line">        EnumSet&lt;Watercolors&gt; setUnion=Sets.union(set1,set2);</span><br><span class="line">        EnumSet&lt;Watercolors&gt; setIntersection=Sets.intersection(set1,set2);</span><br><span class="line">        EnumSet&lt;Watercolors&gt; setComplement=Sets.complement(set1,set2);</span><br><span class="line">        </span><br><span class="line">        EnumSet&lt;Watercolors&gt; superset=EnumSet.range(Watercolors.ZINC,Watercolors.PERMANENT_GREEN);</span><br><span class="line">        EnumSet&lt;Watercolors&gt; subset=EnumSet.range(Watercolors.CRIMSON, Watercolors.ULTRAMARINE);</span><br><span class="line">        EnumSet&lt;Watercolors&gt; setDifference=Sets.difference(superset,subset);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"\n Set Union &gt;&gt;&gt;&gt;&gt;"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Watercolors w : setUnion)&#123;</span><br><span class="line">            System.out.print(w+<span class="string">"    "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"\n Set Intersection &gt;&gt;&gt;&gt;&gt;"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Watercolors w : setIntersection)&#123;</span><br><span class="line">            System.out.print(w+<span class="string">"    "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"\n Set Complement &gt;&gt;&gt;&gt;&gt;"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Watercolors w : setComplement)&#123;</span><br><span class="line">            System.out.print(w+<span class="string">"    "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"\n Set Difference &gt;&gt;&gt;&gt;&gt;"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Watercolors w : setDifference)&#123;</span><br><span class="line">            System.out.print(w+<span class="string">"    "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-18"><a href="#Exercise-18" class="headerlink" title="Exercise 18"></a>Exercise 18</h4><ul>
<li><strong>Exercise 18</strong>: (3) Following the form of BankTeller.java, create an example where BigFish eat LittleFish in the Ocean.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt;</span>&#123;<span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span></span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmallFish</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id=counter++;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SmallFish</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"Small Fish No."</span>+id;&#125;</span><br><span class="line">    <span class="comment">//内部类工厂Generator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Generator&lt;SmallFish&gt; <span class="title">generator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Generator&lt;SmallFish&gt;()&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> SmallFish <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> SmallFish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigFish</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id=counter++;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">BigFish</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"Big Fish No."</span>+id;&#125;</span><br><span class="line">    <span class="comment">//内部类工厂Generator</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Generator&lt;BigFish&gt; <span class="title">generator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Generator&lt;BigFish&gt;()&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> BigFish <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> BigFish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BigEatSmall</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">(BigFish bf, SmallFish sf)</span></span>&#123;</span><br><span class="line">        System.out.println(bf+<span class="string">" EAT "</span>+sf);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">        Queue&lt;SmallFish&gt; foods=<span class="keyword">new</span> LinkedList&lt;SmallFish&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">            foods.add(SmallFish.generator().next());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;BigFish&gt; killers=<span class="keyword">new</span> ArrayList&lt;BigFish&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">            killers.add(BigFish.generator().next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(SmallFish sf:foods)&#123;</span><br><span class="line">            BigEatSmall.eat(killers.get(rand.nextInt(killers.size())),sf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-19"><a href="#Exercise-19" class="headerlink" title="Exercise 19"></a>Exercise 19</h4><ul>
<li><strong>Exercise 19</strong>: (2) Following the form of Store.java, build a model of a containerized cargo ship.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Generator</span>&lt;<span class="title">T</span>&gt;</span>&#123;<span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span></span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generators</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">fill</span><span class="params">(List&lt;T&gt; list, Generator&lt;T&gt; gen, <span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;num;i++)&#123;</span><br><span class="line">            list.add(gen.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id=++count;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(<span class="keyword">double</span> price)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"        Product No."</span>+id + <span class="string">" &gt;&gt;&gt; "</span> + <span class="string">"price: $"</span> + price;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Generator&lt;Product&gt; generator = <span class="keyword">new</span> Generator&lt;Product&gt;() &#123;</span><br><span class="line">        <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Product <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Product( Math.round(rand.nextDouble() * <span class="number">1000.0</span>) + <span class="number">0.99</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Container</span> <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Product</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SIZE=<span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id=++count;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Container</span><span class="params">(<span class="keyword">int</span> max)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        size=max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(<span class="keyword">int</span> numP)</span></span>&#123;</span><br><span class="line">        Generators.fill(<span class="keyword">this</span>,Product.generator,Math.min(size,numP));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder s=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        s.append(<span class="string">"    Container No."</span>+id+<span class="string">"[Max Size: "</span>+size+<span class="string">"] &gt;&gt;&gt; \n"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Product p:<span class="keyword">this</span>)&#123;</span><br><span class="line">            s.append(p+<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Generator&lt;Container&gt; generator = <span class="keyword">new</span> Generator&lt;Container&gt;()&#123;</span><br><span class="line">        Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Container <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Container(rand.nextInt(MAX_SIZE));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Deck</span> <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Container</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SIZE=<span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id=++count;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Deck</span><span class="params">(<span class="keyword">int</span> max)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        size=max;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(<span class="keyword">int</span> numC, <span class="keyword">int</span> numP)</span></span>&#123;</span><br><span class="line">        Generators.fill(<span class="keyword">this</span>, Container.generator, Math.min(size,numC));</span><br><span class="line">        <span class="keyword">for</span>(Container c:<span class="keyword">this</span>)&#123;</span><br><span class="line">            c.fill(numP);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder s=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        s.append(<span class="string">"Deck No."</span>+id+<span class="string">"[Max Size: "</span>+size+<span class="string">"] &gt;&gt;&gt; \n"</span>);</span><br><span class="line">        <span class="keyword">for</span>(Container c:<span class="keyword">this</span>)&#123;</span><br><span class="line">            s.append(c+<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Generator&lt;Deck&gt; generator=<span class="keyword">new</span> Generator&lt;Deck&gt;()&#123;</span><br><span class="line">        Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Deck <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Deck(rand.nextInt(MAX_SIZE));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CargoShip</span> <span class="keyword">extends</span> <span class="title">ArrayList</span>&lt;<span class="title">Deck</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SIZE=<span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CargoShip</span><span class="params">(<span class="keyword">int</span> numD, <span class="keyword">int</span> numC, <span class="keyword">int</span> numP)</span> </span>&#123;</span><br><span class="line">        Generators.fill(<span class="keyword">this</span>,Deck.generator,Math.min(numD,MAX_SIZE));</span><br><span class="line">        <span class="keyword">for</span>(Deck d:<span class="keyword">this</span>)&#123;</span><br><span class="line">            d.fill(numC,numP);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span>(Deck d : <span class="keyword">this</span>)&#123;</span><br><span class="line">            result.append(d+<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> CargoShip(<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-20"><a href="#Exercise-20" class="headerlink" title="Exercise 20"></a>Exercise 20</h4><ul>
<li><strong>Exercise 20</strong>: (1) Create an interface with two methods, and a class that implements that interface and adds another method. In another class, create a generic method with an argument type that is bounded by the interface, and show that the methods in the interface are callable inside this generic method. In main( ), pass an instance of the implementing class to the generic method.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">I</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Impl</span> <span class="keyword">implements</span> <span class="title">I</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am a()!"</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am b()!"</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">c</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am c()!"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise20</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends I&gt; <span class="function"><span class="keyword">void</span> <span class="title">generic</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">        t.a();</span><br><span class="line">        t.b();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Exercise20.generic(<span class="keyword">new</span> Impl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-21"><a href="#Exercise-21" class="headerlink" title="Exercise 21"></a>Exercise 21</h4><ul>
<li><strong>Exercise 21</strong>: (4) Modify ClassTypeCapture.java by adding a Map<string,class<?>&gt;, a method addType(String typename, Class&lt;?&gt; kind), and a method createNew(String typename). createNew( ) will either produce a new instance of the class associated with its argument string, or produce an error message.</string,class<?></li>
</ul>
<p>这题需要注意的是：Map<string,class<?>&gt; typeMap=new HashMap<string,class<?>&gt;(); 这样带通配符的赋值方法竟然可以。也就是Map里可以存不同泛型的Class对象。证明JAVA的泛型是编译时泛型，运行时擦除。</string,class<?></string,class<?></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Building</span> </span>&#123;<span class="function"><span class="keyword">public</span> <span class="title">Building</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am Building!"</span>);&#125;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">House</span> <span class="keyword">extends</span> <span class="title">Building</span> </span>&#123;<span class="function"><span class="keyword">public</span> <span class="title">House</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am House!"</span>);&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassTypeCapture</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Class&lt;?&gt;&gt; typeMap=<span class="keyword">new</span> HashMap&lt;String,Class&lt;?&gt;&gt;();</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addType</span><span class="params">(String key, Class&lt;?&gt; value)</span></span>&#123;</span><br><span class="line">        typeMap.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">createNew</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        Class&lt;?&gt; c=typeMap.get(name);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Object o=c.newInstance();</span><br><span class="line">            <span class="keyword">return</span> o;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassTypeCapture ctc=<span class="keyword">new</span> ClassTypeCapture();</span><br><span class="line">        ctc.addType(<span class="string">"Building"</span>,Building.class);</span><br><span class="line">        ctc.addType(<span class="string">"House"</span>,House.class);</span><br><span class="line">        <span class="comment">//ctc.createNew("Hello");   //Exception: java.lang.NullPointerException</span></span><br><span class="line">        ctc.createNew(<span class="string">"Building"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span><br><span class="line">        ClassTypeCapture&lt;Building&gt; ctt1 = new ClassTypeCapture&lt;Building&gt;(Building.class);</span><br><span class="line">        System.out.println(ctt1.f(new Building()));</span><br><span class="line">        System.out.println(ctt1.f(new House()));</span><br><span class="line">        ClassTypeCapture&lt;House&gt; ctt2 = new ClassTypeCapture&lt;House&gt;(House.class);</span><br><span class="line">        System.out.println(ctt2.f(new Building()));</span><br><span class="line">        System.out.println(ctt2.f(new House()));</span><br><span class="line">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/generic/" rel="tag">#generic</a>
          
            <a href="/tags/泛型/" rel="tag">#泛型</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/08/classObjectEgg/" rel="next" title="由Object/Class引发的“鸡蛋问题”？">
                <i class="fa fa-chevron-left"></i> 由Object/Class引发的“鸡蛋问题”？
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/08/21/arrayObject/" rel="prev" title="Java中的数组是对象吗？">
                Java中的数组是对象吗？ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/08/09/tij4-15/"
           data-title="（草稿中）" data-url="www.ciaoshen.com/2016/08/09/tij4-15/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/shenAvatar.jpg"
               alt="沈玮 | Wei SHEN" />
          <p class="site-author-name" itemprop="name">沈玮 | Wei SHEN</p>
          <p class="site-description motion-element" itemprop="description">Coder & Designer</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">42</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">143</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/helloShen" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/72441576/" target="_blank">
                  
                    <i class="fa fa-globe"></i> DouBan
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/pang-pang-37-37" target="_blank">
                  
                    <i class="fa fa-globe"></i> ZhiHu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#泛型的语法"><span class="nav-number">1.</span> <span class="nav-text">泛型的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一些需要注意的点"><span class="nav-number">2.</span> <span class="nav-text">一些需要注意的点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类型参数接受向上转型"><span class="nav-number">2.1.</span> <span class="nav-text">类型参数接受向上转型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数组不接受泛型"><span class="nav-number">2.2.</span> <span class="nav-text">数组不接受泛型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基本型无法作为类型参数"><span class="nav-number">2.3.</span> <span class="nav-text">基本型无法作为类型参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态方法不能访问类型参数"><span class="nav-number">2.4.</span> <span class="nav-text">静态方法不能访问类型参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#泛型接口"><span class="nav-number">3.</span> <span class="nav-text">泛型接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#泛型方法"><span class="nav-number">4.</span> <span class="nav-text">泛型方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#参数类型推断（Type-Argument-Inference）"><span class="nav-number">4.1.</span> <span class="nav-text">参数类型推断（Type Argument Inference）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一个结合接口，内部类的比较复杂的场景"><span class="nav-number">5.</span> <span class="nav-text">一个结合接口，内部类的比较复杂的场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#另一个实现多个接口，以及内部类的场景：迭代器"><span class="nav-number">6.</span> <span class="nav-text">另一个实现多个接口，以及内部类的场景：迭代器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#擦除"><span class="nav-number">7.</span> <span class="nav-text">擦除</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#因为擦除，Java泛型做不了什么？"><span class="nav-number">7.1.</span> <span class="nav-text">因为擦除，Java泛型做不了什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#泛型类型参数擦除到第一个边界"><span class="nav-number">7.2.</span> <span class="nav-text">泛型类型参数擦除到第一个边界</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#擦除式泛型怎么创建参数类型实例？"><span class="nav-number">8.</span> <span class="nav-text">擦除式泛型怎么创建参数类型实例？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#不传递Class对象，改而传递工厂。"><span class="nav-number">8.1.</span> <span class="nav-text">不传递Class对象，改而传递工厂。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#“模板方法”模式"><span class="nav-number">8.2.</span> <span class="nav-text">“模板方法”模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#泛型数组"><span class="nav-number">9.</span> <span class="nav-text">泛型数组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#两种方法声明泛型数组"><span class="nav-number">9.1.</span> <span class="nav-text">两种方法声明泛型数组</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#接受检查的强类型方法（理论上更好的方法）"><span class="nav-number">9.1.1.</span> <span class="nav-text">接受检查的强类型方法（理论上更好的方法）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#不接受检查的弱类型方法（JDK里普遍使用）"><span class="nav-number">9.1.2.</span> <span class="nav-text">不接受检查的弱类型方法（JDK里普遍使用）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#第二种方法里需要注意"><span class="nav-number">9.1.3.</span> <span class="nav-text">第二种方法里需要注意</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通配超类边界：”-super-XXX”"><span class="nav-number">9.2.</span> <span class="nav-text">通配超类边界：” ? super XXX”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#考虑怎样“放入”和“取出”元素对象，来确定是使用子类边界还是超类边界。"><span class="nav-number">9.3.</span> <span class="nav-text">考虑怎样“放入”和“取出”元素对象，来确定是使用子类边界还是超类边界。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#无界通配符：-lt-gt"><span class="nav-number">9.4.</span> <span class="nav-text">无界通配符：<?></span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于通配符最好的一个例子"><span class="nav-number">9.5.</span> <span class="nav-text">关于通配符最好的一个例子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#协变和自限定"><span class="nav-number">10.</span> <span class="nav-text">协变和自限定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#协变"><span class="nav-number">10.1.</span> <span class="nav-text">协变</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自限定"><span class="nav-number">10.2.</span> <span class="nav-text">自限定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自限定自带协变特性"><span class="nav-number">10.3.</span> <span class="nav-text">自限定自带协变特性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常"><span class="nav-number">11.</span> <span class="nav-text">异常</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java缺乏“潜在类型机制”"><span class="nav-number">12.</span> <span class="nav-text">Java缺乏“潜在类型机制”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最佳实践"><span class="nav-number">13.</span> <span class="nav-text">最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#如果只是用泛型方法可以取代将整个类泛型化，就应该只使用泛型方法。"><span class="nav-number">13.1.</span> <span class="nav-text">如果只是用泛型方法可以取代将整个类泛型化，就应该只使用泛型方法。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#只有当想实现跨越多个类的应用，才应该使用泛型。"><span class="nav-number">13.2.</span> <span class="nav-text">只有当想实现跨越多个类的应用，才应该使用泛型。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#记住"><span class="nav-number">14.</span> <span class="nav-text">记住</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#虚拟机里没有泛型，只有普通的类和方法"><span class="nav-number">14.1.</span> <span class="nav-text">虚拟机里没有泛型，只有普通的类和方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#所有类型的参数都用他们的限定类型替换"><span class="nav-number">14.2.</span> <span class="nav-text">所有类型的参数都用他们的限定类型替换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#桥方法被合成保持多态"><span class="nav-number">14.3.</span> <span class="nav-text">桥方法被合成保持多态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为了保持类型安全性，必要时插入强制类型转换"><span class="nav-number">14.4.</span> <span class="nav-text">为了保持类型安全性，必要时插入强制类型转换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#思考"><span class="nav-number">15.</span> <span class="nav-text">思考</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#编译时类型检查，运行时类型检查都还不够。还需要一个良好的命名，以及良好的测试，来保证类型安全。"><span class="nav-number">15.1.</span> <span class="nav-text">编译时类型检查，运行时类型检查都还不够。还需要一个良好的命名，以及良好的测试，来保证类型安全。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类型安全并不是泛型的根本目的。增加代码的通用性才是。类型安全反而是编写通用代码带来的副作用。"><span class="nav-number">15.2.</span> <span class="nav-text">类型安全并不是泛型的根本目的。增加代码的通用性才是。类型安全反而是编写通用代码带来的副作用。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习"><span class="nav-number">16.</span> <span class="nav-text">练习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-1-2"><span class="nav-number">16.1.</span> <span class="nav-text">Exercise 1,2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-3"><span class="nav-number">16.2.</span> <span class="nav-text">Exercise 3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-4"><span class="nav-number">16.3.</span> <span class="nav-text">Exercise 4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-5"><span class="nav-number">16.4.</span> <span class="nav-text">Exercise 5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-6"><span class="nav-number">16.5.</span> <span class="nav-text">Exercise 6</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-7"><span class="nav-number">16.6.</span> <span class="nav-text">Exercise 7</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-8"><span class="nav-number">16.7.</span> <span class="nav-text">Exercise 8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-9-10"><span class="nav-number">16.8.</span> <span class="nav-text">Exercise 9,10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-11"><span class="nav-number">16.9.</span> <span class="nav-text">Exercise 11</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-13"><span class="nav-number">16.10.</span> <span class="nav-text">Exercise 13</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-14"><span class="nav-number">16.11.</span> <span class="nav-text">Exercise 14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-17"><span class="nav-number">16.12.</span> <span class="nav-text">Exercise 17</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-18"><span class="nav-number">16.13.</span> <span class="nav-text">Exercise 18</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-19"><span class="nav-number">16.14.</span> <span class="nav-text">Exercise 19</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-20"><span class="nav-number">16.15.</span> <span class="nav-text">Exercise 20</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-21"><span class="nav-number">16.16.</span> <span class="nav-text">Exercise 21</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沈玮 | Wei SHEN</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>

</br>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div>
  <span id="busuanzi_container_site_pv">
  Visited  <span id="busuanzi_value_site_pv"></span>  times
  </span>

<span id="busuanzi_container_site_pv">&nbsp; &nbsp; | &nbsp; &nbsp;</span>

  <span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span>  Visitors
  </span>
<div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ciaoshen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  





  
  

  
  


</body>
</html>
