<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="reflect,type information,反射,类型信息," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="什么是反射？书里说的RTTI(Run-Time Type Identification)和反射其实说的是一回事：在运行时获得和使用类型的元信息。其实RTTI是C++里的概念，B大之所以说RTTI是因为它接受这个概念最初是从C++开始。其实Java是没有RTTI这个说法的。具体可以看另一篇文章《Java RTTI和反射的区别？》。
反射要解决一个什么问题？在运行时获得类型的元信息有什么用？书里举了一">
<meta property="og:type" content="article">
<meta property="og:title" content="Thinking in Java 读书笔记：第十四章 - 反射">
<meta property="og:url" content="www.ciaoshen.com/2016/08/01/tij4-14/index.html">
<meta property="og:site_name" content="沈玮 | Wei SHEN">
<meta property="og:description" content="什么是反射？书里说的RTTI(Run-Time Type Identification)和反射其实说的是一回事：在运行时获得和使用类型的元信息。其实RTTI是C++里的概念，B大之所以说RTTI是因为它接受这个概念最初是从C++开始。其实Java是没有RTTI这个说法的。具体可以看另一篇文章《Java RTTI和反射的区别？》。
反射要解决一个什么问题？在运行时获得类型的元信息有什么用？书里举了一">
<meta property="og:updated_time" content="2016-10-15T17:25:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Thinking in Java 读书笔记：第十四章 - 反射">
<meta name="twitter:description" content="什么是反射？书里说的RTTI(Run-Time Type Identification)和反射其实说的是一回事：在运行时获得和使用类型的元信息。其实RTTI是C++里的概念，B大之所以说RTTI是因为它接受这个概念最初是从C++开始。其实Java是没有RTTI这个说法的。具体可以看另一篇文章《Java RTTI和反射的区别？》。
反射要解决一个什么问题？在运行时获得类型的元信息有什么用？书里举了一">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>



  <meta name="baidu-site-verification" content="3iRy3UFlpa" />


<script>
  (function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


  <title> Thinking in Java 读书笔记：第十四章 - 反射 | 沈玮 | Wei SHEN </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74473715-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">沈玮 | Wei SHEN</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Coder & Designer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hDG3wYskg4CYKGSXw8x7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Thinking in Java 读书笔记：第十四章 - 反射
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-01T10:47:30-04:00" content="2016-08-01">
              2016-08-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/01/tij4-14/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/01/tij4-14/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span id="busuanzi_container_page_pv">&nbsp; |  &nbsp; &nbsp; Viewed <span id="busuanzi_value_page_pv"></span> times</span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="什么是反射？"><a href="#什么是反射？" class="headerlink" title="什么是反射？"></a>什么是反射？</h3><p>书里说的<strong>RTTI</strong>(Run-Time Type Identification)和<strong>反射</strong>其实说的是一回事：<strong>在运行时获得和使用类型的元信息</strong>。其实RTTI是C++里的概念，B大之所以说RTTI是因为它接受这个概念最初是从C++开始。其实Java是没有RTTI这个说法的。具体可以看另一篇文章<a href="http://www.ciaoshen.com/2016/08/08/rtti/"><strong>《Java RTTI和反射的区别？》</strong></a>。</p>
<h3 id="反射要解决一个什么问题？"><a href="#反射要解决一个什么问题？" class="headerlink" title="反射要解决一个什么问题？"></a>反射要解决一个什么问题？</h3><p>在运行时获得类型的元信息有什么用？书里举了一个最简单的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>所有其他形状都可以旋转，就圆形不行。但如果想用多态，面向Shape写代码，怎么能够写一个rotation()方法对其他所有形状都有效，但专门跳过Circle类呢？鉴于java是后期绑定，就需要在运行时，所有实例都绑定好的情况下，获得实例的具体类型信息，来决定最终的操作。</p>
<p>当然这只是个例子，实际反射能做的事比这个多得多。</p>
<h3 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h3><p>Java中用来描述对象类型信息的元信息有一个专属类型<strong>java.lang.Class</strong>。每一个类都对应着一个Class类的对象，来描述这个类的元信息。在编译的时候，这个Class对象的信息就已经确定，被一起写进编译好的.class文件中。因此一个类型的每一个实例对象都会包含一个指向这个Class对象的引用。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Class</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Object</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">GenericDeclaration</span>, <span class="title">Type</span>, <span class="title">AnnotatedElement</span></span></span><br></pre></td></tr></table></figure></p>
<h4 id="Object-Class：“鸡生蛋，蛋生鸡”？"><a href="#Object-Class：“鸡生蛋，蛋生鸡”？" class="headerlink" title="Object/Class：“鸡生蛋，蛋生鸡”？"></a>Object/Class：“鸡生蛋，蛋生鸡”？</h4><p>用来描述一个类型元信息的对象都属于java.lang.Class类。而<strong>它又是所有类型的超类java.lang.Object类的派生类</strong>。Java类型对象系统的这个设计，导致了在系统初始加载时候“鸡生蛋，蛋生鸡”问题。</p>
<blockquote>
<p><strong>在一个已经启动完毕、可以使用的Java对象系统里，必须要有一个java.lang.Class实例对应java.lang.Object这个类；而java.lang.Class是java.lang.Object的派生类，按“一般思维”前者应该要在后者完成初始化之后才可以初始化</strong></p>
</blockquote>
<p>但实际上根本不用为这个问题担心。因为Java负责加载Object类和Class类的是一个叫：<strong>引导类加载器（Bootstrap Class Loader）</strong> 的东西。它是C++写的。并且Bootstrap Class Loader本身并不继承java.lang.ClassLoader，完全跳出Object/Class系统。<strong>java.lang.Object和java.lang.Class是同时被初始化，然后同时完成，不存在一个先后关系。但是，在他们同时初始化完成之后，整个对象类型系统就可以自我运行下去了。</strong></p>
<p>关于这个“鸡蛋”问题更详细的讨论，可以看另外一篇专题<a href="http://www.ciaoshen.com/2016/08/08/classObjectEgg/"><strong>《由Object/Class引发的“鸡蛋问题”？》</strong></a>。</p>
<h4 id="获取Class的信息"><a href="#获取Class的信息" class="headerlink" title="获取Class的信息"></a>获取Class的信息</h4><p>为了获得一个类的Class对象的信息，必须先获得<strong>Class对象的引用</strong>。</p>
<h5 id="classname-class"><a href="#classname-class" class="headerlink" title="classname.class"></a>classname.class</h5><p>第一种方法是通过类本身的<strong>“字面类常量”</strong>。叫字面量常量是因为本身是以对象实例的一个字段的形式存在。这方法对<strong>接口</strong>以及<strong>基本型</strong>都有效。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Class c = Shape.class</span><br></pre></td></tr></table></figure></p>
<p>基本型包装器类也有一个TYPE字段。作用和基本类的class字段相同。<br><strong>Integer.TYPE 等价于 int.class</strong></p>
<p>这种方法最常用，更高效。因为走完类的<strong>“加载”</strong>和<strong>“链接”</strong>这两步之后，不会开始<strong>“初始化”</strong>阶段。初始化过程被推迟到对象的静态字段第一次被使用。（关于类的加载过程可以参看<a href="http://www.ciaoshen.com/2016/08/07/classloader/"><strong>《Java类的加载过程》</strong></a> 这篇专题。）</p>
<h5 id="objectname-getClass"><a href="#objectname-getClass" class="headerlink" title="objectname.getClass()"></a>objectname.getClass()</h5><p>如果已经持有这个类的对象，当然很方便：objectname.getClass()方法就可以了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Shape s =  <span class="keyword">new</span> Shape();</span><br><span class="line">Class c = s.getClass();</span><br></pre></td></tr></table></figure></p>
<h5 id="Class-forName-String-fullClassName"><a href="#Class-forName-String-fullClassName" class="headerlink" title="Class.forName(String fullClassName)"></a>Class.forName(String fullClassName)</h5><p>不用持有某个类的对象，也可以获得这个类的Class对象的引用。这需要用到Class类的一个静态方法forName()：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Class c = Class.forName(<span class="string">"com.ciaoshen.thinkinjava.chapter14.Shape"</span>);</span><br></pre></td></tr></table></figure></p>
<p><strong>！注意</strong>：参数必须是类的全限定名：[包名+类名]的形式。<br>需要全名这比较麻烦。因为运行时如果不知道包名，只知道类名，就需要搜索自己CLASSPATH下的所有类名，来找出包名。过程中还需要用正则表达是剔除掉一些内部类的用$连接的特殊情况。</p>
<p>可以找一个外部小工具比如这个<a href="https://github.com/frankslin/classpath-explorer" target="_blank" rel="external"> - <strong>Google Classpath Explorer</strong></a>，或者自己写个工具包吧。</p>
<h3 id="Class类的常用方法"><a href="#Class类的常用方法" class="headerlink" title="Class类的常用方法"></a>Class类的常用方法</h3><p>有了<strong>Class对象的引用</strong>之后，可以用它来做好多事。</p>
<blockquote>
<p><strong>Class#getName()</strong>：返回此类的全限定名（包名+类名）<br><strong>Class#getSimpleName()</strong>：返回此类的类名<br><strong>Class#getCanonicalName()</strong>：返回此类的全限定名（包名+类名）<br><strong>Class#isInterface()</strong>：判定此类是不是接口<br><strong>Class#getInterfaces()</strong>：返回此类实现的接口的Class类对象。<br><strong>Class#getSuperClass()</strong>：返回此类的基类的Class类对象。    ！注意：当得到的Class是Object，会返回null。<br><strong>Class#newInstance()</strong>：返回此类的一个对象。（<em>注：此类必须有默认构造器）<br><em>*Class#getModifiers()</em></em>：获得一个类的修饰词，比如final, static, abstract等。和Modifier配合使用，像这样：Modifier.isAbstract(Class#getModifiers())可以判断一个类是不是抽象类。</p>
</blockquote>
<h3 id="泛化Class对象，用Class对象转型"><a href="#泛化Class对象，用Class对象转型" class="headerlink" title="泛化Class对象，用Class对象转型"></a>泛化Class对象，用Class对象转型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Class</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Object</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">GenericDeclaration</span>, <span class="title">Type</span>, <span class="title">AnnotatedElement</span></span></span><br></pre></td></tr></table></figure>
<p>根据Class类的定义，支持泛型。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;Integer&gt; ci=<span class="keyword">int</span>.class;</span><br></pre></td></tr></table></figure></p>
<p>尖括号中间的类型可以用<strong>“通配符”</strong>来代替。代表随便什么类型的Class类对象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; c=<span class="keyword">int</span>.class;</span><br></pre></td></tr></table></figure></p>
<p>也可以在用通配符的情况下，做进一步限制。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;? extends Number&gt;=<span class="keyword">int</span>.class;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span> <span class="keyword">extends</span> <span class="title">Base</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Class&lt;Derived&gt; cd=Derived.class;</span><br><span class="line">Class&lt;? <span class="keyword">super</span> Derived&gt; csd=cd.getSuperclass();</span><br><span class="line"><span class="comment">//Class&lt;Base&gt; cb=cd.getSuperclass();	//编译器不允许</span></span><br></pre></td></tr></table></figure>
<h3 id="类型检查"><a href="#类型检查" class="headerlink" title="类型检查"></a>类型检查</h3><h4 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h4><p><strong>instanceof</strong>关键字可以判断对象或array是不是某个类型的实例。一般在用”(Type)”向上或向下转型的时候，向上转型没问题，但向下转型的时候注意先用instanceof关键字判断一下是不是要转的派生类的实例。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(x <span class="keyword">instanceof</span> Dog)&#123;</span><br><span class="line">    ((Dog)x).bark();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意，如果一个对象在编译的时候，就根本不可能是目标类型，编译器直接抛出error。比如练习4中，我想判断一个菱形Rhomboid实例是不是Circle圆形。编译器直接报错，让我不要骗自己。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rhomboid r=<span class="keyword">new</span> Rhomboid();</span><br><span class="line"><span class="keyword">if</span>(r <span class="keyword">instanceof</span> Circle)&#123;</span><br><span class="line">	Circle c=(Circle)r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Class-isInstance"><a href="#Class-isInstance" class="headerlink" title="Class#isInstance( )"></a>Class#isInstance( )</h4><p>另一种类型检查方式：<br>Class#isInstance()方法：检查是否是某个类的实例。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Triangle t = <span class="keyword">new</span> Triangle();</span><br><span class="line">Class c = Circle.class;</span><br><span class="line">c.isInstance(t);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Output: false</span></span><br></pre></td></tr></table></figure></p>
<p>Class#isAssignableFrom()方法：检查是否是某个类或这个类的基类。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Shape s = <span class="keyword">new</span> Shape();</span><br><span class="line">Class c = Circle.class;</span><br><span class="line">c.isAssignableFrom(s);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Output: true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="获得类型字段，方法，构造函数，类加载器"><a href="#获得类型字段，方法，构造函数，类加载器" class="headerlink" title="获得类型字段，方法，构造函数，类加载器"></a>获得类型字段，方法，构造函数，类加载器</h3><p>在java.lang.reflect包里，有Field, Method, Constructor, Modifier这样用来获得类中特定某一部分信息类型。</p>
<ul>
<li><strong>Method:</strong> 用Class#getMethods()方法和getDeclaredMethods()方法来获得Method类型元信息。Class#getMethods()获得一个类所有用到的方法，getDeclaredMethods()只返回这个类中声明的方法。</li>
<li><strong>Field:</strong> 用Class#getFields()方法Field类型元信息。</li>
<li><strong>Constructor:</strong> 用Class#getConstructors()方法Constructor类型元信息。注意它接受的参数Class&lt;?&gt;… parameterTypes不是数组，而是一连串Class对象。</li>
</ul>
<p><strong>！注意</strong>：以上方法都受限于目标类的访问权限。不是public就无法获得信息。要突破访问权限的限制，就要用到Class#setAccessible()方法。</p>
<h4 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h4><p>当我们用Class#getMethods()方法获得java.lang.reflect.Method对象之后，我们可以用Method#invoke()方法动态调用该方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvokeMethod</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">plus</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;<span class="keyword">return</span> a+b;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Class&lt;?&gt; c=InvokeMethod.class;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Object o=c.newInstance();</span><br><span class="line">            Method[] ms=c.getMethods();</span><br><span class="line">            <span class="keyword">if</span>(ms.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(Method m:ms)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(m.getName()==<span class="string">"plus"</span>)&#123;</span><br><span class="line">                        System.out.println(m.invoke(o,<span class="number">2</span>,<span class="number">3</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="注册工厂模式"><a href="#注册工厂模式" class="headerlink" title="注册工厂模式"></a>注册工厂模式</h3><p>注册工厂就是把一系列工厂类都预先放到一个工厂类的<strong>静态容器</strong>里，这样每个继承这个工厂类的派生类都能自带所有的工厂。另外也可以不用工厂类，而是存放一个Class对象，然后用newInstance()方法来构造对象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Latte</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mocha</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cappuccino</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Americano</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Breve</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoffeeFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Coffee <span class="title">creat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> r=rand.nextInt(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> facList.get(r).newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception ie)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&lt;? extends Coffee&gt;&gt; facList=<span class="keyword">new</span> ArrayList&lt;Class&lt;? extends Coffee&gt;&gt;();</span><br><span class="line">	<span class="comment">//把Class对象存在静态表里，用来创建对象</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        facList.add(Latte.class);</span><br><span class="line">        facList.add(Mocha.class);</span><br><span class="line">        facList.add(Cappuccino.class);</span><br><span class="line">        facList.add(Americano.class);</span><br><span class="line">        facList.add(Breve.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getClass().getSimpleName() + <span class="string">" "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            System.out.println(CoffeeFactory.creat());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>例子中咖啡工厂CoffeeFactory把各种咖啡的Class对象都存在了自己的静态字段里。这样在运行时可以选择创建任何一种咖啡的实例对象。</p>
<h3 id="动态代理：java-lang-reflect-Proxy"><a href="#动态代理：java-lang-reflect-Proxy" class="headerlink" title="动态代理：java.lang.reflect.Proxy"></a>动态代理：java.lang.reflect.Proxy</h3><p>利用java.lang.reflect.Proxy类，我们可以实现自动给委托类套上代理外壳。此功能非常强大，不但做到了动态获取类型信息，动态执行类型方法，甚至强大到可以根据提供的类型名称和实现的接口方法，直接生成类型的字节码，相当于凭空生成一个.class文件。下面是个具体的Demo代码。关于动态代理更详细的介绍，可以看另一篇专题：<a href="http://www.ciaoshen.com/2016/08/06/proxy/"> <strong>《JDK自带的动态代理工具类Proxy的原理》</strong></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface</span></span>&#123;<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Interface</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"Method a of class A!"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*	//这是Proxy要动态生成的B类。</span><br><span class="line">class B implements Interface&#123;</span><br><span class="line">    public void foo()&#123;a.foo();&#125;</span><br><span class="line">    public A a=new A();</span><br><span class="line">&#125;</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">consum</span><span class="params">(Interface i)</span></span>&#123;</span><br><span class="line">        i.foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DynamicProxyHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object proxied;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicProxyHandler</span><span class="params">(Object proxied)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.proxied = proxied;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> method.invoke(proxied, args);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDynamicProxy</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        A a=<span class="keyword">new</span> A();</span><br><span class="line">		<span class="comment">//直接把A类对象a当参数传进去，就动态产生一个代理类对象</span></span><br><span class="line">        Interface proxy = (Interface)Proxy.newProxyInstance(Interface.class.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[]&#123;Interface.class &#125;, <span class="keyword">new</span> DynamicProxyHandler(a));</span><br><span class="line">        Consumer.consum(proxy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类型信息破坏接口和解耦"><a href="#类型信息破坏接口和解耦" class="headerlink" title="类型信息破坏接口和解耦"></a>类型信息破坏接口和解耦</h3><p>Java的反射功能非常强大，可以动态地获取类型信息，动态调用方法。但同时也是一把“双刃剑”。因为有了更多的控制权，意味着更少的安全性。因为知道了运行时类型，意味着可以越过多态，越过面向接口的限制，直接调用接口没有定义的隐藏方法。虽然可以通过设置访问权限来防范，但java.lang.reflect包的<strong>setAccessible()</strong>方法却可以随意在运行时修改访问权限。</p>
<p>这问题根本没办法防范，一旦暴露了，字段，方法名称，程序员就可以动态访问字段和方法。甚至甚至不发布源码，只发布字节码都挡不住，因为有javap这样的反编译工具。</p>
<p>那到底有没有办法解决这个问题呢？</p>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><h3 id="Exercise-3-4-5-6"><a href="#Exercise-3-4-5-6" class="headerlink" title="Exercise 3,4,5,6"></a>Exercise 3,4,5,6</h3><p><strong>Exercise 3</strong>: (2) Add Rhomboid to Shapes.java. Create a Rhomboid, upcast it to a Shape, then downcast it back to a Rhomboid. Try downcasting to a Circle and see what happens.<br><strong>Exercise 4</strong>: (2) Modify the previous exercise so that it uses instanceof to check the type before performing the downcast.<br><strong>Exercise 5</strong>: (3) Implement a rotate(Shape) method in Shapes.java, such that it checks to see if it is rotating a Circle (and, if so, doesn’t perform the operation).<br><strong>Exercise 6</strong>: (4) Modify Shapes.java so that it can “highlight” (set a flag in) all shapes of a particular type. The toString( ) method for each derived Shape should indicate whether that Shape is “highlighted.”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Base Class</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123; System.out.println(<span class="keyword">this</span> + <span class="string">".draw()"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">()</span></span>&#123;System.out.println(<span class="keyword">this</span> + <span class="string">".rotate()"</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlight</span><span class="params">()</span></span>&#123;flag=<span class="keyword">true</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlightOff</span><span class="params">()</span></span>&#123;flag=<span class="keyword">false</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHighlighted</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> flag;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag=<span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  Derived Class</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (isHighlighted()? <span class="string">"H"</span>:<span class="string">"UnH"</span>)+<span class="string">"ighlited "</span>+<span class="string">"Circle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (isHighlighted()? <span class="string">"H"</span>:<span class="string">"UnH"</span>)+<span class="string">"ighlited "</span>+<span class="string">"Square"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (isHighlighted()? <span class="string">"H"</span>:<span class="string">"UnH"</span>)+<span class="string">"ighlited "</span>+<span class="string">"Triangle"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rhomboid</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (isHighlighted()? <span class="string">"H"</span>:<span class="string">"UnH"</span>)+<span class="string">"ighlited "</span>+<span class="string">"Rhomboid"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> *  Processing Class</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Shapes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Shape s)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(s <span class="keyword">instanceof</span> Circle))&#123;</span><br><span class="line">            s.rotate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">highlight</span><span class="params">(Shape s)</span></span>&#123;</span><br><span class="line">        s.highlight();</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">highlightOff</span><span class="params">(Shape s)</span></span>&#123;</span><br><span class="line">        s.highlightOff();</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Shape&gt; shapeList = Arrays.asList(<span class="keyword">new</span> Circle(), <span class="keyword">new</span> Square(), <span class="keyword">new</span> Triangle(), <span class="keyword">new</span> Rhomboid());</span><br><span class="line">        <span class="keyword">for</span>(Shape shape : shapeList)&#123;</span><br><span class="line">            shape.draw();</span><br><span class="line">            System.out.println(shape.getClass().getSimpleName());</span><br><span class="line">            <span class="keyword">if</span>(shape <span class="keyword">instanceof</span> Rhomboid)&#123;</span><br><span class="line">                Rhomboid r=(Rhomboid)shape;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//Circle c=(Circle)shape;   //不能把不是圆形的形状向下转型成圆形</span></span><br><span class="line">            &#125;</span><br><span class="line">            Shapes.rotate(shape);</span><br><span class="line">            Shapes.highlight(shape);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-7"><a href="#Exercise-7" class="headerlink" title="Exercise 7"></a>Exercise 7</h4><p><strong>Exercise 7</strong>: (3) Modify SweetShop.java so that each type of object creation is controlled by a command-line argument. That is, if your command line is “Java Sweetshop Candy,” then only the Candy object is created. Notice how you can control which Class objects are loaded via the commandline argument.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123; System.out.println(<span class="string">"Loading Candy"</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Gum</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123; System.out.println(<span class="string">"Loading Gum"</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cookie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123; System.out.println(<span class="string">"Loading Cookie"</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SweetShop</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class c=Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            Object o=c.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException cne) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Couldn’t find this Class! Please check your name!"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(InstantiationException ie) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Error during init of object! Must have a default constructor!"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IllegalAccessException iae)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Error during init of object! Please check the accessibility of constructor!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Exercise-8"><a href="#Exercise-8" class="headerlink" title="Exercise 8"></a>Exercise 8</h4><p><strong>Exercise 8</strong>: (5) Write a method that takes an object and recursively prints all the classes in that object’s hierarchy.</p>
<p>这题遇到两个坑，一个是当我用Class#newInstance()根据Class对象实例化，如果一路往上遇到abstract抽象类，会抛出InstantiationException异常，表示抽象类无法实例化。所以在捕获到之后还要判断一下是否是抽象类，如果是，那就打印出名字，标明是抽象类，然后跳到上一层基类。然后用一个loop强制重新回到try{}的代码块。</p>
<p>另一个坑是getSuperclass()如果得到的是Object类，会返回null。虽然不影响最后的实现，但没人觉得这设计有点不合理吗？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassFamily</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printBase</span><span class="params">(Object o)</span></span>&#123;</span><br><span class="line">        Class&lt;?&gt; c=o.getClass();</span><br><span class="line">        System.out.println(c.getName());</span><br><span class="line">        Field[] fs=c.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span>(Field f : fs)&#123;</span><br><span class="line">            System.out.println(f);</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt; spc=c.getSuperclass();</span><br><span class="line">        <span class="keyword">boolean</span> flag=<span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(spc!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span>(!flag)&#123;</span><br><span class="line">                flag=<span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    printBase(spc.newInstance());</span><br><span class="line">                &#125; <span class="keyword">catch</span>(InstantiationException ie)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(Modifier.isAbstract(spc.getModifiers()))&#123;</span><br><span class="line">                        System.out.println(<span class="string">"abstract "</span>+spc.getName());</span><br><span class="line">                        fs=spc.getDeclaredFields();</span><br><span class="line">                        <span class="keyword">for</span>(Field f : fs)&#123;</span><br><span class="line">                            System.out.println(f);</span><br><span class="line">                        &#125;</span><br><span class="line">                        spc=spc.getSuperclass();</span><br><span class="line">                        flag=<span class="keyword">false</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        System.out.println(<span class="string">"Error during init of object! Must have a default constructor!"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(IllegalAccessException iae)&#123;</span><br><span class="line">                    System.out.println(<span class="string">"Error during init of object! Please check the accessibility of constructor!"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Oval o=<span class="keyword">new</span> Oval();</span><br><span class="line">        ClassFamily.printBase(o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-10"><a href="#Exercise-10" class="headerlink" title="Exercise 10"></a>Exercise 10</h4><p><strong>Exercise 10</strong>: (3) Write a program to determine whether an array of char is a primitive type or a true Object.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestChar</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] c=&#123;<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>&#125;;</span><br><span class="line">        System.out.println(c <span class="keyword">instanceof</span> <span class="keyword">char</span>[]);</span><br><span class="line">        System.out.println(c <span class="keyword">instanceof</span> Object);</span><br><span class="line">        System.out.println(c.getClass().getName());</span><br><span class="line">        System.out.println(c.getClass().getSuperclass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Excercise-14"><a href="#Excercise-14" class="headerlink" title="Excercise 14"></a>Excercise 14</h4><p><strong>Exercise 14</strong>: (4) A constructor is a kind of factory method. Modify RegisteredFactories.java so that instead of using an explicit factory, the class object is stored in the List, and newlnstance( ) is used to create each object.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter14;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Part</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Part <span class="title">createRandom</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = rand.nextInt(partFactories.size());</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> partFactories.get(n).newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(InstantiationException ie)&#123;</span><br><span class="line">            System.out.println(partFactories.get(n)+<span class="string">" cannot be initialized!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(IllegalAccessException iae)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Check the access level of "</span>+partFactories.get(n)+<span class="string">" class!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&lt;? extends Part&gt;&gt; partFactories = <span class="keyword">new</span> ArrayList&lt;Class&lt;? extends Part&gt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        partFactories.add(FuelFilter.class);</span><br><span class="line">        partFactories.add(AirFilter.class);</span><br><span class="line">        partFactories.add(CabinAirFilter.class);</span><br><span class="line">        partFactories.add(OilFilter.class);</span><br><span class="line">        partFactories.add(FanBelt.class);</span><br><span class="line">        partFactories.add(PowerSteeringBelt.class);</span><br><span class="line">        partFactories.add(GeneratorBelt.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Filter</span> <span class="keyword">extends</span> <span class="title">Part</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FuelFilter</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirFilter</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CabinAirFilter</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OilFilter</span> <span class="keyword">extends</span> <span class="title">Filter</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Belt</span> <span class="keyword">extends</span> <span class="title">Part</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FanBelt</span> <span class="keyword">extends</span> <span class="title">Belt</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeneratorBelt</span> <span class="keyword">extends</span> <span class="title">Belt</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PowerSteeringBelt</span> <span class="keyword">extends</span> <span class="title">Belt</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisteredFactories</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">            System.out.println(Part.createRandom());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-15"><a href="#Exercise-15" class="headerlink" title="Exercise 15"></a>Exercise 15</h4><p><strong>Exercise 15</strong>: (4) Implement a new PetCreator using Registered Factories, and modify the Pets Facade so that it uses this one instead of the other two. Ensure that the rest of the examples that use Pets .Java still work correctly.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PetsCreator</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&lt;? extends Pets&gt;&gt; facList=<span class="keyword">new</span> ArrayList&lt;Class&lt;? extends Pets&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        facList.add(Pets.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Pets <span class="title">creat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> facList.get(<span class="number">0</span>).newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(InstantiationException ie)&#123;</span><br><span class="line">            System.out.println(facList.get(<span class="number">0</span>)+<span class="string">" cannot be initialized!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(IllegalAccessException iae)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Check the access level of "</span>+facList.get(<span class="number">0</span>)+<span class="string">" class!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pets</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pets</span><span class="params">()</span></span>&#123;count++;id=count;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"Pet No."</span>+id;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id=<span class="number">0l</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> count=<span class="number">0l</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            System.out.println(PetsCreator.creat());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-16"><a href="#Exercise-16" class="headerlink" title="Exercise 16"></a>Exercise 16</h4><p><strong>Exercise 16</strong>: (4) Modify the Coffee hierarchy in the Generics chapter to use Registered Factories.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Latte</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mocha</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cappuccino</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Americano</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Breve</span> <span class="keyword">extends</span> <span class="title">Coffee</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CoffeeFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Coffee <span class="title">creat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> r=rand.nextInt(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> facList.get(r).newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(InstantiationException ie)&#123;</span><br><span class="line">            System.out.println(facList.get(r)+<span class="string">" cannot be initialized!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(IllegalAccessException iae)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Check the access level of "</span>+facList.get(r)+<span class="string">" class!"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand=<span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&lt;? extends Coffee&gt;&gt; facList=<span class="keyword">new</span> ArrayList&lt;Class&lt;? extends Coffee&gt;&gt;();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        facList.add(Latte.class);</span><br><span class="line">        facList.add(Mocha.class);</span><br><span class="line">        facList.add(Cappuccino.class);</span><br><span class="line">        facList.add(Americano.class);</span><br><span class="line">        facList.add(Breve.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coffee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id = counter++;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getClass().getSimpleName() + <span class="string">" "</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            System.out.println(CoffeeFactory.creat());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Exercise-17-18"><a href="#Exercise-17-18" class="headerlink" title="Exercise 17,18"></a>Exercise 17,18</h4><p><strong>Exercise 17</strong>: (2) Modify the regular expression in ShowMethods.java to additionally strip off the keywords native and final (hint: use the OR operator’|’)<br><strong>Exercise 18</strong>: (1) Make ShowMethods a non-public class and verify that the synthesized default constructor no longer shows up in the output.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShowMethods</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String usage=<span class="string">"usage:\n"</span> + <span class="string">"ShowMethods qualified.class.name\n"</span> + <span class="string">"To show all methods in class or:\n"</span> + <span class="string">"ShowMethods qualified.class.name word\n"</span> + <span class="string">"To search for methods involving ‘word’"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Pattern p = Pattern.compile(<span class="string">"(\\w+\\.)|(\\sfinal)|(\\snative)"</span>);</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(usage);</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> lines = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; c = Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            Method[] methods = c.getMethods();</span><br><span class="line">            Constructor&lt;? extends Object&gt;[] ctors = c.getConstructors();</span><br><span class="line">            <span class="keyword">if</span>(args.length == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(Method method : methods)&#123;</span><br><span class="line">                    System.out.println(p.matcher(method.toString()).replaceAll(<span class="string">""</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(Constructor&lt;? extends Object&gt; ctor : ctors)&#123;</span><br><span class="line">                    System.out.println(p.matcher(ctor.toString()).replaceAll(<span class="string">""</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                lines = methods.length + ctors.length;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(Method method : methods)</span><br><span class="line">                    <span class="keyword">if</span>(method.toString().indexOf(args[<span class="number">1</span>]) != -<span class="number">1</span>) &#123;</span><br><span class="line">                        System.out.println(p.matcher(method.toString()).replaceAll(<span class="string">""</span>));</span><br><span class="line">                        lines++;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">for</span>(Constructor&lt;? extends Object&gt; ctor : ctors)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(ctor.toString().indexOf(args[<span class="number">1</span>]) != -<span class="number">1</span>) &#123;</span><br><span class="line">                        System.out.println(p.matcher(ctor.toString()).replaceAll(<span class="string">""</span>));</span><br><span class="line">                        lines++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"No such class: "</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-19"><a href="#Exercise-19" class="headerlink" title="Exercise 19"></a>Exercise 19</h4><p><strong>Exercise 19</strong>: (4) In ToyTest.java, use reflection to create a Toy object using the non-default constructor.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Toy2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Toy2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Toy2</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;System.out.println(<span class="string">"Toy "</span>+i+<span class="string">" created!"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToyTest2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printInfo</span><span class="params">(Class&lt;?&gt; cc)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Class name: "</span> + cc.getName() +</span><br><span class="line">                           <span class="string">" is interface? ["</span> + cc.isInterface() + <span class="string">"]"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Simple name: "</span> + cc.getSimpleName());</span><br><span class="line">        System.out.println(<span class="string">"Canonical name : "</span> + cc.getCanonicalName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Constructor&lt;?&gt;[] cs=Toy2.class.getConstructors();</span><br><span class="line">        <span class="keyword">for</span>(Constructor&lt;?&gt; c : cs)&#123;</span><br><span class="line">            <span class="keyword">if</span>(c.getParameterTypes().length==<span class="number">1</span>)&#123;</span><br><span class="line">                Class&lt;?&gt;[] paraType=c.getParameterTypes();</span><br><span class="line">                <span class="keyword">if</span>(paraType[<span class="number">0</span>]==<span class="keyword">int</span>.class)&#123;</span><br><span class="line">                    <span class="keyword">try</span>&#123;</span><br><span class="line">                        Object o=c.newInstance(<span class="number">1</span>);</span><br><span class="line">                    &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                        System.out.println(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-20"><a href="#Exercise-20" class="headerlink" title="Exercise 20"></a>Exercise 20</h4><p><strong>Exercise 20</strong>: (5) Look up the interface for java.lang.Class in the JDK documentation from <a href="http://java.sun.com" target="_blank" rel="external">http://java.sun.com</a>. Write a program that takes the name of a class as a command-line argument, then uses the Class methods to dump all the information available for that class. Test your program with a standard library class and a class you create.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassInfo</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class&lt;?&gt; c=Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">                </span><br><span class="line">            <span class="comment">//constructor</span></span><br><span class="line">            Constructor&lt;?&gt;[] cons=c.getConstructors();</span><br><span class="line">            <span class="keyword">if</span>(cons.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(Constructor&lt;?&gt; con : cons)&#123;</span><br><span class="line">                    System.out.println(con);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//methods</span></span><br><span class="line">            Method[] ms=c.getMethods();</span><br><span class="line">            <span class="keyword">if</span>(ms.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(Method m : ms)&#123;</span><br><span class="line">                    System.out.println(m);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//fields</span></span><br><span class="line">            Field[] fs=c.getFields();</span><br><span class="line">            <span class="keyword">if</span>(fs.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(Field f : fs)&#123;</span><br><span class="line">                    System.out.println(f);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Exercise-21"><a href="#Exercise-21" class="headerlink" title="Exercise 21"></a>Exercise 21</h4><p><strong>Exercise 21</strong>: (3) Modify SimpleProxyDemo.java so that it measures method-call times.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">somethingElse</span><span class="params">(String arg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealObject</span> <span class="keyword">implements</span> <span class="title">Interface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123; System.out.println(<span class="string">"doSomething"</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">somethingElse</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"somethingElse "</span> + arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleProxy</span> <span class="keyword">implements</span> <span class="title">Interface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> doSomethingCount=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> somethingElseCount=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Interface proxied;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleProxy</span><span class="params">(Interface proxied)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.proxied = proxied;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SimpleProxy doSomething"</span>);</span><br><span class="line">        proxied.doSomething();</span><br><span class="line">        doSomethingCount++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">somethingElse</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"SimpleProxy somethingElse "</span> + arg);</span><br><span class="line">        proxied.somethingElse(arg);</span><br><span class="line">        somethingElseCount++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showCount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Method doSomething() is called: "</span>+doSomethingCount+<span class="string">" times!"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Method somethingElse() is called: "</span>+somethingElseCount+<span class="string">" times!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleProxyDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">(Interface iface)</span> </span>&#123;</span><br><span class="line">        iface.doSomething();</span><br><span class="line">        iface.somethingElse(<span class="string">"bonobo"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        consumer(<span class="keyword">new</span> RealObject());</span><br><span class="line">        consumer(<span class="keyword">new</span> SimpleProxy(<span class="keyword">new</span> RealObject()));</span><br><span class="line">        SimpleProxy.showCount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-22，23"><a href="#Exercise-22，23" class="headerlink" title="Exercise 22，23"></a>Exercise 22，23</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">somethingElse</span><span class="params">(String s)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RealObject</span> <span class="keyword">implements</span> <span class="title">Interface</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"RealObject is doing something!"</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">somethingElse</span><span class="params">(String s)</span></span>&#123;System.out.println(<span class="string">"RealObject is doing something else called "</span>+s+<span class="string">" !"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DynamicProxyHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//counter here</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Object proxied;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicProxyHandler</span><span class="params">(Object proxied)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.proxied = proxied;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//parameters are already printed here</span></span><br><span class="line">        System.out.println(<span class="string">"**** proxy: "</span> + proxy.getClass() + <span class="string">", method: "</span> + method + <span class="string">", args: "</span> + args);</span><br><span class="line">        <span class="keyword">if</span>(args != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(Object arg : args)&#123;</span><br><span class="line">                System.out.println(<span class="string">" "</span> + arg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Object o=method.invoke(proxied, args);</span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">return</span> o;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//add a method in the handler to show the count</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showCount</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"Proxy is invoked "</span>+count+<span class="string">" times!"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDynamicProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">(Interface iface)</span> </span>&#123;</span><br><span class="line">        iface.doSomething();</span><br><span class="line">        iface.somethingElse(<span class="string">"bonobo"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RealObject real = <span class="keyword">new</span> RealObject();</span><br><span class="line">        consumer(real);</span><br><span class="line">        <span class="comment">// Insert a proxy and call again:</span></span><br><span class="line">        Interface proxy = (Interface)Proxy.newProxyInstance(Interface.class.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[]&#123; Interface.class &#125;, <span class="keyword">new</span> DynamicProxyHandler(real));</span><br><span class="line">        consumer(proxy);</span><br><span class="line">        consumer(proxy);</span><br><span class="line">        consumer(proxy);</span><br><span class="line">        <span class="comment">//show count here</span></span><br><span class="line">        DynamicProxyHandler.showCount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-24"><a href="#Exercise-24" class="headerlink" title="Exercise 24"></a>Exercise 24</h4><p>不再重复RegisteredFactories的代码。添加空对象，只要在Part类里加一个静态单例常量NULL。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//NULL Singleton is here</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Part NULL=<span class="keyword">new</span> Part();</span><br></pre></td></tr></table></figure></p>
<h4 id="Exercise-25"><a href="#Exercise-25" class="headerlink" title="Exercise 25"></a>Exercise 25</h4><p><strong>Exercise 25</strong>: (2) Create a class containing private, protected and package-access methods. Write code to access these methods from outside of the class’s package.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicMethod</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am public method!"</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">packageAccessMethod</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am package access method!"</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">protectedMethod</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am protected method!"</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateMethod</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"I am private method!"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSetAccessibility</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class&lt;?&gt; c=TestClass.class;</span><br><span class="line">            Object o=c.newInstance();</span><br><span class="line">            Method[] ms=c.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span>(Method m:ms)&#123;</span><br><span class="line">                m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                m.invoke(o);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Exercise-26"><a href="#Exercise-26" class="headerlink" title="Exercise 26"></a>Exercise 26</h4><p><strong>Exercise 26</strong>: (3) Implement clearSpitValve( ) as described in the summary.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Instrument</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>&#123;System.out.println(<span class="keyword">this</span>.getClass().getSimpleName()+<span class="string">" is playing!"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Percussion</span> <span class="keyword">extends</span> <span class="title">Instrument</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stringed</span> <span class="keyword">extends</span> <span class="title">Instrument</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wind</span> <span class="keyword">extends</span> <span class="title">Instrument</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cleanSpitValve</span><span class="params">()</span></span>&#123;System.out.println(<span class="keyword">this</span>.getClass().getSimpleName()+<span class="string">" is cleaning the spit valve!"</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitValve</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Instrument ip=<span class="keyword">new</span> Percussion();</span><br><span class="line">        Instrument is=<span class="keyword">new</span> Stringed();</span><br><span class="line">        Instrument iw=<span class="keyword">new</span> Wind();</span><br><span class="line">        </span><br><span class="line">        ip.play();</span><br><span class="line">        is.play();</span><br><span class="line">        iw.play();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Class&lt;?&gt; c=iw.getClass();</span><br><span class="line">            Method m=c.getMethod(<span class="string">"cleanSpitValve"</span>);</span><br><span class="line">            m.invoke(iw);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/reflect/" rel="tag">#reflect</a>
          
            <a href="/tags/type-information/" rel="tag">#type information</a>
          
            <a href="/tags/反射/" rel="tag">#反射</a>
          
            <a href="/tags/类型信息/" rel="tag">#类型信息</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/31/closureV2/" rel="next" title="什么是闭包？">
                <i class="fa fa-chevron-left"></i> 什么是闭包？
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/08/01/growth/" rel="prev" title="[转]程序员的成长路线">
                [转]程序员的成长路线 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/08/01/tij4-14/"
           data-title="Thinking in Java 读书笔记：第十四章 - 反射" data-url="www.ciaoshen.com/2016/08/01/tij4-14/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/shenAvatar.jpg"
               alt="沈玮 | Wei SHEN" />
          <p class="site-author-name" itemprop="name">沈玮 | Wei SHEN</p>
          <p class="site-description motion-element" itemprop="description">Coder & Designer</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">49</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">163</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/helloShen" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/72441576/" target="_blank">
                  
                    <i class="fa fa-globe"></i> DouBan
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/pang-pang-37-37" target="_blank">
                  
                    <i class="fa fa-globe"></i> ZhiHu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是反射？"><span class="nav-number">1.</span> <span class="nav-text">什么是反射？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反射要解决一个什么问题？"><span class="nav-number">2.</span> <span class="nav-text">反射要解决一个什么问题？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class类"><span class="nav-number">3.</span> <span class="nav-text">Class类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Object-Class：“鸡生蛋，蛋生鸡”？"><span class="nav-number">3.1.</span> <span class="nav-text">Object/Class：“鸡生蛋，蛋生鸡”？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取Class的信息"><span class="nav-number">3.2.</span> <span class="nav-text">获取Class的信息</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#classname-class"><span class="nav-number">3.2.1.</span> <span class="nav-text">classname.class</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#objectname-getClass"><span class="nav-number">3.2.2.</span> <span class="nav-text">objectname.getClass()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Class-forName-String-fullClassName"><span class="nav-number">3.2.3.</span> <span class="nav-text">Class.forName(String fullClassName)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class类的常用方法"><span class="nav-number">4.</span> <span class="nav-text">Class类的常用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#泛化Class对象，用Class对象转型"><span class="nav-number">5.</span> <span class="nav-text">泛化Class对象，用Class对象转型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类型检查"><span class="nav-number">6.</span> <span class="nav-text">类型检查</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#instanceof"><span class="nav-number">6.1.</span> <span class="nav-text">instanceof</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-isInstance"><span class="nav-number">6.2.</span> <span class="nav-text">Class#isInstance( )</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得类型字段，方法，构造函数，类加载器"><span class="nav-number">7.</span> <span class="nav-text">获得类型字段，方法，构造函数，类加载器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#调用方法"><span class="nav-number">7.1.</span> <span class="nav-text">调用方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册工厂模式"><span class="nav-number">8.</span> <span class="nav-text">注册工厂模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态代理：java-lang-reflect-Proxy"><span class="nav-number">9.</span> <span class="nav-text">动态代理：java.lang.reflect.Proxy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类型信息破坏接口和解耦"><span class="nav-number">10.</span> <span class="nav-text">类型信息破坏接口和解耦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习"><span class="nav-number">11.</span> <span class="nav-text">练习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exercise-3-4-5-6"><span class="nav-number">12.</span> <span class="nav-text">Exercise 3,4,5,6</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-7"><span class="nav-number">12.1.</span> <span class="nav-text">Exercise 7</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-8"><span class="nav-number">12.2.</span> <span class="nav-text">Exercise 8</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-10"><span class="nav-number">12.3.</span> <span class="nav-text">Exercise 10</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Excercise-14"><span class="nav-number">12.4.</span> <span class="nav-text">Excercise 14</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-15"><span class="nav-number">12.5.</span> <span class="nav-text">Exercise 15</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-16"><span class="nav-number">12.6.</span> <span class="nav-text">Exercise 16</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-17-18"><span class="nav-number">12.7.</span> <span class="nav-text">Exercise 17,18</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-19"><span class="nav-number">12.8.</span> <span class="nav-text">Exercise 19</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-20"><span class="nav-number">12.9.</span> <span class="nav-text">Exercise 20</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-21"><span class="nav-number">12.10.</span> <span class="nav-text">Exercise 21</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-22，23"><span class="nav-number">12.11.</span> <span class="nav-text">Exercise 22，23</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-24"><span class="nav-number">12.12.</span> <span class="nav-text">Exercise 24</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-25"><span class="nav-number">12.13.</span> <span class="nav-text">Exercise 25</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-26"><span class="nav-number">12.14.</span> <span class="nav-text">Exercise 26</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沈玮 | Wei SHEN</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>

</br>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div>
  <span id="busuanzi_container_site_pv">
  Visited  <span id="busuanzi_value_site_pv"></span>  times
  </span>

<span id="busuanzi_container_site_pv">&nbsp; &nbsp; | &nbsp; &nbsp;</span>

  <span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span>  Visitors
  </span>
<div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ciaoshen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  





  
  

  
  


</body>
</html>
