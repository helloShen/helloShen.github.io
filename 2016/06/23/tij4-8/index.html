<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="covariant,late binding,polymorphism,state pattern,协变,后期绑定,多态,状态模式," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="摘要这期我复习多态，有很多我想知道的关于多态的话题。有了继承组合多态之后，编程已经变得很有趣。

多态
后期绑定
多态类的初始化过程
继承类字段的非多态性
返回值类型协变
后期绑定可能的逻辑锁死
考虑多态以后的继承策略
State Pattern

什么是多态简单说，多态就是指一个实例，可以被他本身的数据类型引用，也可以赋值给他的基类。书里的原话：

“an object can be used">
<meta property="og:type" content="article">
<meta property="og:title" content="Think in Java 读书笔记：第八章 - 多态">
<meta property="og:url" content="www.ciaoshen.com/2016/06/23/tij4-8/index.html">
<meta property="og:site_name" content="沈玮 | Wei SHEN">
<meta property="og:description" content="摘要这期我复习多态，有很多我想知道的关于多态的话题。有了继承组合多态之后，编程已经变得很有趣。

多态
后期绑定
多态类的初始化过程
继承类字段的非多态性
返回值类型协变
后期绑定可能的逻辑锁死
考虑多态以后的继承策略
State Pattern

什么是多态简单说，多态就是指一个实例，可以被他本身的数据类型引用，也可以赋值给他的基类。书里的原话：

“an object can be used">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-8/oop_8.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-8/constantPool.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-8/jvm2.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-8/methodArea.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-8/dynBanding.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-8/substitution.png">
<meta property="og:image" content="www.ciaoshen.com/uploads/tij4-8/extention.png">
<meta property="og:updated_time" content="2016-06-28T17:49:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Think in Java 读书笔记：第八章 - 多态">
<meta name="twitter:description" content="摘要这期我复习多态，有很多我想知道的关于多态的话题。有了继承组合多态之后，编程已经变得很有趣。

多态
后期绑定
多态类的初始化过程
继承类字段的非多态性
返回值类型协变
后期绑定可能的逻辑锁死
考虑多态以后的继承策略
State Pattern

什么是多态简单说，多态就是指一个实例，可以被他本身的数据类型引用，也可以赋值给他的基类。书里的原话：

“an object can be used">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>



  <meta name="baidu-site-verification" content="3iRy3UFlpa" />


<script>
  (function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>


  <title> Think in Java 读书笔记：第八章 - 多态 | 沈玮 | Wei SHEN </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74473715-1', 'auto');
  ga('send', 'pageview');
</script>







  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">沈玮 | Wei SHEN</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Coder & Designer</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hDG3wYskg4CYKGSXw8x7','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Think in Java 读书笔记：第八章 - 多态
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-06-23T17:15:20-04:00" content="2016-06-23">
              2016-06-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/23/tij4-8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/23/tij4-8/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span id="busuanzi_container_page_pv">&nbsp; |  &nbsp; &nbsp; Viewed <span id="busuanzi_value_page_pv"></span> times</span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/uploads/tij4-8/oop_8.png" alt="oop_8"></p>
<h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>这期我复习多态，有很多我想知道的关于多态的话题。有了继承组合多态之后，编程已经变得很有趣。</p>
<ul>
<li>多态</li>
<li>后期绑定</li>
<li>多态类的初始化过程</li>
<li>继承类字段的非多态性</li>
<li>返回值类型协变</li>
<li>后期绑定可能的逻辑锁死</li>
<li>考虑多态以后的继承策略</li>
<li>State Pattern</li>
</ul>
<h3 id="什么是多态"><a href="#什么是多态" class="headerlink" title="什么是多态"></a>什么是多态</h3><p>简单说，多态就是指一个实例，可以被他本身的数据类型引用，也可以赋值给他的基类。书里的原话：</p>
<blockquote>
<p>“an object can be used as its own type or as an object of its base type”</p>
</blockquote>
<p>典型的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基类：动物</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">bark</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"**"</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//子类：小狗汪汪叫</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">bark</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"WongWong"</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//子类：小猫喵喵叫</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">bark</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"MiuMiu"</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>比如，小猫，小狗是动物的两个子类。我在创建小狗，小猫实例的时候，可以把他们统一赋值给他们的基类：Animal类型。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//某天晚上宠物叫</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OneNight</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">petBark</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//两只宠物</span></span><br><span class="line">		Animal myPet1=<span class="keyword">new</span> dog();</span><br><span class="line">		Animal myPet2=<span class="keyword">new</span> cat();</span><br><span class="line">		<span class="comment">//一起叫</span></span><br><span class="line">		System.out.println(myPet1.bark());</span><br><span class="line">		System.out.println(myPet2.bark());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>输出的结果就是小猫小狗叫WongWong，MiuMiu，而不会调用基类Animal.bark()。</p>
<h3 id="多态背后的原因：后期绑定"><a href="#多态背后的原因：后期绑定" class="headerlink" title="多态背后的原因：后期绑定"></a>多态背后的原因：后期绑定</h3><p>多态特性归功于后期绑定。显然，之前的例子里，myPet1.bark()，如果在OneNight类编译的时候就绑定的话，就会绑定成Animal.bark()。因为明显myPet1和myPet2指向的都是Animal类型。</p>
<p>而后期绑定，是把方法绑定的动作推迟到了程序运行的runtime。等new dog()，new cat()真正实例化完成以后，直接根据实例的类型来决定绑定哪个bark()方法。</p>
<h3 id="后期绑定在编译层面的细节"><a href="#后期绑定在编译层面的细节" class="headerlink" title="后期绑定在编译层面的细节"></a>后期绑定在编译层面的细节</h3><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-polymorph/" target="_blank" rel="external"><strong>《多态在 Java 和 C++ 编程语言中的实现比较》</strong></a>这篇文章详细介绍了JVM是如何实现后期绑定的。我只是对其中的核心内容做简单的转述，方便自己今后查阅。</p>
<p>文章里使用了一个男孩儿，女孩儿的栗子，Person继承自Object类，然后再异化成Boy和Girl。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基类</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"I'm a person."</span>; </span><br><span class="line">	 &#125; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;&#125; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span>&#123;&#125; </span><br><span class="line">	</span><br><span class="line"> &#125; </span><br><span class="line"><span class="comment">//子类男孩儿</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Boy</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"I'm a boy"</span>; </span><br><span class="line">	 &#125; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span>&#123;&#125; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fight</span><span class="params">()</span></span>&#123;&#125; </span><br><span class="line"> &#125; </span><br><span class="line"><span class="comment">//子类女孩儿</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Girl</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"I'm a girl"</span>; </span><br><span class="line">	 &#125; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span>&#123;&#125; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sing</span><span class="params">()</span></span>&#123;&#125; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>然后开个Party类，创建女孩实例，向上转型放在Person类型数据里，然后调用speak()方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Party</span></span>&#123; </span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">happyHour</span><span class="params">()</span></span>&#123; </span><br><span class="line"> 		Person g = <span class="keyword">new</span> Girl(); </span><br><span class="line"> 		g.speak(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后runtime程序就运行Party的happyHour()方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Run &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Party ourParty = <span class="keyword">new</span> Party();</span><br><span class="line">		ourParty.happyHour();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="前期不绑定：编译以后的class文件"><a href="#前期不绑定：编译以后的class文件" class="headerlink" title="前期不绑定：编译以后的class文件"></a>前期不绑定：编译以后的class文件</h4><p>之前已经说了，所谓后期绑定，就是编译的时候不绑定调用方法的数据类型。多态出现在Party类里。编译好的Party.class文件里g.speak()是不会绑定speak()方法的数据类型的。但也不能什么都不留，实际上，在这里编译器会留下的信息是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">invokevirtual Person offset<span class="comment">#15</span></span><br></pre></td></tr></table></figure></p>
<p>翻译过来就是：等着runtime动态调用Person类Index为15的方法。</p>
<p>这里要先科普两个东西。第一，<strong>invokevirtual</strong>是JVM的动态调用指令之一。JVM 的方法调用指令有四个，分别是 invokestatic，invokespecial，invokesvirtual 和 invokeinterface。前两个是静态绑定，后两个是动态绑定的。</p>
<p>第二，<strong>偏移值15</strong>。这是因为编译完的class文件中，类的每个方法都有一个编号Index。很重要的一点是，子类中继承自基类的方法的Index，都和其在基类中的Index相同。比如，toString()是Object类中的Index是100，当他被继承到Person类以后，Index还是100，在Boy和Girl里也是100不变。有了这个重要信息，JVM后期绑定时，无论runtime实例属于基类还是哪个子类，都能准确定位需要绑定的方法。</p>
<p>但实际上JVM编译器在编译好的class文件里，是不会显示地写出一句<strong>invokevirtual Person offset#15</strong>，而是只留下一条密码：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">invokevirtual <span class="comment">#12</span></span><br></pre></td></tr></table></figure></p>
<p>因为编译器为了尽量减少数据的冗余，编译完的信息都是高度结构化的数据，其中很重要的一部分叫做<strong>常量池（constant pool）</strong>。</p>
<p>常量池由一组数据表组成，其中保存的是一个 Java 类引用的一些常量信息，包含一些字符串常量及对于类的符号引用信息等。Java 代码编译生成的类文件中的常量池是静态常量池，当类被载入到虚拟机内部的时候，在内存中产生类的常量池叫运行时常量池。下图展示了常量池中一些重要的表，<br><img src="/uploads/tij4-8/constantPool.png" alt="jvm2"></p>
<p>我们并不需要完全了解常量池的运作，可以把他当做一个黑箱，之前的那条密码中的数字<strong>#12</strong>就是指常量池中索引为12的条目。通过查找这个黑箱，我们就可以翻译为<strong>invokevirtual Person offset#15</strong>这条重要信息。</p>
<h4 id="后期绑定的过程"><a href="#后期绑定的过程" class="headerlink" title="后期绑定的过程"></a>后期绑定的过程</h4><p>多态向上转型前期跳过绑定时留在class文件里的信息我们已经知道了。现在就来看看后期runtime怎么通过这组信息动态绑定到需要调用的数据类型。</p>
<h5 id="JVM内存回顾：方法区"><a href="#JVM内存回顾：方法区" class="headerlink" title="JVM内存回顾：方法区"></a>JVM内存回顾：方法区</h5><p>讲之前，先回顾一下之前<a href="http://www.ciaoshen.com/2016/03/15/javaGC/">《Java垃圾回收初探》</a>里JVM对内存的分配。<br><img src="/uploads/tij4-8/jvm2.png" alt="jvm2"><br>简单讲，就是三大块，</p>
<ul>
<li><strong>逻辑堆</strong>：存放runtime创建的实例</li>
<li><strong>方法区</strong>：runtime加载被调用类的数据，包括字段，方法，以及一些元数据。</li>
<li><strong>堆栈区</strong>：主要就是每个线程所独享的Stack(存对象的引用，以及基本型数据)，Native Method Stack，PC Register区。</li>
</ul>
<p>原先因为讲垃圾回收，主角当然是逻辑堆。现在讲后期绑定，就轮到方法区做主角了。</p>
<h5 id="加载类文件，生成”方法表”"><a href="#加载类文件，生成”方法表”" class="headerlink" title="加载类文件，生成”方法表”"></a>加载类文件，生成”方法表”</h5><p>runtime的时候，根据我们的主线程Run类的main()方法，就需要加载Party类，Person类，Girl类等所有的相关类。</p>
<p>首先，JVM有一个叫<strong>类加载器</strong>（Classloader）的东西，当程序的某一线程运行需要某一个类的时候，这个加载器就会这个类的class文件，产生这个类的方法代码、类变量、成员变量的定义，然后都存放在上面讲的方法区里。</p>
<p>接下来，刚才加载的数据里有很重要的一个，叫<strong>方法表</strong>的东西。比如，Person，Boy，Girl，Object几个类加载到方法区后就各自产生一个方法表，<br><img src="/uploads/tij4-8/methodArea.png" alt="methodArea"></p>
<p>JVM当然不会傻傻地在方法区列出所有类的所有方法，这个方法表的作用就是消除数据冗余。所有方法代码都只存一份，其他都用方法表列出引用。比如Girl 和 Boy 的方法表包含所有方法的引用：</p>
<ul>
<li>各自新定义的方法：toString()，sing()，fight()</li>
<li>继承自基类 Person 的方法：eat() 和 speak()</li>
<li>其余都继承自 Object 的方法（大部分并没有显示出来）</li>
</ul>
<h5 id="动态绑定"><a href="#动态绑定" class="headerlink" title="动态绑定"></a>动态绑定</h5><p><img src="/uploads/tij4-8/dynBanding.png" alt="dynBanding"><br>如上图所示，主线程运行Party类happyHour()方法里的g.speak()的时候，就读到了前期编译的时候留下的信息：<strong>invokevirtual Person offset#15</strong>。</p>
<p>这时候g的实例已经产生，动态调用命令invokevirtual的意思就是等g实例产生以后，找到逻辑堆里g对象实际对应的Girl类，再根据偏移量15找到是Girl.speak()方法。这时候，方法类型绑定完成。</p>
<h3 id="final关键字的真正含义"><a href="#final关键字的真正含义" class="headerlink" title="final关键字的真正含义"></a>final关键字的真正含义</h3><p>与其说是禁止用户修改，不如说是禁止后期绑定，强制在编译class文件时就前期绑定好。</p>
<p>static修饰符，隐含强制final。</p>
<h3 id="多态对”字段”无效"><a href="#多态对”字段”无效" class="headerlink" title="多态对”字段”无效"></a>多态对”字段”无效</h3><p>我们一直是以一种歌功颂德的心态在描述和看待后期绑定和多态的！但事实上多态远非完美！最大的问题在于<strong>多态只对”方法”有效，对”字段”无效</strong>。子类向基类转型后，直接访问字段，返回值是基类的字段值。</p>
<p>下面的这个例子，子类独轮车，继承自基类轮子车。他们都只有一个表示自身种类的字段，和用来显示字段的方法。</p>
<p>显然独轮车重新定义了info字段，改成他自己的名字。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基类：轮子车</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cycle</span> </span>&#123;</span><br><span class="line">    <span class="comment">//field</span></span><br><span class="line">    <span class="keyword">public</span> String info=<span class="string">"I am a cycle!"</span>;</span><br><span class="line">    <span class="comment">//method to show the field</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.info);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类：独轮车</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UniCycle</span> </span>&#123;</span><br><span class="line">	<span class="comment">//field: 企图覆盖基类的info字段</span></span><br><span class="line">    <span class="keyword">public</span> String info=<span class="string">"I am a Unicycle!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但实际上，通过直接访问字段，我们发现向上转型后，输出的仍然是基类轮子车的info。我们期待的多态并没有发生。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建独轮车实例，然后向上转型</span></span><br><span class="line">Cycle cycle1=<span class="keyword">new</span> UniCycle();</span><br><span class="line"><span class="comment">//直接访问字段</span></span><br><span class="line">System.out.println(cycle1.info);	<span class="comment">//output: I am a cycle!</span></span><br></pre></td></tr></table></figure></p>
<p>如果想要访问独轮车的info字段，必须调用显示info字段的getInfo()方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过方法访问字段</span></span><br><span class="line">cycle1.getInfo();	<span class="comment">//output: I am a Unicycle!</span></span><br></pre></td></tr></table></figure></p>
<p>问题到底在哪儿呢？</p>
<h4 id="先重提类的初始化顺序"><a href="#先重提类的初始化顺序" class="headerlink" title="先重提类的初始化顺序"></a>先重提类的初始化顺序</h4><p>问题的原因要追溯到类的初始化过程，前几章已经好几次提过类的初始化顺序，这里为了说清楚这个问题，还是再重提一下。很清楚的是类初始化的过程中都会调用构造函数，无论我们有没有显式的定义构造函数。继承类，在构造自身之前会先构造一个父类，然后再把父类”重写”成自己。所以，子类构造过程要经过下面三个阶段：</p>
<ul>
<li>子类默认递归调用基类构造函数</li>
<li>成员字段和成员函数初始化，优先处理静态成员</li>
<li>最后调用自身构造函数</li>
</ul>
<h4 id="子类字段不具备多态性的原因"><a href="#子类字段不具备多态性的原因" class="headerlink" title="子类字段不具备多态性的原因"></a>子类字段不具备多态性的原因</h4><p>关键问题出在子类调用完基类构造器，创建完父类实例之后，开始要初始化自己成员字段时，如果子类拥有一个和父类的同名字段时，编译器并不会像对待方法那样重写字段，而是同时保有两个同名字段，一个叫this.field，一个叫super.field。对象在方法内调用自身字段，可以显式写明要哪一个，如果不写，也是优先调用this.field。但当向上转型的对象在外部被调用时，默认返回值就是super.field了，因为当前对象本身就是一个基类的对象。</p>
<p>这就造成了多态的小小”失态”：<strong>只有成员方法具有多态性，而成员字段不具备多态性。</strong> 而且，这样的错误编译器是不报错的，很隐蔽。</p>
<p>我们当然可以把子类字段设置成和基类不同的名字，但这样已经失去了多态去耦合的意义。</p>
<p>所以这里又再次证明了把字段设成private这种风格的重要性。关掉所有字段的外部访问权限，而一律使用getField()和setField()代理方法来访问，这样就不会出问题，可以愉快地享受多态带来的好处了。当然，最好也养成习惯，<strong>不要给基类和子类设置同名字段</strong>，不要老想着会重写，记住子类字段是不会覆盖基类字段的。</p>
<p>另外，private和static修饰的内容，不管是字段还是方法，都是不具备多态性的，编译的时候就绑定了。这个比较好理解。</p>
<h4 id="关于”covatiant”协变"><a href="#关于”covatiant”协变" class="headerlink" title="关于”covatiant”协变"></a>关于”covatiant”协变</h4><p>书里提到一种子类里某一方法的返回值，恰巧是基类里同一方法返回值的子类，这种特殊情况。书里给的例子很清楚，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grain</span> </span>&#123;	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Grain"</span>; &#125;&#125;<span class="class"><span class="keyword">class</span> <span class="title">Wheat</span> <span class="keyword">extends</span> <span class="title">Grain</span> </span>&#123;	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="string">"Wheat"</span>; &#125;&#125;<span class="class"><span class="keyword">class</span> <span class="title">Mill</span> </span>&#123;	<span class="function">Grain <span class="title">process</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> Grain(); &#125;&#125;<span class="class"><span class="keyword">class</span> <span class="title">WheatMill</span> <span class="keyword">extends</span> <span class="title">Mill</span> </span>&#123;	<span class="function">Wheat <span class="title">process</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> Wheat(); &#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>情况是这样，WheatMill类继承自Mill基类。问题在于，WheatMill在重写Mill的process()方法的时候，把返回值给改了。原本返回Grain类，现在返回Grain的子类Wheat了。</p>
<p>从程序员的角度，小麦磨坊当然只磨小麦啦，这是合理的。但从编译的角度，返回值不同，就是两个不同的方法，不会被覆盖的。最简单，像下面两个sayHello()函数，一个有返回值，一个没有，在Hello类里，肯定是两个不同的方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//无返回值</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"Hello!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回String</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="string">"Hello"</span>;&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据之前的初始化的顺序，在创建子类WheatMill的时候，先会创建一个基类GrainMill类，里面包含一个Grain process(){}方法。当后来创建子类WheatMill的Wheat process(){}方法的时候，不覆盖Grain process(){}。导致WheatMill()实际含有两个不同的process()方法。</p>
<p>平时用的时候不会有问题，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//小麦磨坊</span></span><br><span class="line">m = <span class="keyword">new</span> WheatMill();</span><br><span class="line"><span class="comment">//麦子</span></span><br><span class="line">w = <span class="keyword">new</span> Wheat();</span><br><span class="line"><span class="comment">//小麦磨坊磨麦子</span>w = m.process();</span><br></pre></td></tr></table></figure></p>
<p>但程序员想用到多态的时候，就出问题了，g = m.process()这一行，明显调用的是基类Grain里的Grain process(){}方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//还是小麦磨坊</span></span><br><span class="line">m = <span class="keyword">new</span> WheatMill();</span><br><span class="line"><span class="comment">//这次要磨别的谷子比如大米了</span>Grain g = <span class="keyword">new</span> Grain();</span><br><span class="line"><span class="comment">//磨出来的会是什么呢？</span>g = m.process();	System.out.println(g);&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以，Java5以前，这段代码磨出的是大米：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Grain</span><br></pre></td></tr></table></figure></p>
<p>但Java5以后的版本，磨出的还是麦子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Wheat</span><br></pre></td></tr></table></figure></p>
<p>因为编译器当看到子类同一方法返回值是基类返回值的子类时，就自动协同转型，认为是同一个方法，子类Wheat process(){}就把基类Grain process(){}覆盖掉了。</p>
<p>这个特性我并不很喜欢，因为虽然用可以用多态了，但实际上破坏了编译的”程序正义”，有点法外开恩的意思。</p>
<h3 id="后期绑定的小缺点"><a href="#后期绑定的小缺点" class="headerlink" title="后期绑定的小缺点"></a>后期绑定的小缺点</h3><p>后期绑定确实很美妙，但实现起来也有他的问题。比较典型的一个例子如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="comment">//member method</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(System.out.println(<span class="string">"Which shape?"</span>)</span>)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//constructor</span></span><br><span class="line">	Shape()&#123;</span><br><span class="line">		draw();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</span><br><span class="line">	<span class="comment">//member method</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(System.out.println(<span class="string">"Turn a round!"</span>)</span>)</span>;</span><br><span class="line">	</span><br><span class="line">	Circle()&#123;</span><br><span class="line">		draw();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DrawShape</span></span>&#123;</span><br><span class="line">	<span class="comment">//main method</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Shape newShape=<span class="keyword">new</span> Circle();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了初始化newShape实例，Circle的构造器先调用基类Shape的构造器，构造器内部调用了成员方法draw()，但问题在于这时候draw()方法显然还没有绑定，因为根据动态绑定原则，光看Shape.draw()这句话是无法知道到底调用Shape.draw()还是Circle.draw()的，一切都要等newShape实例初始化完成，根据他的类型再做定论，但显然这一刻永远等不到，newShape这不正在初始化呢嘛。所以问题就来了，卡住了。</p>
<p>为了解决这种互相依赖锁死的问题，编译器强行规定这时候就不动态绑定，不多态了，直接调用基类Shape的draw()。所以最后的输出会是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Which shape?</span><br><span class="line">Turn a round!</span><br></pre></td></tr></table></figure></p>
<p>这种情况容易产生很隐蔽的bug。所以这种构造函数内调用成员方法的做法不稳妥，Bruce Eckel劝我们尽量少用。最多调用private和final方法。</p>
<h3 id="从多态的角度比较继承和组合"><a href="#从多态的角度比较继承和组合" class="headerlink" title="从多态的角度比较继承和组合"></a>从多态的角度比较继承和组合</h3><p>前几章作者一直更倾向于使用组合。从多态的角度，作者还是坚持尽量多用组合。谨慎使用继承，除非在必要的时候。但多态没有继承，根本玩不起来。所以，一个合理的风格应该是：</p>
<blockquote>
<p><strong>“Use inheritance to express differences in behavior, and fields to express variations in state.”</strong></p>
</blockquote>
<p>这个风格我是有体会的，当一个东西有很多种变体的时候，用基类描述通用行为和参数，然后在不同的子类里描述各自的特殊行为参数，这样用继承是合理的。而且在实例化的时候，有很强的需要用到多态，向上转型，面向通用基类编程。</p>
<p>之前《氏族战争》里，作为一个生产Human的工厂类Clan，我就设计成一个虚拟工厂基类，来描述构造一个人类的通用参数和行为。但下面，每个种族就有自己特殊的技能和遗传特性了，这就是作者原文提到的”参数和行为的差异性”了。”兽族”，”矮人族”，”鼠族”，继承Human的共同属性，然后再各自异化，就显得比较合理。</p>
<p>最后游戏的应用层面，运用多态完全就是面向Human这个虚拟接口编程了，底层哪怕再扩展100个种族，游戏应用层面完全不需要改代码。</p>
<h4 id="State-Pattern"><a href="#State-Pattern" class="headerlink" title="State Pattern"></a>State Pattern</h4><p>为了证明组合比继承更灵活，书里介绍了一个State Pattern。用的是演员的例子。State Pattern的好处，就是可以在runtime随意切换实例的类型。</p>
<p>演员分两类状态，开心的，和不开心的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//演员基类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Actor</span> </span>&#123;	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span> </span>&#123;&#125;&#125;</span><br><span class="line"><span class="comment">//开心演员</span><span class="class"><span class="keyword">class</span> <span class="title">HappyActor</span> <span class="keyword">extends</span> <span class="title">Actor</span> </span>&#123;	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span> </span>&#123; print(<span class="string">"HappyActor"</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//难过演员</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SadActor</span> <span class="keyword">extends</span> <span class="title">Actor</span> </span>&#123;	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">act</span><span class="params">()</span> </span>&#123; print(<span class="string">"SadActor"</span>); &#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>舞台不是继承演员，而是组合，内部包含一个演员，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stage</span> </span>&#123;	<span class="keyword">private</span> Actor actor = <span class="keyword">new</span> HappyActor();	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">()</span> </span>&#123; actor = <span class="keyword">new</span> SadActor(); &#125;	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performPlay</span><span class="params">()</span> </span>&#123; actor.act(); &#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>关键是里面的change()方法，可以临时切换舞台上演员的状态，一会儿是开心演员，一会儿是不开心演员。所谓的灵活就灵活在这儿。</p>
<h4 id="继承是纯替换还是扩展"><a href="#继承是纯替换还是扩展" class="headerlink" title="继承是纯替换还是扩展?"></a>继承是纯替换还是扩展?</h4><p>纯替换，就是指继承的时候，老老实实只重写基类方法，而不添加新方法。<br><img src="/uploads/tij4-8/substitution.png" alt="substitution"><br>但大多数情况，还是会在子类里加一点新方法，就是扩展了。<br><img src="/uploads/tij4-8/extention.png" alt="extention"></p>
<p>作者好像不鼓励扩展。因为，这样做在向下转型的时候不安全。基类强制转换成子类以后，并没有能力执行子类里的扩展方法。Java当然会检查数据类型，错误情况下会抛出ClassCastException异常。</p>
<p>但从设计角度，让兽人偶尔做做正常人类不做的事，比如说吃人，好像也无可厚非。不然也没有一种可以替代的模式，让兽人完成吃人这个动作。</p>
<h3 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h3><h4 id="Exercise-9"><a href="#Exercise-9" class="headerlink" title="Exercise 9"></a>Exercise 9</h4><blockquote>
<p>Create an inheritance hierarchy of Rodent: Mouse, Gerbil, Hamster, etc. In the base class, provide methods that are common to all Rodents, and override these in the derived classes to perform different behaviors depending on the specific type of Rodent. Create an array of Rodent, fill it with different specific types of Rodents, and call your base-class methods to see what happens.</p>
</blockquote>
<h5 id="基类，老鼠：Rodent-java"><a href="#基类，老鼠：Rodent-java" class="headerlink" title="基类，老鼠：Rodent.java"></a>基类，老鼠：Rodent.java</h5><p>鼠类的基类。</p>
<ul>
<li>字段1：不同的名字。</li>
<li>字段2：每一种老鼠都有他们最爱吃的一种食物。</li>
<li>行为1：所有的老鼠吃东西的时候，都会把东西啃坏。</li>
<li>行为2：他们会入侵有食物的地方（接口），寻找他们爱吃的食物，吃一个就跑。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 9 - Polymophism</span><br><span class="line"> *  Rodent is base-class of Mouse, Gerbil and Hamster.</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rodent</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Rodent <span class="title">newRodent</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Rodent();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    *  PUBLIC METHODS</span><br><span class="line">    */</span></span><br><span class="line">    <span class="comment">//each rodent will eat one food and flee</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invade</span><span class="params">(HaveFood granary)</span> </span>&#123;</span><br><span class="line">        String[] foodList=granary.haveFood();</span><br><span class="line">        <span class="keyword">if</span>(foodList!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;foodList.length;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(foodList[i]==<span class="keyword">this</span>.food)&#123;</span><br><span class="line">                    foodList[i]=eat(foodList[i]);</span><br><span class="line">                    System.out.println(foodList[i]);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//chew some part of the food</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">eat</span><span class="params">(String food)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> food+<span class="string">" eaten by "</span>+<span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//Although Java pass the arguments by their references, this method can not change the value of "food"</span></span><br><span class="line">    <span class="comment">//Because 《food=food+"x"》 will create a new copy of string food, thus will not change the original argument</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat2</span><span class="params">(String food)</span></span>&#123;</span><br><span class="line">        food=food+<span class="string">" eaten by "</span>+<span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[Name: "</span>+<span class="keyword">this</span>.name+<span class="string">"], [Food: "</span>+<span class="keyword">this</span>.food+<span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PACKAGE ACCESS CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    Rodent()&#123;</span><br><span class="line">        <span class="keyword">this</span>.name=<span class="string">""</span>;</span><br><span class="line">        <span class="keyword">this</span>.food=<span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PACKAGE ACCESS FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    String food;</span><br><span class="line">    String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(Rodent.newRodent().toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="三种子类：家鼠，沙鼠，仓鼠"><a href="#三种子类：家鼠，沙鼠，仓鼠" class="headerlink" title="三种子类：家鼠，沙鼠，仓鼠"></a>三种子类：家鼠，沙鼠，仓鼠</h5><p>三种不同的鼠类：家鼠，沙鼠，仓鼠，继承鼠类的共同属性和行为。各自的特点是爱吃的东西不同：</p>
<ul>
<li><strong>家鼠</strong>爱吃大米</li>
<li><strong>沙鼠</strong>爱吃麦子</li>
<li><strong>仓鼠</strong>爱吃坚果。</li>
</ul>
<p><strong>Mouse.java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 9 - Polymophism</span><br><span class="line"> *  Mouse is a type of Rodent.</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mouse</span> <span class="keyword">extends</span> <span class="title">Rodent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Rodent <span class="title">newRodent</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Mouse();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Mouse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.name=<span class="string">"mouse"</span>;</span><br><span class="line">        <span class="keyword">super</span>.food=<span class="string">"rice"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(Mouse.newRodent().toString());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Gerbil.java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 9 - Polymophism</span><br><span class="line"> *  Gerbil is a type of Rodent.</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Gerbil</span> <span class="keyword">extends</span> <span class="title">Rodent</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Rodent <span class="title">newRodent</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Gerbil();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Gerbil</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.name=<span class="string">"gerbil"</span>;</span><br><span class="line">        <span class="keyword">super</span>.food=<span class="string">"wheat"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(Gerbil.newRodent().toString());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Hamster.java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 9 - Polymophism</span><br><span class="line"> *  Humster is a type of Rodent.</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hamster</span> <span class="keyword">extends</span> <span class="title">Rodent</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Rodent <span class="title">newRodent</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Hamster();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Hamster</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.name=<span class="string">"hamster"</span>;</span><br><span class="line">        <span class="keyword">super</span>.food=<span class="string">"nut"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PACKAGE ACCESS FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(Hamster.newRodent().toString());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="一类接口：有食物的地方"><a href="#一类接口：有食物的地方" class="headerlink" title="一类接口：有食物的地方"></a>一类接口：有食物的地方</h5><p>有食物的地方只是一种接口，指粮仓，厨房，垃圾箱这类鼠类主要的食物来源地。</p>
<ul>
<li>字段1：主要字段就是一个食物列表</li>
<li>方法1：随机装填食物列表</li>
</ul>
<p><strong>HaveFood.java</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 9 - Polymophism</span><br><span class="line"> *  HaveFood is an interface for the place where we can find food.</span><br><span class="line"> *  Ex: Granary, Kichen, TrashCan</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">HaveFood</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> String[] haveFood(); <span class="comment">//return the food list</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">randomFood</span><span class="params">()</span></span>; <span class="comment">//randomly get a type of food</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkFood</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeFood</span><span class="params">()</span></span>; <span class="comment">//charge the food</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PACKAGE ACCESS CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PACKAGE ACCESS FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    String[] foodList=<span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="有食物的地方：粮仓"><a href="#有食物的地方：粮仓" class="headerlink" title="有食物的地方：粮仓"></a>有食物的地方：粮仓</h5><p>粮仓实现了有食物的地方这一接口。粮仓里可能随机储藏的食物包括：玉米，大米，小麦，面粉，牛奶，坚果，鸡蛋，糖，油。</p>
<p><strong>Granary.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 9 - Polymophism</span><br><span class="line"> *  Granary implements the HaveFood interface</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Granary</span> <span class="keyword">implements</span> <span class="title">HaveFood</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> String[] haveFood()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.foodList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">randomFood</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Random foodRander=<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span> foodId=foodRander.nextInt(<span class="number">9</span>);</span><br><span class="line">        String food=<span class="string">""</span>;</span><br><span class="line">        <span class="keyword">switch</span>(foodId)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                food=<span class="string">"corn"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                food=<span class="string">"wheat"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                food=<span class="string">"rice"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                food=<span class="string">"flour"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                food=<span class="string">"milk"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                food=<span class="string">"nut"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                food=<span class="string">"egg"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                food=<span class="string">"suger"</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                food=<span class="string">"oil"</span>; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> food;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkFood</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String content=<span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="keyword">this</span>.foodList.length;i++)&#123;</span><br><span class="line">            content=content+<span class="string">"["</span>+<span class="keyword">this</span>.foodList[i]+<span class="string">"]"</span>;</span><br><span class="line">            <span class="keyword">if</span>(i!=<span class="keyword">this</span>.foodList.length-<span class="number">1</span>)&#123;</span><br><span class="line">                content+=<span class="string">", "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    <span class="comment">//randomly charge the food</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">storeFood</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="keyword">this</span>.foodList.length;i++)&#123;</span><br><span class="line">            <span class="keyword">this</span>.foodList[i]=randomFood();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PACKAGE ACCESS CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    Granary(<span class="keyword">int</span> size)&#123;</span><br><span class="line">        <span class="keyword">this</span>.foodList=<span class="keyword">new</span> String[size];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PACKAGE ACCESS FIELDS</span><br><span class="line">     */</span></span><br><span class="line">    String[] foodList=<span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Granary testGranary=<span class="keyword">new</span> Granary(<span class="number">10</span>);</span><br><span class="line">        testGranary.storeFood();</span><br><span class="line">        System.out.println(testGranary.checkFood());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="剧本：-老鼠总动员"><a href="#剧本：-老鼠总动员" class="headerlink" title="剧本： 老鼠总动员"></a>剧本： 老鼠总动员</h5><p>剧本很简单，一波10只随机产生的老鼠军团，入侵粮仓。</p>
<p><strong>RodentStory.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 9 - Polymophism</span><br><span class="line"> *  A large of rodents invade a granary.</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RodentStory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC PROXY OF CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHODS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rodentInvadeGranary</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//create a granary</span></span><br><span class="line">        Granary myGranary=<span class="keyword">new</span> Granary(<span class="number">50</span>);</span><br><span class="line">        myGranary.storeFood();</span><br><span class="line">        <span class="comment">//check the granary</span></span><br><span class="line">        System.out.println(myGranary.checkFood());</span><br><span class="line">        <span class="comment">//create a group of rodents</span></span><br><span class="line">        Rodent[] rodentLegion=groupOfRodent(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//rodents invade the granary</span></span><br><span class="line">        <span class="keyword">for</span>(Rodent r: rodentLegion)&#123;</span><br><span class="line">            r.invade(myGranary);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//check the granary</span></span><br><span class="line">        System.out.println(<span class="string">"================================="</span>);</span><br><span class="line">        System.out.println(myGranary.checkFood());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Rodent[] groupOfRodent(<span class="keyword">int</span> number)&#123;</span><br><span class="line">        Rodent[] rodentLegion=<span class="keyword">new</span> Rodent[number];</span><br><span class="line">        Random rodentRander=<span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;number;i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> rodentType=rodentRander.nextInt(<span class="number">3</span>);</span><br><span class="line">            <span class="keyword">switch</span>(rodentType)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    rodentLegion[i]=Mouse.newRodent(); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    rodentLegion[i]=Gerbil.newRodent(); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    rodentLegion[i]=Hamster.newRodent(); <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rodentLegion;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELDS</span><br><span class="line">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     *  <span class="doctag">@param</span> args void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        RodentStory.rodentInvadeGranary();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h5><p>老鼠军团入侵之前，粮仓一片安详。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oil], [rice], [milk], [nut], [wheat], [oil], [nut], [milk], [rice], [nut], [nut], [rice], [wheat], [wheat], [wheat], [corn], [corn], [corn], [oil], [wheat], [flour], [egg], [milk], [rice], [suger], [corn], [nut], [suger], [rice], [egg], [egg], [suger], [suger], [milk], [egg], [nut], [egg], [rice], [corn], [corn], [corn], [flour], [oil], [milk], [oil], [egg], [rice], [rice], [nut], [corn]</span><br></pre></td></tr></table></figure></p>
<p>入侵之后，一片狼藉。特定种类的老鼠只吃特殊种类的食物，凶手们很快就被找到啦。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oil], [rice eaten by mouse], [milk], [nut eaten by hamster], [wheat eaten by gerbil], [oil], [nut eaten by hamster], [milk], [rice eaten by mouse], [nut], [nut], [rice eaten by mouse], [wheat eaten by gerbil], [wheat eaten by gerbil], [wheat eaten by gerbil], [corn], [corn], [corn], [oil], [wheat], [flour], [egg], [milk], [rice eaten by mouse], [suger], [corn], [nut], [suger], [rice], [egg], [egg], [suger], [suger], [milk], [egg], [nut], [egg], [rice], [corn], [corn], [corn], [flour], [oil], [milk], [oil], [egg], [rice], [rice], [nut], [corn]</span><br></pre></td></tr></table></figure></p>
<h5 id="小插曲：Java参数传址，但警惕String"><a href="#小插曲：Java参数传址，但警惕String" class="headerlink" title="小插曲：Java参数传址，但警惕String"></a>小插曲：Java参数传址，但警惕String</h5><p>代码过程中出现一个有意义的小插曲：当时我想让被老鼠咬坏的食物改名字。于是有了下面的方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat2</span><span class="params">(String food)</span></span>&#123;</span><br><span class="line">    food=food+<span class="string">" eaten by "</span>+<span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Java是传址的，我想当然，函数内部会改变参数food的值（表示被老鼠咬过了）。但结果和我想的相反，food不会被改变。</p>
<p>原因参见这个帖子：<a href="http://stackoverflow.com/questions/14916520/java-string-immutable-passed-by-reference-value" target="_blank" rel="external"><strong>StackOverFlow：为什么String当参数无法被改变？</strong></a></p>
<p>问题就在于<strong>a=a+”x”</strong>这个操作具有欺骗性。执行之后会创建另一个新的Object，也就是a完全指向了另一个新对象的地址。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String a = <span class="string">"A"</span>;	<span class="comment">//a指针指向地址x0ffff</span></span><br><span class="line">		<span class="comment">//地址x0ffff存着对象"A"</span></span><br><span class="line">String b = a;	<span class="comment">//b指针也指向地址x0ffff</span></span><br><span class="line"></span><br><span class="line">b = b + <span class="string">"x"</span>;	<span class="comment">//在地址x0bbbb创建对象"Ax"</span></span><br><span class="line">		<span class="comment">//b指针指向地址x0bbbb</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Exercise-10"><a href="#Exercise-10" class="headerlink" title="Exercise 10"></a>Exercise 10</h4><blockquote>
<p>Create a base class with two methods. In the first method, call the second method. Inherit a class and override the second method. Create an object of the derived class, upcast it to the base type, and call the first method. Explain what happens.</p>
</blockquote>
<h5 id="基类：-ExerTenBase-java"><a href="#基类：-ExerTenBase-java" class="headerlink" title="基类： ExerTenBase.java"></a>基类： ExerTenBase.java</h5><ul>
<li><strong>beCalled()</strong>方法打印说：是我基类方法干的。</li>
<li><strong>call()</strong>调用beCalled()。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 10 - Polymophism</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExerTenBase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHOD</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span></span>&#123;beCalled();&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beCalled</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"From Base!"</span>);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELD</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="子类：-ExerTenInherit-java"><a href="#子类：-ExerTenInherit-java" class="headerlink" title="子类： ExerTenInherit.java"></a>子类： ExerTenInherit.java</h5><ul>
<li>重写<strong>beCalled()</strong>方法打印说：是我子类方法干的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> *  Exercise 10 - Polymophism</span><br><span class="line"> *  <span class="doctag">@author</span> wei.shen<span class="doctag">@iro</span>.umontreal.ca</span><br><span class="line"> *  <span class="doctag">@version</span> 1.0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.ciaoshen.thinkinjava.chapter8;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExerTenInherit</span> <span class="keyword">extends</span> <span class="title">ExerTenBase</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PUBLIC METHOD</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beCalled</span><span class="params">()</span></span>&#123;System.out.println(<span class="string">"From Derived!"</span>);&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE CONSTRUCTOR</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  PRIVATE FIELD</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  MAIN</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        ExerTenBase testObject=<span class="keyword">new</span> ExerTenInherit();</span><br><span class="line">        testObject.call();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MacBook-Pro-de-Wei:java Wei$ sh run.sh ExerTenInherit</span><br><span class="line">From Derived!</span><br></pre></td></tr></table></figure>
<p>结果是多态生效，执行了子类的方法。</p>
<p>原因就是因为多态。基类和子类拥有同一个call()函数，但有不同的beCalled()。因为子类实例创建的时候，重写了基类的beCall()方法。然后，后期绑定的时候，找到子类实例，调用了子类重写以后的beCall()方法。</p>
<h4 id="Exercise-12"><a href="#Exercise-12" class="headerlink" title="Exercise 12"></a>Exercise 12</h4><blockquote>
<p>Modify Exercise 9 so that it demonstrates the order of initialization of the base classes and derived classes. Now add member objects to both the base and derived classes and show the order in which their initialization occurs during construction.</p>
</blockquote>
<p>理论上的调用顺序：</p>
<ul>
<li>构造Object类</li>
<li>初始化基类Rodent的fields和methods</li>
<li>Rodent()构造函数</li>
<li>初始化子类的fields和methods</li>
<li>子类构造函数</li>
</ul>
<p>所以我在block{}和构造器里都插入了print语句。</p>
<h5 id="显示各部分构造过程：Rodent-java"><a href="#显示各部分构造过程：Rodent-java" class="headerlink" title="显示各部分构造过程：Rodent.java"></a>显示各部分构造过程：Rodent.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造器</span></span><br><span class="line">   Rodent()&#123;</span><br><span class="line">       System.out.println(<span class="string">"Rodent constructor&#123;&#125;"</span>);</span><br><span class="line">       <span class="keyword">this</span>.name=<span class="string">""</span>;</span><br><span class="line">       <span class="keyword">this</span>.food=<span class="string">""</span>;</span><br><span class="line">       System.out.println(<span class="string">"&gt;&gt;&gt; A Rodent model is prepared!"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//构造器之前会运行block</span></span><br><span class="line">   &#123;</span><br><span class="line">       System.out.println(<span class="string">"Object Constructor&#123;&#125;"</span>);</span><br><span class="line">       System.out.println(<span class="string">"Before Rodent constructor&#123;&#125;: Initialize fields and methods."</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="显示各部分构造过程：Mouse-java"><a href="#显示各部分构造过程：Mouse-java" class="headerlink" title="显示各部分构造过程：Mouse.java"></a>显示各部分构造过程：Mouse.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造器</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">Mouse</span><span class="params">()</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"Mouse constructor&#123;&#125;"</span>);</span><br><span class="line">       <span class="keyword">super</span>.name=<span class="string">"mouse"</span>;</span><br><span class="line">       <span class="keyword">super</span>.food=<span class="string">"rice"</span>;</span><br><span class="line">       System.out.println(<span class="string">"&gt;&gt;&gt; A Mouse join the rodent legion!!!"</span>);</span><br><span class="line">       System.out.println(<span class="string">""</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//构造器之前会运行block</span></span><br><span class="line">   &#123;</span><br><span class="line">       System.out.println(<span class="string">"Before Mouse constructor&#123;&#125;: Initialize fields and methods."</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="显示各部分构造过程：Gerbil-java"><a href="#显示各部分构造过程：Gerbil-java" class="headerlink" title="显示各部分构造过程：Gerbil.java"></a>显示各部分构造过程：Gerbil.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造器</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">Gerbil</span><span class="params">()</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"Gerbil constructor&#123;&#125;"</span>);</span><br><span class="line">       <span class="keyword">super</span>.name=<span class="string">"gerbil"</span>;</span><br><span class="line">       <span class="keyword">super</span>.food=<span class="string">"wheat"</span>;</span><br><span class="line">       System.out.println(<span class="string">"&gt;&gt;&gt; A Gerbil join the rodent legion!!!"</span>);</span><br><span class="line">       System.out.println(<span class="string">""</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//构造器之前会运行block</span></span><br><span class="line">   &#123;</span><br><span class="line">       System.out.println(<span class="string">"Before Gerbil constructor&#123;&#125;: Initialize fields and methods."</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="显示各部分构造过程：Hamster-java"><a href="#显示各部分构造过程：Hamster-java" class="headerlink" title="显示各部分构造过程：Hamster.java"></a>显示各部分构造过程：Hamster.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造器</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">Hamster</span><span class="params">()</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"Hamster constructor&#123;&#125;"</span>);</span><br><span class="line">       <span class="keyword">super</span>.name=<span class="string">"hamster"</span>;</span><br><span class="line">       <span class="keyword">super</span>.food=<span class="string">"nut"</span>;</span><br><span class="line">       System.out.println(<span class="string">"&gt;&gt;&gt; A Hamster join the rodent legion!!!"</span>);</span><br><span class="line">       System.out.println(<span class="string">""</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//构造器之前会运行block</span></span><br><span class="line">   &#123;</span><br><span class="line">       System.out.println(<span class="string">"Before Hamster constructor&#123;&#125;: Initialize fields and methods."</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h5 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h5><p>和理论上的顺序一致：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Gerbil constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Gerbil constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Gerbil join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Gerbil constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Gerbil constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Gerbil join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Gerbil constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Gerbil constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Gerbil join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Gerbil constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Gerbil constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Gerbil join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Mouse constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Mouse constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Mouse join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Gerbil constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Gerbil constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Gerbil join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Mouse constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Mouse constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Mouse join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Hamster constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Hamster constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Hamster join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Mouse constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Mouse constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Mouse join the rodent legion!!!</span><br><span class="line"></span><br><span class="line">Object Constructor&#123;&#125;</span><br><span class="line">Before Rodent constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Rodent constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Rodent model is prepared!</span><br><span class="line">Before Mouse constructor&#123;&#125;: Initialize fields and methods.</span><br><span class="line">Mouse constructor&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; A Mouse join the rodent legion!!!</span><br></pre></td></tr></table></figure>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/covariant/" rel="tag">#covariant</a>
          
            <a href="/tags/late-binding/" rel="tag">#late binding</a>
          
            <a href="/tags/polymorphism/" rel="tag">#polymorphism</a>
          
            <a href="/tags/state-pattern/" rel="tag">#state pattern</a>
          
            <a href="/tags/协变/" rel="tag">#协变</a>
          
            <a href="/tags/后期绑定/" rel="tag">#后期绑定</a>
          
            <a href="/tags/多态/" rel="tag">#多态</a>
          
            <a href="/tags/状态模式/" rel="tag">#状态模式</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/12/reuseExercise/" rel="next" title="重构小练习：小游戏-氏族战争">
                <i class="fa fa-chevron-left"></i> 重构小练习：小游戏-氏族战争
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/28/tij4-9/" rel="prev" title="Think in Java 读书笔记：第九章 - 虚拟类和接口">
                Think in Java 读书笔记：第九章 - 虚拟类和接口 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/06/23/tij4-8/"
           data-title="Think in Java 读书笔记：第八章 - 多态" data-url="www.ciaoshen.com/2016/06/23/tij4-8/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/shenAvatar.jpg"
               alt="沈玮 | Wei SHEN" />
          <p class="site-author-name" itemprop="name">沈玮 | Wei SHEN</p>
          <p class="site-description motion-element" itemprop="description">Coder & Designer</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">26</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">105</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/helloShen" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.douban.com/people/72441576/" target="_blank">
                  
                    <i class="fa fa-globe"></i> DouBan
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/pang-pang-37-37" target="_blank">
                  
                    <i class="fa fa-globe"></i> ZhiHu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#摘要"><span class="nav-number">1.</span> <span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是多态"><span class="nav-number">2.</span> <span class="nav-text">什么是多态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多态背后的原因：后期绑定"><span class="nav-number">3.</span> <span class="nav-text">多态背后的原因：后期绑定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后期绑定在编译层面的细节"><span class="nav-number">4.</span> <span class="nav-text">后期绑定在编译层面的细节</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#前期不绑定：编译以后的class文件"><span class="nav-number">4.1.</span> <span class="nav-text">前期不绑定：编译以后的class文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#后期绑定的过程"><span class="nav-number">4.2.</span> <span class="nav-text">后期绑定的过程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JVM内存回顾：方法区"><span class="nav-number">4.2.1.</span> <span class="nav-text">JVM内存回顾：方法区</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#加载类文件，生成”方法表”"><span class="nav-number">4.2.2.</span> <span class="nav-text">加载类文件，生成”方法表”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#动态绑定"><span class="nav-number">4.2.3.</span> <span class="nav-text">动态绑定</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#final关键字的真正含义"><span class="nav-number">5.</span> <span class="nav-text">final关键字的真正含义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多态对”字段”无效"><span class="nav-number">6.</span> <span class="nav-text">多态对”字段”无效</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#先重提类的初始化顺序"><span class="nav-number">6.1.</span> <span class="nav-text">先重提类的初始化顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子类字段不具备多态性的原因"><span class="nav-number">6.2.</span> <span class="nav-text">子类字段不具备多态性的原因</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于”covatiant”协变"><span class="nav-number">6.3.</span> <span class="nav-text">关于”covatiant”协变</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后期绑定的小缺点"><span class="nav-number">7.</span> <span class="nav-text">后期绑定的小缺点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从多态的角度比较继承和组合"><span class="nav-number">8.</span> <span class="nav-text">从多态的角度比较继承和组合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#State-Pattern"><span class="nav-number">8.1.</span> <span class="nav-text">State Pattern</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#继承是纯替换还是扩展"><span class="nav-number">8.2.</span> <span class="nav-text">继承是纯替换还是扩展?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题"><span class="nav-number">9.</span> <span class="nav-text">练习题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-9"><span class="nav-number">9.1.</span> <span class="nav-text">Exercise 9</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基类，老鼠：Rodent-java"><span class="nav-number">9.1.1.</span> <span class="nav-text">基类，老鼠：Rodent.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三种子类：家鼠，沙鼠，仓鼠"><span class="nav-number">9.1.2.</span> <span class="nav-text">三种子类：家鼠，沙鼠，仓鼠</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#一类接口：有食物的地方"><span class="nav-number">9.1.3.</span> <span class="nav-text">一类接口：有食物的地方</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#有食物的地方：粮仓"><span class="nav-number">9.1.4.</span> <span class="nav-text">有食物的地方：粮仓</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#剧本：-老鼠总动员"><span class="nav-number">9.1.5.</span> <span class="nav-text">剧本： 老鼠总动员</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#结果"><span class="nav-number">9.1.6.</span> <span class="nav-text">结果</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#小插曲：Java参数传址，但警惕String"><span class="nav-number">9.1.7.</span> <span class="nav-text">小插曲：Java参数传址，但警惕String</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-10"><span class="nav-number">9.2.</span> <span class="nav-text">Exercise 10</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基类：-ExerTenBase-java"><span class="nav-number">9.2.1.</span> <span class="nav-text">基类： ExerTenBase.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#子类：-ExerTenInherit-java"><span class="nav-number">9.2.2.</span> <span class="nav-text">子类： ExerTenInherit.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#结果-1"><span class="nav-number">9.2.3.</span> <span class="nav-text">结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exercise-12"><span class="nav-number">9.3.</span> <span class="nav-text">Exercise 12</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#显示各部分构造过程：Rodent-java"><span class="nav-number">9.3.1.</span> <span class="nav-text">显示各部分构造过程：Rodent.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#显示各部分构造过程：Mouse-java"><span class="nav-number">9.3.2.</span> <span class="nav-text">显示各部分构造过程：Mouse.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#显示各部分构造过程：Gerbil-java"><span class="nav-number">9.3.3.</span> <span class="nav-text">显示各部分构造过程：Gerbil.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#显示各部分构造过程：Hamster-java"><span class="nav-number">9.3.4.</span> <span class="nav-text">显示各部分构造过程：Hamster.java</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#结果-2"><span class="nav-number">9.3.5.</span> <span class="nav-text">结果</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沈玮 | Wei SHEN</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>

</br>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div>
  <span id="busuanzi_container_site_pv">
  Visited  <span id="busuanzi_value_site_pv"></span>  times
  </span>

<span id="busuanzi_container_site_pv">&nbsp; &nbsp; | &nbsp; &nbsp;</span>

  <span id="busuanzi_container_site_uv">
  <span id="busuanzi_value_site_uv"></span>  Visitors
  </span>
<div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ciaoshen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  





  
  

  
  


</body>
</html>
